
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?17455640712527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:82:"/bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1745564054580";s:6:"source";s:64:"/bitrix/components/bitrix/app.placement/templates/menu/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.rest");if(!!BX.rest.PlacementMenu){return}BX.rest.PlacementMenu=function(e){BX.rest.PlacementMenu.superclass.constructor.apply(this,arguments)};BX.extend(BX.rest.PlacementMenu,BX.rest.Placement);BX.rest.PlacementMenu.prototype.load=function(e,t,n,a){this.initializeInterface(a);BX.rest.AppLayout.openApplication(t,n,{PLACEMENT_ID:e,PLACEMENT:this.param.placement})};BX.rest.PlacementMenu.prototype.initializeInterface=function(e){var t=top.BX.rest.AppLayout.initializePlacement(this.param.placement);t.prototype.reloadData=function(t,n){e();n()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?174556408054031";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks.Grid");BX.Tasks.GridActions={gridId:null,groupSelector:null,registeredTimerNodes:{},defaultPresetId:"",getTotalCountProceed:false,currentGroupAction:null,restrictions:{project:{limitExceeded:false,limitFeatureId:""}},checkCanMove:function(){return!BX.Tasks.GridInstance||BX.Tasks.GridInstance.checkCanMove()},initPopupBalloon:function(e,t,i){this.groupSelector=null;this.flowSelectorDialog=null;BX.bind(BX(t+"_control"),"click",BX.delegate((function(){if(e==="flow"){if(!this.flowSelectorDialog){this.flowSelectorDialog=new BX.UI.EntitySelector.Dialog({targetNode:BX(t+"_control"),width:350,height:400,multiple:false,dropdownMode:true,enableSearch:true,cacheable:true,entities:[{id:"flow",options:{onlyActive:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onBeforeSelect":e=>{const s=e.getData();BX(t+"_control").value=BX.util.htmlspecialcharsback(s.item.title.text)||"";BX(i+"_control").value=s.item.id||""}},recentTabOptions:{stub:"BX.Tasks.Flow.EmptyStub",stubOptions:{showArrow:true}}});const e=new BX.Tasks.Flow.Footer(this.flowSelectorDialog);this.flowSelectorDialog.setFooter(e.render())}this.flowSelectorDialog.show()}else{if(!this.groupSelector){const s=t+"_control";const r=i+"_control";this.groupSelector=new BX.Tasks.GroupSelector({mode:e,targetNodeId:s,showAvatars:true,enableSearch:true,multiple:false,context:"TASKS"});this.groupSelector.subscribe("itemSelected",(e=>{const{item:t}=e.getData();document.getElementById(s).value=BX.util.htmlspecialcharsback(t.getTitle())||"";document.getElementById(r).value=t.getId()||""}))}this.groupSelector.show()}}),this))},onTagUpdateClick:function(e,t,i){var s=function(t){var i=t.getData().id;if(Number(i)===Number(e)){var s=BX.Main.gridManager.getById(this.gridId).instance.getRows().getById(i);var r=s.getCellById("TAG").querySelector(".main-grid-tag-add");p.setTargetNode(r)}};var r=function(t){var i=t.getData().id;if(Number(i)===Number(e)){p.hide()}};var a=false;var n=function(t){const i=t.getTarget();const s=t.getData().item;s.setSort(1);i.getTab("all").getRootNode().addItem(s);if(a){i.clearSearch();BX.Tasks.GridActions.reloadRow(e);a=false;d();return}var r=i.getSelectedItems().map((function(e){return e.getTitle()}));d();BX.Tasks.GridActions.action("setTags",e,{tags:r})};var o=function(e){var t=e.getTarget();var i=e.getData().query;if(i.trim()!==""){l()}else{d()}};var l=function(){p.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=false;p.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=false};var d=function(){p.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=true;p.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=true};var u=function(e,t){if(p.getContainer().querySelector(`div.${e}`)){return}var i=document.createElement("div");i.className=e;i.innerHTML=`\n\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'  \n\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t${t}\n\t\t\t\t\t</span> \n\t\t\t\t</div>\n\t\t\t`;p.getFooterContainer().before(i)};var c=function(){var t=["click","keydown"];var i=function(t){if(t.type==="keydown"){if(!((t.ctrlKey||t.metaKey)&&t.keyCode===13)){return}}var i=p.getSelectedItems().map((function(e){return e.getTitle()}));var s=p.getTagSelectorQuery();if(s.trim()===""){return}BX.ajax.runComponentAction("bitrix:tasks.task","setTags",{mode:"class",data:{taskId:e,tags:i,newTag:s}}).then((function(e){if(e.data.success){a=true;const t=p.addItem({id:s,entityId:"task-tag",title:s,sort:1,badges:[{title:e.data.owner}]});p.getTab("all").getRootNode().addItem(t);t.select()}else{const t="tasks-list-tag-already-exists-alert";u(t,e.data.error);const i=function(){const e=p.getContainer().querySelector(`div.${t}`);e&&e.remove()};setTimeout(i,2e3)}}))};t.forEach((function(e){if(e==="click"){p.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").addEventListener(e,i)}else{p.getContainer().addEventListener(e,i)}}))};var h=i.getData();if(BX.Tasks.GridActions.tagsAreConverting){var f=new top.BX.UI.Dialogs.MessageBox({title:BX.message("TASKS_TASK_LIST_TAGS_ARE_CONVERTING_TITLE"),message:BX.message("TASKS_TASK_LIST_TAGS_ARE_CONVERTING_TEXT"),buttons:top.BX.UI.Dialogs.MessageBoxButtons.OK,okCaption:BX.message("TASKS_TASK_LIST_TAGS_ARE_CONVERTING_COME_BACK_LATER"),onOk:function(){f.close()}});f.show();return}var g=function(){var e=document.querySelectorAll("td.main-grid-cell.main-grid-cell-left");var t=h.button;e.forEach((function(e){if(e.contains(t)){t=e}}));return t};var p=new BX.UI.EntitySelector.Dialog({id:"tasks-task-list-tag-widget",targetNode:g(),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,entities:[{id:"task-tag",options:{taskId:e,groupId:t}}],searchOptions:{allowCreateItem:false},footer:BX.Tasks.EntitySelector.Footer,footerOptions:{userId:BX.Tasks.GridInstance.userId,taskId:e,groupId:t},clearUnavailableItems:true,events:{onLoad:function(){p.getFooterContainer().style.zIndex=1;BX.addCustomEvent("Tasks.Tasks.Grid:RowRemove",BX.proxy(r,this));c()}.bind(this),onHide:function(){BX.removeCustomEvent("Tasks.Tasks.Grid:RowRemove",BX.proxy(r,this))}.bind(this),onSearch:function(e){o(e)}.bind(this),"Item:onSelect":function(e){n(e)}.bind(this),"Item:onDeselect":function(e){n(e)}.bind(this)}});p.show()},onProjectAddClick:function(e,t){var i=new BX.UI.EntitySelector.Dialog({targetNode:t,enableSearch:true,context:"TASKS_PROJECT",entities:[{id:"project",options:{lockProjectLink:this.restrictions.project.limitExceeded,lockProjectLinkFeatureId:this.restrictions.project.limitFeatureId}}],events:{"Item:onSelect":function(t){var i=t.getData().item;BX.Tasks.GridActions.action("setGroup",e,{groupId:i.getId()});t.getTarget().hide()}}});i.show()},toggleFilter:function(e,t,i){var s=BX.Main.filterManager.getById(this.gridId);if(!s){console.log("BX.Main.filterManager not initialised");return}if(t){this.reduceFilter(s,e,i)}else{this.extendFilter(s,e,i)}},extendFilter:function(e,t,i){if(i){t=this.extendCurrentFieldsValues(e,t)}e.getApi().extendFilter(t)},reduceFilter:function(e,t,i){var s=!i;if(i){t=this.reduceCurrentFieldsValues(e,t);Object.values(t).forEach((function(e){if(BX.Type.isArray(e)&&e.length<=0){s=true}}))}if(!s){e.getApi().extendFilter(t);return}var r=e.getFilterFields();Object.keys(t).forEach((function(t){r.forEach((function(i){if(i.getAttribute("data-name")===t){e.getFields().deleteField(i)}}))}));e.getSearch().apply()},extendCurrentFieldsValues:function(e,t){var i=t;var s=e.getFilterFieldsValues();Object.entries(t).forEach((function([e,t]){var r=s[e];if(BX.Type.isArray(r)&&BX.Type.isArray(t)){t.forEach((function(t){if(!r.includes(t)){r.push(t);i[e]=r}}))}}));return i},reduceCurrentFieldsValues:function(e,t){var i=t;var s=e.getFilterFieldsValues();Object.entries(t).forEach((function([e,t]){var r=s[e];if(BX.Type.isArray(r)&&BX.Type.isArray(t)){t.forEach((function(t){if(r.includes(t)){r.splice(r.indexOf(t),1);i[e]=r}}))}}));return i},filter:function(e){var t=BX.Main.filterManager.getById(this.gridId);if(!t){console.log("BX.Main.filterManager not initialised");return}var i=t.getFilterFieldsValues();var s=t.getApi();Object.keys(e).forEach((function(t){i[t]=e[t]}));s.setFields(i);s.apply()},changePin:function(e,t,i){var s=i.getData();var r=s.button;if(BX.Dom.hasClass(r,BX.Grid.CellActionState.ACTIVE)){BX.Tasks.GridActions.action("unpin",e,{groupId:t});BX.Dom.removeClass(r,BX.Grid.CellActionState.ACTIVE);BX.Dom.addClass(r,BX.Grid.CellActionState.SHOW_BY_HOVER)}else{BX.Tasks.GridActions.action("pin",e,{groupId:t});BX.Dom.addClass(r,BX.Grid.CellActionState.ACTIVE);BX.Dom.removeClass(r,BX.Grid.CellActionState.SHOW_BY_HOVER)}},changeMute:function(e,t){var i=t.getData();var s=i.button;if(BX.Dom.hasClass(s,BX.Grid.CellActionState.ACTIVE)){BX.Tasks.GridActions.action("unmute",e);BX.Dom.removeClass(s,BX.Grid.CellActionState.ACTIVE);BX.Dom.addClass(s,BX.Grid.CellActionState.SHOW_BY_HOVER)}else{BX.Tasks.GridActions.action("mute",e);BX.Dom.addClass(s,BX.Grid.CellActionState.ACTIVE);BX.Dom.removeClass(s,BX.Grid.CellActionState.SHOW_BY_HOVER)}},action:function(e,t,i){switch(e){case"add2Timeman":{if(BX.addTaskToPlanner){BX.addTaskToPlanner(t)}else if(window.top.BX.addTaskToPlanner){window.top.BX.addTaskToPlanner(t)}break}case"copyLink":{if(BX.clipboard.copy(i.copyLink)){BX.UI.Notification.Center.notify({content:BX.message("TASKS_LIST_ACTION_COPY_LINK_NOTIFICATION")})}break}case"complete":case"renew":{BX.ajax.runAction("bitrix:tasks.scrum.task.isScrumTask",{mode:"class",data:{taskId:t}}).then(function(s){if(s.data===true){this.doScrumAction(e,t,i)}else{this.doAction(e,t,i)}}.bind(this));break}case"take":{this.doTakeAction(t,i);break}default:{this.doAction(e,t,i);break}}},doAction:function(e,t,i){i=i||{};i["taskId"]=t;let s="bitrix:tasks.task";if(e==="pin"||e==="unpin"){s="bitrix:tasks.task.list"}if(e==="ping"){BX.UI.Notification.Center.notify({content:BX.message("TASKS_LIST_ACTION_PING_NOTIFICATION")})}return BX.ajax.runComponentAction(s,e,{mode:"class",data:i}).then(function(i){if(e==="complete"){this.sendAnalyticsOnTaskComplete()}if(e==="delete"){BX.Tasks.Util.fireGlobalTaskEvent("DELETE",{ID:t});BX.UI.Notification.Center.notify({content:BX.message("TASKS_DELETE_SUCCESS")})}if(!this.gridId){window.location.href=window.location.href;return false}if(!this.checkCanMove()){this.reloadRow(t)}return true}.bind(this)).catch(function(e){if(e.errors){const t=e.errors[0].message||e.errors[0].MESSAGE;BX.UI.Notification.Center.notify({content:t})}}.bind(this))},doTakeAction:function(e,t){if(!t.allowTimeTracking){this.doAction("TAKE",e,t);return}BX.ajax.runComponentAction("bitrix:tasks.task","getTaskFromTimer",{mode:"class",data:{}}).then((i=>{const s=i.data;if(!s.id){this.doAction("TAKE",e,t);return}let r=BX.Loc.getMessage("TASKS_TASK_CONFIRM_START_TIMER");r=r.replace("{{TITLE}}",BX.type.isNotEmptyString(s.title)?BX.util.htmlspecialchars(s.title):BX.Loc.getMessage("TASKS_UNKNOWN"));BX.Tasks.confirm(r,BX.delegate((function(i){if(i){this.doAction("TAKE",e,t)}}),this),{title:BX.Loc.getMessage("TASKS_TASK_CONFIRM_START_TIMER_TITLE")})}))},doScrumAction(e,t,i){const s=new BX.Promise;let r=null;let a=false;top.BX.loadExt("tasks.scrum.task-status").then(function(){if(!BX.type.isUndefined(top.BX.Tasks.Scrum)&&!BX.type.isUndefined(top.BX.Tasks.Scrum.TaskStatus)){r=new top.BX.Tasks.Scrum.TaskStatus({taskId:t,action:e,performActionOnParentTask:true});r.updateState().then(function(){r.isParentScrumTask().then(function(i){a=i;if(a){s.fulfill()}else{if(e==="complete"){return r.showDod(t).then(function(){s.fulfill()}.bind(this)).catch(function(){s.reject()}.bind(this))}else{s.fulfill()}}}.bind(this))}.bind(this))}else{s.fulfill()}}.bind(this));s.then(function(){this.doAction(e,t,i).then(function(){if(r&&a){r.update()}}.bind(this))}.bind(this))},getTotalCount:function(e,t,i,s){if(this.getTotalCountProceed){return}this.getTotalCountProceed=true;var r=document.getElementById(e+"_row_count_wrapper");this.showCountLoader(r);BX.ajax.runComponentAction("bitrix:tasks.task.list","getTotalCount",{mode:"class",data:{userId:t,groupId:i,parameters:JSON.stringify(s)}}).then(function(e){this.hideCountLoader(r);if(e.data){e.data=typeof e.data=="number"?e.data:0;var t=r.querySelector("a");if(t){t.remove()}r.append(e.data)}this.getTotalCountProceed=false}.bind(this)).catch(function(e){if(e.errors){BX.Tasks.alert(e.errors)}this.getTotalCountProceed=false}.bind(this))},showCountLoader:function(e){var t=e.querySelector("a");if(t){t.style.display="none"}var i=e.querySelector(".tasks-circle-loader-circular");if(i){i.style.display="inline"}},hideCountLoader:function(e){var t=e.querySelector(".tasks-circle-loader-circular");if(t){t.style.display="none"}},reloadRow:function(e){var t=BX.Main.gridManager.getById(this.gridId);if(t&&t.hasOwnProperty("instance")){t.instance.updateRow(e.toString())}},reloadGrid:function(){if(BX.SidePanel&&BX.SidePanel.Instance&&BX.SidePanel.Instance.getLastOpenSlider()){BX.SidePanel.Instance.destroy(BX.SidePanel.Instance.getLastOpenSlider().getUrl())}var e=BX.Main.filterManager.getById(this.gridId);if(!e){console.log("BX.Main.filterManager not initialised");return}e.getSearch().apply()},setCurrentGroupAction:function(e){this.currentGroupAction=e},processBeforeGroupActionSent:function(){if(this.currentGroupAction==="ping"){BX.UI.Notification.Center.notify({content:BX.message("TASKS_LIST_GROUP_ACTION_PING_NOTIFICATION")})}this.currentGroupAction=null},confirmGroupAction:function(e){const t=BX.Main.gridManager.getById(e).instance.getActionsPanel().getValues();const i=BX.Main.gridManager.getById(e).instance.getActionKey();const s=t[i];const r=this.preparationDataGroupAction(e,s);if(!s.includes("none")&&(r.forAll!=="N"||r.selectedIds.length)){const e=new BX.Tasks.GroupActionsStepper({action:s,data:r,requestStopFunction(){BX.Tasks.GridActions.processBeforeGroupActionSent();BX.Tasks.GridActions.reloadGrid()}});e.showDialog()}},preparationDataGroupAction(e,t){const i=BX.Main.gridManager.getById(e).instance.getRows().getSelectedIds();const s=BX.Main.gridManager.getById(e).instance.getActionsPanel().getValues();const r={forAll:s[`action_all_rows_${e}`]?"Y":"N",selectedIds:i,groupId:Number(this.groupId)};if(t==="setdeadline"){r.setDeadline=s.ACTION_SET_DEADLINE_from}if(t==="adjustdeadline"||t==="substractdeadline"){r.num=Number(s.num);r.type=s.type}if(t==="settaskcontrol"){r.taskControlState=s.value}if(t==="setresponsible"){r.responsibleId=Number(s.responsibleId)}if(t==="setoriginator"){r.originatorId=Number(s.originatorId)}if(t==="addauditor"){r.auditorId=Number(s.auditorId)}if(t==="addaccomplice"){r.accompliceId=Number(s.accompliceId)}if(t==="setgroup"){r.specifyGroupId=Number(s.groupId)}if(t==="setflow"){r.flowId=Number(s.flowId)}return r},onDeadlineChangeClick:function(e,t,i,s){i=i||(new Date).getDate();t=t||s.getData().button;var r=BX.calendar({node:t,value:i,form:"",bTime:true,currentTime:Math.round(new Date/1e3)-(new Date).getTimezoneOffset()*60,bHideTimebar:true,bCompatibility:true,bCategoryTimeVisibilityOption:"tasks.bx.calendar.deadline",bTimeVisibility:BX.Tasks.GridInstance?BX.Tasks.GridInstance.calendarSettings.deadlineTimeVisibility==="Y":false,callback_after:function(e,t){return function(i){var s=new Date;if(i.getTime()>s.getTime()){BX.onCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",[])}var r=BX.CJSTask.ajaxUrl;BX.CJSTask.ajaxUrl=BX.CJSTask.ajaxUrl+"&_CODE=CHANGE_DEADLINE&viewType=VIEW_MODE_LIST";BX.CJSTask.batchOperations([{operation:"CTaskItem::update()",taskData:{ID:t,DEADLINE:BX.calendar.ValueToString(i,true)}}],{callbackOnSuccess:function(e,t,i){return function(e){}}(e,t,i)});BX.CJSTask.ajaxUrl=r;if(!BX.Tasks.GridActions.checkCanMove()){BX.Tasks.GridActions.reloadRow(t)}}}(t,e)});var a=BX.Tasks.TourGuideController.getGuide();if(a&&a.setCalendarPopup&&a.isCorrectRow(e)&&!a.getIsStopped()){a.setCalendarPopup(r.popup)}},onMarkChangeClick:function(e,t,i){BX.TaskGradePopup.show(e,t,i,{events:{onPopupClose:this.__onGradePopupClose,onPopupChange:this.__onGradePopupChange}});BX.addClass(t,"task-grade-and-report-selected");return false},__onGradePopupClose:function(){BX.removeClass(this.bindElement,"task-grade-and-report-selected")},__onGradePopupChange:function(){this.bindElement.className="task-grade-and-report"+(this.listValue!=="NULL"?" task-grade-"+this.listItem.className:"")+(this.report?" task-in-report":"");this.bindElement.title=BX.message("TASKS_MARK")+": "+this.listItem.name;BX.Tasks.GridActions.action("legacyUpdate",this.id,{data:{MARK:this.listValue==="NULL"?"":this.listValue}})},renderTimerItem:function(e,t,i,s,r,a){a=a||false;var n="task-timer-inner";var o=t+r;if(s){n=n+" task-timer-play"}else if(a){n=n+" task-timer-pause"}else{n=n+" task-timer-clock"}if(i>0&&o>i){n=n+" task-timer-overdue"}return BX.create("span",{props:{id:"task-timer-block-"+e,className:"task-timer-block"},events:{click:function(e,t){return function(){if(BX.hasClass(BX("task-timer-block-inner-"+e),"task-timer-play")){BX.TasksTimerManager.stop(e)}else if(t){BX.TasksTimerManager.start(e)}}}(e,a)},children:[BX.create("span",{props:{id:"task-timer-block-inner-"+e,className:n},children:[BX.create("span",{props:{className:"task-timer-icon"}}),BX.create("span",{props:{id:"task-timer-block-value-"+e,className:"task-timer-time"},text:BX.Tasks.GridActions.renderTimerTimes(o,i,s)})]})]})},renderTimerTimes:function(e,t,i){var s="";var r=!!i;s=BX.Tasks.GridActions.renderSecondsToHHMMSS(e,r);if(t>0){s=s+" / "+BX.Tasks.GridActions.renderSecondsToHHMMSS(t,false)}return s},renderSecondsToHHMMSS:function(e,t){var i="00";var s="";var r="";var a=0;if(e>0){s+=Math.floor(e/3600);r+=Math.floor(e/60)%60}else{s+=Math.ceil(e/3600);r+=Math.ceil(e/60)%60}var n=i.substring(0,2-s.length)+s+":"+i.substring(0,2-r.length)+r;if(t){a=""+e%60;n=n+":"+i.substring(0,2-a.length)+a}return n},redrawTimerNode:function(e,t,i,s,r,a){var n=BX("task-timer-block-"+e);var o=BX.Tasks.GridActions.renderTimerItem(e,t,i,s,r,a);if(n){n.parentNode.replaceChild(o,n)}else{var l=BX("task-timer-block-container-"+e);if(l){if(this.registeredTimerNodes[e]){BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}l.appendChild(o);if(BX("task-timer-block-"+e)){this.registeredTimerNodes[e]=this.__getTimerChangeCallback(e);BX.addCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}}}},removeTimerNode:function(e){if(this.registeredTimerNodes[e]){BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}var t=BX("task-timer-block-"+e);if(t){t.parentNode.removeChild(t)}},__getTimerChangeCallback:function(e){var t=null;return function(i){var s=null;var r=null;if(i.action==="refresh_daemon_event"){if(Number(i.taskId)!==Number(e)){if(t==="paused"){return}s="paused"}else{if(t!=="playing"){s="playing"}BX.Tasks.GridActions.redrawTimerNode(i.taskId,i.data.TASK.TIME_SPENT_IN_LOGS,i.data.TASK.TIME_ESTIMATE,true,i.data.TIMER.RUN_TIME,true)}}else if(i.action==="start_timer"){if(Number(e)===Number(i.taskId)&&i.timerData&&Number(e)===Number(i.timerData.TASK_ID)){s="playing"}else{s="paused"}}else if(i.action==="stop_timer"){if(Number(e)==Number(i.taskId)){s="paused"}}else if(i.action==="init_timer_data"){if(i.data.TIMER){if(Number(i.data.TIMER.TASK_ID)===Number(e)){s=i.data.TIMER.TIMER_STARTED_AT>0?"playing":"paused"}else if(i.data.TIMER.TASK_ID>0){s="paused"}}}if(s!==null){r=BX("task-timer-block-inner-"+e);if(r&&!BX.hasClass(r,"task-timer-clock")){if(s==="paused"){BX.removeClass(r,"task-timer-play");BX.addClass(r,"task-timer-pause")}else if(s==="playing"){BX.removeClass(r,"task-timer-pause");BX.addClass(r,"task-timer-play")}}t=s}}},sendAnalyticsOnTaskComplete:function(){const e={tool:"tasks",category:"task_operations",event:"task_complete",type:"task",c_section:BX.Tasks.Grid.groupId?"project":"tasks",c_element:"context_menu",c_sub_section:"list"};if(BX.UI.Analytics){BX.UI.Analytics.sendData(e)}else{BX.Runtime.loadExtension("ui.analytics").then((()=>{BX.UI.Analytics.sendData(e)}))}},onStageSwitch:function(e,t,i){const s=BX.Main.gridManager.getById(this.gridId).instance.getRows().getById(e);const r=s.getCellById("STAGE_ID");if(!r){return}const a=r.querySelector(".tasks-grid-stage-container");if(!a){return}if(this.isCurrentStageSelected(a,t)){return}let n=true;let o="";for(const e of a.children){const s=parseInt(e.dataset.stageId);if(n){e.style.backgroundColor=i}else{e.style.backgroundColor=""}e.dataset.selected="N";if(s===parseInt(t)){n=false;o=e.title;e.dataset.selected="Y"}}if(o!==""){const e=r.querySelector(".tasks-grid-stage-title");if(e){e.innerHTML=o}}this.saveStage(e,t)},isCurrentStageSelected:function(e,t){for(const i of e.children){const e=i.dataset.selected;const s=parseInt(i.dataset.stageId);if(s===t&&e==="Y"){return true}}return false},saveStage:function(e,t){return BX.ajax.runComponentAction("bitrix:tasks.task","moveStage",{mode:"class",data:{taskId:e,stageId:t}}).then((i=>{if(i&&i.errors&&i.errors.length===0){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE_STAGE",{ID:e,STAGE_ID:t},{STAY_AT_PAGE:true},{id:e})}}))}};BX((function(){"use strict";BX.Tasks.Grid=function(e){this.grid=BX.Main.gridManager.getInstanceById(e.gridId);this.userId=Number(e.userId);this.ownerId=Number(e.ownerId);this.groupId=Number(e.groupId);this.lastGroupId=Number(e.lastGroupId);this.sorting=e.sorting;this.groupByGroups=e.groupByGroups==="true";this.groupBySubTasks=e.groupBySubTasks==="true";this.arParams=e.arParams;this.migrationBarOptions=e.migrationBarOptions;this.calendarSettings=e.calendarSettings?e.calendarSettings:{};this.taskList=new Map;this.comments=new Map;this.actions={taskAdd:"taskAdd",taskUpdate:"taskUpdate",taskRemove:"taskRemove",commentAdd:"commentAdd",pinChanged:"pinChanged"};this.classes={highlighted:"task-list-item-highlighted",pinned:"tasks-list-item-pinned"};this.isMyList=this.userId===this.ownerId;this.canPin=this.isMyList;this.updateCanMove();this.init(e)};BX.Tasks.Grid.prototype={init:function(e){this.subscribeToPull();this.bindEvents();this.fillTaskListItems(e.taskList);this.colorPinnedRows();this.showStub();if(e.arParams&&e.arParams["LAZY_LOAD"]){this.grid.reload()}},subscribeToPull(){new BX.Pull.QueueManager({moduleId:"tasks",userId:this.ownerId,config:{loadItemsDelay:1e3},additionalData:{},events:{onBeforePull:e=>{const{pullData:{command:t,params:i}}=e.data;const s={comment_read_all:this.onPullCommentReadAll,project_read_all:this.onPullProjectReadAll,tag_changed:this.onPullTagChanged};if(s[t]){s[t].apply(this,[i])}},onPull:e=>{const{pullData:{command:t,params:i},promises:s}=e.data;const r=(new BX.Tasks.ControllerTaskEvent).resolveIdByParam(t,i);if(r>0){s.push(Promise.resolve({data:{id:r,action:t,actionParams:i}}))}}},callbacks:{onBeforeQueueExecute:e=>Promise.resolve(),onQueueExecute:e=>new Promise(((t,i)=>{BX.Tasks.ControllerTask.getRepository(e,this).then((i=>{this.executePullQueue(this.getPullItems(e,i)).then((()=>{t()}))}))})),onReload:()=>{}}})},getPullItems(e,t){const i=[];e.forEach((e=>{i.push({...e,...{repository:t}})}));return i},executePullQueue(e){const t={comment_add:this.onPullCommentAdd,task_add:this.onPullTaskAdd,task_update:this.onPullTaskUpdate,task_view:this.onPullTaskView,task_remove:this.onPullTaskRemove,user_option_changed:this.onUserOptionChanged};return new Promise(((i,s)=>{e.forEach((e=>{const{data:{action:i,actionParams:s},repository:r}=e;if(t[i]){t[i].apply(this,[s,r])}}));i()}))},bindEvents:function(){BX.addCustomEvent("BX.Main.grid:sort",function(e,t){if(t===this.grid){this.sorting.sort={};this.sorting.sort[e.sort_by]=e.sort_order}}.bind(this));BX.addCustomEvent("BX.Main.grid:paramsUpdated",function(){this.updateCanMove();this.colorPinnedRows();this.clearTaskListItems();this.clearLastGroupId();this.getRows().map((function(e){return e.getId()})).filter((function(e){return e!=="template_0"})).forEach(function(e){this.addTaskListItem(e);this.updateLastGroupId(e)}.bind(this));this.showStub()}.bind(this));BX.addCustomEvent("BX.Tasks.Filter.group",function(e,t,i){if(this.getGrid()===e){this[t]=i}}.bind(this))},updateCanMove:function(){this.canMove=this.isMyList&&this.sorting.sort.ACTIVITY_DATE&&this.sorting.sort.ACTIVITY_DATE==="desc"&&!this.groupByGroups&&!this.groupBySubTasks},checkCanMove:function(){return this.canMove},colorPinnedRows:function(){this.getRows().forEach(function(e){var t=e.getNode();this.getIsPinned(e.getId())?BX.addClass(t,this.classes.pinned):BX.removeClass(t,this.classes.pinned)}.bind(this))},getIsPinned:function(e){return this.isRowExist(e)&&this.getRowNodeById(e).querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active")instanceof HTMLElement},onPullTaskView:function(e,t){if(this.userId!==Number(e.USER_ID)||!this.isRowExist(e.TASK_ID.toString())){return}this.updateActivityDateCellForTask(e.TASK_ID,{},{},t)},onPullCommentReadAll:function(e){this.onReadAll(e)},onPullProjectReadAll:function(e){this.onReadAll(e)},onReadAll:function(e){if(this.userId!==Number(e.USER_ID)){return}this.updateActivityDateCellForTasksFromLocalStorage()},updateActivityDateCellForTasksHandler:function(e,t,i){Object.keys(e.data).forEach(function(t){if(this.isRowExist(t)){var s=this.getRowById(t);var r=e.data[t];if(s.getCellById("ACTIVITY_DATE")){s.setCellsContent({ACTIVITY_DATE:r.content.ACTIVITY_DATE})}s.setActions(r.actions);s.setCellActions(r.cellActions);s.setCounters(r.counters);if(i.highlightRow===true){this.highlightGridRow(t)}}}.bind(this))},updateActivityDateCellForTasksFromLocalStorage:function(){var e={};var t=this.getTaskListItems();var i={taskIds:t,arParams:this.arParams};BX.ajax.runComponentAction("bitrix:tasks.task.list","getGridRows",{mode:"class",data:i}).then(function(e){this.updateActivityDateCellForTasksHandler(e,{},{})}.bind(this)).catch(function(e){if(e.errors){BX.Tasks.alert(e.errors)}}.bind(this))},updateActivityDateCellForTask:function(e,t,i,s){i=i||{};var r=s.collectionGrid.get(BX.Text.toNumber(e));if(r[e]){this.updateActivityDateCellForTasksHandler({data:r},t,i)}else{BX.Tasks.alert("grid.id is empty"+e)}},onPullCommentAdd:function(e,t){if(this.checkComment(e)){var i=e.entityXmlId.split("_");if(i){this.checkTask(i[1],{action:this.actions.commentAdd,userId:Number(e.ownerId),isCompleteComment:e.isCompleteComment},t)}}},onPullTagChanged:function(e){if(this.groupId===0){this.getGrid().reload()}if(this.groupId!==0&&e.groupId===this.groupId){this.getGrid().reload()}var t=BX.UI.EntitySelector.Dialog.getById("tasks-task-list-tag-widget");t&&t.hide()},onPullTaskAdd:function(e,t){if(e.params.addCommentExists===false){this.checkTask(e.TASK_ID.toString(),{action:this.actions.taskAdd,userId:this.ownerId},t)}},onPullTaskUpdate:function(e,t){var i=BX.UI.EntitySelector.Dialog.getById("tasks-task-list-tag-widget");if(i){if("GROUP_ID"in e.AFTER&&e.AFTER.GROUP_ID!==e.BEFORE.GROUP_ID){i.hide()}}if(e.params.updateCommentExists===false){this.checkTask(e.TASK_ID.toString(),{action:this.actions.taskUpdate,userId:this.ownerId},t)}else if(e.params.removedParticipants.includes(this.ownerId.toString())&&(!this.groupId||this.groupId!==Number(e.AFTER.GROUP_ID))){this.removeItem(e.TASK_ID.toString())}},onPullTaskRemove:function(e,t){if(this.checkCanMove()){this.removeItem(e.TASK_ID.toString())}},onUserOptionChanged:function(e,t){if(!this.checkCanMove()||this.userId!==Number(e.USER_ID)){return}var i=e.TASK_ID.toString();switch(Number(e.OPTION)){case 1:this.updateActivityDateCellForTask(i,{},{},t);break;case 2:case 3:if(this.canPin){this.placeToNearTasks(i,null,{action:this.actions.pinChanged},t)}break;default:break}},placeToNearTasks:function(e,t,i,s){var r=s.collectionNear.get(BX.Text.toNumber(e));if(r[e]){var a=r[e];var n=a.before;var o=a.after;if(n&&this.isRowExist(n)||o&&this.isRowExist(o)){var l={before:n,after:o};Object.keys(i).forEach((function(e){l[e]=i[e]}));this.updateItem(e,t,l,s)}else{this.removeItem(e)}}},checkComment:function(e){var t=e.entityXmlId.split("_");if(!t){return false}var i=t[0];var s=t[1];if(i!=="TASK"){return false}if(!this.comments.has(s)){this.comments.set(s,new Set)}var r=this.comments.get(s);var a=e.messageId;var n=e.participants.map((function(e){return e.toString()}));if(r.has(a)){return false}r.add(a);return n.includes(this.userId.toString())||this.groupId===e.groupId},checkTask:function(e,t,i){t=t||{};var s=null;var r=i.collection;var a=i.collectionSiftThroughFilter;if(t.isCompleteComment===false||t.userId===this.userId){s=a.getById(e)}else{s=r.getById(e)}this.onCheckTaskSuccess(s,e,t,i)},onCheckTaskSuccess:function(e,t,i,s){if(BX.Type.isNil(e)){this.removeItem(t);return}var r=e.getFields();if(this.isRowExist(t)){if(this.checkCanMove()){i.canMoveRow=i.action!==this.actions.taskUpdate;this.updateGridRow(t,r,i,s)}else{if(i.action===this.actions.commentAdd){if(i.isCompleteComment===true){this.getGrid().updateRow(t)}else{var a={};a[t]=r;this.updateActivityDateCellForTask(t,a,{highlightRow:true},s)}}else if(i.action===this.actions.taskUpdate){this.getGrid().updateRow(t)}}}else if(this.checkCanMove()){if(i.action===this.actions.taskUpdate){this.placeToNearTasks(t,r,i,s)}else{this.updateItem(t,r,i,s)}}},updateItem:function(e,t,i,s){t=t||null;i=i||{};if(!this.hasTaskListItem(e)){this.addTaskListItem(e);this.addGridRow(e,t,i,s)}else{this.updateGridRow(e,t,i,s)}},addGridRow:function(e,t,i,s){var r=s.collectionGrid.get(BX.Text.toNumber(e));if(r[e]){var t=r[e];var a={id:e,columns:t.content,actions:t.actions,cellActions:t.cellActions,counters:t.counters};var n=this.getGridMoveRows(e,i);if(n.rowAfter){a.insertAfter=n.rowAfter}else if(n.rowBefore){a.insertBefore=n.rowBefore}else{a.append=true}if(this.taskList.size>this.getPageNumber()*this.getPageSize()){var o=this.getLastRowId();this.removeTaskListItem(o);BX.remove(this.getRowNodeById(o));this.showMoreButton()}this.hideStub();this.getRealtime().addRow(a);this.colorPinnedRows()}else{BX.Tasks.alert("grid.id is empty"+e)}const l=this.getGrid().containerId;const d=document.getElementById(l+"_check_all");if(d&&d.disabled===true){d.disabled=false}},updateGridRow:function(e,t,i,s){if(!this.isRowExist(e)){return}var r=s.collectionGrid.get(BX.Text.toNumber(e));if(r[e]){var t=r[e];var a=this.getRowById(e);a.setCellsContent(t.content);a.setActions(t.actions);a.setCellActions(t.cellActions);a.setCounters(t.counters);if(i.canMoveRow!==false){this.getGrid().getRows().reset();var n=this.getGridMoveRows(e,i);this.moveRow(e,n.rowAfter)}this.highlightGridRow(e).then(function(){this.colorPinnedRows()}.bind(this));this.getGrid().bindOnRowEvents();BX.onCustomEvent("Tasks.Tasks.Grid:RowUpdate",{id:e})}else{BX.Tasks.alert("grid.id is empty"+e)}},removeItem:function(e){if(!this.isRowExist(e)){return}this.removeTaskListItem(e);this.getGrid().removeRow(e);BX.onCustomEvent("Tasks.Tasks.Grid:RowRemove",{id:e})},getGridMoveRows:function(e,t){var i;var s;switch(t.action){case this.actions.pinChanged:case this.actions.taskUpdate:i=t.before;s=t.after;break;default:i=this.getFirstRowId();s=this.getIsPinned(e)?0:this.getLastPinnedRowId();break}return{rowBefore:i,rowAfter:s}},moveRow:function(e,t){if(t){this.getGrid().getRows().insertAfter(e,t)}else{const t=this.getGrid().getRows().getBodyFirstChild();this.getGrid().getRows().insertBefore(e,t.getId())}},getLastPinnedRowId:function(){var e=Object.values(this.getRows()).filter(function(e){return this.getIsPinned(e.getId())}.bind(this));var t=Object.keys(e);if(t.length>0){return e[t[t.length-1]].getId()}return 0},getFirstRowId:function(){var e=this.getRows();return e.length?this.getRowProp(e[0],"id"):0},getLastRowId:function(){var e=this.getGrid().getRows().getBodyLastChild();return e?this.getRowProp(e,"id"):0},highlightGridRow:function(e){var t=new BX.Promise;if(!this.isRowExist(e)){t.reject();return t}var i=this.getRowNodeById(e);var s=BX.hasClass(i,this.classes.pinned);if(s){BX.removeClass(i,this.classes.pinned)}BX.addClass(i,this.classes.highlighted);setTimeout(function(){BX.removeClass(i,this.classes.highlighted);if(s){BX.addClass(i,this.classes.pinned)}t.fulfill()}.bind(this),900);return t},getGrid:function(){return this.grid},getRows:function(){return this.getGrid().getRows().getBodyChild()},isRowExist:function(e){return this.getRowById(e)!==null},getRowById:function(e){return this.getGrid().getRows().getById(e)},getRowNodeById:function(e){return this.getRowById(e).getNode()},getRowProp:function(e,t){return BX.data(e.getNode(),t)},setRowProp:function(e,t,i){e.getNode().setAttribute("data-"+t,i)},getPageNumber:function(){var e=1;var t=this.getGrid().getContainer().querySelector(".main-grid-nav-panel");if(t){var i=t.querySelector(".main-ui-pagination");if(i){var s=i.querySelector(".main-ui-pagination-active");if(s){e=s.innerText}}}return e},getPageSize:function(){var e=50;var t=BX(this.getGrid().getContainerId()+"_"+this.getGrid().settings.get("pageSizeId"));if(t){e=BX.data(t,"value")}return e},getRealtime:function(){return this.getGrid().getRealtime()},showStub:function(){},hideStub:function(){this.getGrid().hideEmptyStub()},showMoreButton:function(){this.getGrid().getMoreButton().getNode().style.display="inline-block"},hideMoreButton:function(){this.getGrid().getMoreButton().getNode().style.display="none"},getTaskListItems:function(){return Array.from(this.taskList.keys())},hasTaskListItem:function(e){return this.taskList.has(parseInt(e,10))},addTaskListItem:function(e){this.taskList.set(parseInt(e,10))},removeTaskListItem:function(e){this.taskList.delete(parseInt(e,10))},fillTaskListItems:function(e){Object.keys(e).forEach(function(e){this.addTaskListItem(e)}.bind(this))},clearTaskListItems:function(){this.taskList.clear()},updateLastGroupId:function(e){if(e.indexOf("group_")===0){this.lastGroupId=Number(e.replace("group_",""))}},clearLastGroupId:function(){this.lastGroupId=0}};BX.addCustomEvent("tasksTaskEvent",BX.delegate((function(e,t){if(!BX.Tasks.GridActions.checkCanMove()){BX.Tasks.GridActions.reloadGrid()}}),this));BX.addCustomEvent("SidePanel.Slider:onCloseByEsc",(function(e){var t=/tasks\/task\/edit/;var i=e.getSlider().getUrl();if(t.test(i)&&!confirm(BX.message("TASKS_CLOSE_PAGE_CONFIRM"))){e.denyAction()}}));BX.addCustomEvent("BX.Main.Filter:apply",function(e,t,i){var s=window.location.href;var r=new URL(s);var a=r.searchParams.get("F_STATE");var n=a==="sR"?s.replace("&F_STATE=sR",""):s;window.history.replaceState(null,null,n)}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",(function(e,t){var i=BX.Main.filterManager.getById(BX.Tasks.GridActions.gridId);if(!i){console.log("BX.Main.filterManager not initialised");return}var s={preset_id:BX.Tasks.GridActions.defaultPresetId,additional:{ROLEID:e==="view_all"?0:e}};var r=i.getApi();r.setFilter(s,{ROLE_TYPE:"TASKS_ROLE_TYPE_"+(e===""?"view_all":e)});window.history.pushState(null,null,t)}));BX.addCustomEvent("Tasks.Toolbar:onItem",(function(e){var t=e.getData();if(t.counter&&t.counter.filter){t.counter.filter.toggleByField({PROBLEM:t.counter.filterValue})}}));BX.Tasks.Grid.Sorting=function(e){this.grid=BX.Main.gridManager.getInstanceById(e.gridId);this.currentGroupId=e.currentGroupId;this.treeMode=e.treeMode;BX.message(e.messages);this.init();BX.addCustomEvent("BX.Main.grid:rowDragStart",this.handleRowDragStart.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragMove",this.handleRowDragMove.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragEnd",this.handleRowDragEnd.bind(this))};BX.Tasks.Grid.Sorting.prototype={init:function(){this.dragRow=null;this.targetRow=null;this.error=false;this.targetTask=null;this.before=true;this.newGroup=null;this.newParentId=null},getGrid:function(){return this.grid},getRow:function(e){return this.getGrid().getRows().get(e)},getRowById:function(e){return this.getGrid().getRows().getById(e)},getRows:function(){return this.getGrid().getRows().getBodyChild()},getRowProp:function(e,t){return e.getNode().dataset[t]},getRowType:function(e){return this.getRowProp(e,"type")},getRowGroupId:function(e){return this.getRowProp(e,"groupId")},handleRowDragStart:function(e,t){this.dragRow=this.getRow(e.getDragItem())},handleRowDragMove:function(e,t){this.targetRow=this.getRow(e.getTargetItem());var i=this.targetRow?this.getRowType(this.targetRow):null;this.newParentId=null;this.error=false;var s=null;if(i==="task"){var r=this.targetRow.getParentId();if(r!==this.dragRow.getParentId()){this.newParentId=r}s=this.getGroupByRow(this.targetRow);this.targetTask=this.targetRow;this.before=true}else{if(i==="group"){s=this.getPreviousGroup(this.targetRow)}else{s=this.getLastGroup()}var a=this.getClosestTask(this.targetRow);this.targetTask=a.task;this.before=a.before}this.newGroup=s.id!==this.getGroupByRow(this.dragRow).id?s:null;if(i==="task"&&this.isChildOf(this.targetTask,this.dragRow)){this.error=true}else if(this.newGroup&&this.newGroup.id>0&&(this.getRowProp(this.dragRow,"canEdit")==="false"||!this.newGroup.canCreateTasks)){this.error=true}else if(this.newParentId!==null&&this.getRowProp(this.dragRow,"canEdit")==="false"){this.error=true}this.error?e.disallowMove(BX.message("TASKS_ACCESS_DENIED")):e.allowMove()},handleRowDragEnd:function(e,t){if(!this.error){this.save()}this.init()},save:function(){var e=this.dragRow.getId();var t=this.targetTask?this.targetTask.getId():null;if(e===t){return}var i={sourceId:e,targetId:t,before:this.before?1:0,currentGroupId:this.currentGroupId};if(this.newGroup!==null){i.newGroupId=this.newGroup.id;this.setGroupId(this.dragRow,i.newGroupId)}if(this.newParentId!==null&&this.treeMode){i.newParentId=this.newParentId}BX.ajax.runComponentAction("bitrix:tasks.task.list","sortTask",{mode:"class",data:{data:i}}).then(function(e){}.bind(this)).catch(function(e){if(e.errors){BX.Tasks.alert(e.errors)}}.bind(this))},getParentRow:function(e){return this.getRowById(e.getParentId())},isChildOf:function(e,t){var i=this.getParentRow(e);while(i!==null){if(i===t){return true}i=this.getParentRow(i)}return false},getGroupById:function(e){var t=this.getRows();for(var i=0;i<t.length;i++){var s=t[i];if(this.getRowType(s)==="group"&&this.getRowGroupId(s)===String(e)){return this.getGroupByRow(s)}}return this.getDefaultProject()},setGroupId:function(e,t){e.getDataset().groupId=t;var i=e.getChildren();for(var s=0;s<i.length;s++){this.setGroupId(i[s],t)}},getDefaultProject:function(){return{id:"0",canCreateTasks:true}},getGroupByRow:function(e){if(this.getRowType(e)==="group"){return{id:this.getRowGroupId(e),canCreateTasks:this.getRowProp(e,"canCreateTasks")==="true"}}else{return this.getGroupById(this.getRowGroupId(e))}},getLastGroup:function(){var e=null;var t=this.getRows();for(var i=t.length-1;i>=0;i--){var s=t[i];if(this.getRowType(s)==="group"){return this.getGroupByRow(s)}}return this.getDefaultProject()},getPreviousGroup:function(e){var t=null;var i=this.getRows();var s=false;for(var r=i.length-1;r>=0;r--){var a=i[r];if(e===a){s=true;continue}if(s&&this.getRowType(a)==="group"){return this.getGroupByRow(a)}}return this.getDefaultProject()},getClosestTask:function(e){var t=this.getRows();var i=e?e.getIndex()-1:t.length;for(var s=i-1;s>=0;s--){if(this.getRowType(t[s])==="task"&&t[s].getDepth()==="0"){return{task:t[s],before:false}}}for(s=i+1;s<t.length;s++){if(this.getRowType(t[s])==="task"&&t[s].getDepth()==="0"){return{task:t[s],before:true}}}return{task:null,before:true}}};BX.Tasks.TourGuideController=function(e){this.tours=e.tours;this.guide=null;this.initGuides(e)};BX.Tasks.TourGuideController.prototype={initGuides:function(e){var t=this.tours.firstGridTaskCreation;var i=this.tours.expiredTasksDeadlineChange;if(t.show){this.guide=new BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide(e)}else if(i.show||i.backgroundCheck){this.guide=new BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide(e)}},getGuide:function(){return this.guide}};BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide=function(e){this.tour=e.tours.firstGridTaskCreation;this.popupData=this.tour.popupData;this.start()};BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide.prototype={start:function(){var e=BX("tasks-buttonAdd");if(!e){return}e.href=BX.Uri.addParam(e.href,{FIRST_GRID_TASK_CREATION_TOUR_GUIDE:"Y"});this.guide=new BX.UI.Tour.Guide({steps:[{target:e,title:this.popupData[0].title,text:this.popupData[0].text}],onEvents:true});BX.addCustomEvent("UI.Tour.Guide:onFinish",function(t){if(t.getData().guide===this.guide){e.href=BX.Uri.removeParam(e.href,["FIRST_GRID_TASK_CREATION_TOUR_GUIDE"])}}.bind(this));this.showNextStep()},showNextStep:function(){setTimeout(function(){this.guide.showNextStep()}.bind(this),500)}};BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide=function(e){this.userId=e.userId;this.tour=e.tours.expiredTasksDeadlineChange;this.popupData=this.tour.popupData;this.counterToCheck=this.tour.counterToCheck;this.rowId=0;this.calendarPopup=0;this.isStopped=false;this.viewMode="grid";this.ajaxActionPrefix="tasks.tourguide.expiredtasksdeadlinechange.";this.grid=BX.Main.gridManager.getInstanceById(e.gridId);if(this.tour.show){this.start()}else if(this.tour.backgroundCheck){this.isPullListening=true}this.bindEvents()};BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide.prototype={bindEvents:function(){var e={user_counter:this.onUserCounter.bind(this)};BX.addCustomEvent("onPullEvent-tasks",function(t,i){if(e[t]){e[t].apply(this,[i])}}.bind(this));BX.addCustomEvent("UI.Tour.Guide:onPopupClose",function(){this.stop()}.bind(this));BX.addCustomEvent("UI.Tour.Guide:onFinish",function(e){if(e.getData().guide===this.guide&&this.getCurrentStepIndex()===0){BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onExpiredCounterGridReloaded,this))}}.bind(this))},onUserCounter:function(e){if(!this.isPullListening||this.userId!==Number(e.userId)){return}var t=Number(e[0].view_role_originator.expired)+Number(e[0].view_role_responsible.expired);if(t>=Number(this.counterToCheck)){this.isPullListening=false;BX.ajax.runAction(this.ajaxActionPrefix+"proceed",{analyticsLabel:{viewMode:this.viewMode}}).then(function(e){if(e.data){this.start()}}.bind(this))}},start:function(){this.guide=new BX.UI.Tour.Guide({steps:[{target:document.querySelector(".tasks-counters--item-counter"),title:this.popupData[0].title,text:this.popupData[0].text}],onEvents:true});this.showNextStep()},markShowedStep:function(e){BX.ajax.runAction(this.ajaxActionPrefix+"markShowedStep",{analyticsLabel:{viewMode:this.viewMode,step:e}})},onExpiredCounterGridReloaded:function(){BX.removeCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onExpiredCounterGridReloaded,this));var e=null;Object.values(this.grid.getRows().getBodyChild()).forEach(function(t){if(!this.rowId&&t.getNode().querySelector(".ui-label.ui-label-danger.ui-label-fill.ui-label-link")){this.rowId=t.getId();e=t.getNode().querySelector(".ui-label.ui-label-danger.ui-label-fill.ui-label-link")}}.bind(this));if(this.rowId>0&&e){this.guide.steps.push(new BX.UI.Tour.Step({target:e,title:this.popupData[1].title,text:this.popupData[1].text}));this.showNextStep()}},setCalendarPopup:function(e){if(!this.calendarPopup&&this.getCurrentStepIndex()===1){this.calendarPopup=e;BX.addCustomEvent(this.calendarPopup,"onPopupAfterClose",BX.proxy(this.onCalendarPopupClose,this))}},onCalendarPopupClose:function(){BX.removeCustomEvent(this.calendarPopup,"onPopupAfterClose",BX.proxy(this.onCalendarPopupClose,this));setTimeout(function(){BX.removeCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",BX.proxy(this.onDeadlineSave,this))}.bind(this),500);BX.addCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",BX.proxy(this.onDeadlineSave,this))},onDeadlineSave:function(){BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onGridReloaded,this))},onGridReloaded:function(){BX.removeCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onGridReloaded,this));if(this.grid.getRows().getById(this.rowId)===null){this.guide.steps.push(new BX.UI.Tour.Step({title:this.popupData[2].title,text:this.popupData[2].text,buttons:[{text:this.popupData[2].buttons[0],event:function(){this.stop()}.bind(this)}]}));this.showNextStep()}},showNextStep:function(){if(this.isStopped){return}setTimeout(function(){this.guide.showNextStep();this.markShowedStep(this.getCurrentStepIndex())}.bind(this),500)},getCurrentStepIndex:function(){return this.guide.currentStepIndex},isCorrectRow:function(e){return Number(this.rowId)===Number(e)},getIsStopped:function(){return this.isStopped},stop:function(){this.isStopped=true;this.guide.close()}}}));this.BX=this.BX||{};(function(e,t,i,s,r){"use strict";var a=Object.freeze({COMMENT_ADD:"comment_add",TASK_ADD:"task_add",TASK_UPDATE:"task_update",TASK_VIEW:"task_view",TASK_REMOVE:"task_remove",USER_OPTION_CHANGED:"user_option_changed"});function n(e,t){l(e,t);t.add(e)}function o(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function d(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var u=new WeakMap;var c=new WeakSet;var h=new WeakSet;var f=new WeakSet;var g=function(){function e(){var i;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);n(this,f);n(this,h);n(this,c);o(this,u,{writable:true,value:0});s=t.Type.isPlainObject(s)?s:{};babelHelpers.classPrivateFieldSet(this,u,(i=s.timeout)!==null&&i!==void 0?i:100)}babelHelpers.createClass(e,[{key:"resolveIdByParam",value:function e(t,i){if(d(this,h,m).call(this,t)){var s=d(this,c,p).call(this,t,i);if(s>0){return s}else{throw new Error("Index is not resolved for command: "+t)}}}},{key:"intervalEmitByParams",value:function e(t){var i=this;return new Promise((function(e,s){var r=Object.values(t);var a=setInterval((function(){if(r.length===0){clearTimeout(a);e();return}var t=r.shift();var s=t.poolItem,n=t.repository;d(i,f,T).call(i,s,n)}),babelHelpers.classPrivateFieldGet(i,u))}))}},{key:"batchEmitByParams",value:function e(t){var i=this;return new Promise((function(e,s){var r=Object.values(t);for(var a in r){if(!r.hasOwnProperty(a)){continue}var n=r[a];var o=n.poolItem,l=n.repository;d(i,f,T).call(i,o,l)}e()}))}}]);return e}();function p(e,t){var i="";if([a.TASK_ADD,a.TASK_UPDATE,a.TASK_REMOVE,a.TASK_VIEW,a.USER_OPTION_CHANGED].includes(e)){i=t.TASK_ID}else{i=t.taskId}return i}function m(e){var t=Object.values(a);return t.includes(e)}function T(e,t){var i=Object.values(e),s=babelHelpers.slicedToArray(i,1),a=s[0];var n=Object.keys(e),o=babelHelpers.slicedToArray(n,1),l=o[0];var d=a.fields.params;r.EventEmitter.emit("BX.Tasks.Event:onEmit",{command:l,params:d,repository:t})}function v(e,t){I(e,t);t.add(e)}function k(e,t,i){I(e,t);t.set(e,i)}function I(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function b(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var w=new WeakMap;var B=new WeakSet;var C=new WeakSet;var S=new WeakSet;var y=function(){function e(){babelHelpers.classCallCheck(this,e);v(this,S);v(this,C);v(this,B);k(this,w,{writable:true,value:{collectionNear:new Map,collectionGrid:new Map,collection:new i.TaskCollection,collectionSiftThroughFilter:new i.TaskCollection}})}babelHelpers.createClass(e,[{key:"callByFilter",value:function e(i,s){var r=this;return new Promise((function(e,a){var n=b(r,B,X).call(r,i,s);var o=b(r,C,A).call(r,n);if(Object.keys(o).length>0){BX.rest.callBatch(o,(function(i){Object.keys(o).forEach((function(e){var s;var a=(s=i[e])!==null&&s!==void 0?s:null;if(t.Type.isNull(a)===false){var n=a.answer.result;b(r,S,E).call(r,e,n)}}));e(r.get())}))}}))}},{key:"get",value:function e(){return babelHelpers.classPrivateFieldGet(this,w)}}]);return e}();function X(e,s){var r={};var a={collectionSiftThroughFilter:{cmd:"tasks.task.list",filter:{id:e.id,returnAccess:e.returnAccess,siftThroughFilter:{userId:e.siftThroughFilter.userId,groupId:e.siftThroughFilter.groupId}}},collection:{cmd:"tasks.task.list",filter:{id:e.id,returnAccess:e.returnAccess}},collectionGrid:{cmd:"tasks.task.getGridRows",filter:{id:e.id},params:s.arParams},collectionNear:{cmd:"tasks.task.getNearTasks",filter:{id:e.id},navigation:s.navigation,params:s.arParams}};Object.keys(a).forEach((function(e){var s=a[e];switch(e){case"collection":case"collectionSiftThroughFilter":r[e]={cmd:s.cmd,param:i.TaskCollection.internalize(s.filter)};break;case"collectionGrid":case"collectionNear":r[e]={cmd:s.cmd,param:{taskIds:t.Type.isArrayFilled(s.filter.id)?s.filter.id:[s.filter.id],navigation:t.Type.isUndefined(s===null||s===void 0?void 0:s.navigation)?null:s.navigation,arParams:s.params}};break}}));return r}function A(e){var t={};Object.keys(e).forEach((function(i){var s=e[i];t[i]=[s.cmd,s.param]}));return t}function E(e,i){var s=this;if(Object.keys(babelHelpers.classPrivateFieldGet(this,w)).includes(e)){switch(e){case"collection":case"collectionSiftThroughFilter":babelHelpers.classPrivateFieldGet(this,w)[e].init(i.tasks);break;case"collectionNear":case"collectionGrid":Object.keys(i).forEach((function(r){if(r>0){var a={};a[r]=i[r];babelHelpers.classPrivateFieldGet(s,w)[e].set(t.Text.toNumber(r),a)}}));break}}}var G=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getRepository",value:function e(t,i){var s=new y;var r=[];t.forEach((function(e){r.push(e.data.id)}));return new Promise((function(e,t){s.callByFilter({id:r,returnAccess:"Y",siftThroughFilter:{userId:i.ownerId,groupId:i.groupId}},{arParams:i.arParams,navigation:{pageNumber:i.getPageNumber(),pageSize:i.getPageSize()}}).then((function(){e(s.get())}))}))}},{key:"getRepositoryByCollectionPushEventsAsync",value:function t(i,s){var a=new y;var n=e.getValuesId(i);return new Promise((function(e,t){a.callByFilter({id:n,returnAccess:"Y",siftThroughFilter:{userId:s.ownerId,groupId:s.groupId}},{arParams:s.arParams,navigation:{pageNumber:s.getPageNumber(),pageSize:s.getPageSize()}}).then((function(){var t=a.get();r.EventEmitter.emit("BX.Tasks.ControllerTask:onGetRepository",{params:{items:i,repository:t}});e()}))}))}},{key:"emitByCollectionEventImitterEventsAsync",value:function t(i){var s=new g;var r=e.prepareByPoolToEmit(i);return new Promise((function(e,t){s.batchEmitByParams(r).then((function(){return e()}))}))}},{key:"getValuesId",value:function e(t){var i=[];try{for(var s in t){if(!t.hasOwnProperty(s)){continue}var r=Object.keys(t[s]),a=babelHelpers.slicedToArray(r,1),n=a[0];var o=Object.values(t[s]),l=babelHelpers.slicedToArray(o,1),d=l[0];var u=d.fields.id;if(i.includes(u)===false){i.push(u)}}}catch(e){}return i}},{key:"getItemsByType",value:function e(t,i){var s=[];Object.keys(t).forEach((function(e){var r=t[e];if(Object.keys(r)[0]===i){s.push(r[i].fields)}}));return s}},{key:"sortedById",value:function e(t){t.sort((function(e,t){return e.id>t.id?1:t.id<t.id?-1:0}));return t}},{key:"prepareByPoolToEmit",value:function t(i){var s=[];var r=a.USER_OPTION_CHANGED;Object.keys(i).forEach((function(t){var a=i[t];var n=a["default"].fields.params.items;var o=a["default"].fields.params.repository;var l={};var d=e.sortedById(e.getItemsByType(n,r));Object.keys(n).forEach((function(e){if(Object.keys(n[e])[0]===r){l=babelHelpers.defineProperty({},r,{fields:d.shift()})}else{l=n[e]}s.push({poolItem:l,repository:o})}))}));return s}}]);return e}();function R(e,t,i){P(e,t);t.set(e,i)}function P(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _=new WeakMap;var D=new WeakMap;var N=new WeakMap;var M=new WeakMap;var x=new WeakMap;var F=new WeakMap;var O=new WeakMap;var H=new WeakMap;var L=new WeakMap;var U=new WeakMap;var j=function(e){babelHelpers.inherits(t,e);function t(e){var i;var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));R(babelHelpers.assertThisInitialized(s),_,{writable:true,value:[{id:"user",options:{emailUsers:true,inviteGuestLink:true},filters:[{id:"tasks.distributedUserDataFilter"}]},{id:"department",options:{selectMode:"usersOnly"}}]});R(babelHelpers.assertThisInitialized(s),D,{writable:true,value:[{id:"project",filters:[{id:"tasks.projectDataFilter"}]}]});R(babelHelpers.assertThisInitialized(s),N,{writable:true,value:(i={},babelHelpers.defineProperty(i,"user",babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_)),babelHelpers.defineProperty(i,"group",babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),D)),babelHelpers.defineProperty(i,"project",babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),D)),babelHelpers.defineProperty(i,"all",babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_).concat(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),D))),i)});R(babelHelpers.assertThisInitialized(s),M,{writable:true,value:"user"});R(babelHelpers.assertThisInitialized(s),x,{writable:true,value:null});R(babelHelpers.assertThisInitialized(s),F,{writable:true,value:false});R(babelHelpers.assertThisInitialized(s),O,{writable:true,value:false});R(babelHelpers.assertThisInitialized(s),H,{writable:true,value:false});R(babelHelpers.assertThisInitialized(s),L,{writable:true,value:"TASKS"});R(babelHelpers.assertThisInitialized(s),U,{writable:true,value:null});s.setEventNamespace("BX.Tasks.GroupSelector");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),M,e.mode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),x,e.targetNodeId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),F,e.showAvatars);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),O,e.enableSearch);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),H,e.multiple);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),L,e.context);return s}babelHelpers.createClass(t,[{key:"getDialog",value:function e(){var t=this;if(!babelHelpers.classPrivateFieldGet(this,U)){babelHelpers.classPrivateFieldSet(this,U,new s.Dialog({targetNode:document.getElementById(babelHelpers.classPrivateFieldGet(this,x)),showAvatars:babelHelpers.classPrivateFieldGet(this,F),enableSearch:babelHelpers.classPrivateFieldGet(this,O),multiple:babelHelpers.classPrivateFieldGet(this,H),context:babelHelpers.classPrivateFieldGet(this,L),entities:babelHelpers.classPrivateFieldGet(this,N)[babelHelpers.classPrivateFieldGet(this,M)],events:{"Item:onSelect":function e(i){return t.onItemSelect(i)}}}))}return babelHelpers.classPrivateFieldGet(this,U)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,U)===null){this.getDialog()}babelHelpers.classPrivateFieldGet(this,U).show()}},{key:"onItemSelect",value:function e(t){this.emit("itemSelected",t.getData())}}]);return t}(r.EventEmitter);e.Action=a;e.ControllerTask=G;e.ControllerTaskEvent=g;e.ControllerTaskRepository=y;e.GroupSelector=j})(this.BX.Tasks=this.BX.Tasks||{},BX,BX.Tasks.TaskModel,BX.UI.EntitySelector,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js?17455640807131";s:6:"source";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.js";s:3:"min";s:76:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.map.js";}"*/
BX.namespace("Tasks.Component");BX.Tasks.Component.IframePopup=function(t){this.opts=BX.merge({},t);this.vars={skip:true,callbacks:{},resizeInterval:false,resizeLock:true,lastHeight:false};this.sys={scope:null};this.instances={win:false};this.ctrls={iframe:null,wrap:null,close:null};this.setCallbacks(t.callbacks);this.bindEvents()};BX.mergeEx(BX.Tasks.Component.IframePopup.prototype,{add:function(t){this.edit(0,t)},view:function(t){this.open("view",t)},edit:function(t,e){this.open("edit",t,{urlParams:e})},open:function(t,e,n){e=parseInt(e);if(isNaN(e)||e<0){return}n=n||{};var i=this.getPath(t,e,n.urlParams);if(BX.Bitrix24&&"PageSlider"in BX.Bitrix24){BX.Bitrix24.PageSlider.open(i)}else{this.toggleLoading(true);this.getWindow().show();this.getWindow().setBindElement(this.getWindowCoords());this.getWindow().adjustPosition();this.getIframe().src=i}},close:function(){this.getWindow().close()},bindEvents:function(){BX.bind(window,"resize",BX.throttle(this.onWindowResize,100,this));BX.addCustomEvent(window,"tasksIframeLoad",this.onContentLoaded.bind(this));BX.addCustomEvent(window,"tasksIframeUnload",this.onContentUnLoaded.bind(this))},bindInnerDocumentEvents:function(){var t=this.getContentDocument();if(t){BX.bind(t,"keydown",this.onInnerDocumentKeyDown.bind(this))}},getIframe:function(){if(this.ctrls.iframe===null){this.ctrls.iframe=BX.create("iframe",{attrs:{scrolling:"no",frameBorder:"0"}})}return this.ctrls.iframe},getWindow:function(){if(this.instances.win===false){this.instances.win=new BX.PopupWindow("tasks-iframe-popup",{top:0,left:0},{autoHide:false,closeByEsc:true,content:this.getIframeContainer(),overlay:true,lightShadow:false,closeIcon:true,contentNoPaddings:true,draggable:false,titleBar:true,events:{onPopupClose:BX.delegate(this.onPopupClose,this),onPopupShow:BX.delegate(this.onPopupOpen,this)}});this.ctrls.close=BX.create("div",{props:{className:"hidden"},attrs:{id:"tasks-popup-close",title:BX.message("TASKS_TIP_COMPONENT_TEMPLATE_CLOSE_WINDOW")},events:{click:BX.delegate(this.onCloseClicked,this)},children:[BX.create("span")]});BX.insertAfter(this.ctrls.close,BX("popup-window-overlay-tasks-iframe-popup"))}return this.instances.win},setTitle:function(t,e){var n="";if(t!=false){t=t=="view"?"VIEW":"EDIT";e=parseInt(e);if(isNaN(e)||e<=0){e=0}if(t=="EDIT"&&e==0){t="NEW"}n=BX.message("TASKS_TIP_COMPONENT_TEMPLATE_"+t+"_TASK_TITLE");if(e>0){n=n.replace("#TASK_ID#",e)}}this.getWindow().setTitleBar(n)},getPath:function(t,e,n){t=t=="view"?"view":"edit";e=parseInt(e);var i=this.opts.pathToTasks.replace("#task_id#",e);i=i+(i.indexOf("?")==-1?"?":"&")+"IFRAME=Y";if(BX.type.isPlainObject(n)){for(var s in n){i+="&"+s+"="+encodeURIComponent(n[s])}}i=i.replace("#action#",t);return i},getWindowCoords:function(){var t=BX.pos(this.getIframeContainer()).width;var e=BX.GetWindowSize().innerWidth;var n=BX.GetWindowScrollPos().scrollTop;return{left:Math.floor((e-t)/2),top:30+n}},getContentDocument:function(){var t=this.getIframe();var e=null;if(t.contentDocument){e=t.contentDocument}if(t.contentWindow){e=t.contentWindow.document}return e&&e.body?e:null},getIframeContainer:function(){if(this.ctrls.wrap===null){this.ctrls.wrap=this.ctrls.wrap=BX.create("div",{props:{className:"tasks-iframe-wrap loading fixedHeight"},attrs:{id:"tasks-iframe-wrap"},children:[this.getIframe()]})}return this.ctrls.wrap},getContentContainer:function(){var t=this.getContentDocument();if(t){return t.getElementById("tasks-content-outer")}return null},onCloseClicked:function(){this.getWindow().close()},onTaskGlobalEvent:function(t,e){if(BX.type.isNotEmptyString(t)){var n=t.toString().toUpperCase();e=e||{};e.task=e.task||{};e.options=e.options||{};var i=[];var s=parseInt(e.task.ID);if(n=="DELETE"&&!isNaN(s)&&s){i.push(e.task.ID)}else if(n=="ADD"||n=="UPDATE"){if(e.taskUgly){i.push(e.taskUgly)}else{return}}if(!e.options.STAY_AT_PAGE){this.close()}if(typeof this.vars.callbacks[n]!="undefined"&&this.vars.callbacks[n]!==false){var o=this.vars.callbacks[n];if(BX.type.isString(o)){o=BX.Tasks.deReference(o,window)}if(BX.type.isFunction(o)){o.apply(window,i)}}}},onContentLoaded:function(){var t=this.getContentDocument();if(t){var e=this.parseUrl(t.location.pathname);if(e){this.setTitle(e.action,e.taskId)}}this.toggleLoading(false);this.startMonitorContent();this.bindInnerDocumentEvents()},onContentUnLoaded:function(){this.setTitle(false);this.stopMonitorContent()},onPopupOpen:function(){BX.toggleClass(this.ctrls.close,"hidden");this.toggleLoading(true)},onPopupClose:function(){BX.toggleClass(this.ctrls.close,"hidden");this.lockHeight();this.stopMonitorContent();this.toggleLoading(true);this.vars.lastHeight=false;this.getIframe().src="about:blank"},onWindowResize:function(){if(this.getWindow().isShown()){this.getWindow().setBindElement(this.getWindowCoords())}},onContentResize:function(){if(this.getWindow().isShown()&&!this.vars.resizeLock){var t=this.getContentDocument();if(t){var e=this.getContentContainer();if(e){var n=e.offsetHeight;if(n!=this.vars.lastHeight){this.getIframeContainer().style.height=n+"px";this.vars.lastHeight=n;this.unLockHeight()}this.getWindow().popupContainer.style.marginBottom="40px";this.getWindow().resizeOverlay()}}}},onInnerDocumentKeyDown:function(t){if(BX.Tasks.Util.isEsc(t)){this.close()}},lockHeight:function(){this.toggleFixedHeight(true)},unLockHeight:function(){this.toggleFixedHeight(false)},toggleFixedHeight:function(t){BX[t?"addClass":"removeClass"](this.getIframeContainer(),"fixedHeight")},toggleLoading:function(t){BX[t?"addClass":"removeClass"](this.getIframeContainer(),"loading")},stopMonitorContent:function(){this.vars.resizeLock=true},startMonitorContent:function(){this.vars.resizeLock=false;if(this.vars.resizeInterval===false){this.vars.resizeInterval=setInterval(BX.proxy(this.onContentResize,this),300)}},setCallbacks:function(t){if(BX.type.isPlainObject(t)){BX.Tasks.each(t,function(t,e){if(t=="#SHOW_ADDED_TASK_DETAIL#"){return}if(t!==false&&(BX.type.isFunction(t)||BX.type.isNotEmptyString(t))){this.vars.callbacks[e]=t}}.bind(this))}},showCreateForm:function(){this.add()},parseUrl:function(t){var e=this.opts.pathToTasks;if(e){e=e.toLowerCase().replace("#action#","(view|edit){1}").replace("#task_id#","(\\d+)");var n=t.match(new RegExp(e));if(n&&BX.type.isArray(n)){var i=n[1]||false;var s=n[2]||false;if(i&&s){return{action:i,taskId:parseInt(s)}}}}return null},onTaskAdded:function(t,e,n,i,s){BX.onCustomEvent(this,"onTaskAdded",[t,e,n,i,s])},onTaskChanged:function(t,e,n,i,s){BX.onCustomEvent(this,"onTaskChanged",[t,e,n,i,s])},onTaskDeleted:function(t){BX.onCustomEvent(this,"onTaskDeleted",[t])}});BX.Tasks.Component.IframePopup.create=function(t){if(window.top!=window){return}if(typeof BX.Tasks.Singletons=="undefined"){BX.Tasks.Singletons={}}if(typeof BX.Tasks.Singletons.iframePopup=="undefined"){BX.Tasks.Singletons.iframePopup=new BX.Tasks.Component.IframePopup(t);window.taskIFramePopup=BX.Tasks.Singletons.iframePopup;window.BX.TasksIFrameInst=BX.Tasks.Singletons.iframePopup}else{BX.Tasks.Singletons.iframePopup.setCallbacks(t.callbacks)}return BX.Tasks.Singletons.iframePopup};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?17455640801711";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.gridId=t.gridId||"";this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.gridId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={};switch(t.counterTypeId){case"tasks_my_expired":var i=BX.date.format("d.m.Y",new Date,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_to:i};break;case"tasks_my_expired_cand":var r=new Date;var a=new Date;r.setUTCHours(r.getUTCHours()-24);var n=BX.date.format("d.m.Y H:i:s",r,null,true);a.setUTCHours(a.getUTCHours()+24);var s=BX.date.format("d.m.Y H:i:s",a,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_from:n,DEADLINE_to:s};break}this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?174556408060";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?174556396763408";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeparator="main-buttons-submenu-delimiter";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="--over";this.classMenuShown="--menu-shown";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="--locked";this.classExtraItemLink="";this.classExtraItemText="";this.classExtraItemIcon="";this.classExtraItemCounter="";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classDefaultSubmenuDelimimeter="popup-window-delimiter-section";this.classInner="main-buttons-inner-container";this.listContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.enableItemMouseEnter=true;this.menuShowTimeout=null;this.isMoreMenuShown=false;this.onDragStarted=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.isEditEnabledState=false;this.theme=BX.Type.isStringFilled(e.theme)?e.theme:"default";this.maxItemLength=BX.Type.isNumber(e.maxItemLength)&&e.maxItemLength>6?e.maxItemLength:20;this.tmp={};this.itemData=new WeakMap;this.handleMoreMenuItemMouseEnter=this.handleMoreMenuItemMouseEnter.bind(this);this.init(t,e);return{addMenuItem:this.addMenuItem.bind(this),deleteMenuItem:this.deleteMenuItem.bind(this),updateMenuItemText:this.updateMenuItemText.bind(this),getItemById:this.getItemById.bind(this),getAllItems:this.getAllItems.bind(this),getHiddenItems:this.getHiddenItems.bind(this),getVisibleItems:this.getVisibleItems.bind(this),getDisabledItems:this.getDisabledItems.bind(this),getMoreButton:this.getMoreButton.bind(this),adjustMoreButtonPosition:this.adjustMoreButtonPosition.bind(this),getItemData:this.getItemData.bind(this),getSubmenu:this.getMoreMenu.bind(this),showSubmenu:this.showMoreMenu.bind(this),closeSubmenu:this.closeMoreMenu.bind(this),refreshSubmenu:this.refreshMoreMenu.bind(this),getMoreMenu:this.getMoreMenu.bind(this),showMoreMenu:this.showMoreMenu.bind(this),closeMoreMenu:this.closeMoreMenu.bind(this),refreshMoreMenu:this.refreshMoreMenu.bind(this),getCurrentSettings:this.getCurrentSettings.bind(this),saveSettings:this.saveSettings.bind(this),updateCounter:this.updateCounter.bind(this),getActive:this.getActive.bind(this),isDisabled:this.isDisabled.bind(this),isVisibleItem:this.isVisibleItem.bind(this),isEditEnabled:this.isEditEnabled.bind(this),isActiveInMoreMenu:this.isActiveInMoreMenu.bind(this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,menuShown:this.classMenuShown,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.Type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.Type.isStringFilled(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.Type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.Type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.Type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.Type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};this.initItems();this.adjustMoreButtonPosition();this.bindEventsOnMoreButton();this.bindOnResize();BX.Event.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}const s=this.getHomeItem();if(s){const{url:t}=s;this.lastHomeLink=t}const i=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));i.forEach((function(t){const e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;const t=e.closest(".main-buttons-item-child-button-cloned");if(t){this.clonedChildButton=t}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))}),this)},calculateChildListWidth:function(){if(this.realChildButton){const t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");const e=10;return Array.from(t).reduce((function(t,e){const s=BX.Text.toNumber(BX.Dom.style(e,"width"));const i=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));const n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+s+i+n}),e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}const e=this.realChildButton.querySelector(".main-buttons-item-child-list");this.enableItemMouseEnter=false;setTimeout((()=>{this.enableItemMouseEnter=true}),200);const s=BX.Dom.attr(this.realChildButton,"data-child-items");const i=BX.Dom.attr(this.realChildButton,"data-is-opened");let n={};if(i){BX.Dom.attr(this.realChildButton,"data-is-opened",null);s.forEach((function(t){const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}}),this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);s.forEach((t=>{const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}}));setTimeout((()=>{BX.Dom.style(e,"overflow","unset")}),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout((()=>{this._onResizeHandler()}),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);const e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout((()=>{BX.Dom.style(this.clonedChildButton,"transition",null)}),0)},_onDocumentClick:function(t){if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}let e=this.getItem(t);if(BX.Type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isEditButton(t.target)){this.handleEditButtonClick(t);return false}if(this.isSetHide(e)){const t=this.getVisibleItems();const e=BX.Type.isArray(t)?t.length:null;const s=this.editItemData.ID.replace(this.listContainer.id+"_","");let i=this.getItemById(s);const n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&e>2){this.disableItem(n)}if(e===1){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshMoreMenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){const t=this.editItemData.ID.replace(this.listContainer.id+"_","");const e=this.getItemById(t);const s=this.getItemAlias(e);if(this.isDisabled(s)){this.enableItem(s)}this.listContainer.insertBefore(e,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshMoreMenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(!this.isDragButton(t.target)&&!this.isEditButton(t.target)){const s=this.getItemData(e);let i=s["ON_CLICK"];if(this.isSublink(t.target)){i=BX.Type.isPlainObject(s["SUB_LINK"])?s["SUB_LINK"]["ON_CLICK"]:""}if(BX.Type.isStringFilled(i)){t.preventDefault();this.execScript(i,t)}}}if(this.isEditEnabled()&&this.getMoreMenu()){this.getMoreMenu().getPopupWindow().setAutoHide(false)}},isActiveInMoreMenu:function(){const t=this.getHiddenItems();const e=this.getDisabledItems();const s=t.concat(e);return s.some((function(t){const e=this.getItemData(t);return e["IS_ACTIVE"]===true}),this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){const t=e[BX.message("SITE_ID")];for(const e in t){if(t.hasOwnProperty(e)){this.updateCounter(e,t[e])}}}},getActive:function(){let t=this.getAllItemsData();let e=null;let s=null;while(BX.Type.isArrayFilled(t)){const i=t.shift();if(i["IS_ACTIVE"]===true){if(s===null){s=i}e=i;t=BX.Type.isArrayFilled(i["ITEMS"])?[...i["ITEMS"]]:null}}if(e!==null&&s!==null){const t=BX(s.ID);if(BX.Type.isDomNode(t)){e.NODE=t}else{e.NODE=null}}return e},isSetHome:function(t){return BX.Dom.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.Dom.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(false);BX.Dom.addClass(e.getPopupContainer(),this.classEditState)}BX.Dom.addClass(this.listContainer,this.classEditState);this.isEditEnabledState=true},disableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(true);BX.Dom.removeClass(e.getPopupContainer(),this.classEditState)}BX.Dom.removeClass(this.listContainer,this.classEditState);this.isEditEnabledState=false;this.destroyItemEditMenu()},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.Type.isPlainObject(t)&&"ID"in t){const s=[this.listContainer.id,"_edit_item"].join("");let i=BX.Main.MenuManager.getMenuById(s);if(i){BX.Main.MenuManager.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},destroyItemEditMenu:function(){const t=[this.listContainer.id,"_edit_item"].join("");const e=BX.Main.MenuManager.getMenuById(t);if(e){BX.Main.MenuManager.destroy(t)}},getContainer:function(){if(!BX.Type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode.parentNode}return this.container},getItemEditMenu:function(){return BX.Main.MenuManager.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){const i=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];const n=t["ID"].replace(this.listContainer.id+"_","");const o=this.getItemById(n);if(this.isDisabled(o)){i.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{i.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}if(t["IS_PINNED"]){const e=this.getParentItem(t["ID"]);i.push({text:this.message("MIB_UNPIN_ITEM").replace("#NAME#",e?e["TEXT"]:""),onclick:(e,s)=>{this.handleItemUnpin(t,o);s.getMenuWindow().close()}})}const a=BX.pos(s);const u={menuId:e,anchor:s,menuItems:i,settings:{autoHide:true,offsetTop:0,offsetLeft:a.width/2,zIndex:20,angle:{position:"top",offset:a.width/2}}};const r=BX.Main.MenuManager.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in r&&BX.Type.isArray(r.menuItems)){r.menuItems.forEach((function(t){BX.Event.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))}),this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[r,t,this]);this.editMenu=r;return r},prepareMenuItemData:function(t){const e={CLASS:"",CLASS_SUBMENU_ITEM:"",COUNTER:0,COUNTER_ID:t.counterId,DATA_ID:t.dataId,HAS_CHILD:false,HAS_MENU:false,HTML:"",ID:t.id,IS_ACTIVE:false,IS_DISABLED:"false",IS_LOCKED:false,IS_PASSIVE:false,MAX_COUNTER_SIZE:99,NODE:BX.Tag.render`<div id="${t.id}" class="main-buttons-item"></div>`,ON_CLICK:t.onClick,SUB_LINK:false,SUPER_TITLE:false,TEXT:t.text,TITLE:"",URL:t.url};return e},addMenuItem:function(t){const e=this.getCurrentSettings();const s=Object.keys(e);const i=this.prepareMenuItemData(t);const n=this.createRootItem(i);const o=this.getItemById(s[s.length-1]);BX.Dom.insertAfter(n,o);this.initItems()},deleteMenuItem:function(t){this.itemData.delete(t);BX.Dom.remove(t)},updateMenuItemText:function(t,e){if(!t||!e){return}const s=this.getItemData(t);s.TEXT=e;const i=this.getItemById(s.ID);const n="main-buttons-item-text-box";const o=BX.Buttons.Utils.getByClass(i,n);o.innerText=e},getHomeItem:function(){const t=this.getVisibleItems();const e=BX.Type.isArray(t)&&t.length>0?t[0]:null;if(!e){return null}const s=this.getItemData(e);const i=this.normalizeUrl(s["URL"]);if(this.canBeHomed(i,s)){return{itemData:s,url:i,firstVisibleItem:e}}if(BX.Type.isArrayFilled(s["ITEMS"])){for(let t=0;t<s["ITEMS"].length;t++){const i=s["ITEMS"][t];if(i["IS_PINNED"]||i["IS_DISBANDED"]||i["IS_DELIMITER"]){continue}const n=this.normalizeUrl(i["URL"]);if(this.canBeHomed(n,i)){return{itemData:i,url:n,firstVisibleItem:e}}}}return null},normalizeUrl:function(t){if(!BX.Type.isStringFilled(t)){return""}if(t.charAt(0)==="?"){const e=document.createElement("a");e.href=t;t=e.pathname+e.search}return t},canBeHomed:function(t,e){if(!BX.Type.isStringFilled(t)||BX.Type.isStringFilled(e["ON_CLICK"])){return false}if(BX.Reflection.getClass("BX.SidePanel.Instance")){const e=BX.SidePanel.Instance.getUrlRule(t);if(e){return false}}const s=new BX.Event.BaseEvent({data:{itemLink:t,itemData:e}});BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onBeforeFirstItemChange",s);return!s.isDefaultPrevented()},isEditButton:function(t){return BX.Dom.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.Dom.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){const t=this.getAllItems().map((function(t){const e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)}));return Math.max.apply(Math,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){let e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.Type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classMenuShown=t.menuShown||this.classMenuShown;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeparator=t.separator||this.classSeparator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked;this.classExtraItemLink=t.extraItemLink||this.classExtraItemLink;this.classExtraItemText=t.extraItemText||this.classExtraItemText;this.classExtraItemIcon=t.extraItemIcon||this.classExtraItemIcon;this.classExtraItemCounter=t.extraItemCounter||this.classExtraItemCounter},setMessages:function(t){if(!BX.Type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.Type.isStringFilled(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){let e=null;if(BX.Type.isStringFilled(t)){const s=t.startsWith(this.listContainer.id)?t:this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s.replaceAll(":","\\:"))}return e},getItemCounterObject:function(t){let e=null;if(BX.Type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}this.updateItemsByCounterId(this.getAllItemsData(),t,e);this.updateMoreButtonCounter()},updateItemsByCounterId:function(t,e,s,i=[]){for(let n=0;n<t.length;n++){const o=t[n];if(o["COUNTER_ID"]===e){o["COUNTER"]=Number(s);this.setCounterValueById(e,o["COUNTER"]);for(let t=i.length-1;t>=0;t--){const e=i[t];e["COUNTER"]=e["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(e["COUNTER_ID"],e["COUNTER"])}}if(o["ITEMS"]){this.updateItemsByCounterId(o["ITEMS"],e,s,[...i,o])}}},recalculateItemsCounters:function(t,e=[]){let s=0;for(let i=0;i<t.length;i++){const n=t[i];if(n["ITEMS"]){n["COUNTER"]=this.recalculateItemsCounters(n["ITEMS"],[...e,n])}const o=n["IS_PINNED"]===true;s+=BX.Type.isNumber(n["COUNTER"])&&!o?n["COUNTER"]:0}for(let t=e.length-1;t>=0;t--){const s=e[t];s["COUNTER"]=s["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(s["COUNTER_ID"],s["COUNTER"])}return s},setCounterValueById:function(t,e){if(!BX.Type.isStringFilled(t)){return}const s=e>99?"99+":e>0?e:"";const i=document.querySelectorAll(`[data-mib-counter-id="${t}"]`);Array.from(i).forEach((t=>{t.textContent=s}))},setMoreButtonCounter:function(t){const e=this.getItemCounterObject(this.moreButton);e.textContent=t>99?"99+":t>0?t:""},bindEventsOnMoreButton:function(){BX.Event.bind(this.moreButton,"click",this.handleMoreButtonClick.bind(this));BX.Event.bind(this.moreButton,"mouseenter",this.handleMoreButtonMouseEnter.bind(this));BX.Event.bind(this.moreButton,"mouseleave",this.handleMoreButtonMouseLeave.bind(this))},bindOnResize:function(){const t=BX.Runtime.throttle(this._onResizeHandler,100,this);const e=new ResizeObserver(t);e.observe(this.listContainer.closest(".main-buttons"));BX.Event.bind(window,"resize",t)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getAllItemsData:function(){return this.getAllItems().map((t=>this.getItemData(t)))},getVisibleItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getHiddenItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>!this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getDisabledItems:function(){return this.getAllItems().filter((t=>this.isDisabled(t)))},getMoreButton:function(){const t=this.getContainer().getElementsByClassName(this.classItemMore);return t[0]||null},getLastVisibleItem:function(){const t=this.getVisibleItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},getLastDisabledItem:function(){const t=this.getDisabledItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){this.updateMoreButtonCounter();this.getHiddenItems().forEach((t=>{BX.Dom.removeClass(t,"--hidden")}));this.getHiddenItems().forEach((t=>{BX.Dom.addClass(t,"--hidden")}));if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},getMoreMenuId:function(t){let e="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){let t="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getMenuItemText:function(t,e=null){const s=BX.Type.isElementNode(t)?this.getItemData(t):t;return BX.Tag.render`
				<span class="main-buttons-menu-popup-item">${[BX.Tag.render`<span class="${this.classItemIcon}"></span>`,this.createItemText(s),this.createItemCounter(s),e&&this.isEditEnabled()?this.createItemPin(s,e):""]}</span>
			`},createRootItem:function(t){let e=this.classItem;e+=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";if(t["IS_PASSIVE"]){e+=" --passive"}else if(t["IS_ACTIVE"]){if(BX.Type.isStringFilled(this.classItemActive)){e+=" "+this.classItemActive}else{e+=" main-buttons-item-active"}}if(t["HAS_MENU"]){e+=" --has-menu"}if(t["IS_LOCKED"]){e+=" --locked"}const s=BX.Tag.render`
				<div
					id="${t["ID"]}"
					class="${e}"
					data-disabled="${t["IS_DISABLED"]}"
					data-class="${t["CLASS_SUBMENU_ITEM"]}"
					data-id="${t["DATA_ID"]}"
					data-top-menu-id="${this.getId()}"
					title=""
				>${[this.createItemLink(t,true),BX.Type.isPlainObject(t["SUB_LINK"])?this.createItemSubLink(t["SUB_LINK"]):""]}</div>
			`;this.setItemData(s,t);return s},createItemLink:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};let s;const i=["main-buttons-item-link",this.classExtraItemLink].join(" ").trim();if(BX.Type.isStringFilled(t["URL"])){s=BX.Tag.render`<a class="${i}" href="${BX.Text.encode(t["URL"])}"></a>`}else{s=BX.Tag.render`<span class="${i}"></span>`}BX.Dom.append(this.createItemIcon(t),s);BX.Dom.append(this.createItemText(t,e),s);BX.Dom.append(this.createItemCounter(t),s);return s},createItemSubLink:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";const s=BX.Type.isStringFilled(t["URL"])?BX.Text.encode(t["URL"]):"";return BX.Tag.render`
				<a class="${this.classItemSublink}${e}" href="${s}"></a>
			`},createItemIcon:function(t){const e=[this.classItemIcon,this.classExtraItemIcon].join(" ").trim();return BX.Tag.render`<span class="${e}"></span>`},createItemText:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};const s=[this.classItemText,this.classExtraItemText].join(" ").trim();let i=BX.Type.isStringFilled(t["TEXT"])?t["TEXT"]:"";if(e&&i.length>this.maxItemLength){i=i.substring(0,this.maxItemLength-3)+"..."}let n="";if(BX.Type.isPlainObject(t["SUPER_TITLE"])){let{TEXT:e,CLASS:s,COLOR:i}=t["SUPER_TITLE"];s=BX.Type.isStringFilled(s)?` ${s}`:"";const o=BX.Type.isStringFilled(i)?` style="color:${i}"`:"";n=BX.Tag.render`
					<span class="main-buttons-item-super-title${s}"${o}>${e}</span>
				`}return BX.Tag.render`
				<span class="${s}">${[BX.Tag.render`<span 
						class="main-buttons-item-drag-button"
						onclick="${this.handleDragButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,n,BX.Tag.render`
						<span class="main-buttons-item-text-title">
							<span class="main-buttons-item-text-box">${BX.Text.encode(i)}<span class="main-buttons-item-menu-arrow"></span></span>
						</span>
					`,BX.Tag.render`<span 
						class="main-buttons-item-edit-button"
						onclick="${this.handleEditButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,BX.Tag.render`<span class="main-buttons-item-text-marker"></span>`]}</span>
			`},createItemCounter:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=[this.classItemCounter,this.classExtraItemCounter].join(" ").trim();let s="";const i=BX.Type.isNumber(t["MAX_COUNTER_SIZE"])?t["MAX_COUNTER_SIZE"]:99;if(BX.Type.isNumber(t["COUNTER"])&&t["COUNTER"]>0){s=t["COUNTER"]>i?`${i}+`:t["COUNTER"]}const n=BX.Type.isStringFilled(t["COUNTER_ID"])?t["COUNTER_ID"]:"";return BX.Tag.render`<span data-mib-counter-id="${n}" class="${e}">${s}</span>`},createItemPin:function(t,e){return BX.Tag.render`
				<span class="main-buttons-item-pin" 
					data-slider-ignore-autobinding="true"
					onclick="${this.handleItemPin.bind(this,t,e)}"
					onmouseenter="${this.handleItemPinEnter.bind(this)}"
					onmouseleave="${this.handleItemPinLeave.bind(this)}"
				></span>
			`},getLockedClass:function(t){let e="";if(BX.Type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getMoreMenuItems:function(){const t=this.getAllItems();const e=this.getHiddenItems();const s=this.getDisabledItems();const i=[];if(t.length){t.forEach((t=>{if(e.indexOf(t)===-1&&s.indexOf(t)===-1){const e=this.getItemData(t);i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}}))}if(e.length){e.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}if(this.isSettingsEnabled){i.push({delimiter:true,html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classManage].join(" ")});i.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});const t=["ui-btn",this.theme==="default"?"ui-btn-sm":"ui-btn-xs","ui-btn-success-light","ui-btn-no-caps","ui-btn-round","ui-btn-icon-main-buttons-apply"];i.push({html:`\n\t\t\t\t\t<span class="${t.join(" ")}">\n\t\t\t\t\t\t<span class="ui-btn-text">${this.message("MIB_APPLY_SETTING_MENU_ITEM")}</span>\n\t\t\t\t\t</span>`,className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")});i.push({delimiter:true,html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}}return i},getMenuItems:function(t){return this.createMenuItems(this.getItemData(t),t)},getMoreMenuSubItems:function(t){return this.createMenuItems(this.getItemData(t),null)},createMenuItems:function(t,e=null){if(!BX.Type.isArrayFilled(t["ITEMS"])){return[]}const s=t["ITEMS"];const i=[];for(let t=0;t<s.length;t++){const n=s[t];if(n["IS_PINNED"]||n["IS_DISBANDED"]){continue}const o=n["IS_DELIMITER"]===true;if(o){const t=i.length===0;const e=i[i.length-1];if(t||e&&e["delimiter"]===true){continue}}const a=["menu-popup-no-icon","main-buttons-menu-item"];if(n["IS_ACTIVE"]===true){a.push("main-buttons-menu-item-active")}const u=BX.Text.toBoolean(n["IS_LOCKED"]);if(u){a.push(this.classItemLocked)}if(this.isEditEnabled()){a.push(this.classEditState)}let r;if(o){r={delimiter:true,className:a.join(" "),text:n["TEXT"]}}else{r={html:this.getMenuItemText(n,e),href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],className:a.join(" ")}}const l=n.hasOwnProperty("AJAX_OPTIONS");if(l){r.cacheable=true;r.events=this._getEvents(n["AJAX_OPTIONS"]);r.items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}else if(BX.Type.isArrayFilled(n["ITEMS"])&&!this.isEditEnabled()){const t=this.createMenuItems(n,e);if(t.length){r.items=t}}i.push(r)}if(i.length&&i[i.length-1]["delimiter"]===true){i.pop()}return i},_setAjaxMode:function(t){for(let e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){return{onSubMenuShow:()=>{if(this.subMenuLoaded){return}const e=this.getSubMenu();e.removeMenuItem("loading");const s=e.getMenuItem("loading");this.getSubItems(t).then((t=>{this._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()})).catch((t=>{if(s){s.getLayout().text.innerText=t}}))}}},getSubItems:function(t){return new Promise((function(e,s){if(this.progress){s(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then((t=>{this.progress=false;e(t.data)}))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then((t=>{this.progress=false;e(t.data)}))}}))},getMoreMenuArgs:function(){const t=this.getMoreMenuId();const e=this.moreButton;const s=this.getMoreMenuItems();const i={autoHide:false,compatibleMode:false,maxHeight:800,offsetTop:4,cacheable:false,bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this)},subMenuOptions:{events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}}};let n=null;if(this.theme==="default"){const t=350;const s=25;n={className:"main-buttons-menu-popup main-buttons-more-menu-popup",offsetLeft:-s,minWidth:240,maxWidth:t,subMenuOptions:{className:"main-buttons-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:150,maxWidth:t},events:{onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,e)}}}else if(this.theme==="air"){const t=350;n={className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",offsetLeft:-10,offsetTop:-5,minWidth:240,maxWidth:t,subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu"}}}else{const t=this.moreButton.querySelector(".main-buttons-item-text-title");const e=t.offsetWidth;const s=250;const i=e/2-s/2+BX.Main.Popup.getOption("angleLeftOffset");const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");const a=s/2-o;n={className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",offsetLeft:i,minWidth:s,maxWidth:s,angle:{position:"top",offset:a},subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu"}}}n=BX.Runtime.merge(i,n);if(this.isEditEnabled()){n.className+=" "+this.classEditState}return[t,e,s,n]},getChildMenuArgs:function(t){const e={autoHide:false,compatibleMode:false,offsetTop:4,cacheable:false,maxHeight:800,bindOptions:{position:"bottom",forceTop:true},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t)},subMenuOptions:{minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}}};let s=null;if(this.theme==="default"){const e=25;s={className:"main-buttons-menu-popup",maxWidth:350,minWidth:t.offsetWidth+e*2+30,offsetLeft:-e,events:{onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,t)},subMenuOptions:{className:"main-buttons-menu-popup --sub-menu"}}}else if(this.theme==="air"){s={className:"main-buttons-default-menu-popup",offsetTop:-5,offsetLeft:-10,maxWidth:350,minWidth:200,subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu"}}}else{const e=250;s={className:"main-buttons-default-menu-popup",maxWidth:e,minWidth:Math.min(t.offsetWidth+25*2+30,e),subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu"}}}return BX.Runtime.merge(e,s)},centerPopupArrow(t,e){const s=e.offsetWidth;const i=t.getPopupContainer().offsetWidth;const n=s/2-i/2;const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-o});t.setOffset({offsetLeft:n+BX.Main.Popup.getOption("angleLeftOffset")})},visibleControlMoreButton:function(){const t=this.getHiddenItems();if(!t.length){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createMoreMenu:function(){const t=BX.Main.MenuManager.create(...this.getMoreMenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.getMenuItems().forEach((function(t){const e=t.getLayout().item;BX.Event.bind(e,"click",BX.delegate(this._onDocumentClick,this))}),this);return t},createChildMenu:function(t){const e=this.getMenuItems(t);if(e.length){const s=BX.Main.MenuManager.create(this.getChildMenuId(),t,e,this.getChildMenuArgs(t));if(!this.isEditEnabled()&&this.isSettingsEnabled){const e=()=>{this.showMoreMenu();this.enableEdit();this.destroyChildMenu();this.showChildMenu(t)};s.getMenuItems().forEach((t=>{const s=t.getLayout().item;s.draggable=true;BX.Event.bind(s,"dragstart",e)}))}return s}return null},showMoreMenu:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.closeChildMenu()}let t=this.getMoreMenu();if(t!==null){t.getPopupWindow().show()}else{this.destroyMoreMenu();t=this.createMoreMenu();t.getPopupWindow().show()}this.setMoreMenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.getPopupWindow().setAutoHide(false)}},showChildMenu:function(t){clearTimeout(this.childMenuLeaveTimeout);if(!this.isEditEnabled()){this.closeMoreMenu()}if(!this.isVisibleItem(t)){return}const e=BX.Main.MenuManager.getMenuById(this.getChildMenuId());if(e&&e.bindElement===t){e.getPopupWindow().show();this.destroyItemEditMenu()}else{this.destroyChildMenu(t);const e=this.createChildMenu(t);if(e){e.getPopupWindow().show();this.destroyItemEditMenu()}}},closeMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}t.getPopupWindow().close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setMoreMenuShown(false)},closeChildMenu:function(){const t=this.getChildMenu();if(t===null){return}this.closePinHint();t.close()},getMoreMenu:function(){return BX.Main.MenuManager.getMenuById(this.getMoreMenuId())},getChildMenu:function(){return BX.Main.MenuManager.getMenuById(this.getChildMenuId())},destroyMoreMenu:function(){BX.Main.MenuManager.destroy(this.getMoreMenuId())},destroyChildMenu:function(){BX.Main.MenuManager.destroy(this.getChildMenuId())},refreshMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}const e=this.getMoreMenuArgs();if(BX.Type.isArray(e)){this.destroyMoreMenu();this.createMoreMenu();this.showMoreMenu()}},setMoreMenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}if(this.isSubmenuShown){BX.Dom.addClass(this.moreButton,this.classMenuShown)}else{BX.Dom.removeClass(this.moreButton,this.classMenuShown)}},activateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(!BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){const t={};this.getAllItems().forEach(((e,s)=>{t[e.id]={sort:s,isDisabled:this.isDisabled(e),isPinned:this.isPinned(e)}}));return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.Type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}const t={};this.optionsToSave.forEach((function(e){t[e.name]=e.value}));this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);return BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){const t=this.getCurrentSettings();const e="settings";if(!BX.Type.isPlainObject(t)){return}if(BX.Type.isDomNode(this.listContainer)&&"id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));const s=this.getHomeItem();if(s){const{itemData:t,url:e,firstVisibleItem:i}=s;if(t){if(this.lastHomeLink!==e){this.saveOptions("firstPageLink",e);this.sendOptions();BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[e,i])}this.lastHomeLink=e}}}},resetSettings:function(){let t=null;const e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:()=>{if(BX.Dom.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.Dom.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings((s=>{if(s){BX.Dom.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");this.sendOptions().then((function(){window.location.reload()})).catch((function(){window.location.reload()}))}}))}}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){const e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);let s=new BX.Promise;const i=s;for(let t=0;t<e.length;t++){s=s.then(e[t])}s.then((function(e){t(null,e)}),(function(e){t(e,null)}));i.fulfill()},moveButtonAlias:function(t,e){if(!t||!this.dragItem){return}const s=this.getItemAlias(this.dragItem);const i=this.getItemAlias(t);if(this.isListItem(s)){if(i){if(e){BX.Dom.insertAfter(s,i)}else{this.listContainer.insertBefore(s,i)}}else{this.listContainer.appendChild(s)}}if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},moveButton:function(t,e){if(!BX.Type.isDomNode(t)||!BX.Type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.Type.isDomNode(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.listContainer.insertBefore(this.dragItem,t)}}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.getMoreMenuContainer().insertBefore(this.dragItem,t)}}},getMoreMenuContainer:function(){const t=this.getMoreMenu();let e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){const s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.Dom.hasClass(t,e)&&t!==s){return t}}else{return null}}return null},findChildrenByClassName:function(t,e){let s=null;if(BX.Type.isDomNode(t)&&BX.Type.isStringFilled(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},initItems:function(){this.getAllItems().forEach((t=>{this.initItem(t)}))},initItem:function(t){if(this.isSettingsEnabled){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");BX.Event.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t,"drop",BX.delegate(this._onDrop,this));t.dataset.link="item-"+BX.Text.getRandom().toLowerCase()}BX.Event.bind(t,"click",this._handleItemClick.bind(this));BX.Event.bind(t,"mouseenter",this.handleItemMouseEnter.bind(this));BX.Event.bind(t,"mouseleave",this.handleItemMouseLeave.bind(this))},dragAndDropInitInSubmenu:function(){const t=this.getMoreMenu();if(!t){return}const e=t.menuItems;e.forEach((t=>{if(this.isSeparator(t.layout.item)||this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=false}else{t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.Event.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.Dom.hasClass(t.layout.item,this.classHiddenLabel)||BX.Dom.hasClass(t.layout.item,this.classManage)){BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}}))},getItem:function(t){if(!BX.Type.isDomNode(t)){if(!t||!BX.Type.isDomNode(t.target)){return null}}else{t={target:t}}let e=t.target.closest("."+this.classItem);if(!BX.Type.isDomNode(e)){e=t.target.closest("."+this.classDefaultSubmenuItem+", ."+this.classDefaultSubmenuDelimimeter)}return e},getItemData:function(t){if(!BX.Type.isDomNode(t)){return{}}const e=this.itemData.get(t);if(e){return e}let s;try{s=JSON.parse(t.dataset.item)}catch(t){s={}}this.setItemData(t,s);return s},setItemData(t,e){if(BX.Type.isElementNode(t)&&BX.Type.isPlainObject(e)){e.NODE=t;this.itemData.set(t,e)}},setOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity",.5)},unsetOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.Dom.addClass(this.listContainer,this.classOnDrag);BX.Dom.addClass(BX(this.getMoreMenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){const t=this.getMoreMenu();this.getAllItems().forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t,this.classItemOver)}));if(t&&BX.Type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t.layout.item,this.classItemOver)}))}BX.Dom.removeClass(this.listContainer,this.classOnDrag);BX.Dom.removeClass(BX(this.getMoreMenuId(true)),this.classOnDrag)},getIconClass:function(t){let e="";if(BX.Type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.Type.isStringFilled(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){const e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){let e;if(!BX.Type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.Dom.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.Type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){let e=null;if(!BX.Type.isDomNode(t)){return e}const s=this.getAllItems();const i=this.isSubmenuItem(t);const n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach((function(s){BX.Dom.hasClass(t,this.getAliasLink(s))&&(e=s)}),this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.Dom.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.Dom.removeClass(t,this.classSecret)},fakeDragItem:function(){if(!BX.Type.isDomNode(this.dragItem)||!BX.Type.isDomNode(this.overItem)){return}let t=null;if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateMoreMenuItems:function(){const t=this.getMoreMenu();if(t===null){return}const e=t.menuItems;if(!BX.Type.isArray(e)||!e.length){return}const s=this.getHiddenItems();const i=this.getDisabledItems();const n=i.concat(s);e.forEach((t=>{const e=[].some.call(n,(e=>BX.Dom.hasClass(t.layout.item,this.dataValue(e,"link"))||this.isDisabled(t.layout.item)||this.isSeparator(t.layout.item)||this.isDropzone(t.layout.item)));if(e||(this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)||this.isNotHiddenItem(t.layout.item)||this.isSeparator(t.layout.item)||t.layout.item===this.dragItem)&&!this.isMoreButton(t.layout.item)){this.showItem(t.layout.item)}else{this.hideItem(t.layout.item)}}))},isNotHiddenItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.Type.isDomNode(t)&&!BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.removeClass(t,this.classItemOver)}},dataValue:function(t,e){let s="";if(BX.Type.isDomNode(t)){const i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(t,e){if(BX.Type.isStringFilled(t)){const s=new Function("event",t);s(e)}},showLicenseWindow:function(){if(!B24.licenseInfoPopup){return}const t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_handleItemClick:function(t){if(!this.isEditEnabled()){const e=this.getItem(t);this.showChildMenu(e)}},handleEditButtonClick:function(t){t.preventDefault();t.stopPropagation();let e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}const s=this.getItemData(e);const i=this.getItemEditMenu();if(i&&i.popupWindow.isShown()&&this.lastEditNode===e){i.popupWindow.close()}else{this.showItemEditMenu(s,t.target)}this.lastEditNode=e},handleDragButtonClick:function(t){t.preventDefault();t.stopPropagation()},handleItemPinEnter:function(t){const e=this.getChildMenu();if(e){this.showPinHint(t.currentTarget)}},showPinHint:function(t){const e=48;const s=BX.Main.PopupManager.create({id:"main-buttons-pin-hint",closeByEsc:true,padding:15,className:"main-buttons-pin-hint-popup",height:e,cacheable:false,autoHide:true,bindOptions:{forceBindPosition:true},content:this.message("MIB_PIN_HINT"),darkMode:true,events:{onAfterShow:function(e){const s=e.getTarget();const i=BX.Dom.getPosition(t);const n=BX.Dom.getPosition(s.getPopupContainer());if(n.left<i.left+i.width){s.setAngle({position:"top",offset:0});s.setOffset({offsetLeft:20,offsetTop:5});s.adjustPosition()}}}});s.setAngle({position:"left",offset:0});s.setOffset({offsetLeft:t.offsetWidth+5,offsetTop:-t.offsetHeight/2-e/2-2});s.setBindElement(t);s.show();s.adjustPosition()},closePinHint:function(){const t=BX.Main.PopupManager.getPopupById("main-buttons-pin-hint");if(t){t.close()}},handleItemPinLeave:function(t){this.closePinHint()},handleItemPin:function(t,e,s){s.stopPropagation();s.preventDefault();const i=this.createRootItem(t);BX.Dom.addClass(i,"main-buttons-item-insert-animation");BX.Dom.insertBefore(i,e);requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(i,{width:i.scrollWidth+"px",opacity:1})}))}));const n=()=>{BX.Dom.removeClass(i,"main-buttons-item-insert-animation");BX.Dom.style(i,"width",null);BX.Dom.style(i,"opacity",null);const t=this.getItemData(e);this.recalculateItemsCounters([t]);this.adjustMoreButtonPosition();this.showMoreMenu();this.updateMoreButtonCounter();this.showChildMenu(e);this.saveSettings()};setTimeout(n,300);this.initItem(i);this.pinItem(t);this.destroyMoreMenu();this.destroyChildMenu()},handleItemUnpin:function(t,e){BX.Dom.style(e,{width:e.offsetWidth+"px"});BX.Dom.addClass(e,"main-buttons-item-insert-animation");requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(e,{width:0,margin:0,opacity:0})}))}));const s=()=>{BX.Dom.remove(e);this.adjustMoreButtonPosition();this.showMoreMenu();this.updateMoreButtonCounter();this.saveSettings()};setTimeout(s,300);this.pinItem(t,false);const i=[];let n="";const o=t["ID"].split(":");o.forEach((t=>{n+=`${n===""?"":":"}${t}`;const e=this.getItemById(n);if(e){i.push(this.getItemData(e))}}));this.destroyMoreMenu();this.recalculateItemsCounters(i)},pinItem:function(t,e=true){const s=t["ID"];const i=s.split(":");let n="";i.forEach(((t,o)=>{n+=`${n===""?"":":"}${t}`;const a=this.getItemById(n);if(!a){return}const u=this.getItemData(a);let r=u["ITEMS"];let l=n;const h=i.slice(o+1);const m=[u];while(BX.Type.isArrayFilled(h)&&BX.Type.isArrayFilled(r)){l=l+":"+h.shift();for(let t=0;t<r.length;t++){const i=r[t];if(i["ID"]===s){i["IS_PINNED"]=e;for(let t=m.length-1;t>=0;t--){const s=m[t];const i=t===0;if(e){const t=s["ITEMS"].some((t=>{const e=t["IS_PINNED"]===true;const s=t["IS_DISBANDED"]===true;const i=t["IS_DELIMITER"]===true;return!e&&!s&&!i}));if(!t){s["IS_DISBANDED"]=true;if(i){a.dataset.disbanded=true}}}else{if(i){a.dataset.disbanded=false}s["IS_DISBANDED"]=false}const n=s["ITEMS"].some((t=>t["IS_ACTIVE"]===true&&t["IS_PINNED"]!==true&&t["IS_DELIMITER"]!==true));if(n){s["IS_ACTIVE"]=true;if(i){this.activateItem(a)}}else{s["IS_ACTIVE"]=false;if(i){this.deactivateItem(a)}}}return}else if(i["ID"]===l){r=i["ITEMS"];l=i["ID"];m.push(i);break}}}}))},getParentItem:function(t){const e=t.split(":");let s="";for(let i=0;i<e.length;i++){s+=`${s===""?"":":"}${e[i]}`;const n=this.getItemById(s);if(!n){continue}const o=this.getItemData(n);let a=o["ITEMS"];let u=s;const r=e.slice(i+1);let l=null;while(BX.Type.isArrayFilled(r)&&BX.Type.isArrayFilled(a)){u=u+":"+r.shift();for(let e=0;e<a.length;e++){const s=a[e];if(s["ID"]===t){return l===null?o:l}else if(s["ID"]===u){a=s["ITEMS"];u=s["ID"];l=s;break}}}}return null},_onDragStart:function(t){const e=this.getVisibleItems();const s=BX.Type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.Type.isDomNode(this.dragItem)){return}if(s===1&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.onDragStarted=true;this.closeChildMenu();this.destroyItemEditMenu();if(this.isListItem(this.dragItem)){this.showMoreMenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();const e=this.getItem(t);this.onDragStarted=false;if(!BX.Type.isDomNode(e)){return}this.unsetDragStyles();this.refreshMoreMenu();if(!this.isEditEnabled()){this.closeMoreMenu()}const s=BX.findNextSibling(this.dragItem,(t=>this.isVisibleItem(t)));const i=BX.findPreviousSibling(this.dragItem,(t=>this.isVisibleItem(t)));if(BX.Dom.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i)||this.isDisabled(s)&&this.isSubmenuItem(s)){this.disableItem(this.dragItem);this.refreshMoreMenu()}if(this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){let t=this.getHiddenItems();const e=this.getDisabledItems();t=t.concat(e);let s=0;if(BX.Type.isArray(t)){t.forEach((t=>{const e=this.getItemData(t);const i=BX.Type.isNumber(e["COUNTER"])&&e["COUNTER"]>0?e["COUNTER"]:0;s+=i}))}if(BX.Type.isNumber(s)){this.setMoreButtonCounter(s)}},_onDragEnter:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();this.overItem=this.getItem(t);if(!BX.Type.isDomNode(this.overItem)||!BX.Type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();const e=this.isNext(t);const s=this.isGoodPosition(t);if(e&&s){let t;let e=false;if(this.isListItem(this.overItem)){t=this.findNextSiblingByClass(this.overItem,this.classItem);if(t===null&&this.getLastVisibleItem()===this.overItem){t=this.overItem;e=true}}else{t=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem);if(this.isSettings(t)||this.isApplySettingsButton(t)||this.isResetSettingsButton(t)){return}if(t===null&&this.getItemAlias(this.getLastDisabledItem())===this.overItem){t=this.overItem;e=true}}if(BX.Type.isDomNode(t)){this.moveButton(t,e);this.moveButtonAlias(t,e);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}}else if(!e&&s&&!BX.Dom.hasClass(this.overItem,this.classHiddenLabel)){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}},_onDragLeave:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){const e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}const s=this.getItemAlias(this.dragItem);if(this.isListItem(s)){s.dataset.disabled="false"}this.unsetDragStyles();t.preventDefault()},handleMoreMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this.handleMoreMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this.handleMoreMenuMouseLeave.bind(this))},handleMoreMenuMouseEnter:function(){clearTimeout(this.submenuLeaveTimeout)},handleMoreMenuMouseLeave:function(){this.tryCloseMoreMenuOnTimeout()},tryCloseMoreMenuOnTimeout:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.submenuLeaveTimeout=setTimeout((()=>{this.closeMoreMenu()}),500)}},handleMoreMenuShow:function(t){BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuShow",{event:t});setTimeout((()=>{if(!this.isEditEnabled()){t.getTarget().setAutoHide(true)}}),500)},handleMoreMenuClose:function(){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuClose");this.setMoreMenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}this.destroyItemEditMenu()},_onChildMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this._onChildMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this._onChildMenuMouseLeave.bind(this))},_onChildMenuMouseEnter:function(){clearTimeout(this.childMenuLeaveTimeout)},_onChildMenuMouseLeave:function(){this.tryCloseChildMenuOnTimeout()},tryCloseChildMenuOnTimeout:function(){if(this.isEditEnabled()){return}clearTimeout(this.childMenuLeaveTimeout);this.childMenuLeaveTimeout=setTimeout((()=>{this.closeChildMenu()}),500)},_onChildMenuShow:function(t,e){BX.Dom.addClass(t,this.classMenuShown);BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuShow",{item:t,event:e});if(this.theme!=="default"&&this.theme!=="air"){this.centerPopupArrow(e.getTarget(),t)}setTimeout((()=>{e.getTarget().setAutoHide(true)}),500)},_onChildMenuClose:function(t){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuClose");BX.Dom.removeClass(t,this.classMenuShown);this.closePinHint()},handleAdjustPosition:function(t,e){const s=25;const i=BX.Dom.getPosition(t);const n=e.getTarget();if(e.left<i.left-s){const t=n.getPopupContainer().offsetWidth;const o=i.right-t+s;if(o>0){e.left=o;BX.Dom.addClass(n.getPopupContainer(),"--left-handed")}}else{BX.Dom.removeClass(n.getPopupContainer(),"--left-handed")}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.closeChildMenu();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},handleMoreButtonClick:function(t){t.preventDefault();this.showMoreMenu()},handleMoreButtonMouseEnter:function(t){if(this.enableItemMouseEnter){clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showMoreMenu()}),100)}clearTimeout(this.submenuLeaveTimeout)},handleMoreButtonMouseLeave:function(){clearTimeout(this.menuShowTimeout);this.tryCloseMoreMenuOnTimeout()},handleItemMouseEnter:function(t){if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);clearTimeout(this.childMenuLeaveTimeout);clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showChildMenu(e)}),100);BX.Dom.addClass(e,this.classItemOver)},handleItemMouseLeave:function(t){clearTimeout(this.menuShowTimeout);if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);BX.Dom.removeClass(e,this.classItemOver);this.tryCloseChildMenuOnTimeout()},handleMoreMenuItemMouseEnter:function(t){if(this.isEditEnabled()){t.preventDefault()}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsResetButton)},isDisabled:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.Dom.hasClass(t,this.classItemDisabled)}return e},isPinned:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.getItemData(t)["IS_PINNED"]===true}return e},isSettings:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.Dom.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.Dom.hasClass(t,this.classDropzone)},isNext:function(t){const e=this.dragItem.getBoundingClientRect();const s=this.overItem.getBoundingClientRect();const i=getComputedStyle(this.dragItem);const n=parseInt(i.marginRight.replace("px",""));let o=null;if(this.isListItem(this.overItem)){o=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){o=t.clientY>e.top}return o},isGoodPosition:function(t){const e=this.overItem;if(!BX.Type.isDomNode(e)){return false}let s;const i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.Type.isDomNode(t)){return false}return t.offsetTop===0&&!BX.Dom.hasClass(t,"--hidden")},isMoreButton:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSeparator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){let e=null;if(!BX.Type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.Type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate((function(){e=BX(t.containerId);if(!BX.Type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}),this))}},getById:function(t){let e=null;if(BX.type.isString(t)&&BX.Type.isStringFilled(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1745563967575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?17455640803754";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.isProjectLimitExceeded=Boolean(this.option("isProjectLimitExceeded"));this.isScrumLimitExceeded=Boolean(this.option("isScrumLimitExceeded"));this.isTaskAccessPermissionsLimit=Boolean(this.option("isTaskAccessPermissionsLimit"));this.isRoleControlDisabled=Boolean(this.option("isRoleControlDisabled"))},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",(function(t){t.preventDefault();var e=t.target.className;var n=this.dataset.id=="view_all"?"":this.dataset.id;var s=this.dataset.url;if(e==="main-buttons-item-sublink "&&n===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[n,s]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")}))}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){switch(t){case"user_counter":this.onUserCounter(e);break;case"project_add":this.onProjectAdd(e);break;case"project_remove":this.onProjectRemove(e);break}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,n){this.onFilterApply(t,e,n)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var n=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this));var n=BX("tasks_panel_menu_view_flow");if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.flow_total)}var s=BX("tasks_panel_menu_view_scrum");if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.scrum_total_comments)}},onProjectAdd:function(t){this.updateScrumLimit()},onProjectRemove:function(t){this.updateScrumLimit()},updateScrumLimit(){var t=BX("tasks_panel_menu_view_scrum");if(!t){return}this.checkScrumLimit().then(function(t){this.isScrumLimitExceeded=Boolean(t)}.bind(this))},checkScrumLimit:function(){return BX.ajax.runAction("bitrix:tasks.scrum.info.checkScrumLimit",{data:{},signedParameters:this.signedParameters}).then((function(t){return t.data}))},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,n){if(this.isRoleControlDisabled){return}try{var s=n.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var r=0;r<o.length;r++){BX.removeClass(o[r],"main-buttons-item-active")}if(typeof s!=="undefined"){if(!s){s="view_all"}BX.addClass(BX("tasks_panel_menu_"+s),"main-buttons-item-active");var a=BX.Tasks.Component.TasksToolbar.getInstance();if(a){a.rerender(s)}}}catch(t){}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?17455640807131";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.map.js";}"*/
if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},keypress:function(e){},open:function(e,t){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(e){this._control.setData(BX.util.htmlspecialcharsback(e.nameFormatted),e.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(e){this._control=e;if(this._fieldId!==e.getId()){this._selector=null;this.close()}else{this._selector=e;this.open(e.field)}},onCustomEntitySelectorClose:function(e){if(this._fieldId!==e.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(e,t){var i=new BX.FilterEntitySelector(e,t);i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(e){var t=null,i=e.selectorId,n=e.buttonAddId,s=e.pathTaskAdd.indexOf("?")===-1?e.pathTaskAdd+"?GROUP_ID=":e.pathTaskAdd+"&GROUP_ID=",o=e.messages,r=e.groups,a=e.currentGroup,l=e.groupLimit,c=e.offsetLeft;var d=function(e){if(BX(n)){BX(n).setAttribute("href",s+e)}};a.id=parseInt(a.id);a.text=BX.util.htmlspecialchars(a.text);d(a.id);BX.bind(BX(i),"click",(function(){if(t===null){var e=[];var n=function(e,s){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[s.id,a.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[s.id,a.id]);if(s.id!==a.id){var o=t.getMenuItems();t.addMenuItem({id:a.id,text:a.text,onclick:BX.delegate(n,this)},o.length>0?o[0]["id"]:null);if(s.id!=="wo"){if(t.getMenuItem(s.id)){t.removeMenuItem(s.id)}else if(o.length>=l){t.removeMenuItem(o[o.length-3].id)}}}t.close();a={id:s.id,text:s.text};d(s.id);if(BX(i+"_text")){BX(i+"_text").innerHTML=s.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[a])};for(var s=0,u=r.length;s<u;s++){e.push({id:parseInt(r[s]["id"]),text:BX.util.htmlspecialchars(r[s]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(n,this)})}if(r.length>0){e.push({delimiter:true});e.push({id:"new",text:o.TASKS_BTN_GROUP_SELECT,onclick:function(e,i){t.getPopupWindow().setAutoHide(false);var s=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:i.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});s.bindEvent("item-selected",(function(e){n(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});s.close()}));s.bindEvent("close",(function(e){t.getPopupWindow().setAutoHide(true)}));s.open()}})}if(!c){c=0}t=BX.PopupMenu.create(i,BX(i),e,{autoHide:true,closeByEsc:true,offsetLeft:c})}t.popupWindow.show()}))}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(e,t,i){t=t||"asc";if(BX.Main.gridManager!=undefined){var n=BX.Main.gridManager.getById(i).instance;n.sortByColumn({sort_by:e,sort_order:t});if(e==="SORTING"){n.getRows().enableDragAndDrop()}else{n.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:i,action:"setSort"}),{by:e,order:t},(function(e){try{e=JSON.parse(e);if(!e.error){window.location.reload()}}catch(e){}}))}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(e,t){if(!BX(e)){return}BX.bind(BX(e).querySelector(".webform-small-button"),"click",(function(){var i=new BX.UI.EntitySelector.Dialog({targetNode:BX(e),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",t.sprintId]],entities:[{id:"sprint-selector",options:{groupId:t.groupId,onlyCompleted:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function(i){var n=i.getData().item;t.sprintId=n.id;BX.onCustomEvent(BX(e),"onTasksGroupSelectorChange",[{id:t.groupId,sprintId:n.id,name:n.customData.get("name")}]);var s=BX(e).querySelector(".webform-small-button-text");s.textContent=n.customData.get("label")}}});i.show()}))}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(e){var t=document.location.href;t=BX.util.add_url_param(t,{group_id:e});document.location.href=t}}}this.BX=this.BX||{};(function(e,t,i){"use strict";function n(e,t){o(e,t);t.add(e)}function s(e,t,i){o(e,t);t.set(e,i)}function o(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function r(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var a=new WeakMap;var l=new WeakMap;var c=new WeakSet;var d=new WeakSet;var u=new WeakSet;var h=new WeakSet;var p=new WeakSet;var f=function(){function e(t){babelHelpers.classCallCheck(this,e);n(this,p);n(this,h);n(this,u);n(this,d);n(this,c);s(this,a,{writable:true,value:void 0});s(this,l,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,a,t.filterId);r(this,c,g).call(this)}babelHelpers.createClass(e,[{key:"payAttention",value:function t(){var i=this;setTimeout((function(){i.guide.showNextStep();r(i,h,X).call(i)}),e.DELAY)}}]);return e}();function g(){var e;r(e=r(this,d,m).call(this),u,B).call(e)}function m(){babelHelpers.classPrivateFieldSet(this,l,BX.Main.filterManager.getById(babelHelpers.classPrivateFieldGet(this,a)));return this}function B(){this.guide=new t.Guide({simpleMode:true,onEvents:true,steps:[{target:babelHelpers.classPrivateFieldGet(this,l).getPopupBindElement(),title:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TITLE"),text:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});this.guide.getPopup().setWidth(420);return this}function X(){var e=this;i.ajax.runComponentAction("bitrix:tasks.interface.filter","markPresetAhaMomentViewed",{mode:"class",data:{}})["catch"]((function(t){r(e,p,S).call(e,t)}))}function S(e){console.log(e)}babelHelpers.defineProperty(f,"DELAY",1e3);e.Preset=f})(this.BX.Tasks=this.BX.Tasks||{},BX.UI.Tour,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1745563967189470";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i,n,s,r,a){"use strict";(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(e){var t,i,n,s,r;t={block:"main-ui-control-field-group",name:e.name+"_datesel",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:"","data-time":e.enableTime},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var a=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){a=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:a}]}s={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:a};t.content.push(s)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_datesel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(n);if(!("dragButton"in e)||e.dragButton!==false){r={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(r)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(e){var t,i,n,s,r;t={block:"main-ui-control-field",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var a=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){a=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:a}]}s={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:a};t.content.push(s)}if(BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("valueDelete"in e&&e.valueDelete===true){n={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(n)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){r={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(r)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(e){var t,i,n,s;t={block:"main-ui-control-field-group",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var r=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){r=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:r}]}n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:r};t.content.push(n)}if(BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){s={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(s)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in e?e.type:"text",name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:""}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-textarea"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control main-ui-control-textarea"],tag:"textarea",attrs:{name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:""},content:"value"in e?e.value:""}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(e){var t={block:"main-ui-select-inner-label",content:"label"in e?e.label:""};var i={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":e.id,"data-name":e.name,"data-item":"item"in e?JSON.stringify(e.item):{}},events:{click:"onClick"in e?e.onClick:""},content:t};return i}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(e){return{block:"main-ui-filter-info",tag:"span",content:e.content,attrs:{title:e.title}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var t,i,n;t={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach((function(e){t.mix.push(e)}))}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};t.content.push(i);if("valueDelete"in e&&e.valueDelete===true){n={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(n)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(e){var t=["main-ui-filter-search-square"];if("isPreset"in e&&e.isPreset){t.push("main-ui-filter-search-square-preset")}var i="title"in e?e.title:"";var n="name"in e?BX.util.htmlspecialcharsback(e.name):"";if("icon"in e&&BX.Type.isPlainObject(e.icon)){var s=e.icon.title;i=i.length?s+": "+i:"";n=n.length?s+": "+n:""}return{block:"main-ui-square",mix:t,attrs:{"data-item":"item"in e?JSON.stringify(e.item):"",title:i},content:[{block:"main-ui-square-item",content:n},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(e){var t,i,n,s,r;t={block:"main-ui-control-field-group",name:"name"in e?e.name+"_numsel":"",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var a=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){a=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:a}]}s={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:a};t.content.push(s)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_numsel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(n);if(!("dragButton"in e)||e.dragButton!==false){r={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(r)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(e){return{block:"main-ui-filter-sidebar-item"+("pinned"in e&&e.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in e?e.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in e?e.placeholder:"",value:"text"in e?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(e.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in e?e.text:"",attrs:{title:"text"in e?e.text:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in e&&e.noEditPinTitle?e.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in e&&e.editNameTitle?e.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in e&&e.removeTitle?e.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in e&&e.editPinTitle?e.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function e(t,i){var n;i=BX.type.isPlainObject(i)?i:null;n=Object.keys(i);[].forEach.call(t||[],(function(e){n.forEach((function(t){BX.style(e,t,i[t])}))}))},closestParent:function e(t,i){if(t){if(!i){return t.parentNode||null}else{return BX.findParent(t,{className:i})}}},closestChilds:function e(t){return!!t?t.children:null},getNext:function e(t){return!!t?t.nextElementSibling:null},getPrev:function e(t){return!!t?t.previousElementSibling:null},collectionSort:function e(t,i){var n,s,r,a,l;if(t&&i&&t!==i&&t.parentNode===i.parentNode){n=this.closestParent(i);s=this.closestChilds(n);r=s.length;a=this.getIndex(s,t);l=this.getIndex(s,i);if(r===l){n.appendChild(i)}if(a>l){n.insertBefore(t,i)}if(a<l&&r!==l){n.insertBefore(t,this.getNext(i))}}},getIndex:function e(t,i){return[].indexOf.call(t||[],i)},getByClass:function e(t,i,n){var s=[];if(i){s=(t||document.body).getElementsByClassName(i);if(!n){s=s.length?s[0]:null}else{s=[].slice.call(s)}}return s},getByTag:function e(t,i,n){var s=[];if(i){s=(t||document.body).getElementsByTagName(i);if(!n){s=s.length?s[0]:null}else{s=[].slice.call(s)}}return s},getBySelector:function e(t,i,n){var s=[];if(i){if(!n){s=(t||document.body).querySelector(i)}else{s=(t||document.body).querySelectorAll(i);s=[].slice.call(s)}}return s},requestAnimationFrame:function e(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.apply(window,arguments)},sortObject:function e(t){var i={};Object.keys(t).sort().forEach((function(e){i[e]=t[e]}));return i},objectsIsEquals:function e(t,i){return JSON.stringify(t)===JSON.stringify(i)},isKey:function e(t,i){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var s=!!t?"keyCode"in t?t.keyCode:"which"in t?t.which:0:0;return s in n&&n[s]===i}}})();(function(){BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function e(t,i,n){if(!BX.type.isNotEmptyObject(n)||!BX.type.isNotEmptyObject(n.item)||!BX.type.isNotEmptyString(n.selectorId)){return}var s=n.selectorId,r=n.item;var a=BX.Filter.DestinationSelectorManager.controls[s];if(a){var l=r.id;if(BX.type.isNotEmptyString(t)&&t=="Y"&&BX.type.isNotEmptyString(i)){var o=new RegExp("^"+i+"(\\d+)$");var u=l.match(o);if(BX.type.isArray(u)){l=u[1]}}else{var c={};BX.onCustomEvent(window,"BX.Filter.DestinationSelector:convert",[{selectorId:s,value:l},c]);if(BX.type.isNotEmptyString(c.value)){l=c.value}}a.setData(BX.util.htmlspecialcharsback(r.name),l);a.getLabelNode().value="";a.getLabelNode().blur()}},onDialogOpen:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var n=BX.Filter.DestinationSelector.items[i];if(n){n.onDialogOpen()}},onDialogClose:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var n=BX.Filter.DestinationSelector.items[i];if(n){n.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(e,t){if(typeof this.items[e]!="undefined"){return this.items[e]}var i=new BX.Filter.DestinationSelector(e,t);i.initialize(e,t);this.items[e]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[e]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(e,t){return this.settings.hasOwnProperty(e)?this.settings[e]:t};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(e,t){this.id=e;this.settings=t?t:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var n={};n[this.fieldId]=i.itemId;n[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(n)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var e=this.id;if(!this.inited){var t=this.getSearchInput();t.id=t.name;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",BX.delegate((function(e){if(typeof e.id!="undefined"||e.id!=this.id){return}this.opened=true}),this));BX.addCustomEvent(window,"BX.UI.SelectorManager:onCreate",BX.delegate((function(e){if(!BX.type.isNotEmptyString(e)||e!=this.id){return}BX.onCustomEvent(window,"BX.Filter.DestinationSelector:setSelected",[{selectorId:e,current:this.control.getCurrentValues()}])}),this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:t.id,containerId:t.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManagerV2.controls[this.id]!=="undefined"){BX.Main.selectorManagerV2.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(e){var t=e.getId();if(this.fieldId!==t){this.control=null}else{this.control=e;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(e){if(this.fieldId===e.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(e,t){if(BX.findParent(e.target,{className:"bx-lm-box"})){t.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(e){if(this.fieldId===e.getId()){var t=BX.UI.SelectorManager.instances[e.getId()];if(t&&typeof e.hiddenInput!="undefined"&&typeof e.hiddenInput.value!="undefined"&&BX.type.isNotEmptyObject(t.itemsSelected)&&typeof t.itemsSelected[e.hiddenInput.value]!="undefined"){delete t.itemsSelected[e.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(e){if(typeof e.id=="undefined"||e.id!=this.id){return}this.inited=true;if(!this.control){e.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var u=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"filter",null);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"dialogOptions",null);babelHelpers.defineProperty(this,"control",null);babelHelpers.defineProperty(this,"isMultiple",false);babelHelpers.defineProperty(this,"needAddEntityIdToFilter",false);babelHelpers.defineProperty(this,"isActive",false);babelHelpers.defineProperty(this,"needShowDialogOnEmptyInput",true);this.id=t;this.settings=i?i:{};this.filter=this.getSetting("filter",null);if(!this.filter){throw new Error("Filter option is required for EntitySelector field")}this.isMultiple=!!this.getSetting("isMultiple",false);this.needAddEntityIdToFilter=this.getSetting("addEntityIdToResult","N")==="Y";this.needShowDialogOnEmptyInput=!!this.getSetting("showDialogOnEmptyInput",true);this.dialogOptions=this.prepareDialogOptions();this.dialog=null;s.EventEmitter.subscribe("BX.Main.Filter:customEntityFocus",this.onCustomEntityFocus.bind(this));s.EventEmitter.subscribe("BX.Main.Filter:customEntityBlur",this.onCustomEntityBlur.bind(this));s.EventEmitter.subscribe("BX.Main.Filter:onGetStopBlur",this.onGetStopBlur.bind(this));s.EventEmitter.subscribe("BX.Main.Filter:move",this.onCustomEntityRemove.bind(this));s.EventEmitter.subscribe("BX.Main.Filter:onApplyPreset",this.onApplyPreset.bind(this));this.controlInputChangeHandler=this.onSearchInputChange.bind(this)}babelHelpers.createClass(e,[{key:"open",value:function e(){var t=this;this.isActive=true;if(!this.dialog){this.initDialog().then((function(){if(t.isActive){t.openDialog()}}))}else{this.openDialog()}}},{key:"close",value:function e(){this.isActive=false;if(this.dialog&&this.dialog.isOpen()){this.dialog.hide()}}},{key:"getFilterField",value:function e(){return this.filter.getField(this.id)}},{key:"getFilterFieldInputWrapper",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,".main-ui-control-entity")}},{key:"getFilterFieldInput",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,"."+this.filter.settings.classStringInput+'[type="text"]')}},{key:"setControl",value:function e(t){this.control=t}},{key:"unsetControl",value:function e(){this.control=null}},{key:"getSetting",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"prepareDialogOptions",value:function e(){var t={enableSearch:false,hideOnSelect:true,autoHide:false,hideByEsc:false};var i=this.getSetting("dialogOptions",{});i=Object.assign(t,i);return i}},{key:"openDialog",value:function e(){if(this.dialog.isOpen()){return}var t=this.getFilterFieldInputWrapper();var i=this.getFilterFieldInput();var n=a.Type.isDomNode(i)?i.value.trim():"";this.dialog.setTargetNode(t);this.dialog.setWidth(t.offsetWidth);if(this.needShowDialogOnEmptyInput||n.length){this.dialog.show()}this.updateSelectedItemsInDialog(this.dialog);if(n.length){this.dialog.search(n)}}},{key:"initDialog",value:function t(){var i=this;return e.initDialogExtension().then((function(e){var t=e.Dialog;i.dialog=new t(o(o({},i.dialogOptions),{},{id:i.getDialogId(),multiple:i.isMultiple}));s.EventEmitter.subscribe(i.dialog,"Item:onSelect",i.onDialogItemSelect.bind(i));s.EventEmitter.subscribe(i.dialog,"Item:onDeselect",i.onDialogItemDeSelect.bind(i));s.EventEmitter.subscribe(i.dialog,"onLoad",i.onDialogLoad.bind(i));var n=i.getFilterFieldInput();a.Event.bind(n,"input",i.controlInputChangeHandler)}))}},{key:"addItemToFilter",value:function e(t,i){if(!this.control){return}if(this.isMultiple){var n=this.control.getCurrentValues();if(!n.filter((function(e){return e.value===t})).length){n.push({value:t,label:i});this.control.setMultipleData(n)}}else{this.control.setSingleData(i,t)}}},{key:"removeItemFromFilter",value:function e(t){if(!this.control){return}if(this.isMultiple){var i=this.control.getCurrentValues();this.control.setMultipleData(i.filter((function(e){return e.value!==t})))}else{this.control.clearValue()}}},{key:"getDialogId",value:function e(){return this.id+"_"+this.filter.getParam("FILTER_ID")}},{key:"getItemId",value:function e(t){if(this.needAddEntityIdToFilter){return JSON.stringify([t.getEntityId()+"",t.getId()+""])}return t.getId()+""}},{key:"updateSelectedItemsInDialog",value:function e(t){var i=this;if(!this.control){return}var n=this.control.getCurrentValues();if(!this.isMultiple){n=[n]}var s=n.map((function(e){return e.value}));t.getItems().forEach((function(e){if(s.indexOf(i.getItemId(e))>-1){e.select(true)}else{e.deselect()}}))}},{key:"onCustomEntityFocus",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),s=n[0];if(this.id!==s.getId()){return}this.setControl(s);this.open()}},{key:"onCustomEntityBlur",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),s=n[0];if(this.id!==s.getId()){return}this.close();this.unsetControl()}},{key:"onGetStopBlur",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,2),s=n[0],r=n[1];if(!(this.dialog&&this.dialog.isOpen())){return}var l=this.getFilterField();if(!l){return}var o=s.target;if(o===l.node||l.node.contains(o)&&!a.Dom.hasClass(o,this.filter.settings.classFieldDelete)||o===document.body){r.stopBlur=true;return}var u=this.dialog.getPopup().getContentContainer();if(o===u||u.contains(o)){r.stopBlur=true}}},{key:"onCustomEntityRemove",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),s=n[0];if(this.id!==s.getId()){return}if(this.dialog){this.dialog.destroy();this.dialog=null}this.unsetControl()}},{key:"onApplyPreset",value:function e(t){if(this.dialog){this.dialog.destroy();this.dialog=null}this.unsetControl()}},{key:"onSearchInputChange",value:function e(t){if(this.dialog){if(!this.needShowDialogOnEmptyInput){if(t.target.value){this.open()}else{this.close()}}this.dialog.search(t.target.value)}}},{key:"onDialogItemSelect",value:function e(t){var i=t.getData(),n=i.item;this.addItemToFilter(this.getItemId(n),n.getTitle());this.getFilterFieldInput().value=""}},{key:"onDialogItemDeSelect",value:function e(t){var i=t.getData(),n=i.item;this.removeItemFromFilter(this.getItemId(n))}},{key:"onDialogLoad",value:function e(t){var i=t.getTarget();this.updateSelectedItemsInDialog(i)}}],[{key:"initDialogExtension",value:function t(){if(!e.initExtensionPromise){e.initExtensionPromise=a.Runtime.loadExtension("ui.entity-selector")}return e.initExtensionPromise}},{key:"create",value:function t(i,n){if(a.Type.isObject(this.items[i])){if(a.Type.isObject(n.filter)){this.items[i].filter=n.filter}return this.items[i]}var s=new e(i,n);this.items[i]=s;return s}}]);return e}();babelHelpers.defineProperty(u,"initExtensionPromise",null);babelHelpers.defineProperty(u,"items",{});var c=a.Reflection.namespace("BX.Filter");c.EntitySelector=u;(function(){BX.namespace("BX.Filter");BX.Filter.FieldController=function(e,t){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(e,t)};BX.Filter.FieldController.prototype={init:function e(t,i){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(i instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=i;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function e(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function e(){return this.field},getInput:function e(){var t,i;if(!BX.type.isDomNode(this.input)){t=this.getType();i=this.parent.types;if(t===i.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===i.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===i.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===i.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function e(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function e(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function e(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach((function(e){BX.remove(e)}))}},_onDeleteClick:function e(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function e(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function e(){var t="";var i=this.getInput();if(BX.type.isDomNode(i)){t=i.value}return t},getType:function e(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();(function(){BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(e){if(!!e&&!BX.hasClass(e,"main-ui-control-entity")){e=BX.Filter.Utils.getByClass(e,"main-ui-control-entity")}return!!e&&JSON.parse(BX.data(e,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function e(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function e(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function e(){this.labelInput=null;this.hiddenInput=null},getField:function e(){return this.field},getId:function e(){var t=this.getHiddenNode();var i=null;if(BX.type.isDomNode(t)){i=t.name}return i},getLabelNode:function e(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function e(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function e(t){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(t)+'}"]','[data-item*=":\\"'+BX.util.jsencode(t)+'\\"}"]'].join(", "))},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function e(){this.getSquares().forEach(BX.remove)},setSquare:function e(t,i){var n=this.getField();var s={block:"main-ui-square",name:t,item:{_label:t,_value:i}};var r=BX.decl(s);var a=this.getSquares();if(!a.length){BX.prepend(r,n)}else{BX.insertAfter(r,a[a.length-1])}},getCurrentValues:function e(){var t=this.getSquares();var i,n;if(this.isMultiple()){n=[];for(var s=0,r=t.length;s<r;s++){try{i=JSON.parse(BX.data(t[s],"item"));n.push({label:i._label,value:i._value})}catch(e){}}}else{if(t.length===0){n={label:"",value:""}}else{try{i=JSON.parse(BX.data(t[0],"item"));n={label:i._label,value:i._value}}catch(e){n={label:"",value:""}}}}return n},setData:function e(t,i){return this.isMultiple()?this.setMultipleData(t,i):this.setSingleData(t,i)},setSingleData:function e(t,i){var n=this.getHiddenNode();this.removeSquares();this.setSquare(t,i);if(BX.type.isDomNode(n)){n.value=i;BX.fireEvent(n,"input")}},setMultipleData:function e(t,i){var n=[];var s=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach((function(e){n.push(e.value);this.setSquare(e.label,e.value)}),this);if(BX.type.isDomNode(s)){s.value=JSON.stringify(n);BX.fireEvent(s,"input")}}}if(!BX.type.isArray(t)&&i!==null){if(!this.getSquareByValue(i)){this.setSquare(t,i);this.getSquares().forEach((function(e){var t=JSON.parse(BX.data(e,"item"));if(BX.type.isPlainObject(t)){n.push(t._value)}}));s.value=JSON.stringify(n);BX.fireEvent(s,"input")}}},clearValue:function e(){this.removeSquares();var t=this.getHiddenNode();t.value=this.isMultiple()?"[]":""},setPopupContainer:function e(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function e(){return this.popupContainer}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Search=function(e){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(e)};BX.Filter.Search.prototype={init:function e(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function e(){var t=this.getInput();if(!!t){t.blur();t.autofocus=null}},getFindButton:function e(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function e(){this.apply()},selectSquare:function e(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function e(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function e(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function e(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function e(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function e(){var t=this.getSquares();return t.length&&t.every(this.isSquareSelected,this)},isSquareSelected:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function e(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function e(){var t=this.getSearchString().length;var i=this.getInput();var n=i.selectionStart;var s=i.selectionEnd;return n===0&&s!==0&&s===t},isSelectionStart:function e(){var t=this.getInput();var i=t.selectionStart;var n=t.selectionEnd;return i===0&&n===0},isSquareRemoveButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},getClearButton:function e(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function e(){if(!BX.browser.IsMobile()){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},findSquareByChild:function e(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function e(t){var i=BX.data(t,"item");return!!t&&!!i?JSON.parse(i):null},isSquareControl:function e(t){var i=this.getSquareData(t);return!!i&&(i.type==="control"||BX.type.isArray(i))},onPresetSquareRemove:function e(){var t=this.parent;var i=t.getPreset();var n=i.getCurrentPresetId();var s=t.getParam("RESET_TO_DEFAULT_MODE");var r=t.getParam("VALUE_REQUIRED");var a=i.isPinned(n);var l=this.getSquares();if(l.length===1){if(r&&a){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(s&&a||!s){var o=true;this.lastPromise=t.resetFilter(o);t.closePopup()}}if(s&&!a){this.lastPromise=t.getPreset().applyPinnedPreset()}}if(l.length>1){var u=i.getPreset(i.getCurrentPresetId());var c=i.getPreset("tmp_filter");c.FIELDS=BX.clone(u.ADDITIONAL);u.ADDITIONAL=[];i.deactivateAllPresets();i.applyPreset("tmp_filter");t.applyFilter()}},onControlSquareRemove:function e(t){var i=this.parent;var n=i.getPreset();var s=i.getParam("RESET_TO_DEFAULT_MODE");var r=i.getParam("VALUE_REQUIRED");var a;if(s&&this.getSquares().length===1){if(r){a=this.getSquareData(t);i.clearControls(a);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=i.getPreset().applyPinnedPreset()}}else{a=this.getSquareData(t);i.clearControls(a);i.closePopup();if(BX.type.isArray(a)){a.forEach((function(e){n.removeAdditionalField(e.name)}))}if(BX.type.isPlainObject(a)){n.removeAdditionalField(a.name)}this.apply()}},onValueRequiredSquareRemove:function e(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function e(t){var i=this.parent.getParam("VALUE_REQUIRED_MODE");var n=!this.isSquareControl(t);if(i){this.onValueRequiredSquareRemove()}else{if(n){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function e(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function e(t){!!t&&BX.remove(t)},_onSearchContainerClick:function e(t){var i=this.parent;if(this.isClearButton(t.target)){if(!i.getParam("VALUE_REQUIRED")){if(!i.getParam("VALUE_REQUIRED_MODE")){if(i.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{var n=i.getPreset().isPinned(i.getPreset().getCurrentPresetId());if(n||i.getPreset().getCurrentPresetId()==="tmp_filter"){var s=i.getPreset().getPreset(i.getPreset().getCurrentPresetId());if(s.ADDITIONAL.length){s.ADDITIONAL=[];this.lastPromise=i.getPreset().applyPreset(i.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{if(i.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var r=this.findSquareByChild(t.target);this.complexSquareRemove(r);this.adjustFocus()}else{if(!i.getPopup().isShown()){i.showPopup()}else{var a=this.getInput();var l=a.selectionStart;var o=a.selectionEnd;var u=this.getSearchString().length;if(!(u&&l===0&&o===u)){if(i.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.closePopup()}}else{i.closePopup();if(i.getParam("VALUE_REQUIRED_MODE")){i.restoreRemovedPreset()}}}}}},_onKeyDown:function e(t){var i=BX.Filter.Utils;var n=this.parent;if(i.isKey(t,"enter")){if(n.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}n.closePopup()}if(i.isKey(t,"tab")||i.isKey(t,"downArrow")){n.showPopup();n.adjustFocus();this.unselectSquares()}if(i.isKey(t,"upArrow")){n.closePopup();if(n.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(n.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(i.isKey(t,"a")&&t.metaKey||i.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(i.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var s=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(s){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(i.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var r=this.getLastSquare();this.isSquareSelected(r)?this.complexSquareRemove(r):this.selectSquare(r)}if(!i.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function e(){var t=this.getInput();return!!t?t.value:""},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function e(){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}},isResolvedRequest:function e(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function e(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function e(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate((function(){this.lastPromise=this.parent.resetFilter()}),this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function e(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton();this.parent.setIsSetOutsideState(false);this.parent.setDefaultPresetAppliedState(false)}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}if(this.parent.isAppliedDefaultPreset()){this.parent.setDefaultPresetAppliedState(true)}}if(this.parent.isAppliedUserFilter()){BX.Dom.addClass(this.container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.container,"main-ui-filter-search--active")}},_onInput:function e(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function e(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function e(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function e(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function e(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function e(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function e(t){var i=this.getInput();i.placeholder=t},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function e(){this.clearInput();this.removePreset()},makeSquares:function e(t,i,n){var s;var r=null;var a=this.getContainer();var l={squares:[],moreSquares:[]};t.forEach((function(e,t){if(t<i){s=BX.decl(e);r=r||s;if(!n){if(t===0){BX.prepend(s,a)}else{BX.insertAfter(s,r)}}else{var o=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(o){BX.insertAfter(s,o)}else{BX.prepend(s,a)}}r=s;l.squares.push(s)}else{l.moreSquares.push({type:"control",name:e.value,title:e.title,icon:e.icon})}}),this);return l},squares:function e(t,i,n){var s,r,a,l,o;var e=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(n){e.forEach((function(e){var t=BX.data(e,"item");if(t){BX.remove(e)}}))}else{e.forEach(BX.remove)}s=this.prepareSquaresData(t);r=this.makeSquares(s,i,n);l=0;o={squaresData:s,width:0};if(r.moreSquares.length){a={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+r.moreSquares.length,item:r.moreSquares,title:r.moreSquares.map((function(e){var t=e.title;if("icon"in e&&BX.Type.isPlainObject(e.icon)){var i=e.icon.title;t=t.length?i+": "+t:""}return t})).join(", \n")};a=BX.decl(a);r.squares.push(a);BX.insertAfter(a,r.squares[r.squares.length-2]);l=r.squares.reduce((function(e,t){return e+BX.width(t)+(parseFloat(BX.style(t,"margin-right"))||0)}),0)}o.width=l;return o},setPreset:function e(t){var i=this.getContainer();var n,s;var r;if(BX.type.isPlainObject(t)){s=BX.Filter.Utils.getByClass(i,this.parent.settings.classSquare,true);s.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){n=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(n,i);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){r=this.squares(t.ADDITIONAL,1,true);if(BX.width(i)-r.width<100){r=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach((function(e,i){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+i}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+i}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}}))}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){r=this.squares(t.FIELDS,2);if(BX.width(i)-r.width<100){r=this.squares(t.FIELDS,1)}}}if(r&&BX.type.isArray(r.squaresData)&&r.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"))}this.showClearButton()}else{this.adjustPlaceholder()}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function e(t){var i,n,s;var r=[];t=t.filter((function(e){return!!e&&this.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))}),this);t.map((function(e){i=null;if(!BX.Type.isStringFilled(e.ADDITIONAL_FILTER)){switch(e.TYPE){case this.parent.types.DATE:{i=e.LABEL+": "+e.SUB_TYPE.NAME;if(e.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(e.VALUES._quarter)){var t=e.QUARTERS.filter((function(t){return t.VALUE==e.VALUES._quarter})).map((function(e){return e.NAME}));t=t.length?t.join(""):"";i=e.LABEL+": "+t+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(e.VALUES._year)){i=e.LABEL+": "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(e.VALUES._month)){var a=e.MONTHS.filter((function(t){return t.VALUE==e.VALUES._month})).map((function(e){return e.NAME}));a=a.length?a.join(""):"";i=e.LABEL+": "+a+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+e.VALUES._from}}if((e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(e.VALUES._days))){i=null}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){i=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){i=e.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE||e.STRICT){i=e.LABEL+": "+e.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){n=[];i=e.LABEL+": ";e.VALUE.forEach((function(e,t){if(t<2){n.push(e.NAME)}}));i+=n.join(", ");if(e.VALUE.length>2){s=[];e.VALUE.forEach((function(e){s.push(e.NAME)}));i=s.join(", ")}}break}case this.parent.types.NUMBER:{if(e.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": > ";i+=e.VALUES._from}}if(e.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": < ";i+=e.VALUES._to}}if(e.SUB_TYPE.VALUE==="before_n"){if(BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": < ";i+=e.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:case this.parent.types.ENTITY_SELECTOR:{if(e.MULTIPLE){var l=!!e.VALUES._label?e.VALUES._label:[];if(BX.type.isPlainObject(l)){l=Object.keys(l).map((function(e){return l[e]}))}if(!BX.type.isArray(l)){l=[l]}if(l.length>0){i=e.LABEL+": ";i+=l.join(", ")}}else{if(BX.type.isNotEmptyString(e.VALUES._value)&&BX.type.isNotEmptyString(e.VALUES._label)){i=e.LABEL+": ";i+=e.VALUES._label}}break}case this.parent.types.CUSTOM:{i="_VALUE"in e&&BX.type.isNotEmptyString(e._VALUE)?e.LABEL:null;break}default:{if(BX.type.isNotEmptyString(e.VALUE)){i=e.LABEL+": "+e.VALUE}break}}}else{var o={block:"main-ui-search-square",name:e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY"),value:e.NAME,icon:"ICON"in e?e.ICON:null,item:{type:"control",name:e.NAME},title:e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY")};if(e.ADDITIONAL_FILTER===BX.Filter.AdditionalFilter.Type.HAS_ANY_VALUE){o.name=e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE");o.title=e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE")}r.push(o)}if(i!==null){r.push({block:"main-ui-search-square",name:i,value:e.NAME,icon:"ICON"in e?e.ICON:null,item:{type:"control",name:e.NAME},title:i})}}),this);return r},getPreset:function e(){var t=this.getContainer();var i=this.parent.settings.classSquare;var n=null;if(BX.type.isDomNode(t)){n=BX.Filter.Utils.getByClass(t,i)}return n},removePreset:function e(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);this.adjustPlaceholder()}this.hideClearButton()},updatePreset:function e(t){this.removePreset();this.setPreset(t)}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Settings=function(e,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classPopupFieldList4Column="main-ui-filter-field-list-4-column";this.classPopupFieldList5Column="main-ui-filter-field-list-5-column";this.classPopupFieldList6Column="main-ui-filter-field-list-6-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classLimitsAnimation="main-ui-filter-field-limits-animate";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classSidePanelContainer="side-panel-container";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.classPopupSearchFieldListItemHidden="main-ui-filter-field-list-item-hidden";this.classPopupSearchFieldListItemVisible="main-ui-filter-field-list-item-visible";this.classPopupSearchSectionItem="main-ui-filter-popup-search-section-input";this.classPopupSearchSectionItemIcon="main-ui-filter-popup-search-section-item-icon";this.classPopupSearchSectionItemIconActive="main-ui-filter-popup-search-section-item-icon-active";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.maxPopupColumnCount=6;this.popupWidth=630;this.init(e,t)};BX.Filter.Settings.prototype={init:function e(t,i){this.generalTemplateId=i.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(t)},get:function e(t,i){return t&&t in this&&!BX.type.isFunction(this[t])?this[t]:i},mergeSettings:function e(t){if(BX.type.isPlainObject(t)){Object.keys(t).forEach((function(e){if(!BX.type.isFunction(this[e])){this[e]=t[e]}}),this)}}}})();var d,h;function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var m=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getInstance",value:function e(){return t.cache.remember("instance",(function(){return new t}))}},{key:"fetchAdditionalFilter",value:function e(i,n){if(a.Type.isStringFilled(i)&&a.Type.isPlainObject(n)){if("".concat(i,"_").concat(t.Type.IS_EMPTY)in n){return t.Type.IS_EMPTY}if("".concat(i,"_").concat(t.Type.HAS_ANY_VALUE)in n){return t.Type.HAS_ANY_VALUE}}return null}}]);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"cache",new a.Cache.MemoryCache);e.setEventNamespace("BX.Main.Filter.AdditionalFilter");e.options=f({},i);a.Event.bind(document,"click",e.onDocumentClick.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(t,[{key:"getAdditionalFilterMenu",value:function e(){var i=this;return this.cache.remember("menu",(function(){return new r.Menu({id:"additional_filter_menu",autoHide:false,items:[{id:"isEmpty",text:a.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_MENU_IS_EMPTY"),onclick:i.onAdditionalFilterMenuItemClick.bind(i,t.Type.IS_EMPTY)},{id:"hasAnyValue",text:a.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_MENU_HAS_ANY_VALUE"),onclick:i.onAdditionalFilterMenuItemClick.bind(i,t.Type.HAS_ANY_VALUE)},{id:"delimiter",delimiter:true},{id:"helper",html:a.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HOW")+'<span class="ui-hint"><span class="ui-hint-icon"></span></span>',onclick:function e(){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=14006190");event.preventDefault()}}}]})}))}},{key:"onAdditionalFilterMenuItemClick",value:function e(t){var i=this.getCurrentFieldNode();this.initAdditionalFilter(i,t)}},{key:"onDocumentClick",value:function e(){this.getAdditionalFilterMenu().close()}},{key:"setCurrentFieldId",value:function e(t){this.cache.set("currentFieldId",t)}},{key:"getCurrentFieldId",value:function e(){return this.cache.get("currentFieldId","")}},{key:"setCurrentFieldNode",value:function e(t){this.cache.set("currentFieldNode",t)}},{key:"getCurrentFieldNode",value:function e(){return this.cache.get("currentFieldNode")}},{key:"onAdditionalFilterButtonClick",value:function e(t,i){i.stopPropagation();var n=i.currentTarget;this.setCurrentFieldId(t);this.setCurrentFieldNode(n.parentElement);var s=this.getAdditionalFilterMenu();var r=String(a.Dom.attr(n,"data-allowed-types")).split(",");s.getMenuItems().forEach((function(e){var t=e.getId();if(r.includes(t)||t==="helper"||t==="delimiter"){a.Dom.removeClass(e.layout.item,"main-ui-disable")}else{a.Dom.addClass(e.layout.item,"main-ui-disable")}}));if(s.getPopupWindow().isShown()){if(s.getPopupWindow().bindElement!==n){s.getPopupWindow().setBindElement(n);s.getPopupWindow().adjustPosition()}else{s.close()}}else{s.getPopupWindow().setBindElement(n);s.show()}}},{key:"getAdditionalFilterButton",value:function e(i){var n=this;var s=i.fieldId,r=i.enabled;return this.cache.remember("field_".concat(s),(function(){var e=!a.Type.isArrayFilled(r)&&r!==true;var i=function(){if(a.Type.isArrayFilled(r)){return r.join(",")}if(!e){return[t.Type.IS_EMPTY,t.Type.HAS_ANY_VALUE].join(",")}return""}();return a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="ui-icon ui-icon-service-light-other main-ui-filter-additional-filters-button','"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tdata-allowed-types="','"\n\t\t\t\t>\n\t\t\t\t\t<i></i>\n\t\t\t\t</span>\n\t\t\t'])),e?" main-ui-disable":"",n.onAdditionalFilterButtonClick.bind(n,s),i)}))}},{key:"initAdditionalFilter",value:function e(t,i){var n=this.getCurrentFieldId();if(n===""){n=t.attributes[1].value}var s=this.getAdditionalFilterPlaceholderField(n,i);a.Dom.addClass(t,"main-ui-filter-field-with-additional-filter");var r=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(r){a.Dom.replace(r,s)}else{a.Dom.append(s,t)}}},{key:"restoreField",value:function e(t){if(a.Type.isDomNode(t)){var i=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(i){a.Dom.remove(i)}a.Dom.removeClass(t,"main-ui-filter-field-with-additional-filter")}}},{key:"getAdditionalFilterPlaceholderField",value:function e(i,n){var s=this;return this.cache.remember("placeholder_".concat(i,"_").concat(n),(function(){var e=function(){if(n===t.Type.HAS_ANY_VALUE){return a.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE")}return a.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY")}();var i=function e(t){s.restoreField(t.currentTarget.closest(".main-ui-filter-field-with-additional-filter"))};return a.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-control main-ui-filter-additional-filter-placeholder" data-type="','">\n\t\t\t\t\t<div class="main-ui-square">\n\t\t\t\t\t\t<div class="main-ui-square-item">','</div>\n\t\t\t\t\t\t<div class="main-ui-item-icon main-ui-square-delete" onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),n,e,i)}))}},{key:"getFilter",value:function e(t){if(a.Type.isDomNode(t)){var i=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(a.Type.isDomNode(i)){var n=a.Dom.attr(i,"data-type");var s=a.Dom.attr(t,"data-name");return babelHelpers.defineProperty({},"".concat(s,"_").concat(n),"y")}}return null}}]);return t}(s.EventEmitter);babelHelpers.defineProperty(m,"Type",{IS_EMPTY:"isEmpty",HAS_ANY_VALUE:"hasAnyValue"});babelHelpers.defineProperty(m,"cache",new a.Cache.MemoryCache);var g=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.presets=null;this.container=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t}},{key:"bindOnPresetClick",value:function e(){var t=this;(this.getPresets()||[]).forEach((function(e){a.Event.bind(e,"click",BX.delegate(t._onPresetClick,t))}))}},{key:"getAddPresetField",value:function e(){return this.getContainer().querySelector(".main-ui-filter-new-filter")}},{key:"getAddPresetFieldInput",value:function e(){return this.getAddPresetField().querySelector(".main-ui-filter-sidebar-edit-control")}},{key:"clearAddPresetFieldInput",value:function e(){var t=this.getAddPresetFieldInput();if(a.Type.isDomNode(t)){t.value=""}}},{key:"normalizePreset",value:function e(t){return t.closest(".main-ui-filter-sidebar-item")}},{key:"deactivateAllPresets",value:function e(){this.getPresets().forEach((function(e){a.Dom.removeClass(e,"main-ui-filter-current-item")}))}},{key:"createSidebarItem",value:function e(t,i,n){return BX.decl({block:"sidebar-item",text:a.Text.decode(i),id:t,pinned:n,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})}},{key:"activatePreset",value:function e(t){var i=this;this.deactivateAllPresets();var n=function(){if(a.Type.isString(t)){return i.getPresetNodeById(t)}return t}();if(a.Type.isDomNode(n)){a.Dom.addClass(n,"main-ui-filter-current-item")}}},{key:"getPresetNodeById",value:function e(t){return this.getPresets().find((function(e){return a.Dom.attr(e,"data-id")===t}))}},{key:"getPresetId",value:function e(t){return a.Dom.attr(t,"data-id")}},{key:"updatePresetName",value:function e(t,i){if(a.Type.isDomNode(t)&&a.Type.isString(i)&&i!==""){var n=this.getPresetNameNode(t);if(a.Type.isDomNode(n)){a.Runtime.html(n,i)}}}},{key:"removePreset",value:function e(t,i,n){var s=this.getCurrentPresetId();var r=[];var a={preset_id:i,is_default:n};var l={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(a,l);BX.remove(t);if(BX.type.isArray(this.parent.params.PRESETS)){r=this.parent.params.PRESETS.filter((function(e){return e.ID!==i}),this);this.parent.params.PRESETS=r}if(BX.type.isArray(this.parent.editablePresets)){r=this.parent.editablePresets.filter((function(e){return e.ID!==i}),this);this.parent.editablePresets=r}if(i===s){this.parent.getSearch().removePreset();this.resetPreset()}}},{key:"pinPreset",value:function e(t){if(!BX.type.isNotEmptyString(t)){t="default_filter"}var i=this.getPresetNodeById(t);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(t==="default_filter"){return}}var n={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var s={preset_id:t};this.getPresets().forEach((function(e){a.Dom.removeClass(e,this.parent.settings.classPinnedPreset)}),this);BX.addClass(i,this.parent.settings.classPinnedPreset);this.parent.saveOptions(s,n)}},{key:"_onPresetClick",value:function e(t){var i;var n;var s;var r;var l;var o;var u;t.preventDefault();u=this.parent;o=u.settings;l=t.target;i=t.currentTarget;n=this.getPresetId(i);s=this.getPreset(n);if(a.Dom.hasClass(l,o.classPinButton)){if(this.parent.isEditEnabled()){if(a.Dom.hasClass(i,o.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(n)}}}if(a.Dom.hasClass(l,o.classPresetEditButton)){this.enableEditPresetName(i)}if(a.Dom.hasClass(l,o.classPresetDeleteButton)){r="IS_DEFAULT"in s?s.IS_DEFAULT:false;this.removePreset(i,n,r);return false}if(!a.Dom.hasClass(l,o.classPresetDragButton)&&!a.Dom.hasClass(l,o.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var c=this.getPreset(this.getCurrentPresetId());var d=this.getPreset(n);c.ADDITIONAL=[];d.ADDITIONAL=[];this.activatePreset(i);this.applyPreset(n);if(!this.parent.isEditEnabled()){u.applyFilter(null,true);if(t.isTrusted){u.closePopup()}if(u.isAddPresetEnabled()){u.disableAddPreset()}}}}},{key:"applyPinnedPreset",value:function e(){var t=this.parent;var i=this.isPinned(this.getCurrentPresetId());var n;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();n=this.parent.applyFilter()}else if(!i){var s=this.getPinnedPresetId();var r=this.getPreset(s);r.ADDITIONAL=[];var a=this.getPinnedPresetNode();var l=false;var o=true;this.deactivateAllPresets();this.activatePreset(a);this.applyPreset(s);n=t.applyFilter(l,o);t.closePopup()}else{n=t.resetFilter()}return n}},{key:"updateEditablePreset",value:function e(t){var i=this.parent.getFilterFieldsValues();var n=this.getFields().map((function(e){return BX.data(e,"name")}));var s=this.parent.preparePresetFields(i,n);var r=this.getPreset(t);r.FIELDS=s;r.TITLE=this.getPresetInput(this.getPresetNodeById(t)).value;r.ROWS=n}},{key:"getPresetInput",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetEditInput)}},{key:"enableEditPresetName",value:function e(t){var i=this.getPresetInput(t);BX.addClass(t,this.parent.settings.classPresetNameEdit);i.select();i.value=BX.util.htmlspecialcharsback(i.value);a.Event.bind(i,"input",BX.delegate(this._onPresetNameInput,this))}},{key:"_onPresetNameInput",value:function e(t){var i=this.parent.getSearch();var n=t.currentTarget.value;var s=BX.findParent(t.currentTarget,{className:this.parent.settings.classPreset},true,false);var r=this.getPresetId(s);var a=this.getCurrentPresetId();var l={ID:r,TITLE:n};if(r===a){i.updatePreset(l)}}},{key:"getPresetNameNode",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetName)}},{key:"disableEditPresetName",value:function e(t){var i=this.getPresetInput(t);a.Dom.removeClass(t,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(i)){i.blur();BX.unbind(i,"input",BX.delegate(this._onPresetNameInput,this))}}},{key:"getPreset",value:function e(t,i){var n=this.parent.getParam(i?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!i){n=this.parent.editablePresets}var s=n.filter((function(e){return e.ID===t}));if(t==="tmp_filter"&&!s.length){var r=BX.clone(this.getPreset("default_filter"));r.ID="tmp_filter";n.push(r);s.push(r)}return s.length!==0?s[0]:null}},{key:"getPresetField",value:function e(t,i){var n=this.getPreset(t);var s=null;if(BX.type.isPlainObject(n)&&"FIELDS"in n&&BX.type.isArray(n.FIELDS)){s=n.FIELDS.filter((function(e){return e.NAME===i}));s=s.length?s[0]:null}return s}},{key:"applyPreset",value:function e(t,i){t=i?"default_filter":t||"default_filter";var n=this.getPreset(t);if(t!=="default_preset"){n=this.extendPreset(n)}this.parent.getSearch().updatePreset(n);this.updatePresetFields(n,i);BX.onCustomEvent("BX.Main.Filter:onApplyPreset",[t])}},{key:"extendPreset",value:function e(t){var i=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(t)){t=BX.clone(t);t.FIELDS.forEach((function(e){var t;var n=i.FIELDS.some((function(i,n){var s=false;if(i.NAME===e.NAME){t=n;s=true}return s}),this);if(n&&t||n&&t===0){i.FIELDS[t]=e}else if(!this.isEmptyField(e)){i.FIELDS.push(e)}}),this);t.FIELDS=i.FIELDS}return t}},{key:"isEmptyField",value:function e(t){var i=true;if(a.Type.isStringFilled(t.ADDITIONAL_FILTER)){return false}if(t.TYPE===this.parent.types.STRING){if(t.VALUE&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(t.VALUE)&&"VALUE"in t.VALUE&&t.VALUE.VALUE){i=false}}if(t.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(t.VALUE)&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_ENTITY||t.TYPE===this.parent.types.DEST_SELECTOR||t.TYPE===this.parent.types.ENTITY_SELECTOR){if(BX.type.isPlainObject(t.VALUES)){if(BX.type.isNotEmptyString(t.VALUES._label)&&BX.type.isNotEmptyString(t.VALUES._value)){i=false}if(BX.type.isPlainObject(t.VALUES._label)&&BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._label).length&&Object.keys(t.VALUES._value).length){i=false}if(BX.type.isArray(t.VALUES._label)&&BX.type.isArray(t.VALUES._value)&&t.VALUES._label.length&&t.VALUES._value.length){i=false}if((BX.type.isArray(t.VALUES._label)&&t.VALUES._label.length||BX.type.isPlainObject(t.VALUES._label)&&Object.keys(t.VALUES._label).length)&&(BX.type.isArray(t.VALUES._value)&&t.VALUES._value.length||BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._value).length)){i=false}}}if(t.TYPE===this.parent.types.DATE){var n="_datesel"in t.VALUES?t.VALUES._datesel:t.SUB_TYPE.VALUE;if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to||t.VALUES._quarter||t.VALUES._month&&!BX.type.isArray(t.VALUES._month)||t.VALUES._year&&!BX.type.isArray(t.VALUES._year)||t.VALUES._days&&!BX.type.isArray(t.VALUES._days))||BX.type.isArray(t.VALUES._days)&&t.VALUES._days.length||BX.type.isArray(t.VALUES._month)&&t.VALUES._month.length||BX.type.isArray(t.VALUES._year)&&t.VALUES._year.length||n===this.parent.dateTypes.CURRENT_DAY||n===this.parent.dateTypes.CURRENT_WEEK||n===this.parent.dateTypes.CURRENT_MONTH||n===this.parent.dateTypes.CURRENT_QUARTER||n===this.parent.dateTypes.LAST_7_DAYS||n===this.parent.dateTypes.LAST_30_DAYS||n===this.parent.dateTypes.LAST_60_DAYS||n===this.parent.dateTypes.LAST_90_DAYS||n===this.parent.dateTypes.LAST_WEEK||n===this.parent.dateTypes.LAST_MONTH||n===this.parent.dateTypes.TOMORROW||n===this.parent.dateTypes.YESTERDAY||n===this.parent.dateTypes.NEXT_WEEK||n===this.parent.dateTypes.NEXT_MONTH){i=false}}if(t.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to)){i=false}}if(t.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE){i=false}}return i}},{key:"resetPreset",value:function e(t){this.applyPreset("",t)}},{key:"getFields",value:function e(){var t=this.parent.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getBySelector(t.parentNode,".".concat(this.parent.settings.classFileldControlList," > div"),true)}return i}},{key:"getField",value:function e(t){var i=this.getFields();var n=null;var s;var r;if(BX.type.isArray(i)&&i.length){r=i.filter((function(e){if(BX.type.isDomNode(e)){s=BX.data(e,"name")}return s===t.NAME}),this);n=r.length>0?r[0]:null}return n}},{key:"removeField",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n;var s;i=i||false;if(BX.type.isPlainObject(t)){s=t.NAME;t=this.getField(t);if(BX.type.isArray(this.parent.fieldsList)){n=this.parent.fieldsList.indexOf(t);if(n!==-1){delete this.parent.fieldsList[n]}}this.parent.unregisterDragItem(t)}if(BX.type.isDomNode(t)){s=BX.data(t,"name");this.parent.getFields().deleteField(t)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,s);if(a&&!this.isEmptyField(a)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!i){this.parent.saveFieldsSort()}}},{key:"removeFields",value:function e(t){t.forEach((function(e){this.removeField(e,true)}),this);this.parent.saveFieldsSort()}},{key:"addField",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n;var s;var r;if(BX.type.isPlainObject(t)){n=this.parent.getFieldListContainer();r=this.parent.getControls();s=BX.type.isArray(r)?r[r.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){t.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{t.TABINDEX=2}if(BX.type.isDomNode(n)){s=this.createControl(t);if(BX.type.isDomNode(s)){BX.append(s,n);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var l=this.getPresetField(a,t.NAME);if(l&&!this.isEmptyField(l)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}if(!i){this.parent.saveFieldsSort()}}},{key:"createControl",value:function e(t){var i;switch(t.TYPE){case this.parent.types.STRING:{i=this.parent.getFields().createInputText(t);break}case this.parent.types.TEXTAREA:{i=this.parent.getFields().createTextarea(t);break}case this.parent.types.SELECT:{i=this.parent.getFields().createSelect(t);break}case this.parent.types.MULTI_SELECT:{i=this.parent.getFields().createMultiSelect(t);break}case this.parent.types.NUMBER:{i=this.parent.getFields().createNumber(t);break}case this.parent.types.DATE:{i=this.parent.getFields().createDate(t);break}case this.parent.types.CUSTOM_DATE:{i=this.parent.getFields().createCustomDate(t);break}case this.parent.types.DEST_SELECTOR:{i=this.parent.getFields().createDestSelector(t);break}case this.parent.types.ENTITY_SELECTOR:{i=this.parent.getFields().createEntitySelector(t);break}case this.parent.types.CUSTOM:{i=this.parent.getFields().createCustom(t);break}case this.parent.types.CUSTOM_ENTITY:{i=this.parent.getFields().createCustomEntity(t);break}default:{break}}if(this.parent.getParam("ENABLE_ADDITIONAL_FILTERS")){var n=m.getInstance();var s=n.getAdditionalFilterButton({fieldId:t.NAME,enabled:t.ADDITIONAL_FILTER_ALLOWED});a.Dom.append(s,i);if(!t.ADDITIONAL_FILTER_ALLOWED){BX.Dom.addClass(i,"main-ui-filter-additional-filters-hide")}if(a.Type.isStringFilled(t.ADDITIONAL_FILTER)){n.initAdditionalFilter(i,t.ADDITIONAL_FILTER)}}if(BX.type.isDomNode(i)){i.dataset.name=t.NAME;i.FieldController=new BX.Filter.FieldController(i,this.parent);if(t.REQUIRED){var r=i.querySelector(".main-ui-filter-field-delete");if(r){BX.remove(r)}}}return i}},{key:"removeNotCompareVariables",value:function e(t,i){if(BX.type.isPlainObject(t)){var n=this.parent.dateTypes;var s=this.parent.additionalDateTypes;if("FIND"in t){delete t.FIND}if(!i){Object.keys(t).forEach((function(e){if(e.indexOf("_numsel")!==-1){delete t[e]}if(e.indexOf("_datesel")!==-1){var i=t[e];if(i===n.EXACT||i===n.RANGE||i===s.PREV_DAY||i===s.NEXT_DAY||i===s.MORE_THAN_DAYS_AGO||i===s.AFTER_DAYS||i===n.PREV_DAYS||i===n.NEXT_DAYS||i===n.YEAR||i===n.MONTH||i===n.QUARTER||i===n.NONE||i===n.CUSTOM_DATE){delete t[e]}}var r=this.parent.getFieldByName(e);if(t[e]===""&&(!r||!r.STRICT)){delete t[e]}}),this)}}}},{key:"isPresetValuesModified",value:function e(t){var i=this.getPreset(t);var n=this.parent.preparePresetSettingsFields(i.FIELDS);var s=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(n);this.removeNotCompareVariables(s);var r=BX.Filter.Utils.sortObject(n);var a=BX.Filter.Utils.sortObject(s);return!Object.keys(r).every((function(e){return r[e]===a[e]||(BX.type.isPlainObject(r[e])||BX.type.isArray(r[e]))&&BX.Filter.Utils.objectsIsEquals(r[e],a[e])}))}},{key:"getAdditionalValues",value:function e(t){var i=this.getPreset(t);var n=i.FIELDS.filter((function(e){return!this.isEmptyField(e)}),this);var s=this.parent.preparePresetSettingsFields(n);var r=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s,true);this.removeNotCompareVariables(r,true);this.removeSameProperties(r,s);return r}},{key:"removeSameProperties",value:function e(t,i){if(BX.type.isPlainObject(t)&&BX.type.isPlainObject(i)){Object.keys(i).forEach((function(e){if(e in t){delete t[e]}}))}}},{key:"removeAdditionalField",value:function e(t){var i=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(i.ADDITIONAL)){i.ADDITIONAL=i.ADDITIONAL.filter((function(e){return e.NAME!==t}))}}},{key:"updatePresetFields",value:function e(t,i){var n=this;var s;var r;var a=[];if(BX.type.isPlainObject(t)&&"FIELDS"in t){s=t.FIELDS;if(BX.type.isArray(t.ADDITIONAL)){t.ADDITIONAL.filter((function(e){return n.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))})).forEach((function(e){var t=false;e.IS_PRESET_FIELD=true;s.forEach((function(i,n){if(e.NAME===i.NAME){s[n]=e;t=true}}));if(!t){s.push(e)}}))}(s||[]).filter((function(e){return n.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))})).forEach((function(e,t){e.TABINDEX=t+1;if(i){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{e.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}a.push(this.createControl(e))}),this);this.parent.disableFieldsDragAndDrop();r=this.parent.getFieldListContainer();BX.cleanNode(r);if(a.length){a.forEach((function(e,i){if(BX.type.isDomNode(e)){if(t.ID!=="tmp_filter"&&t.ID!=="default_filter"&&!("IS_PRESET_FIELD"in s[i])&&!this.isEmptyField(s[i])){BX.addClass(e,this.parent.settings.classPresetField)}BX.append(e,r);if(BX.type.isString(s[i].HTML)){var n=BX.create("div");this.parent.getHiddenElement().appendChild(n);BX.html(n,s[i].HTML)}}}),this);this.parent.enableFieldsDragAndDrop()}}}},{key:"showCurrentPresetFields",value:function e(){var t=this.getCurrentPresetData();this.updatePresetFields(t)}},{key:"getCurrentPreset",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)}},{key:"getCurrentPresetId",value:function e(){var t=this.getCurrentPreset();var i=null;if(BX.type.isDomNode(t)){i=this.getPresetId(t)}else{i="tmp_filter"}return i}},{key:"getCurrentPresetData",value:function e(){var t=this.getCurrentPresetId();var i=null;if(BX.type.isNotEmptyString(t)){i=this.getPreset(t);i=this.extendPreset(i)}return i}},{key:"getContainer",value:function e(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)}},{key:"getPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)}},{key:"getDefaultPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)}},{key:"getPinnedPresetNode",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)}},{key:"isPinned",value:function e(t){return this.getPinnedPresetId()===t}},{key:"getPinnedPresetId",value:function e(){var t=this.getPinnedPresetNode();var i="default_filter";if(t){var n=BX.data(t,"id");i=n||i}return i}}]);return e}();var E,y,v,B,A,P,S,_;function L(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */L=function t(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function e(t,i,n){return t[i]=n}}function u(e,t,i,s){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),l=new b(s||[]);return n(a,"_invoke",{value:A(e,i,l)}),a}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function h(){}function p(){}function f(){}var m={};o(m,r,(function(){return this}));var g=Object.getPrototypeOf,E=g&&g(g(I([])));E&&E!==t&&i.call(E,r)&&(m=E);var y=f.prototype=h.prototype=Object.create(m);function v(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function B(e,t){function s(n,r,a,l){var o=c(e[n],e,r);if("throw"!==o.type){var u=o.arg,d=u.value;return d&&"object"==babelHelpers["typeof"](d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){s("next",e,a,l)}),(function(e){s("throw",e,a,l)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return s("throw",e,a,l)}))}l(o.arg)}var r;n(this,"_invoke",{value:function e(i,n){function a(){return new t((function(e,t){s(i,n,e,t)}))}return r=r?r.then(a,a):a()}})}function A(e,t,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return T()}for(i.method=s,i.arg=r;;){var a=i.delegate;if(a){var l=P(a,i);if(l){if(l===d)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var o=c(e,t,i);if("normal"===o.type){if(n=i.done?"completed":"suspendedYield",o.arg===d)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(n="completed",i.method="throw",i.arg=o.arg)}}}function P(e,t){var i=t.method,n=e.iterator[i];if(undefined===n)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=undefined,P(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var s=c(n,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,d;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return s.next=s}}return{next:T}}function T(){return{value:undefined,done:!0}}return p.prototype=f,n(y,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:p,configurable:!0}),p.displayName=o(f,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},v(B.prototype),o(B.prototype,a,(function(){return this})),e.AsyncIterator=B,e.async=function(t,i,n,s,r){void 0===r&&(r=Promise);var a=new B(u(t,i,n,s),r);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(y),o(y,l,"Generator"),o(y,r,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,b.prototype={constructor:b,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var n=this;function s(e,i){return l.type="throw",l.arg=t,n.next=e,i&&(n.method="next",n.arg=undefined),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],l=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var o=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function e(t,n){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var l=a?a.completion:{};return l.type=t,l.arg=n,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(l)},complete:function e(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),d},finish:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),d}},catch:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc===t){var s=n.completion;if("throw"===s.type){var r=s.arg;_(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function e(t,i,n){return this.delegate={iterator:I(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=undefined),d}},e}function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function I(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?b(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}(function(){BX.namespace("BX.Main");BX.Main.Filter=function(e,t,i,n,s,r,a){this.params=e;this.search=null;this.popup=null;this.checkboxListPopup=null;this.presets=null;this.fields=null;this.types=i;this.dateTypes=n;this.additionalDateTypes=r;this.additionalNumberTypes=a;this.numberTypes=s;this.settings=new BX.Filter.Settings(t,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.analyticsLabel=null;this.emitter=new BX.Event.EventEmitter;this.emitter.setEventNamespace("BX.Filter.Field");this.emitter.subscribe=function(e,t){BX.Event.EventEmitter.subscribe(this.emitter,e.replace("BX.Filter.Field:",""),t)}.bind(this);this.enableFieldsSearch=null;this.enableHeadersSections=null;this.init()};function e(e){if(BX.type.isString(e)){e=e.toLowerCase();e=e.replace(/[\-_\s]+(.)?/g,(function(e,t){return t?t.toUpperCase():""}));return e.substr(0,1).toLowerCase()+e.substr(1)}return e}BX.Main.Filter.prototype={init:function e(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"));this.enableFieldsSearch=this.getParam("ENABLE_FIELDS_SEARCH",false);this.enableHeadersSections=this.getParam("HEADERS_SECTIONS",false);if(this.isAppliedDefaultPreset()){this.setDefaultPresetAppliedState(true)}},getEmitter:function e(){return this.emitter},onWindowLoad:function e(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function e(){if("history"in window){var t=window.location.toString();var i=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",i)}},adjustFocus:function e(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function e(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function e(t,i,n){var s=this.getPreset();var r=s.getContainer();var a=s.createSidebarItem(t,i,n);var l=s.getPresetNodeById(t);if(BX.type.isDomNode(l)){BX.remove(l);r.insertBefore(a,s.getAddPresetField())}else{r&&r.insertBefore(a,s.getAddPresetField())}BX.bind(a,"click",BX.delegate(s._onPresetClick,s))},saveUserSettings:function e(t){var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var n=this.getPreset();var s=n.getCurrentPresetId();var r={};this.params["PRESETS"]=BX.clone(this.editablePresets);r.current_preset=s;n.getPresets().forEach((function(e,i){var s=n.getPresetId(e);if(s&&s!=="tmp_filter"){var a=n.getPreset(s);a.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(a.TITLE));a.SORT=i;n.updatePresetName(e,a.TITLE);r[s]={sort:i,name:a.TITLE,fields:this.preparePresetSettingsFields(a.FIELDS),rows:a.FIELDS.map((function(e){return e.NAME})),for_all:t&&!BX.type.isBoolean(a.FOR_ALL)||t&&a.FOR_ALL===true}}}),this);this.saveOptions(r,i,null,t)},isForAll:function e(t){var i=this.getForAllCheckbox();return BX.type.isBoolean(t)&&t||!!i&&!!i.checked},getForAllCheckbox:function e(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function e(t){var i={};var n;(t||[]).forEach((function(e){switch(e.TYPE){case this.types.STRING:{i[e.NAME]=e.VALUE;break}case this.types.TEXTAREA:{i[e.NAME]=e.VALUE;break}case this.types.SELECT:{i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach((function(t,n){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][n]=t.VALUE}),this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach((function(t,n){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][n]=t.VALUE}),this)}break}case this.types.DATE:{if(BX.type.isPlainObject(e.VALUES)){n=Object.keys(e.VALUES);i[e.NAME+"_datesel"]=e.SUB_TYPE.VALUE;n.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}),this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(e.VALUES)){n=Object.keys(e.VALUES);i[e.NAME+"_numsel"]=e.SUB_TYPE.VALUE;n.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}),this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}default:{break}}}),this);return i},savePreset:function e(){var t="filter_"+ +new Date;var i=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,i,null,true,null,null,true);this.addSidebarItem(t,i);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function e(t,i,n,s,r,a,l){var o=this.getFilterFieldsValues();var u=this.getPreset().getFields().map((function(e){return BX.data(e,"name")}));var c=this.getPreset().getCurrentPresetData();var d={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var h,p,f,m,g;var E={};E.additional={};if(t!=="tmp_filter"&&t!=="default_filter"&&!l){var y=BX.type.isArray(c.ADDITIONAL)?c.ADDITIONAL:[];y.forEach((function(e){Object.keys(o).forEach((function(t){if(t.indexOf(e.NAME)!==-1){E.additional[t]=o[t];delete o[t]}}))}))}h=Object.keys(o);if(!n){E.apply_filter="Y"}else{E.clear_filter="Y"}E.save="Y";E.fields=o;E.rows=u.join(",");E.preset_id=t||c.ID;if(BX.type.isNotEmptyString(i)){E.name=BX.util.htmlspecialchars(i)}else{f=this.getPreset().getPresetNodeById(E.preset_id);m=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(m)&&BX.type.isNotEmptyString(m.value)){E.name=m.value}else{E.name=c.TITLE}}if((!("sort"in E)||!BX.type.isNumber(E.sort))&&s){g=this.getParam("PRESETS");E.sort=g.length+2}if(!n){h.forEach((function(e){if(BX.type.isArray(E.fields[e])){p=E.fields[e].length?{}:"";E.fields[e].forEach((function(e,t){p[t]=e}),this);if(p||BX.type.isNumber(p)||BX.type.isBoolean(p)){E.fields[e]=p}}}),this)}if(E.preset_id==="tmp_filter"||this.isAddPresetEnabled()||n){this.updateParams(E)}if(BX.type.isFunction(r)){r()}var v=new BX.Promise(null,this);v.setAutoResolve("fulfill",0);v.then((function(){var e=new BX.Promise(null,this);this.saveOptions(E,d,BX.proxy(e.fulfill,e));return e})).then((function(){!!a&&a()}));return v},saveFieldsSort:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var i=this.getPreset().getFields();var n={};n.preset_id="default_filter";if(BX.type.isArray(i)){n.rows=i.map((function(e){return BX.data(e,"name")}));n.rows=n.rows.join(",")}this.updateParams(n);this.saveOptions(n,t)},updateParams:function e(t){var i,n;if(BX.type.isPlainObject(t)&&"preset_id"in t){i=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(i)){if("name"in t&&BX.type.isNotEmptyString(t.name)){i.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach((function(e){t.fields[e]=""}))}if("fields"in t){i.FIELDS=this.preparePresetFields(t.fields,t.rows)}if("additional"in t&&i.ID!=="tmp_filter"){i.ADDITIONAL=this.preparePresetFields(t.additional,t.rows)}}else{n=this.getParam("PRESETS");i={ID:t.preset_id,TITLE:t.name,SORT:n.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};n.push(i)}}},preparePresetFields:function e(t,i){var n,s;var r=[];if(BX.type.isPlainObject(t)){i=BX.type.isNotEmptyString(i)?i.split(","):[];n=i.length?i:Object.keys(t);n.forEach((function(e){e=e.replace("_datesel","").replace("_numsel","").replace("_"+BX.Filter.AdditionalFilter.Type.IS_EMPTY,"").replace("_"+BX.Filter.AdditionalFilter.Type.HAS_ANY_VALUE,"");s=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(s)){s.ADDITIONAL_FILTER=BX.Filter.AdditionalFilter.fetchAdditionalFilter(e,t);if(!BX.Type.isStringFilled(s.ADDITIONAL_FILTER)){if(s.TYPE===this.types.STRING){s.VALUE=t[e]}if(s.TYPE===this.types.TEXTAREA){s.VALUE=t[e]}if(s.TYPE===this.types.MULTI_SELECT){s.VALUE=this.prepareMultiSelectValue(t[e],s.ITEMS)}if(s.TYPE===this.types.SELECT||s.TYPE===this.types.CHECKBOX){s.VALUE=this.prepareSelectValue(t[e],s.ITEMS)}if(s.TYPE===this.types.DATE){s.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],s.SUB_TYPES);s.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_month"],_quarter:t[e+"_quarter"],_year:t[e+"_year"],_allow_year:t[e+"_allow_year"]}}if(s.TYPE===this.types.CUSTOM_DATE){s.VALUE={days:Object.keys(t[e+"_days"]||{}).map((function(i){return t[e+"_days"][i]})),months:Object.keys(t[e+"_months"]||{}).map((function(i){return t[e+"_months"][i]})),years:Object.keys(t[e+"_years"]||{}).map((function(i){return t[e+"_years"][i]}))}}if(s.TYPE===this.types.NUMBER){s.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],s.SUB_TYPES);s.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(s.TYPE===this.types.DEST_SELECTOR||s.TYPE===this.types.ENTITY_SELECTOR||s.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){s.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){s.VALUES._value=t[e]}}if(s.TYPE===this.types.CUSTOM){s._VALUE=t[e]}}r.push(s)}}),this)}return r},prepareSelectValue:function e(t,i){var n={};var s;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(i)){s=this.prepareMultiSelectValue({0:t},i);n=s.length>0?s[0]:{}}else{n=i[0]}return n},prepareMultiSelectValue:function e(t,i){var n=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(i)){var s=Object.keys(t);var r=s.map((function(e){return t[e]}));n=i.filter((function(e){return r.some((function(t){return t===e.VALUE}))}),this)}return n},getFieldByName:function e(t){var i=this.getParam("FIELDS");var n=i.find((function(e){return e.NAME===t}));if(n){return n}var s=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');n=BX.Filter.Field.instances.get(s);if(n){return n.options}return null},confirmSaveForAll:function e(){return new Promise(function(e){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,e)}.bind(this))},saveOptions:function t(i,n,s,r){n.action=e(n.action);n.forAll=this.isForAll(r);n.commonPresetsId=this.getParam("COMMON_PRESETS_ID");n.apply_filter=i.apply_filter||"N";n.clear_filter=i.clear_filter||"N";n.with_preset=i.with_preset||"N";n.save=i.save||"N";n.isSetOutside=this.isSetOutside();var a={params:n,data:i};delete i.apply_filter;delete i.save;delete i.clear_filter;delete i.with_preset;if(n.forAll&&n.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(n.action,a)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(n.action,a).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(s)&&s()}.bind(this))},backend:function e(t,i){var n=this.analyticsLabel||{};this.analyticsLabel={};return BX.ajax.runComponentAction("bitrix:main.ui.filter",t,{mode:"ajax",data:i,analyticsLabel:I({FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),PRESET_ID:i["data"]["preset_id"],FIND:i["data"].hasOwnProperty("fields")&&i["data"]["fields"].hasOwnProperty("FIND")&&!!i["data"]["fields"]["FIND"]?"Y":"N",ROWS:BX.Type.isObject(i["data"]["additional"])&&Object.keys(i["data"]["additional"]).length==0?"N":"Y"},n)})},limitAnalyticsSend:function e(){BX.ajax.runComponentAction("bitrix:main.ui.filter","limitAnalytics",{mode:"ajax",data:{},analyticsLabel:{FILTER_ID:this.getParam("FILTER_ID"),LIMIT:this.getParam("FILTER_ID")}})},prepareEvent:function e(t){var i,n;if(!("path"in t)||!t.path.length){t.path=[t.target];i=0;while((n=t.path[i++].parentNode)!==null){t.path.push(n)}}return t},restoreRemovedPreset:function e(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var i=t.ID;var n=this.getPreset().getPresetNodeById(i);this.getPreset().applyPreset(i);this.getPreset().activatePreset(n)}}},hasScrollClick:function e(t){var i="clientX"in t?t.clientX:"x"in t?t.x:0;return i>=document.documentElement.offsetWidth},isUseCommonPresets:function e(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function e(t){t=this.prepareEvent(t);return(t.path||[]).some((function(e){return BX.type.isDomNode(e)&&(BX.hasClass(e,this.settings.classFilterContainer)||BX.hasClass(e,this.settings.classSearchContainer)||BX.hasClass(e,this.settings.classDefaultPopup)||BX.hasClass(e,this.settings.classPopupOverlay)||BX.hasClass(e,this.settings.classSidePanelContainer))}),this)},_onDocumentClick:function e(t){var i=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(i&&i.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function e(t){var i=this;t.stopPropagation();t.preventDefault();if(this.getParam("USE_CHECKBOX_LIST_FOR_SETTINGS_POPUP")){BX.Runtime.loadExtension("ui.dialogs.checkbox-list").then((function(){if(BX.UI&&BX.Type.isFunction(BX.UI.CheckboxList)){i.showFieldsSettingsCheckboxList();return}i.showFieldsSettingsPopup()}));return}this.showFieldsSettingsPopup()},showFieldsSettingsPopup:function e(){var t=this.getFieldsPopup();if(t&&!t.isShown()){this.showFieldsPopup();this.syncFields();return}this.closeFieldListPopup()},showFieldsSettingsCheckboxList:function e(){var t=this;if(this.checkboxListPopup){this.checkboxListPopup.show();this.syncCheckboxFields();return}this.getFieldsListPopupContent().then((function(e){var i;var n=t.getPreparedCheckboxListData(e),s=n.sections,r=n.categories,l=n.options;var o=t.enableFieldsSearch,u=t.enableHeadersSections;var c={parentType:"filter"};t.checkboxListPopup=new BX.UI.CheckboxList({columnCount:(i=t.settings.popupColumnsCount)!==null&&i!==void 0?i:4,popupOptions:{width:t.settings.popupWidth},lang:{title:a.Loc.getMessage("MAIN_UI_FILTER__FIELDS_SETTINGS_TITLE"),placeholder:a.Loc.getMessage("MAIN_UI_FILTER__FIELD_SEARCH_PLACEHOLDER"),emptyStateTitle:a.Loc.getMessage("MAIN_UI_FILTER__FIELD_EMPTY_STATE_TITLE"),emptyStateDescription:a.Loc.getMessage("MAIN_UI_FILTER__FIELD_EMPTY_STATE_DESCRIPTION"),allSectionsDisabledTitle:a.Loc.getMessage("MAIN_UI_FILTER__FIELD_ALL_SECTIONS_DISABLED")},sections:s,categories:r,options:l,events:{onApply:function e(i){return t.onCheckboxListApply(i.data.fields)}},params:{destroyPopupAfterClose:false,useSearch:o,useSectioning:u},context:c});t.checkboxListPopup.show()}))},syncCheckboxFields:function e(){var t=this;var i=this.getPreset().getFields();var n=this.checkboxListPopup.getSelectedOptions();n.forEach((function(e){if(!i.some((function(t){return t.dataset.name===e}))){t.checkboxListPopup.handleOptionToggled(e)}}))},getPreparedCheckboxListData:function e(t){var i,n,s=this;var r=this.getDefaultHeaderSection();var a=new Set;var l=this.getHeadersSections();var o=[];var u=[];var c=[];var d=this.getPreset();var h=d.getFields();var p=(i=(n=d.parent.getParam("CURRENT_PRESET"))===null||n===void 0?void 0:n.FIELDS)!==null&&i!==void 0?i:[];var f=this.getParam("RESTRICTED_FIELDS",[]);t.forEach((function(e){var t=e.sectionId.length?e.sectionId:r===null||r===void 0?void 0:r.id;if(s.enableHeadersSections&&!a.has(t)){var i=l[t].name;a.add(t);o.push({title:i,key:t,value:true});u.push({title:i,sectionKey:t,key:t})}var n=e.name;c.push({title:e.label,value:h.some((function(e){return e.dataset.name===n})),categoryKey:t,defaultValue:p.some((function(e){return e.NAME===n})),id:n,locked:f.includes(n)})}));return{sections:o,categories:u,options:c}},syncFields:function e(t){if(BX.type.isPlainObject(t)){if(t.cache===false){this.fieldsPopupItems=null}}var i=this.getPreset().getFields();var n=this.getFieldsPopupItems();var s,r;if(BX.type.isArray(n)&&n.length){n.forEach((function(e){s=BX.data(e,"name").replace("_datesel","").replace("_numsel","");r=i.some((function(e){return BX.data(e,"name")===s}));if(r){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}}),this)}},getFieldsPopupItems:function e(){if(!BX.type.isArray(this.fieldsPopupItems)){var t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}this.prepareAnimation()}return this.fieldsPopupItems},getFieldListContainerClassName:function e(t){var i=parseInt(this.settings.get("popupColumnsCount",0),10);if(i>0&&i<=this.settings.maxPopupColumnCount){return this.settings.get("classPopupFieldList"+i+"Column")}var n=this.settings.classPopupFieldList1Column;if(t>6&&t<12){n=this.settings.classPopupFieldList2Column}if(t>12){n=this.settings.classPopupFieldList3Column}return n},prepareFieldsDecl:function e(t){return(t||[]).map((function(e){return{block:"main-ui-filter-field-list-item",label:"LABEL"in e?e.LABEL:"",id:"ID"in e?e.ID:"",name:"NAME"in e?e.NAME:"",item:e,sectionId:"SECTION_ID"in e?e.SECTION_ID:"",onClick:BX.delegate(this._clickOnFieldListItem,this)}}),this)},getLazyLoadFields:function e(){var t=this.getParam("LAZY_LOAD")["GET_LIST"];var i=new BX.Promise;if(BX.Type.isPlainObject(t)){var n=t.component,s=t.action,r=t.data;BX.ajax.runComponentAction(n,s,{mode:"ajax",data:r}).then((function(e){var t;i.fulfill((t=e.data.fields)!==null&&t!==void 0?t:[])}))}else{BX.ajax({method:"GET",url:t,dataType:"json",onsuccess:function e(t){return i.fulfill(t)}})}return i},getFieldsListPopupContent:function e(){var t=new BX.Promise;var i=this.getParam("FIELDS");var n=BX.type.isArray(i)?i.length:0;if(this.getParam("LAZY_LOAD")){var s=function(e){t.fulfill(this.getPopupContent(this.settings.classPopupFieldList,this.getFieldListContainerClassName(e.length),this.prepareFieldsDecl(e)))}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var r=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var a=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getList"],{data:{filterId:this.getParam("FILTER_ID"),componentName:BX.type.isNotEmptyString(r)?r:"",signedParameters:BX.type.isNotEmptyString(a)?a:""}}).then(function(e){s(e.data)}.bind(this),(function(e){}))}else{this.getLazyLoadFields().then(s)}return t}t.fulfill(this.getPopupContent(this.settings.classPopupFieldList,this.getFieldListContainerClassName(n),this.prepareFieldsDecl(i)));return t},getPopupContent:function e(t,i,n){if(this.getParam("USE_CHECKBOX_LIST_FOR_SETTINGS_POPUP")&&BX.UI&&BX.Type.isFunction(BX.UI.CheckboxList)){return n}var s=BX.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(["<div></div>"])));if(!this.enableHeadersSections){var r=BX.decl({content:n,block:t,mix:i});this.setPopupElementWidthFromSettings(r);s.appendChild(r);if(this.enableFieldsSearch){this.preparePopupContentHeader(s)}return s}var a=this.getDefaultHeaderSection();var l={};n.forEach((function(e){var t=e.sectionId.length?e.sectionId:a.id;if(l[t]===undefined){l[t]=[]}l[t].push(e)}));this.preparePopupContentHeader(s);this.preparePopupContentFields(s,l,t,i);return s},onCheckboxListApply:function e(t){var n=this;return babelHelpers.asyncToGenerator(L().mark((function e(){var s,r,l,o,u,c;return L().wrap((function e(d){while(1)switch(d.prev=d.next){case 0:s=n.getPreset().getFields();r=[];s.forEach((function(e){r.push(e.dataset.name)}));if(!n.isFieldsChangePrevented(t,r)){d.next=5;break}return d.abrupt("return");case 5:d.next=7;return n.fetchFields(t,r);case 7:l=d.sent;if(a.Type.isArray(l)){d.next=11;break}if(a.Type.isPlainObject(l)&&l!==null&&l!==void 0&&l.ERROR){i.UI.Notification.Center.notify({content:l.ERROR})}return d.abrupt("return");case 11:l.forEach((function(e){return n.params.FIELDS.push(e)}));o=t.filter((function(e){return!r.includes(e)}));u=r.filter((function(e){return!t.includes(e)}));c=true;o.forEach((function(e){var t=l.find((function(t){return t.NAME===e}));if(t){n.getPreset().addField(t,c);if(a.Type.isString(t.HTML)){var i=BX.create("div");n.getHiddenElement().appendChild(i);BX.html(i,t.HTML)}}}));u.forEach((function(e){var t=l.find((function(t){return t.NAME===e}));if(t){n.getPreset().removeField(t,c)}}));n.saveFieldsSort();case 18:case"end":return d.stop()}}),e)})))()},fetchFields:function e(t,i){var n=this;return babelHelpers.asyncToGenerator(L().mark((function e(){var s,r,a,l,o;return L().wrap((function e(u){while(1)switch(u.prev=u.next){case 0:if(n.getParam("LAZY_LOAD")){u.next=2;break}return u.abrupt("return",n.getParam("FIELDS"));case 2:s=babelHelpers.toConsumableArray(new Set([].concat(babelHelpers.toConsumableArray(t),babelHelpers.toConsumableArray(i))));r=n.getParam("LAZY_LOAD")["CONTROLLER"];if(!r){u.next=7;break}a=r.componentName,l=r.signedParameters,o=r.getFields;return u.abrupt("return",new Promise((function(e){BX.ajax.runAction(o,{data:{filterId:n.getParam("FILTER_ID"),ids:s,componentName:BX.type.isNotEmptyString(a)?a:"",signedParameters:BX.type.isNotEmptyString(l)?l:""}}).then((function(t){return e(t.data)}))})));case 7:return u.abrupt("return",n.getLazyLoadFieldsByIds(s));case 8:case"end":return u.stop()}}),e)})))()},getLazyLoadFieldsByIds:function e(t){var i=this;return babelHelpers.asyncToGenerator(L().mark((function e(){var n,s;return L().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:n=i.getParam("LAZY_LOAD")["GET_FIELDS"];s=BX.Uri.addParam(n,{ids:t});return r.abrupt("return",new Promise((function(e){BX.ajax({method:"get",url:s,dataType:"json",onsuccess:function t(i){return e(i)}})})));case 3:case"end":return r.stop()}}),e)})))()},isFieldsChangePrevented:function e(t,i){var n=new BX.Event.BaseEvent({data:{fields:t,oldFields:i}});this.emitter.emit("onBeforeChangeFilterItems",n);return n.isDefaultPrevented()},preparePopupContentHeader:function e(t){var i=BX.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-popup-search-header-wrapper">\n\t\t\t\t\t<div class="ui-form-row-inline"></div>\n\t\t\t\t</div>\n\t\t\t'])));t.prepend(i);this.preparePopupContentHeaderSections(i);this.preparePopupContentHeaderSearch(i)},preparePopupContentHeaderSections:function e(t){if(!this.enableHeadersSections){return}var i=BX.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content main-ui-filter-popup-search-section-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t'])));t.firstElementChild.appendChild(i);var n=this.getHeadersSections();for(var s in n){var r=this.settings.classPopupSearchSectionItemIcon+(n[s].selected?" ".concat(this.settings.classPopupSearchSectionItemIconActive):"");var a=BX.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="main-ui-filter-popup-search-section-item" data-ui-popup-filter-section-button="','">\n\t\t\t\t\t\t<div class="','">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),s,r,BX.Text.encode(n[s].name));BX.bind(a,"click",this.onFilterSectionClick.bind(this,a));i.firstElementChild.appendChild(a)}},onFilterSectionClick:function e(t){var i=this.settings.classPopupSearchSectionItemIconActive;var n=t.dataset.uiPopupFilterSectionButton;var s=document.querySelectorAll("[data-ui-popup-filter-section='"+n+"']");if(BX.Dom.hasClass(t.firstElementChild,i)){BX.Dom.removeClass(t.firstElementChild,i);BX.Dom.hide(s[0])}else{BX.Dom.addClass(t.firstElementChild,i);BX.Dom.show(s[0])}},preparePopupContentHeaderSearch:function e(t){if(!this.enableFieldsSearch){return}var i=BX.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content main-ui-filter-popup-search-input-wrapper">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon">\n\t\t\t\t\t\t\t<div class="ui-ctl-before ui-ctl-icon-search"></div>\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear"></button>\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ','">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),this.settings.classPopupSearchSectionItem);t.firstElementChild.appendChild(i);var n=i.getElementsByClassName(this.settings.classPopupSearchSectionItem);if(n.length){var s=n[0];BX.bind(s,"input",this.onFilterSectionSearchInput.bind(this,s));BX.bind(s.previousElementSibling,"click",this.onFilterSectionSearchInputClear.bind(this,s))}},preparePopupContentFields:function e(t,i,n,s){if(!this.enableHeadersSections){return}var r=BX.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<div class="main-ui-filter-popup-search-sections-wrapper"></div>'])));t.appendChild(r);for(var a in i){var l=BX.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="main-ui-filter-popup-section-wrapper" data-ui-popup-filter-section="','"></div>\n\t\t\t\t'])),a);this.setPopupElementWidthFromSettings(l);if(!this.getHeadersSectionParam(a,"selected")){l.setAttribute("hidden","")}var o=BX.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<h3 class="main-ui-filter-popup-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</h3>\n\t\t\t\t"])),BX.Text.encode(this.getHeadersSectionParam(a,"name")));var u=BX.decl({block:n,mix:s,content:i[a]});l.appendChild(o);l.appendChild(u);r.appendChild(l)}},prepareAnimation:function e(){var t=this;if(this.enableFieldsSearch){this.fieldsPopupItems.forEach((function(e){BX.bind(e,"animationend",t.onAnimationEnd.bind(t,e))}))}},onAnimationEnd:function e(t){t.style.display=BX.Dom.hasClass(t,this.settings.classPopupSearchFieldListItemHidden)?"none":"inline-block"},onFilterSectionSearchInput:function e(t){var i=t.value;if(i.length){i=i.toLowerCase()}this.getFieldsPopupItems().forEach(function(e){var t=e.innerText.toLowerCase();if(i.length&&t.indexOf(i)===-1){BX.Dom.removeClass(e,this.settings.classPopupSearchFieldListItemVisible);BX.Dom.addClass(e,this.settings.classPopupSearchFieldListItemHidden)}else{BX.Dom.removeClass(e,this.settings.classPopupSearchFieldListItemHidden);BX.Dom.addClass(e,this.settings.classPopupSearchFieldListItemVisible);e.style.display="inline-block"}}.bind(this))},onFilterSectionSearchInputClear:function e(t){if(t.value.length){t.value="";this.onFilterSectionSearchInput(t)}},getDefaultHeaderSection:function e(){var t=this.getHeadersSections();for(var i in t){if("selected"in t[i]&&t[i].selected){return t[i]}}return null},getHeadersSections:function e(){return this.getParam("HEADERS_SECTIONS")},getHeadersSectionParam:function e(t,i,n){if(this.getHeadersSections()[t]!==undefined&&this.getHeadersSections()[t][i]!==undefined){return this.getHeadersSections()[t][i]}return n},getFieldLoader:function e(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function e(t){var i=t.target;var n;if(!BX.hasClass(i,this.settings.classFieldListItem)){i=BX.findParent(i,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(i)){try{n=JSON.parse(BX.data(i,"item"))}catch(e){}if(this.isFieldChangePrevented(n,BX.hasClass(i,this.settings.classMenuItemChecked))){return}var s=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(i);var r=i.querySelector(".main-ui-select-inner-label");if(r){r.classList.add("main-ui-no-before")}var a=function(e){s.fulfill(e);this.getFieldLoader().hide();if(r){r.classList.remove("main-ui-no-before")}}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var l=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var o=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getField"],{data:{filterId:this.getParam("FILTER_ID"),id:n.NAME,componentName:BX.type.isNotEmptyString(l)?l:"",signedParameters:BX.type.isNotEmptyString(o)?o:""}}).then(function(e){a(e.data)}.bind(this),(function(e){}))}else{this.getLazyLoadField(n.NAME).then(a)}}else{s.fulfill(n)}s.then(function(e){this.params.FIELDS.push(e);if(BX.hasClass(i,this.settings.classMenuItemChecked)){BX.removeClass(i,this.settings.classMenuItemChecked);this.getPreset().removeField(e)}else{if(BX.type.isPlainObject(e)){this.getPreset().addField(e);BX.addClass(i,this.settings.classMenuItemChecked);if(BX.type.isString(e.HTML)){var t=BX.create("div");this.getHiddenElement().appendChild(t);BX.html(t,e.HTML)}}}this.syncFields()}.bind(this))}},isFieldChangePrevented:function e(t,i){var n;if(i){n={fields:[],oldFields:[t.NAME]}}else{n={fields:[t.NAME],oldFields:[]}}var s=new BX.Event.BaseEvent({data:n});this.emitter.emit("onBeforeChangeFilterItems",s);return s.isDefaultPrevented()},getHiddenElement:function e(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function e(t){var i=this.getParam("LAZY_LOAD")["GET_FIELD"];var n=new BX.Promise;if(BX.Type.isPlainObject(i)){var s=i.component,r=i.action,a=i.data;a.fieldId=t;BX.ajax.runComponentAction(s,r,{mode:"ajax",data:a}).then((function(e){var t;n.fulfill((t=e.data.field)!==null&&t!==void 0?t:[])}))}else{BX.ajax({method:"get",url:BX.util.add_url_param(i,{id:t}),dataType:"json",onsuccess:function e(t){return n.fulfill(t)}})}return n},showFieldsPopup:function e(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function e(){if(this.getParam("USE_CHECKBOX_LIST_FOR_SETTINGS_POPUP")&&BX.UI&&BX.Type.isFunction(BX.UI.CheckboxList)){if(this.checkboxListPopup){this.checkboxListPopup.destroy();this.checkboxListPopup=null}return}var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function e(){var t=this.getFieldsPopup();var i=BX.pos(this.getAddField());i.forceBindPosition=true;t.adjustPosition(i)},getFieldsPopup:function e(){var t=this.settings.get("showPopupInCenter",false)?null:this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:t===null,closeByEsc:t===null,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.setPopupElementWidthFromSettings(this.fieldsPopup.contentContainer);this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(e){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(e);this.syncFields({cache:false});this.adjustFieldListPopupPosition()}.bind(this))}return this.fieldsPopup},setPopupElementWidthFromSettings:function e(t){t.style.width=this.settings.popupWidth+"px"},_onAddPresetClick:function e(){this.enableAddPreset()},enableWaitSate:function e(t){!!t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function e(t){!!t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function e(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var i=this.getPreset().getAddPresetFieldInput();var n=i.parentNode.querySelector(".main-ui-filter-edit-mask");var s;function r(e){if(e.animationName==="fieldError"){e.currentTarget.removeEventListener("animationend",r);e.currentTarget.removeEventListener("oAnimationEnd",r);e.currentTarget.removeEventListener("webkitAnimationEnd",r);e.currentTarget.classList.remove("main-ui-filter-error")}}function a(e){e.addEventListener("animationend",r);e.addEventListener("oAnimationEnd",r);e.addEventListener("webkitAnimationEnd",r);e.classList.add("main-ui-filter-error");var t=new BX.Promise;t.fulfill(true);return t}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){s=i.value;if(s.length){this.savePreset();this.disableAddPreset()}else{a(n).then((function(){i.focus()}))}}if(this.isEditEnabled()){var l=this.getPreset();var o=l.getCurrentPresetId();var u=l.getPresetNodeById(o);var c=l.getPresetInput(u);if(c.value.length===0&&o==="default_filter"){var d=l.getCurrentPresetData();if(d){BX.Dom.attr(c,"value",d.TITLE)}}if(c.value.length>0){l.updateEditablePreset(o);this.saveUserSettings(t);if(!t){this.disableEdit()}}else{var h=u.querySelector(".main-ui-filter-edit-mask");a(h).then((function(){c.focus()}))}}},_onCancelButtonClick:function e(){this.setIsSetOutsideState(false);this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function e(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function e(t){var i=t.target;if(this.getFields().isDragButton(i)){var n=BX.Filter.Utils.getByTag(i.parentNode,"input",true);(n||[]).forEach((function(e){BX.fireEvent(e,"blur")}));BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function e(t){var i=this.getFields();var n=this.getPreset();var s;if(i.isFieldDelete(t.target)){s=i.getField(t.target);n.removeField(s)}if(i.isFieldValueDelete(t.target)){s=i.getField(t.target);i.clearFieldValue(s)}},getButtonsContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function e(){return this.isAddPresetModeState},enableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var n=t.getAddPresetFieldInput();var s=this.getButtonsContainer();BX.show(i);BX.show(s);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(n)){n.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var n=this.getButtonsContainer();BX.hide(i);BX.hide(n);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function e(){var t=this.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return i},getFilterFields:function e(){var t=this.getFieldListContainer();var i=[];var n=[];if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classField,true);n=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(i)){i=[]}if(BX.type.isArray(n)){n.forEach((function(e){i.push(e)}))}}return i},getFilterFieldsValues:function e(){var t=this.getPreset().getFields();var i=this.getSearch();var n={};var s,r;n["FIND"]=i.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach((function(e){var t=BX.Filter.AdditionalFilter.getInstance().getFilter(e);if(t){Object.assign(n,t);return}s=BX.data(e,"type");r=BX.data(e,"name");switch(s){case this.types.STRING:{this.prepareControlStringValue(n,e);break}case this.types.TEXTAREA:{this.prepareControlTextareaValue(n,e);break}case this.types.NUMBER:{this.prepareControlNumberValue(n,r,e);break}case this.types.DATE:{this.prepareControlDateValue(n,r,e);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(n,r,e);break}case this.types.SELECT:{this.prepareControlSelectValue(n,r,e);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(n,r,e);break}case this.types.DEST_SELECTOR:case this.types.CUSTOM_ENTITY:case this.types.ENTITY_SELECTOR:{this.prepareControlCustomEntityValue(n,r,e);break}case this.types.CUSTOM:{this.prepareControlCustomValue(n,r,e);break}default:{break}}}),this)}return n},prepareControlCustomEntityValue:function e(t,i,n){var s=this.fetchSquares(n);var r=this.fetchSquaresData(s);var a=BX.Main.ui.CustomEntity.isMultiple(n);t[i]="";t[i+"_label"]="";if(a){t[i]=[];t[i+"_label"]=[];!!r&&r.forEach((function(e){t[i].push(e._value.toString());t[i+"_label"].push(e._label.toString())}))}else{if(r.length){t[i]=r[0]._value.toString();t[i+"_label"]=r[0]._label.toString()}}},fetchSquares:function e(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function e(t){return t.map((function(e){return JSON.parse(BX.data(e,"item"))}),this)},prepareControlCustomValue:function e(t,i,n){var s=BX.Filter.Utils.getByTag(n,"input",true);t[i]="";if(BX.type.isArray(s)){s.forEach((function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}}))}},prepareControlMultiselectValue:function e(t,i,n){var s=BX.Filter.Utils.getByClass(n,this.settings.classMultiSelect);var r=JSON.parse(BX.data(s,"value"));t[i]="";if(BX.type.isArray(r)&&r.length){t[i]={};r.forEach((function(e,n){t[i][n]=e.VALUE}))}},prepareControlSelectValue:function e(t,i,n){var s=BX.Filter.Utils.getByClass(n,this.settings.classSelect);var r=JSON.parse(BX.data(s,"value"));t[i]=r.VALUE},prepareControlCustomDateValue:function e(t,i,n){var s=n.querySelector('[data-name="'+i+"_days"+'"]');if(s){var r=JSON.parse(s.dataset.value);t[i+"_days"]=r.map((function(e){return e.VALUE}))}var a=n.querySelector('[data-name="'+i+"_months"+'"]');if(a){var l=JSON.parse(a.dataset.value);t[i+"_months"]=l.map((function(e){return e.VALUE}))}var o=n.querySelector('[data-name="'+i+"_years"+'"]');if(o){var u=JSON.parse(o.dataset.value);t[i+"_years"]=u.map((function(e){return e.VALUE}))}},prepareControlDateValue:function e(t,i,n,s){var r=n.querySelector(".main-ui-filter-additional-fields-container");if(r&&!s){BX.remove(r)}var a=BX.Filter.Utils.getByClass(n,this.settings.classSelect);var l=n.querySelector('.main-ui-select[data-name*="_allow_year"]');var o=i+this.settings.datePostfix;var u=i+this.settings.fromPostfix;var c=i+this.settings.toPostfix;var d=i+this.settings.daysPostfix;var h=i+this.settings.monthPostfix;var p=i+this.settings.quarterPostfix;var f=i+this.settings.yearPostfix;var m=i+"_allow_year";var g,E,y,v,B;t[o]="";t[u]="";t[c]="";t[d]="";t[h]="";t[p]="";t[f]="";var A=n.querySelector(".main-ui-date-input");if(A&&A.dataset.isValid==="false"){return}g=JSON.parse(BX.data(a,"value"));t[o]=g.VALUE;if(l){B=JSON.parse(BX.data(l,"value"));t[m]=B.VALUE}switch(g.VALUE){case this.dateTypes.EXACT:{E=BX.Filter.Utils.getByClass(n,this.settings.classDateInput);t[u]=E.value;t[c]=E.value;break}case this.dateTypes.QUARTER:{y=BX.Filter.Utils.getByClass(n,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.indexOf("_quarter")!==-1){t[p]=JSON.parse(BX.data(e,"value")).VALUE}if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.dateTypes.YEAR:{y=BX.Filter.Utils.getByClass(n,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.dateTypes.MONTH:{y=BX.Filter.Utils.getByClass(n,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.indexOf("_month")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var P=BX.Filter.Utils.getByClass(n,this.settings.classNumberInput);if(!!P&&P.name===d){t[d]=P.value}break}case this.dateTypes.RANGE:{E=BX.Filter.Utils.getByClass(n,this.settings.classDateInput,true);E.forEach((function(e){if(e.name===u){t[u]=e.value}else if(e.name===c){t[c]=e.value}}),this);break}case"CUSTOM_DATE":{var S={};this.prepareControlCustomDateValue(S,i,n);t[i+"_days"]=S[i+"_days"];t[h]=S[i+"_months"];t[f]=S[i+"_years"];break}default:{break}}if(r&&!s){BX.append(r,n)}var _=Array.from(n.querySelectorAll('.main-ui-filter-additional-fields-container > [data-type="DATE"]'));if(_){_.forEach((function(e){var i=e.dataset.name;this.prepareControlDateValue(t,i,e,true)}),this)}},prepareControlNumberValue:function e(t,i,n){var s=BX.Filter.Utils.getByClass(n,this.settings.classNumberInput,true);var r=BX.Filter.Utils.getByClass(n,this.settings.classSelect);var a=i+this.settings.numberPostfix;var l=i+this.settings.fromPostfix;var o=i+this.settings.toPostfix;var u;t[l]="";t[o]="";u=JSON.parse(BX.data(r,"value"));t[a]=u.VALUE;s.forEach((function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[l]=e.value||"";if(t[a]==="exact"){t[o]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[o]=e.value||""}}),this)},prepareControlStringValue:function e(t,i){var n=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var s;if(BX.type.isDomNode(n)){s=n.name;t[s]=n.value}},prepareControlTextareaValue:function e(t,i){var n=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var s;if(BX.type.isDomNode(n)){s=n.name;t[s]=n.value}},showGridAnimation:function e(){this.grid&&this.grid.tableFade()},hideGridAnimation:function e(){this.grid&&this.grid.tableUnfade()},getPresetId:function e(t,i){var n=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!i||n==="default_filter"&&!t){n="tmp_filter"}return n},isAppliedUserFilter:function e(){var t=this;var i=this.getPreset().getCurrentPresetData();if(BX.Type.isPlainObject(i)){var n=BX.Type.isArrayFilled(i.FIELDS)&&i.FIELDS.some((function(e){return!t.getPreset().isEmptyField(e)}));var s=BX.Type.isArrayFilled(i.ADDITIONAL)&&i.ADDITIONAL.some((function(e){return!t.getPreset().isEmptyField(e)}));return!i.IS_PINNED&&(n||s)||i.IS_PINNED&&BX.Type.isArrayFilled(i.ADDITIONAL)||BX.Type.isStringFilled(this.getSearch().getSearchString())}return false},isAppliedDefaultPreset:function e(){var t=this;var i=this.getPreset().getCurrentPresetData();if(!i.IS_PINNED){return false}if(BX.Type.isArrayFilled(i.ADDITIONAL)){var n=i.ADDITIONAL.some((function(e){return!t.getPreset().isEmptyField(e)}));if(n){return false}}if(BX.Type.isStringFilled(this.getSearch().getSearchString())){return false}return true},applyFilter:function e(t,i,n){this.setIsSetOutsideState(n);var s=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var a=this.getPreset();var l=this.getSearch();var o={autoResolve:!this.grid};var u=this;this.setDefaultPresetAppliedState(this.isAppliedDefaultPreset());if(this.isAppliedUserFilter()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--active")}this.clearGet();this.showGridAnimation();var c=t?"clear":"apply";BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[s,{action:c},this,r]);var d=this.getPresetId(t,i);this.updatePreset(d,null,t,null).then((function(){l.updatePreset(a.getPreset(d));if(u.getParam("VALUE_REQUIRED")){if(!l.getSquares().length){u.lastPromise=a.applyPinnedPreset()}}})).then((function(){var e={apply_filter:"Y",clear_nav:"Y"};var t=BX.delegate(r.fulfill,r);var i=BX.delegate(r.reject,r);u.grid&&u.grid.reloadTable("POST",e,t,i);BX.onCustomEvent(window,"BX.Main.Filter:apply",[s,{action:c},u,r,o]);o.autoResolve&&r.fulfill()}));return r},getAddField:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function e(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function e(){if(!(this.presets instanceof g)){this.presets=new g(this)}return this.presets},resetControlData:function e(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{t.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function e(t){var i=this.getPreset().getField({NAME:t});var n,s;if(BX.type.isDomNode(i)){n=this.getFieldByName(t);n=this.resetControlData(n);s=this.getPreset().createControl(n);BX.insertAfter(s,i);BX.remove(i)}},clearControls:function e(t){if(BX.type.isArray(t)){t.forEach((function(e){"name"in e&&this.clearControl(e.name)}),this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function e(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function e(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function e(){var t=this.getPopup();var i=t.popupContainer;var n=this.settings.get("FILTER_CLOSE_DELAY");var s;BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--showed");setTimeout(BX.delegate((function(){if(!this.isIe()){BX.removeClass(i,this.settings.classAnimationShow);BX.addClass(i,this.settings.classAnimationClose);s=parseFloat(BX.style(i,"animation-duration"));if(BX.type.isNumber(s)){s=s*1e3}setTimeout((function(){t.close()}),s)}else{t.close()}}),this),n);if(this.getParam("LIMITS_ENABLED")){BX.removeClass(this.getFilter(),this.settings.classLimitsAnimation)}this.closeFieldListPopup();this.adjustFocus()},showPopup:function e(){var t=this.getPopup();var i;if(!t.isShown()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--showed");this.isOpened=true;var n=this.settings.get("FILTER_SHOW_DELAY");if(this.getParam("LIMITS_ENABLED")===true){this.limitAnalyticsSend()}setTimeout(BX.delegate((function(){t.show();if(!this.isIe()){i=t.popupContainer;BX.removeClass(i,this.settings.classAnimationClose);BX.addClass(i,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}var e=[].slice.call(this.getFieldListContainer().querySelectorAll("textarea"));e.forEach((function(e){BX.style(e,"height",e.scrollHeight+"px")}))}),this),n)}},getSaveForAllCheckbox:function e(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function e(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function e(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var i=null;if(BX.type.isNotEmptyString(t)){i=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!i?i:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function e(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function e(){this.restoreDefaultFields()},restoreDefaultFields:function e(){var t=this.getPreset().getPreset("default_filter",true);var i=this.getParam("PRESETS");var n=this.getPreset().getCurrentPresetId();var s={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var r=t.FIELDS.map((function(e){return e.NAME}));var a=r.join(",");i.forEach((function(e,n){if(e.ID==="default_filter"){i[n]=BX.clone(t)}}),this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach((function(e,i){if(e.ID==="default_filter"){this.editablePresets[i]=BX.clone(t)}}),this)}this.getPreset().applyPreset(n);this.updatePreset(n);this.saveOptions({preset_id:"default_filter",rows:a,save:"Y",apply_filter:"N"},s)},getRestoreFieldsButton:function e(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function e(){var t=this.getParam("DEFAULT_PRESETS");var i=this.getParam("PRESETS");var n=false;var s,r,a;if(BX.type.isArray(t)){t.sort((function(e,t){return e.SORT-t.SORT}));t.forEach((function(e){n=i.some((function(t,i){if(t.ID===e.ID){s=i;return true}}));if(n){i[s]=BX.clone(e)}else{i.push(BX.clone(e))}if(e.ID!=="default_filter"){this.addSidebarItem(e.ID,e.TITLE,e.IS_PINNED);if(e.IS_PINNED){r=e.ID}}}),this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!r){r="default_filter"}a=this.getPreset().getPresetNodeById(r);if(a){BX.fireEvent(a,"click")}},saveRestoreFilter:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var i=this.getParam("PRESETS");var n={};var s;if(BX.type.isArray(i)){i.forEach((function(e){s=e.FIELDS.map((function(e){return e.NAME}));s=s.join(",");n[e.ID]={name:e.TITLE||null,sort:e.SORT,preset_id:e.ID,fields:this.prepareFields(e.FIELDS),rows:s,for_all:e.FOR_ALL}}),this);this.saveOptions(n,t)}},prepareFields:function e(t){var i={};var n;if(BX.type.isArray(t)){t.forEach((function(e){if(e.TYPE===this.types.SELECT){i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:""}if(e.TYPE===this.types.MULTI_SELECT){e.VALUE.forEach((function(t,n){i[e.NAME]=i[e.NAME]||{};i[e.NAME][n]=t.VALUE}));i[e.NAME]=i[e.NAME]||""}if(e.TYPE===this.types.DATE||e.TYPE===this.types.NUMBER){n=Object.keys(e.VALUES);n.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}));if(e.TYPE===this.types.DATE){i[e.NAME+"_datesel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}if(e.TYPE===this.types.NUMBER){i[e.NAME+"_numsel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}}if(e.TYPE===this.types.DEST_SELECTOR||e.TYPE===this.types.ENTITY_SELECTOR||e.TYPE===this.types.CUSTOM_ENTITY){i[e.NAME+"_label"]=e.VALUES._label;i[e.NAME+"_value"]=e.VALUES._value}}),this)}return i},getRestoreButton:function e(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function e(){this.setIsSetOutsideState(false);var t=this.getPreset();var i=t.getCurrentPresetId();var n;if(i!=="tmp_filter"&&i!=="default_filter"&&!t.isPresetValuesModified(i)){var s=t.getPreset(i);var r=t.getAdditionalValues(i);var a=t.getFields().map((function(e){return BX.data(e,"name")}));s.ADDITIONAL=this.preparePresetFields(r,a);s.ADDITIONAL=s.ADDITIONAL.filter((function(e){return!this.getPreset().isEmptyField(e)}),this);n=this.applyFilter(false,i);this.closePopup()}else{t.deactivateAllPresets();n=this.applyFilter();this.closePopup()}return n},_onResetButtonClick:function e(){if(this.getParam("VALUE_REQUIRED")){var t=this.getPreset().getCurrentPresetData();if(t.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function e(t){var i=this.getSearch();var n=this.getPreset();if(!t){i.clearInput()}i.removePreset();n.deactivateAllPresets();n.resetPreset(true);i.hideClearButton();i.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function e(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function e(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function e(t){var i=this.getDragButton(t);if(i){i.onbxdragstart=BX.delegate(this._onFieldDragStart,this);i.onbxdragstop=BX.delegate(this._onFieldDragStop,this);i.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(i);jsDD.registerDest(i)}return t},unregisterDragItem:function e(t){var i=this.getDragButton(t);if(i){jsDD.unregisterObject(i);jsDD.unregisterDest(i)}},_onFieldDragStart:function e(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function e(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function e(){var t=this;var i,n;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach((function(e,s){if(e){i=e.getBoundingClientRect();n=i.top+BX.scrollTop(window)+i.height/2;if(s>t.dragIndex&&t.sortOffset>n&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(s<t.dragIndex&&t.sortOffset<n&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((s<t.dragIndex&&t.sortOffset>n||s>t.dragIndex&&t.sortOffset<n)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}}))},disableFieldsDragAndDrop:function e(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function e(){var t,i,n,s;t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach((function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){n=this.getDragButton(e);n.onbxdragstart=BX.delegate(this._onDragStart,this);n.onbxdragstop=BX.delegate(this._onDragStop,this);n.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(n);jsDD.registerDest(n);this.presetsList.push(e)}}),this)}},getDragButton:function e(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function e(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){jsDD.unregisterObject(e);jsDD.unregisterDest(e)}}),this)}},_onDragStart:function e(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function e(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function e(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function e(){var t,i;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)&&!BX.hasClass(e,this.settings.classDefaultFilter)){this.presetsList.push(e)}}),this)}},_onDrag:function e(){var t=this;var i,n;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach((function(e,s){if(e){i=e.getBoundingClientRect();n=i.top+BX.scrollTop(window)+i.height/2;if(s>t.dragIndex&&t.sortOffset>n&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(s<t.dragIndex&&t.sortOffset<n&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((s<t.dragIndex&&t.sortOffset>n||s>t.dragIndex&&t.sortOffset<n)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}}))},getSidebarControlsContainer:function e(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function e(){var t=this.getPreset();var i=t.getPresets();var n;if(BX.type.isArray(i)&&i.length){i.forEach((function(e){n=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&n!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}}),this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function e(){var t=this.getPreset();var i=t.getPresets();if(BX.type.isArray(i)&&i.length){i.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){BX.removeClass(e,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(e)}}),this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function e(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function e(){return this.isEditEnabledState},getEditButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function e(t,i){return t in this.params?this.params[t]:i},getFilter:function e(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function e(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function e(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function e(t,i,n){if("CONFIRM"in t&&t.CONFIRM){var s=this.getParam("FILTER_ID")+"-confirm-dialog";var r='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var a="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var l=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function e(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function e(){BX.type.isFunction(n)?n():null;this.popupWindow.close();this.popupWindow.destroy()}}});var u=new BX.PopupWindow(s,null,{content:r,titleBar:a,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[l,o]});BX.addCustomEvent(u,"onPopupClose",BX.delegate((function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)}),this));if(!u.isShown()){u.show();var c=u.popupContainer;BX.removeClass(c,this.settings.classAnimationShow);BX.addClass(c,this.settings.classAnimationShow)}}else{BX.type.isFunction(i)?i():null}},getInitialValue:function e(t){if(BX.type.isString(t)){var i=this.params.INITIAL_FILTER;if(BX.type.isPlainObject(i)){var n=Object.entries(i).reduce((function(e,i){if(i[0].startsWith(t)){e.push(i)}return e}),[]);if(n.length===1){return n[0][1]}if(n.length>1){return n.reduce((function(e,i){e[i[0].replace(t,"")]=i[1];return e}),{})}}}return""},getField:function e(t){var i=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');return BX.Filter.Field.instances.get(i)},isSetOutside:function e(){return BX.Text.toBoolean(this.isSetOutsideState)},setIsSetOutsideState:function e(t){this.isSetOutsideState=BX.Text.toBoolean(t);var i=this.getSearch().getContainer();if(this.isSetOutsideState){BX.Dom.addClass(i,"main-ui-filter-set-outside");BX.Dom.removeClass(i,"main-ui-filter-set-inside")}else{BX.Dom.addClass(i,"main-ui-filter-set-inside");BX.Dom.removeClass(i,"main-ui-filter-set-outside")}},setDefaultPresetAppliedState:function e(t){this.isDefaultPresetAppliedState=BX.Text.toBoolean(t);var i=this.getSearch().getContainer();if(this.isDefaultPresetAppliedState){BX.Dom.addClass(i,"main-ui-filter-default-applied")}else{BX.Dom.removeClass(i,"main-ui-filter-default-applied")}}}})();(function(){BX.Main.filterManager={data:{},push:function e(t,i){if(BX.type.isNotEmptyString(t)&&i){this.data[t]=i}},getById:function e(t){var i=null;if(t in this.data){i=this.data[t]}return i},getList:function e(){return Object.values(this.data)}}})();var T;function F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function D(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?F(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var X=Symbol("onValueChange");var C=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Filter.Field");i.id=e.options.NAME;i.parent=e.parent;i.node=e.node;i.options=D({},e.options);i.cache=new a.Cache.MemoryCache;i[X]=i[X].bind(babelHelpers.assertThisInitialized(i));a.Event.bind(i.node,"input",i[X]);a.Event.bind(i.node,"change",i[X]);var n=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-control-value-delete"));n.forEach((function(e){e.addEventListener("click",(function(){setTimeout((function(){i[X]()}))}))}));var s=new MutationObserver((function(){i[X]()}));var r=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-select"));r.forEach((function(e){s.observe(e,{attributes:true,attributeFilter:["data-value"]})}));t.instances.set(i.node,babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"subscribe",value:function e(t,i){a.Event.EventEmitter.subscribe(this,t.replace("BX.Filter.Field:",""),i)}},{key:X,value:function e(){this.emit("change",{field:this,value:this.getValue()})}},{key:"getAdditionalFieldContainer",value:function e(){return this.cache.remember("additionalFieldsContainer",(function(){return a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-additional-fields-container"></div>\n\t\t\t'])))}))}},{key:"hasAdditional",value:function e(){return a.Dom.hasClass(this.node,"main-ui-filter-field-with-additional-fields")}},{key:"addAdditionalField",value:function e(i){if(!this.hasAdditional()){a.Dom.addClass(this.node,"main-ui-filter-field-with-additional-fields");a.Dom.append(this.getAdditionalFieldContainer(),this.node)}var n=this.parent.getPreset();var s=this.prepareFieldOptions(i);var r=n.createControl(s);this.appendRenderedField(r);return t.instances.get(r)}},{key:"prepareListItems",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(a.Type.isPlainObject(t)){return Object.entries(t).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return{NAME:n,VALUE:i}}))}return{}}},{key:"prepareFieldOptions",value:function e(t){var i=this;if(a.Type.isPlainObject(t)){var n=this.parent.params.FIELDS_STUBS;var s=t.type,r=s===void 0?"string":s;var l=n.find((function(e){return e.NAME===r}));if(a.Type.isPlainObject(l)){var o=D(D({},l),{},{NAME:t.id,LABEL:t.name,TYPE:r==="checkbox"?"SELECT":l.TYPE,VALUE_REQUIRED:t.valueRequired===true});if(r==="list"){return D(D({},o),{},{ITEMS:[].concat(babelHelpers.toConsumableArray(o.ITEMS),[this.prepareListItems(t.items)]),params:{isMulti:function(){if(a.Type.isPlainObject(t.params)){return t.params===true}return false}()}})}if(r==="date"){var u=function(){if(a.Type.isPlainObject(t.value)&&Reflect.has(t.value,"_datesel")){return t.value._datesel}return i.parent.dateTypes.NONE}();return D(D({},o),{},{SUB_TYPES:function(){if(a.Type.isArray(t.exclude)){return o.SUB_TYPES.filter((function(e){return!t.exclude.includes(e.VALUE)}))}return o.SUB_TYPES}(),SUB_TYPE:function(){return o.SUB_TYPES.find((function(e){return e.VALUE===u}))}(),VALUES:function(){if(a.Type.isPlainObject(t.value)){return D({},t.value)}return o.VALUES}()})}if(r==="string"||r==="custom_date"||r==="number"||r==="checkbox"||r==="custom_entity"){return o}}}return t}},{key:"appendRenderedField",value:function e(t){if(a.Type.isDomNode(t)){var i=this.getAdditionalFieldContainer();a.Dom.append(t,i)}}},{key:"getValue",value:function e(){var t=this.parent.getFilterFieldsValues();var i=this.options,n=i.TYPE,s=i.NAME;if(n==="DATE"||n==="NUMBER"){return Object.entries(t).reduce((function(e,t){var i=babelHelpers.slicedToArray(t,2),n=i[0],r=i[1];if(n.startsWith(s)){e[n.replace(s,"")]=r}return e}),{})}if(s in t){return t[s]}return""}},{key:"setValue",value:function e(t){var i=this;var n=this.options.TYPE;if(n==="DATE"||n==="NUMBER"){if(a.Type.isPlainObject(t)){var s=this.parent.getFieldListContainer();Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],r=t[1];var l=s.querySelector('[data-name="'.concat(i.id,'"] [data-name="').concat(i.id).concat(n,'"], [data-name="').concat(i.id,'"] [name="').concat(i.id).concat(n,'"]'));if(l){if(a.Dom.hasClass(l,"main-ui-select")){var o=a.Dom.attr(l,"data-items");if(a.Type.isArray(o)){var u=o.find((function(e){return e.VALUE===r}));if(a.Type.isPlainObject(u)){a.Dom.attr(l,"data-value",u);var c=l.querySelector(".main-ui-select-name");if(c){c.innerText=u.NAME}var d=BX.Main.ui.Factory.get(l);if(!d){d={node:l,instance:new BX.Main.ui.select(l)};BX.Main.ui.Factory.data.push(d)}if(a.Type.isPlainObject(d)){BX.onCustomEvent(window,"UI::Select::Change",[d.instance,u])}}}}else if(l.tagName==="INPUT"){l.value=r}}}))}}}}]);return t}(a.Event.EventEmitter);babelHelpers.defineProperty(C,"instances",new WeakMap);var N=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t}babelHelpers.createClass(e,[{key:"setFields",value:function e(t){if(a.Type.isPlainObject(t)){this.parent.getPopup();var i=this.parent.getPreset();i.deactivateAllPresets();var n={preset_id:"tmp_filter",fields:t};this.parent.updateParams(n);i.applyPreset("tmp_filter")}}},{key:"setFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.setAnalyticsLabel(i);if(a.Type.isObject(t)){this.parent.updateParams(t);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(t.preset_id);this.parent.getPreset().applyPreset(t.preset_id);if(!t.checkFields||!this.parent.getPreset().isPresetValuesModified(t.preset_id)){var n=true;this.parent.applyFilter(false,t.preset_id,n)}else{var s={};if(a.Type.isPlainObject(t.fields)){s=Object.assign({},t.fields)}if(a.Type.isPlainObject(t.additional)){s=Object.assign({},t.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(s);this.apply()}}}},{key:"extendFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.setAnalyticsLabel(n);if(a.Type.isObject(t)){Object.keys(t).forEach((function(e){if(a.Type.isNumber(t[e])){t[e]=String(t[e])}}));var s=this.parent.getPreset().getCurrentPresetId();if(i||s==="tmp_filter"||s==="default_filter"){var r=Object.assign({},this.parent.getFilterFieldsValues(),t);this.setFields(r);this.apply();return}var l=this.parent.getPreset().getAdditionalValues(s);if(a.Type.isPlainObject(l)&&Object.keys(l).length){t=Object.assign({},l,t)}this.setFilter({preset_id:s,additional:t,checkFields:true})}}},{key:"apply",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.setAnalyticsLabel(t);if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){var i=false;var n=false;var s=true;this.parent.applyFilter(i,n,s)}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}},{key:"getEmitter",value:function e(){return this.parent.emitter}},{key:"setAnalyticsLabel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(a.Type.isObject(t)){this.parent.analyticsLabel=t}}}]);return e}();function O(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value,enableTime:e.enableTime}}}function U(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value}}}function k(){return{block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}}}function R(e){return{block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:e.tabindex,value:e.value,items:e.items,name:e.name,valueDelete:false}}}var M;function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function V(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var x=new WeakMap;var j=new WeakMap;var Y=new WeakMap;var q=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",this._onDateTypeChange.bind(this))}},{key:"deleteField",value:function e(t){a.Dom.remove(t)}},{key:"isFieldDelete",value:function e(t){return a.Dom.hasClass(t,this.parent.settings.classFieldDelete)}},{key:"isFieldValueDelete",value:function e(t){return a.Dom.hasClass(t,this.parent.settings.classValueDelete)||a.Dom.hasClass(t.parentNode,this.parent.settings.classValueDelete)}},{key:"isDragButton",value:function e(t){return t&&a.Dom.hasClass(t,this.parent.settings.classPresetDragButton)}},{key:"clearFieldValue",value:function e(t){if(t){var i=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-control"));var n=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-square"));n.forEach((function(e){return a.Dom.remove(e)}));i.forEach((function(e){if(Reflect.has(e,"value")){e.value=""}}))}}},{key:"getField",value:function e(t){if(a.Type.isDomNode(t)){return t.closest(".main-ui-control-field, .main-ui-control-field-group")}return null}},{key:"render",value:function e(t,i){if(a.Type.isString(t)&&a.Type.isPlainObject(i)){var n=Object.entries(i).reduce((function(e,t){var i=babelHelpers.slicedToArray(t,2),n=i[0],s=i[1];return e.replace(new RegExp("{{".concat(n,"}}"),"g"),s)}),t);var s=a.Dom.create("div",{html:n});var r=s.querySelector(".main-ui-control-field-group");if(r){return r}var l=s.querySelector(".main-ui-control-field");if(l){return l}var o=s.querySelector(".main-ui-filter-field-line");if(o){return o}}return null}},{key:"createInputText",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:a.Type.isString(t.VALUE)||a.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};var n=BX.decl(i);this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:n})});return n}},{key:"createTextarea",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-textarea",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:a.Type.isString(t.VALUE)||a.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]});var n=i.querySelector("textarea");var s=function e(){a.Dom.style(n,"height","1px");a.Dom.style(n,"height","".concat(n.scrollHeight,"px"))};a.Event.bind(n,"input",s);a.Event.bind(n,"change",s);a.Event.bind(n,"keyup",s);a.Event.bind(n,"cut",s);a.Event.bind(n,"paste",s);this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createCustomEntityFieldLayout",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var n=t.VALUES._label?t.VALUES._label:[];if(a.Type.isPlainObject(n)){n=Object.keys(n).map((function(e){return n[e]}))}if(!a.Type.isArray(n)){n=[n]}var s=t.VALUES._value?t.VALUES._value:[];if(a.Type.isPlainObject(s)){s=Object.keys(s).map((function(e){return s[e]}))}if(!a.Type.isArray(s)){s=[s]}n.forEach((function(e,t){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:s[t]}})}))}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES._label:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:"".concat(t.NAME,"_label"),tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES._value:"",tabindex:t.TABINDEX});i=BX.decl(i);var r=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(r,"main-ui-square-search-item");r.autocomplete="off";a.Event.bind(r,"focus",BX.proxy(this._onCustomEntityInputFocus,this));a.Event.bind(r,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){a.Event.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}a.Event.bind(r,"keydown",BX.proxy(this._onCustomEntityKeydown,this));a.Event.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i}},{key:"createDestSelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.ready(BX.proxy((function(){BX.Filter.DestinationSelector.create(t.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:t.NAME})}),this));this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createEntitySelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.Filter.EntitySelector.create(t.NAME,{filter:this.parent,isMultiple:t.MULTIPLE,addEntityIdToResult:t.ADD_ENTITY_ID_TO_RESULT,showDialogOnEmptyInput:t.SHOW_DIALOG_ON_EMPTY_INPUT,dialogOptions:t.DIALOG_OPTIONS});this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createCustomEntity",value:function e(t){var i=this.createCustomEntityFieldLayout(t);this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"_onCustomEntityInputFocus",value:function e(t){BX.fireEvent(t.currentTarget,"click")}},{key:"_onCustomEntityInputClick",value:function e(t){t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}var i=new Date(this.trustTimestamp);var n=new Date(this.notTrustTimestamp);var s="".concat(i.getMinutes(),":").concat(i.getSeconds());var r="".concat(n.getMinutes(),":").concat(n.getSeconds());if(s!==r){this._onCustomEntityFocus(t)}}},{key:"_onDocumentFocus",value:function e(t){var i=this.getCustomEntityInstance();var n=i.getPopupContainer();var s=i.getLabelNode()===t.target;var r=!!n&&n.contains(t.target);if(!s&&!r){this._onCustomEntityBlur(t)}}},{key:"_onCustomEntityKeydown",value:function e(t){var i=t.target,n=t.currentTarget;var s=i.parentNode.parentNode;var r=s.querySelectorAll(".main-ui-square");var l=r[r.length-1];if(!a.Type.isDomNode(l)){return}if(BX.Filter.Utils.isKey(t,"backspace")&&n.selectionStart===0){if(a.Dom.hasClass(l,"main-ui-square-selected")){var o=s.querySelector('input[type="hidden"]');if(a.Type.isDomNode(o)){o.value="";BX.fireEvent(o,"input")}a.Dom.remove(l);return}a.Dom.addClass(l,"main-ui-square-selected");return}a.Dom.removeClass(l,"main-ui-square-selected")}},{key:"_onCustomEntityFieldClick",value:function e(t){var i=t.target;if(a.Dom.hasClass(i,"main-ui-square-delete")){var n=i.closest(".main-ui-square");if(a.Type.isDomNode(n)){var s=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[s]);a.Dom.remove(n)}return}var r=i.querySelector('input[type="text"]');if(a.Type.isDomNode(r)){BX.fireEvent(r,"focus")}}},{key:"_onCustomEntityBlur",value:function e(t){var i={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,i]);if(typeof i.stopBlur==="undefined"||!i.stopBlur){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);a.Event.unbind(n.getPopupContainer(),"click",this._stopPropagation);a.Dom.removeClass(n.getField(),"main-ui-focus")}}},{key:"_stopPropagation",value:function e(t){t.stopPropagation()}},{key:"getCustomEntityInstance",value:function e(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance}},{key:"_onCustomEntityFocus",value:function e(t){t.stopPropagation();var i=t.currentTarget;var n=i.closest(".main-ui-control-entity");var s=this.getCustomEntityInstance();s.setField(n);BX.onCustomEvent("BX.Main.Filter:customEntityFocus",[s]);var r=s.getPopupContainer();if(a.Type.isElementNode(r)){a.Event.bind(r,"click",this._stopPropagation)}a.Dom.addClass(n,"main-ui-focus")}},{key:"createCustom",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:["main-ui-control","main-ui-custom-style"],attrs:{"data-name":t.NAME},content:""}});if(a.Type.isString(t.VALUE)){var n=function(){if(Reflect.has(t,"_VALUE")){return t._VALUE}return""}();var s=a.Text.decode(t.VALUE).replace('name="'.concat(t.NAME,'"'),'name="'.concat(t.NAME,'" value="').concat(n,'"'));var r=i.querySelector(".main-ui-custom");a.Runtime.html(r,s)}this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}});this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createMultiSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}});this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:i})});return i}},{key:"createCustomDate",value:function e(t){var i={block:"main-ui-control-field-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(a.Type.isPlainObject(t.VALUE.days)){t.VALUE.days=Object.keys(t.VALUE.days).map((function(e){return t.VALUE.days[e]}))}var n=t.DAYS.filter((function(e){return t.VALUE.days.some((function(t){return t===e.VALUE}))}));var s={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:t.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_days"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.DAYS,value:n,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.DAYS_PLACEHOLDER}}};if(a.Type.isPlainObject(t.VALUE.months)){t.VALUE.months=Object.keys(t.VALUE.months).map((function(e){return t.VALUE.months[e]}))}var r=t.MONTHS.filter((function(e){return t.VALUE.months.some((function(t){return t===e.VALUE}))}));var l={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_months"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.MONTHS,value:r,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.MONTHS_PLACEHOLDER}}};if(a.Type.isPlainObject(t.VALUE.years)){t.VALUE.years=Object.keys(t.VALUE.years).map((function(e){return t.VALUE.years[e]}))}var o=t.YEARS.filter((function(e){return t.VALUE.years.some((function(t){return t===e.VALUE}))}));var u={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_years"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.YEARS,value:o,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.YEARS_PLACEHOLDER}}};i.content.push(s);i.content.push(l);i.content.push(u);var c=BX.decl(i);this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:c})});return c}},{key:"_onDateTypeChange",value:function e(t,i){var n=this;if(this.parent.getPopup().contentContainer.contains(t.node)){var s={};var r=null;var l;var o;var u;if(a.Type.isPlainObject(i)&&Reflect.has(i,"VALUE")){var c=t.getNode();var d=t.getParams();var h=c.dataset.name;if(!a.Type.isPlainObject(d)&&(h.endsWith("_datesel")||h.endsWith("_numsel"))){var p=c.parentNode.parentNode;s.TABINDEX=t.getInput().getAttribute("tabindex");s.SUB_TYPES=t.getItems();s.SUB_TYPE=i;s.NAME=p.dataset.name;s.TYPE=p.dataset.type;s.VALUE_REQUIRED=p.dataset.valueRequired==="true";var f=this.parent.getPreset().getCurrentPresetData();if(a.Type.isArray(f.FIELDS)){var g=f.FIELDS.find((function(e){return e.NAME===s.NAME}));if(a.Type.isNil(g)){g=this.parent.params.FIELDS_STUBS.find((function(e){return e.TYPE===s.TYPE}))}if(!a.Type.isNil(g)){if(h.endsWith("_datesel")){s.MONTHS=g.MONTHS;s.MONTH=g.MONTH;s.YEARS=g.YEARS;s.YEAR=g.YEAR;s.QUARTERS=g.QUARTERS;s.QUARTER=g.QUARTER;s.ENABLE_TIME=g.ENABLE_TIME;s.YEARS_SWITCHER=g.YEARS_SWITCHER}s.VALUES=g.VALUES;s.REQUIRED=g.REQUIRED}}if(this.parent.getParam("ENABLE_LABEL")){l=p.querySelector(".main-ui-control-field-label");s.LABEL=l.innerText}if(h.endsWith("_datesel")){r=this.createDate(s)}else{r=this.createNumber(s)}if(a.Type.isArray(this.parent.fieldsList)){u=this.parent.fieldsList.indexOf(p);if(u!==-1){this.parent.fieldsList[u]=r;this.parent.registerDragItem(r)}}this.parent.unregisterDragItem(p);o=babelHelpers.toConsumableArray(r.querySelectorAll(".main-ui-control-field"));if(a.Type.isArray(o)&&o.length){o.forEach((function(e){e.FieldController=new BX.Filter.FieldController(e,n.parent)}))}if(this.parent.getParam("ENABLE_ADDITIONAL_FILTERS")){var E=m.getInstance().getAdditionalFilterButton({fieldId:s.NAME,enabled:s.ADDITIONAL_FILTER_ALLOWED});a.Dom.append(E,r)}a.Dom.insertAfter(r,p);a.Dom.remove(p)}}}}},{key:"createNumber",value:function e(t){var i=this.parent,n=i.numberTypes,s=i.additionalNumberTypes;var r=this.parent.params.ENABLE_LABEL;var a=t.SUB_TYPE,l=a===void 0?{}:a,o=t.SUB_TYPES,u=o===void 0?[]:o,c=t.TABINDEX,d=c===void 0?"":c,h=t.VALUES,p=h===void 0?{_from:"",_to:""}:h,f=t.LABEL,m=f===void 0?"":f,g=t.ICON,E=g===void 0?null:g,y=t.TYPE;var v=l.VALUE||n.SINGLE;var B=l.PLACEHOLDER||"";var A=t.NAME.replace("_numsel","");var P=function(){if(r){return["main-ui-filter-wield-with-label","main-ui-filter-number-group"]}return["main-ui-filter-number-group"]}();var S={block:"number-group",type:y,mix:P,label:r?m:"",icon:r?E:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:d,value:l,items:u,name:A,deleteButton:true,content:[]};if(v!==n.LESS&&v!==s.BEFORE_N){var _={block:"main-ui-control-field",type:y,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:B,name:"".concat(A,"_from"),tabindex:d,value:p._from||""}};S.content.push(_)}if(v===n.RANGE){var L={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};S.content.push(L)}if(v===n.RANGE||v===n.LESS||v===s.BEFORE_N){var b={block:"main-ui-control-field",type:y,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"".concat(A,"_to"),tabindex:d,value:p._to||""}};S.content.push(b)}var I=BX.decl(S);this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V({},t),node:I})});return I}},{key:"createDate",value:function e(t){var i=this;var n=this.parent,s=n.dateTypes,r=n.additionalDateTypes;var l=t.SUB_TYPE,o=l===void 0?{}:l,u=t.SUB_TYPES,c=u===void 0?[]:u,d=t.PLACEHOLDER,h=d===void 0?"":d,p=t.VALUES,f=p===void 0?{_from:"",_to:"",_quarter:"",_days:"",_month:"",_year:"",_allow_year:""}:p,m=t.TABINDEX,g=m===void 0?"":m,E=t.ENABLE_TIME,y=E===void 0?false:E,v=t.LABEL,B=v===void 0?"":v,A=t.ICON,P=A===void 0?null:A,S=t.TYPE,_=t.VALUE_REQUIRED,L=_===void 0?false:_,b=t.REQUIRED,I=b===void 0?false:b;var T=this.parent.params.ENABLE_LABEL;var F=o.VALUE||s.NONE;var D=t.NAME.replace("_datesel","");var X=function(){if(T){return["main-ui-filter-wield-with-label","main-ui-filter-date-group"]}return["main-ui-filter-date-group"]}();var N={block:"date-group",type:S,mix:X,label:T?B:"",icon:T?P:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:g,value:o,items:c,name:D,enableTime:y,deleteButton:true,content:[]};if(F===s.EXACT){var M=O({type:S,name:"".concat(D.NAME,"_from"),placeholder:h,tabindex:g,value:f._from||"",enableTime:y});N.content.push(M)}if(F===s.NEXT_DAYS||F===s.PREV_DAYS||F===r.PREV_DAY||F===r.NEXT_DAY||F===r.MORE_THAN_DAYS_AGO||F===r.AFTER_DAYS){var w=U({type:S,name:"".concat(D,"_days"),tabindex:g,value:f._days||"",placeholder:h});N.content.push(w)}if(F===s.RANGE){var x={block:"main-ui-filter-range-group",content:[O({type:S,name:"".concat(D,"_from"),placeholder:h,tabindex:g,value:f._from||"",enableTime:y}),k(),O({type:S,name:"".concat(D,"_to"),placeholder:h,tabindex:g,value:f._to||"",enableTime:y})]};N.content.push(x)}if(F===s.MONTH){var j=t.MONTHS,Y=t.MONTH,q=t.YEARS,H=t.YEAR;var G=j.find((function(e){return e.VALUE===f._month}))||Y||j[0];var W=q.find((function(e){return e.VALUE===f._year}))||H||q[0];N.content.push(R({name:"".concat(D,"_month"),value:G,items:j,tabindex:g}),R({name:"".concat(D,"_year"),value:W,items:q,tabindex:g}))}if(F===s.QUARTER){var K=t.YEARS,Q=t.YEAR,J=t.QUARTERS,z=t.QUARTER,Z=t.PARAMS;var $=K.find((function(e){return e.VALUE===f._year}))||Q||K[0];var ee=J.find((function(e){return e.VALUE===f._quarter}))||z||J[0];N.content.push(R({name:"".concat(D,"_year"),value:$,items:K,tabindex:g}),R({name:"".concat(D,"_quarter"),value:ee,items:J,tabindex:g,params:Z}))}if(F===s.YEAR){var te=t.YEARS,ie=t.YEAR;var ne=te.find((function(e){return e.VALUE===f._year}))||ie||te[0];N.content.push(R({name:"".concat(D,"_year"),value:ne,items:te,tabindex:g}))}if(F==="CUSTOM_DATE"){var se=c.find((function(e){return e.VALUE==="CUSTOM_DATE"}));if(se){var re=a.Runtime.clone(se.DECL);if(a.Type.isArray(f._days)){re.VALUE.days=f._days}if(a.Type.isArray(f._month)){re.VALUE.months=f._month}if(a.Type.isArray(f._year)){re.VALUE.years=f._year}var ae=this.createCustomDate(re);a.Dom.removeClass(ae,"main-ui-filter-wield-with-label");var le=babelHelpers.toConsumableArray(ae.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));le.forEach((function(e){return a.Dom.remove(e)}));N.content.push(ae);N.mix.push("main-ui-filter-custom-date-group")}}if(F!==s.NONE&&F!==r.CUSTOM_DATE&&t.YEARS_SWITCHER){var oe=a.Runtime.clone(t.YEARS_SWITCHER);var ue=oe.ITEMS;oe.VALUE=ue.reduce((function(e,t){return t.VALUE===f._allow_year?t:e}));var ce=this.createSelect(oe);a.Dom.addClass(ce,["main-ui-filter-year-switcher","main-ui-filter-with-padding"]);a.Dom.removeClass(ce,"main-ui-filter-wield-with-label");var de=babelHelpers.toConsumableArray(ce.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));de.forEach((function(e){return a.Dom.remove(e)}));var he=N.content.length-1;var pe=N.content[he];if(a.Type.isPlainObject(pe)){if(!a.Type.isArray(pe.mix)){pe.mix=[]}pe.mix.push("main-ui-filter-remove-margin-right")}if(a.Type.isDomNode(pe)){a.Dom.addClass(pe,"main-ui-filter-remove-margin-right")}requestAnimationFrame((function(){a.Dom.addClass(ce.previousElementSibling,"main-ui-filter-remove-margin-right")}));N.content.push(ce);N.mix.push("main-ui-filter-date-with-years-switcher")}var fe=BX.decl(N);var me=a.Runtime.debounce(this.onDateChange,500,this);var ge=babelHelpers.toConsumableArray(fe.querySelectorAll(".main-ui-date-input"));ge.forEach((function(e){e.addEventListener("change",me);e.addEventListener("input",me);var t=e.parentNode;var n=t.querySelector(".main-ui-control-value-delete");if(n){n.addEventListener("click",(function(){setTimeout((function(){i.onDateChange({target:e})}))}))}}));if(L){fe.dataset.valueRequired=true;var Ee=[].concat(babelHelpers.toConsumableArray(ge),babelHelpers.toConsumableArray(fe.querySelectorAll(".main-ui-number-input")));Ee.forEach((function(e){e.addEventListener("change",i.checkRequiredDateValue.bind(i));e.addEventListener("input",i.checkRequiredDateValue.bind(i));var t=e.parentNode;var n=t.querySelector(".main-ui-control-value-delete");if(n){n.addEventListener("click",(function(){setTimeout((function(){i.checkRequiredDateValue({target:e})}))}))}a.Event.bindOnce(e,"mouseout",(function(){i.checkRequiredDateValue({target:e})}))}))}if(I){var ye=fe.querySelector(".main-ui-filter-field-delete");if(ye){BX.remove(ye)}}var ve={};this.parent.prepareControlDateValue(ve,D,fe);Object.entries(ve).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];ve[i.replace(D,"")]=n;delete ve[i]}));this.parent.getEmitter().emit("init",{field:new C({parent:this.parent,options:V(V({},t),{},{VALUES:ve}),node:fe})});return fe}},{key:"checkRequiredDateValue",value:function e(t){if(t.target.value===""){this.showError({id:"valueError",target:t.target,text:this.parent.params.MAIN_UI_FILTER__VALUE_REQUIRED});return}this.hideError({id:"valueError",target:t.target})}},{key:"onDateChange",value:function e(t){var i=this;if(Y.get(t.target)===t.target.value){return}Y.set(t.target,t.target.value);if(t.target.value===""){this.hideError({id:"formatError",target:t.target});return}BX.ajax.runComponentAction("bitrix:main.ui.filter","checkDateFormat",{mode:"ajax",data:{value:t.target.value,format:BX.message("FORMAT_DATETIME")}}).then((function(e){if(!e.data.result){i.showError({id:"formatError",target:t.target});return}i.hideError({id:"formatError",target:t.target})}))}},{key:"showError",value:function e(t){var i=t.id,n=t.target,s=t.text,r=s===void 0?null:s;a.Dom.style(n,"border-color","#FF5752");if(x.has(n)&&j.get(n)===i){a.Dom.remove(x.get(n))}var l=this.parent.params,o=l.MAIN_UI_FILTER__DATE_ERROR_TITLE,u=l.MAIN_UI_FILTER__DATE_ERROR_LABEL;var c=r||"".concat(u," ").concat(a.Loc.getMessage("FORMAT_DATE"));var d=a.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="main-ui-filter-error-message" \n\t\t\t\ttitle="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),o,c);x.set(n,d);j.set(n,i);a.Dom.insertAfter(d,n);a.Dom.attr(n,"is-valid","false")}},{key:"hideError",value:function e(t){var i=t.id,n=t.target;a.Dom.style(n,"border-color",null);if(x.has(n)&&j.get(n)===i){a.Dom.remove(x.get(n))}a.Dom.attr(n,"is-valid","true")}}]);return e}();e.Field=C;e.Api=N;e.Fields=q;e.Presets=g;e.AdditionalFilter=m})(this.BX.Filter=this.BX.Filter||{},BX.UI.EntitySelector,BX,BX,BX.Event,BX.Main,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?17455640801339";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.filterId=t.filterId;this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.filterId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={PROBLEM:t.counterTypeId};this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js?174556408119966";s:6:"source";s:79:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,r,i){"use strict";var o=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filterId=e.filterId;this.filterManager=BX.Main.filterManager.getById(this.filterId);this.bindEvents();this.updateFields()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){s.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){this.updateFields()}},{key:"updateFields",value:function t(){this.fields=this.filterManager.getFilterFieldsValues()}},{key:"isFilteredByField",value:function t(e){if(!Object.keys(this.fields).includes(e)){return false}if(n.Type.isArray(this.fields[e])){return this.fields[e].length>0}return this.fields[e]!==""}},{key:"isFilteredByFieldValue",value:function t(e,n){return this.isFilteredByField(e)&&this.fields[e]===n}},{key:"toggleByField",value:function t(e){var n=this;var s=Object.keys(e)[0];var r=e[s];if(!this.isFilteredByFieldValue(s,r)){this.filterManager.getApi().extendFilter(babelHelpers.defineProperty({},s,r),false,{COUNTER_TYPE:"TASKS_COUNTER_TYPE_"+r});return}this.filterManager.getFilterFields().forEach((function(t){if(t.getAttribute("data-name")===s){n.filterManager.getFields().deleteField(t)}}));this.filterManager.getSearch().apply()}},{key:"getFilter",value:function t(){return this.filterManager}}]);return t}();var a,l,u,c,d;var h=function(){function t(e){babelHelpers.classCallCheck(this,t);this.count=e.count;this.name=e.name;this.type=e.type;this.color=e.color;this.filterField=e.filterField;this.filterValue=e.filterValue;this.filter=e.filter;this.$container=null;this.$innerContainer=null;this.$remove=null;this.$counter=null;this.bindEvents()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){var e=this;s.EventEmitter.subscribe("BX.Tasks.Counters:active",(function(t){e!==t.data?e.unActive():null}))}},{key:"getCounter",value:function t(){if(!this.$counter){var e=this.count>99?"99+":this.count;this.$counter=n.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-num ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),this.getCounterColor(),this.getInnerCounter(e))}return this.$counter}},{key:"getInnerCounter",value:function t(e){if(!this.$innerContainer){this.$innerContainer=n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-num-text --stop --without-animate">',"</div>\t\t\n\t\t\t"])),e)}return this.$innerContainer}},{key:"animateCounter",value:function t(e,s){if(e>99&&s>99){return}if(s>99){s="99+"}if(e>99){e=99}if(s===0){this.getContainer().classList.add("--fade")}if(s>0){this.getContainer().classList.remove("--fade")}n.Dom.clean(this.getCounter());this.getInnerCounter().innerHTML=s;this.getCounter().appendChild(this.getInnerCounter());this.getCounter().classList.remove("--update");this.getCounter().classList.remove("--update-multi")}},{key:"getCounterColor",value:function t(){if(!this.color){return null}return"--".concat(this.color)}},{key:"updateCount",value:function t(e){if(this.count===e)return;this.animateCounter(this.count,e);this.count=e}},{key:"getRemove",value:function t(){if(!this.$remove){this.$remove=n.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-remove"></div>\n\t\t\t'])))}return this.$remove}},{key:"fade",value:function t(){this.getContainer().classList.add("--fade")}},{key:"unFade",value:function t(){this.getContainer().classList.remove("--fade")}},{key:"active",value:function t(e){var r=n.Type.isDomNode(e)?e:this.getContainer();r.classList.add("--hover");s.EventEmitter.emit("BX.Tasks.Counters:active",this)}},{key:"unActive",value:function t(e){var r=n.Type.isDomNode(e)?e:this.getContainer();r.classList.remove("--hover");s.EventEmitter.emit("BX.Tasks.Counters:unActive",this)}},{key:"adjustClick",value:function t(){s.EventEmitter.emit("Tasks.Toolbar:onItem",{counter:this});if(this.$container.classList.contains("--hover")){this.unActive()}else{this.active();this.sendAnalytics()}}},{key:"getPopupMenuItemContainer",value:function t(){var e=n.Loc.getMessage("TASKS_COUNTER_OTHER_TASKS").replace("#TITLE#",this.name.toLowerCase());return n.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="task-counters--popup-item">\n\t\t\t\t\t<span class="tasks-counters--item-counter-num ','">','</span>\n\t\t\t\t\t<span class="task-counters--popup-item-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.getCounterColor(),this.count,e)}},{key:"getContainer",value:function t(e){if(!this.$container){this.$container=n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter ','">\n\t\t\t\t\t<div class="tasks-counters--item-counter-wrapper">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-counters--item-counter-title">',"</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),Number(this.count)===0?" --fade":"",this.getCounter(),this.name,this.getRemove());if(this.filter.isFilteredByFieldValue(this.filterField,this.filterValue)){this.active(this.$container)}n.Event.bind(this.$container,"click",this.adjustClick.bind(this))}return this.$container}},{key:"sendAnalytics",value:function t(){r.sendData({tool:"tasks",category:"task_operations",type:"task",event:this.getAnalyticsEvent(),c_section:this.getAnalyticsSection(),c_element:this.getAnalyticsElement()})}},{key:"getAnalyticsEvent",value:function t(){if(E.counterTypes.expired.includes(this.type)){return"overdue_counters_on"}return"comments_counters_on"}},{key:"getAnalyticsSection",value:function t(){if(E.counterTypes.scrum.includes(this.type)){return"scrum"}if(E.counterTypes.project.includes(this.type)){return"project"}return"tasks"}},{key:"getAnalyticsElement",value:function t(){if(E.counterTypes.expired.includes(this.type)){return"overdue_counters_filter"}return"comments_counters_filter"}}]);return t}();var p,m,f,v,g,y,_,k,b;function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E=function(){babelHelpers.createClass(t,null,[{key:"counterTypes",get:function t(){return{my:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","projects_total_expired","projects_total_comments","sonet_total_expired","sonet_total_comments","groups_total_expired","groups_total_comments","scrum_total_comments","flow_total_expired","flow_total_comments"],other:["project_expired","project_comments","projects_foreign_expired","projects_foreign_comments","groups_foreign_expired","groups_foreign_comments","sonet_foreign_expired","sonet_foreign_comments","scrum_foreign_comments"],additional:["muted_new_comments"],expired:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","project_expired","projects_total_expired","projects_foreign_expired","groups_total_expired","groups_foreign_expired","sonet_total_expired","sonet_foreign_expired","flow_total_expired"],comment:["new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","muted_new_comments","project_comments","projects_total_comments","projects_foreign_comments","groups_total_comments","groups_foreign_comments","sonet_total_comments","sonet_foreign_comments","scrum_total_comments","scrum_foreign_comments","flow_total_comments"],project:["project_expired","projects_total_expired","projects_foreign_expired","groups_total_expired","groups_foreign_expired","sonet_total_expired","sonet_foreign_expired","project_comments","projects_total_comments","projects_foreign_comments","groups_total_comments","groups_foreign_comments","sonet_total_comments","sonet_foreign_comments"],scrum:["scrum_total_comments","scrum_foreign_comments"]}}}]);function t(e){babelHelpers.classCallCheck(this,t);this.userId=e.userId;this.targetUserId=e.targetUserId;this.groupId=e.groupId;this.counters=e.counters;this.initialCounterTypes=e.counterTypes;this.renderTo=e.renderTo;this.role=e.role;this.signedParameters=e.signedParameters;this.popupMenu=null;this.$readAll={cropped:null,layout:null};this.$more=null;this.$moreArrow=null;this.$other={cropped:null,layout:null};this.$myTaskHead=null;this.filter=new o({filterId:e.filterId});this.bindEvents();this.setData(this.counters);this.initPull()}babelHelpers.createClass(t,[{key:"isMyTaskList",value:function t(){return this.userId===this.targetUserId}},{key:"isUserTaskList",value:function t(){return Object.keys(this.otherCounters).length===0}},{key:"isProjectsTaskList",value:function t(){return this.groupId>0}},{key:"isProjectList",value:function t(){return!this.isUserTaskList()&&!this.isProjectsTaskList()}},{key:"initPull",value:function t(){var e=this;BX.PULL.subscribe({moduleId:"tasks",callback:function t(n){return e.processPullEvent(n)}});this.extendWatch()}},{key:"extendWatch",value:function t(){var e=this;if(this.isProjectsTaskList()||this.isProjectList()){var n="TASKS_PROJECTS";if(this.isProjectsTaskList()){n="TASKS_PROJECTS_".concat(this.groupId)}BX.PULL.extendWatch(n,true);setTimeout((function(){return e.extendWatch()}),29*60*1e3)}}},{key:"processPullEvent",value:function t(e){var n={user_counter:this.onUserCounter.bind(this),project_counter:this.onProjectCounter.bind(this),comment_read_all:this.onCommentReadAll.bind(this)};var s=Object.prototype.hasOwnProperty;var r=e.command,i=e.params;if(s.call(n,r)){var o=n[r];if(o){o.apply(this,[i])}}}},{key:"bindEvents",value:function t(){s.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){var e=this;this.filter.updateFields();if(this.isRoleChanged()){this.updateRole();this.updateCountersData()}else{var n=T(T({},this.myCounters),this.otherCounters);Object.values(n).forEach((function(t){if(t){e.filter.isFilteredByFieldValue(t.filterField,t.filterValue)?t.active():t.unActive()}}))}}},{key:"updateCountersData",value:function e(){var s=this;if(t.updateTimeout){t.needUpdate=true;return}t.updateTimeout=true;t.needUpdate=false;n.ajax.runComponentAction("bitrix:tasks.interface.counters","getCounters",{mode:"class",data:{groupId:this.groupId,role:this.role,counters:this.initialCounterTypes},signedParameters:this.signedParameters}).then((function(t){return s.rerender(t.data)}),(function(t){return console.log(t)}));setTimeout(function(){t.updateTimeout=false;if(t.needUpdate){this.updateCountersData()}}.bind(this),t.timeoutTTL)}},{key:"isRoleChanged",value:function t(){return this.role!==(this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all")}},{key:"updateRole",value:function t(){this.role=this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all"}},{key:"onCommentReadAll",value:function t(e){this.updateCountersData()}},{key:"onUserCounter",value:function e(n){var s=this;var r=Object.prototype.hasOwnProperty;if(!this.isUserTaskList()||!this.isMyTaskList()||!r.call(n,this.groupId)||this.userId!==Number(n.userId)){this.updateCountersData();return}var i=0;Object.entries(n[this.groupId][this.role]).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),r=n[0],o=n[1];if(s.myCounters[r]){s.myCounters[r].updateCount(o);if(t.counterTypes.comment.includes(r)){i+=o}}else if(s.additionalCounters[r]&&t.counterTypes.comment.includes(r)){i+=o}}));if(i>0){this.$readAllInner.classList.remove("--fade")}if(n.isSonetEnabled!==undefined&&n.isSonetEnabled===false){this.updateCountersData()}}},{key:"onProjectCounter",value:function t(e){if(this.isUserTaskList()){return}this.updateCountersData()}},{key:"getCounterItem",value:function t(e){return new h({count:e.count,name:e.name,type:e.type,color:e.color,filterField:e.filterField,filterValue:e.filterValue,filter:this.filter})}},{key:"getCounterNameByType",value:function e(s){if(t.counterTypes.expired.includes(s)){return n.Loc.getMessage("TASKS_COUNTER_EXPIRED")}else if(t.counterTypes.comment.includes(s)){return n.Loc.getMessage("TASKS_COUNTER_NEW_COMMENTS")}}},{key:"setData",value:function e(n){var s=this;this.myCounters={};this.otherCounters={};this.additionalCounters={};var r=[].concat(babelHelpers.toConsumableArray(t.counterTypes.additional),babelHelpers.toConsumableArray(t.counterTypes.my),babelHelpers.toConsumableArray(t.counterTypes.other));Object.entries(n).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),i=n[0],o=n[1];if(!r.includes(i)){return}var a=s.getCounterItem({type:i,name:s.getCounterNameByType(i),count:Number(o.VALUE),color:o.STYLE,filterField:o.FILTER_FIELD,filterValue:o.FILTER_VALUE});if(t.counterTypes.additional.includes(i)){s.additionalCounters[i]=a}else if(t.counterTypes.my.includes(i)){s.myCounters[i]=a}else if(t.counterTypes.other.includes(i)){s.otherCounters[i]=a}}))}},{key:"isCroppedBlock",value:function t(e){if(e)return e.classList.contains("--cropp")}},{key:"getReadAllBlock",value:function e(){var s=this;var r=T(T(T({},this.myCounters),this.otherCounters),this.additionalCounters);var i=0;Object.entries(r).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),s=n[0],r=n[1];if(t.counterTypes.comment.includes(s)){i+=r.count}}));this.$readAllInner=n.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div data-role="tasks-counters--item-head-read-all" class="tasks-counters--item-head\n\t\t\t\t\t\t',' \n\t\t\t\t\t\t--action \n\t\t\t\t\t\t--read-all">\n\t\t\t\t<div class="tasks-counters--item-head-read-all--icon"></div>\n\t\t\t\t<div class="tasks-counters--item-head-read-all--text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),i===0?"--fade":"",n.Loc.getMessage("TASKS_COUNTER_READ_ALL"));var o=this.readAllForProjects.bind(this);if(this.isUserTaskList()||this.isProjectsTaskList()&&this.role!=="view_all"){o=this.readAllByRole.bind(this)}else if(this.myCounters["scrum_total_comments"]||this.otherCounters["scrum_foreign_comments"]){o=this.readAllForScrum.bind(this)}n.Event.bind(this.$readAllInner,"click",o);n.Event.bind(this.$readAllInner,"click",(function(){return s.$readAllInner.classList.add("--fade")}));this.$readAll.layout=n.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item">',"</div>\n\t\t"])),this.$readAllInner);return this.$readAll.layout}},{key:"readAllByRole",value:function t(){(new i.Controller).userComments({groupId:this.groupId,userId:this.userId,role:this.role})}},{key:"readAllForProjects",value:function e(){var n=T(T({},this.myCounters),this.otherCounters);Object.entries(n).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),s=n[0],r=n[1];if(t.counterTypes.comment.includes(s)){r.updateCount(0)}}));(new i.Controller).projectComments({groupId:this.groupId})}},{key:"readAllForScrum",value:function e(){var n=T(T({},this.myCounters),this.otherCounters);Object.entries(n).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),s=n[0],r=n[1];if(t.counterTypes.comment.includes(s)){r.updateCount(0)}}));(new i.Controller).scrumComments({groupId:this.groupId})}},{key:"getPopup",value:function t(){var n=this;var s=[];Object.values(this.otherCounters).forEach((function(t){var r=new e.MenuItem({html:t.getPopupMenuItemContainer().innerHTML});r.onclick=n.onPopupItemClick.bind(n,r,t);s.push(r)}));this.popupMenu=new e.Menu({bindElement:this.$moreArrow,className:"tasks-counters--scope",angle:{offset:96},autoHide:true,closeEsc:true,offsetTop:5,offsetLeft:-67,animation:"fading-slide",items:s,events:{onPopupShow:function t(){return n.$more.classList.add("--hover")},onPopupClose:function t(){n.$more.classList.remove("--hover");n.popupMenu.destroy()}}});return this.popupMenu}},{key:"onPopupItemClick",value:function t(e,n){n.adjustClick();this.popupMenu.close()}},{key:"getMoreArrow",value:function t(){if(!this.$moreArrow){this.$moreArrow=n.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-arrow"></div>\n\t\t\t'])))}return this.$moreArrow}},{key:"getMore",value:function t(){var e=this;var s=0;Object.values(this.otherCounters).forEach((function(t){s+=Number(t.count)}));var r=s>99?"99+":s;this.$moreArrow=n.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-counter-arrow"></div>\n\t\t'])));this.$more=n.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-counter--more">\n\t\t\t\t<div class="tasks-counters--item-counter-wrapper">\n\t\t\t\t\t<div class="tasks-counters--item-counter-title">',':</div>\n\t\t\t\t\t<div class="tasks-counters--item-counter-num">\n\t\t\t\t\t\t',"\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("TASKS_COUNTER_MORE"),this.getInnerCounter(r),this.$moreArrow);n.Event.bind(this.$more,"click",(function(){return e.getPopup().show()}));return this.$more}},{key:"getInnerCounter",value:function t(e){if(!this.$innerContainer){this.$innerContainer=n.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-num-text --stop --without-animate">',"</div>\t\t\n\t\t\t"])),e)}return this.$innerContainer}},{key:"getOther",value:function t(){if(Object.keys(this.otherCounters).length===0){return""}var e=[];Object.values(this.otherCounters).forEach((function(t){return e.push(t.getContainer())}));this.$other.cropped=this.isCroppedBlock(this.$other.layout);this.$other.layout=n.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item --other ','">\n\t\t\t\t<div data-role="tasks-counters--item-head-other" class="tasks-counters--item-head">','</div>\n\t\t\t\t<div class="tasks-counters--item-content">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.$other.cropped?"--cropp":"",n.Loc.getMessage("TASKS_COUNTER_OTHER"),e,this.getMore());return this.$other.layout}},{key:"getContainer",value:function t(){var e=[];Object.values(this.myCounters).forEach((function(t){return e.push(t.getContainer())}));this.$myTaskHead=n.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-head">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("TASKS_COUNTER_MY"));this.$element=n.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters tasks-counters--scope">\n\t\t\t\t<div class="tasks-counters--item">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-counters--item-content">',"</div>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.$myTaskHead,e,this.getOther(),this.isUserTaskList()&&!this.isMyTaskList()?"":this.getReadAllBlock());return this.$element}},{key:"rerender",value:function t(e){this.setData(e);this.render()}},{key:"render",value:function t(){var e=this.getContainer();var s=e.cloneNode(true);s.classList.add("task-interface-toolbar");s.style.position="fixed";s.style.opacity="0";s.style.width="auto";s.style.pointerEvents="none";document.body.appendChild(s);this.nodeWidth=s.offsetWidth;document.body.removeChild(s);n.Dom.replace(this.renderTo.firstChild,e)}}]);return t}();babelHelpers.defineProperty(E,"updateTimeout",false);babelHelpers.defineProperty(E,"needUpdate",false);babelHelpers.defineProperty(E,"timeoutTTL",5e3);t.Counters=E})(this.BX.Tasks.Counters=this.BX.Tasks.Counters||{},BX.Main,BX,BX.Event,BX.UI.Analytics,BX.Tasks.Viewed);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17455640301655";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,n){n=n||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=n.sections||{};this.frequencyItem=n.frequencyItem||{};this.ajaxPath=n.ajaxPath||"";this.bindingId=n.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&BX(this.idTop).getAttribute("href")==="#"){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var n=0,e=i.length;n<e;n++){i[n]["text"]=i[n]["text"];if(typeof i[n]["items"]!=="undefined"){i[n]["items"]=this.buildMenu(i[n]["items"])}else if(!i[n]["system"]){i[n]["onclick"]=this.onItemClick.bind(this,i[n]["id"],i[n]["onclick"])}t.push(i[n])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false;if(i&&i.target){i.target.blur()}}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js?17455640803916";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(e){BX.Tasks.Component.TasksToolbar.instance=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){this.rerender("")}else{this.render()}},bindEvents:function(){var e={user_counter:this.onUserCounter};BX.addCustomEvent("onPullEvent-tasks",function(t,n){if(e[t]){e[t].apply(this,[n])}}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",function(e){this.rerender(e)}.bind(this));BX.addCustomEvent("BX.Kanban.ChangeGroup",function(e,t){this.option("groupId",e);this.rerender("")}.bind(this))},onUserCounter:function(e){var t=Number(this.option("userId"));var n=Number(this.option("ownerId"));var o=Number(this.option("groupId"));if(!this.option("showCounters")||!e.hasOwnProperty(o)||t!==n||t!==Number(e.userId)){return}var r=this.option("filterId")||null;if(r){var i="view_all";var s=BX.Main.filterManager.getById(r);if(s){var a=s.getFilterFieldsValues();i=a.ROLEID||i}this.option("counters",this.prepareCounters(e[o][i]));this.render()}},prepareCounters:function(e){var t={total:"",expired:6291456,new_comments:12582912};var n={};Object.keys(e).forEach((function(o){n[o]={code:t[o],counter:e[o]}}));return n},rerender:function(e){},render:function(){return;var e=this.option("templates");var t=this.option("counters");var n=this.option("foreign_counters");var o=this.option("messages");var r=this.option("classes");var i=this.option("buttons");var s=this.option("project_mode");var a=[];if(typeof t.total==="object"&&"counter"in t.total&&t.total.counter>0){a.push(e.total.replace("#COUNTER#",t.total.counter).replace("#TEXT#",o.total));Object.keys(t).forEach(function(n){var s=t[n];if(s.counter>0&&n!=="total"){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",n).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[n+"_"+BX.Loc.getPluralForm(s.counter)]).replace("#CLASS#",r[n]).replace("#BUTTON#",i[n]||""))}}.bind(this))}if(typeof n.foreign_expired==="object"&&"counter"in n.foreign_expired&&n.foreign_expired.counter>0||typeof n.foreign_comments==="object"&&"counter"in n.foreign_comments&&n.foreign_comments.counter>0){a.push(e.foreign.replace("#TEXT#",o.foreign));Object.keys(n).forEach(function(t){var s=n[t];if(s.counter>0){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",t).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[t+"_"+BX.Loc.getPluralForm(s.counter)]).replace("#CLASS#",r[t]).replace("#BUTTON#",i[t]||""))}}.bind(this))}if(!a.length){a.push(e.empty.replace("#TEXT#",o.empty))}this.scope().innerHTML=a.join("");var c=this.option("filterId")||null;var u=this.option("roleId")||"view_all";if(c){var l=BX.Main.filterManager.getById(c);if(l){var p=l.getFilterFieldsValues();u=p.ROLEID||u}}var d=this.scope().getElementsByClassName("tasks-counter-container");Object.values(d).forEach(function(e){BX.bind(e,"click",(function(e){BX.PreventDefault(e);BX.onCustomEvent("Tasks.Toolbar:onItem",[this.dataset.counterCode,window.location.href])}));if(e.nextSibling&&BX.hasClass(e.nextSibling,"tasks-counter-counter-button")&&e.nextSibling.dataset.counterId==="new_comments"){if(s){BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readProject",{data:{groupId:this.option("groupId")||0}})}.bind(this))}else{BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readAll",{data:{groupId:this.option("groupId")||0,userId:this.option("ownerId"),role:u}})}.bind(this))}}}.bind(this))}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?174556408114970";s:6:"source";s:81:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.js";s:3:"min";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js";s:3:"map";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Tasks");BX.Tasks.QuickForm=function(t,e){var s=BX(t);if(!s){throw"BX.Tasks.QuickForm: wrong container id"}this.parameters=e||{};this.layout={container:s,button:BX(this.parameters.button),form:BX("task-new-item-form"),responsible:BX("task-new-item-responsible"),responsibleId:BX("task-new-item-responsible-id"),deadline:BX("task-new-item-deadline"),title:BX("task-new-item-title"),projectLink:BX("task-new-item-project-link"),projectClearing:BX("task-new-item-project-clearing"),projectId:BX("task-new-item-project-id"),descriptionBlock:BX("task-new-item-description-block"),descriptionLink:BX("task-new-item-description-link"),description:BX("task-new-item-description"),saveButton:BX("task-new-item-save"),cancelButton:BX("task-new-item-cancel")};this.gridId=BX.type.isNotEmptyString(this.parameters.gridId)?this.parameters.gridId:null;this.messages=this.parameters.messages||{};this.canManageTask=this.parameters.canManageTask!==false;this.canAddMailUsers=this.parameters.canAddMailUsers===true;this.personalContext=Boolean(this.parameters.personalContext);this.isProjectEnabled=Boolean(this.parameters.isProjectEnabled);this.projectFeatureId=BX.type.isNotEmptyString(this.parameters.projectFeatureId)?this.parameters.projectFeatureId:"";if(this.canManageTask){BX.bind(this.layout.title,"keypress",BX.proxy(this.fireEnterKey,this));if(this.layout.button){BX.bind(this.layout.button,"click",BX.proxy(this.handleButtonClick,this))}BX.bind(this.layout.cancelButton,"click",BX.proxy(this.hide,this));BX.bind(this.layout.saveButton,"click",BX.proxy(this.submit,this));BX.bind(this.layout.descriptionLink,"click",BX.proxy(this.toggleDescription,this));BX.bind(this.layout.deadline,"click",BX.proxy(this.calendar,this));BX.bind(this.layout.deadline,"focus",BX.proxy(this.calendar,this))}else{this.disable()}this.operation="taskQuickAdd";this.errorPopup=null;this.notification=new BX.Tasks.QuickForm.Notification(this);this.projectSelector=new BX.Tasks.QuickForm.ProjectSelector("task-new-item-project-selector",this);this.userSelector=new BX.Tasks.QuickForm.UserSelector("task-new-item-user-selector",this);this.calendarSettings=this.parameters.calendarSettings?this.parameters.calendarSettings:{}};BX.Tasks.QuickForm.prototype.submit=function(){const t=this.layout.title.value;if(BX.util.trim(t).length===0){return false}const e={title:t,deadline:this.layout.deadline.value,description:this.layout.description.value,project:this.layout.projectId.value,pathToTask:this.parameters.pathToTask,siteId:BX.message("SITE_ID"),nameTemplate:this.parameters.nameTemplate,getListParams:this.parameters.getListParams,ganttMode:this.parameters.ganttMode};const s=this.userSelector.getUserId();const i=this.userSelector.getUserEmail();if(s>0){e.responsibleId=s}else if(this.canAddMailUsers&&i.length){e.userEmail=i;e.userName=this.userSelector.getUserName();e.userLastName=this.userSelector.getUserLastName()}this.disable();this.fadeGrid();BX.ajax.runComponentAction("bitrix:tasks.interface.quick.form","addTask",{mode:"class",data:{data:e},analytics:{tool:"tasks",category:"task_operations",event:"task_create",type:"task",c_section:"tasks",c_element:"quick_button",c_sub_section:this.parameters?.ganttMode?"gantt":"list",status:"success"}}).then(function(t){this.onQueryExecuted(t)}.bind(this),function(t){return this.showError(t.errors[0]?.message?t.errors[0].message:"Could not process this operation.")}.bind(this))};BX.Tasks.QuickForm.prototype.onQueryExecuted=function(response){if(response.errors&&response.errors.length){return this.showError("Could not process this operation.")}void BX.ajax.runAction("tasks.analytics.hit",{analyticsLabel:{action:"taskAdding",source:"quickForm",scope:this.parameters.scope}});var data=response.data;var found=data.position&&data.position.found===true;if(found){var grid=this.getGrid();if(grid&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){BX.onCustomEvent(window,"onTasksQuickFormExecuted",[data]);return grid.reloadTable("GET",{},this.applyChanges.bind(this,data,found))}else if(data.task){var result=null;var task=null;try{eval("result = "+data.task);task=result}catch(t){}this.insertIntoGantt(task,data.position)}}BX.onCustomEvent(window,"onTasksQuickFormExecuted",[data]);this.applyChanges(data,found)};BX.Tasks.QuickForm.prototype.applyChanges=function(t,e){var s=t["taskRaw"]&&t["taskRaw"]["TITLE"]?t["taskRaw"]["TITLE"]:"";var i=t["taskPath"];this.notification.show(t["taskId"],s,i,e);this.highlight(t["taskId"],false);this.unfadeGrid();this.enable();this.clear(t.currentUser);this.focus()};BX.Tasks.QuickForm.prototype.insertIntoGantt=function(t,e){if(!window.ganttChart||!t){return}BX.onCustomEvent("onTaskListTaskAdd",[t]);if(t.projectId&&!ganttChart.getProjectById(t.projectId)&&this.parameters.currentGroupId===0&&this.parameters.groupByProject===true){ganttChart.addProjectFromJSON({id:t.projectId,name:t.projectName,opened:true,canCreateTasks:t.projectCanCreateTasks,canEditTasks:t.projectCanEditTasks})}var s=ganttChart.addTaskFromJSON(t);if(s.parentTaskId){var i=ganttChart.getTaskById(s.parentTaskId);if(i){i.expand()}}var o=ganttChart.getTaskById(e.nextTaskId);var a=ganttChart.getTaskById(e.prevTaskId);if(o&&o.projectId===s.projectId){ganttChart.moveTask(s.id,o.id)}else if(a&&a.projectId===s.projectId){ganttChart.moveTask(s.id,a.id,true)}};BX.Tasks.QuickForm.prototype.getNextProject=function(t,e){var s=BX.findChildrenByClassName(t,"task-list-project-item");if(!e&&s.length){return s[0]}var i=null;for(var o=0;o<s.length;o++){if(parseInt(s[o].getAttribute("data-project-id"),10)>e){i=s[o];break}}return i};BX.Tasks.QuickForm.prototype.showError=function(){if(this.errorPopup===null){this.errorPopup=new BX.PopupWindow(this.operation,null,{lightShadow:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:BX.proxy(this.onPopupErrorClose,this)}})]})}var t=[];for(var e=0;e<arguments.length;e++){var s=arguments[e];if(BX.type.isArray(s)){t=BX.util.array_merge(t,s)}else if(BX.type.isString(s)){t.push(s)}}var i="";for(e=0;e<t.length;e++){i+=(typeof t[e].MESSAGE!=="undefined"?t[e].MESSAGE:t[e])+"<br>"}this.errorPopup.setContent("<div class='task-new-item-error-popup'>"+i+"</div>");this.errorPopup.show()};BX.Tasks.QuickForm.prototype.fadeGrid=function(){if(this.getGrid()&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){this.getGrid().tableFade()}};BX.Tasks.QuickForm.prototype.unfadeGrid=function(){if(this.getGrid()&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){this.getGrid().tableUnfade()}};BX.Tasks.QuickForm.prototype.onPopupErrorClose=function(){this.errorPopup.close();this.unfadeGrid();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.calendar=function(t){BX.PreventDefault(t);var e=this.layout.deadline;BX.calendar({node:e,field:e.name,bTime:true,bSetFocus:false,bCompatibility:true,bCategoryTimeVisibilityOption:"tasks.bx.calendar.deadline",bTimeVisibility:this.calendarSettings?this.calendarSettings.deadlineTimeVisibility==="Y":false,value:BX.CJSTask.ui.getInputDateTimeValue(e),bHideTimebar:false})};BX.Tasks.QuickForm.prototype.show=function(){BX.addClass(this.layout.container,"task-top-panel-righttop-open");BX.addClass(this.layout.button,"tasks-quick-form-button-active");this.focus()};BX.Tasks.QuickForm.prototype.hide=function(){BX.removeClass(this.layout.container,"task-top-panel-righttop-open");BX.removeClass(this.layout.button,"tasks-quick-form-button-active");this.notification.hide();this.focus()};BX.Tasks.QuickForm.prototype.handleButtonClick=function(t){if(BX.hasClass(this.layout.container,"task-top-panel-righttop-open")){this.hide()}else{this.show()}};BX.Tasks.QuickForm.prototype.toggleDescription=function(t){BX.toggleClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open");if(BX.hasClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open")){this.layout.description.focus()}else{this.focus()}BX.PreventDefault(t)};BX.Tasks.QuickForm.prototype.fireEnterKey=function(t){t=t||window.event;if(t.keyCode===13){this.submit();BX.PreventDefault(t)}};BX.Tasks.QuickForm.prototype.getGrid=function(){if(this.gridId&&BX.Main&&BX.Main.gridManager){return BX.Main.gridManager.getInstanceById(this.gridId)}return null};BX.Tasks.QuickForm.prototype.disable=function(){this.layout.title.disabled=true;this.layout.deadline.disabled=true;this.layout.responsible.disabled=true;this.layout.description.disabled=true;BX.addClass(this.layout.saveButton,"ui-btn-clock")};BX.Tasks.QuickForm.prototype.enable=function(){this.layout.title.disabled=false;this.layout.deadline.disabled=false;this.layout.responsible.disabled=false;this.layout.description.disabled=false;BX.removeClass(this.layout.saveButton,"ui-btn-clock")};BX.Tasks.QuickForm.prototype.clear=function(t){this.layout.title.value="";this.layout.deadline.value="";this.layout.description.value="";this.personalContext&&this.projectSelector.clearProject();this.userSelector.setCurrentUser(t)};BX.Tasks.QuickForm.prototype.focus=function(){this.layout.title.focus()};BX.Tasks.QuickForm.prototype.highlight=function(t,e){if(window.ganttChart){var s=ganttChart.getTaskById(t);if(s){s.highlight();if(e===true){s.scrollIntoView(false)}}}else if(this.getGrid()){var i=this.getGrid().getRows().getById(t);if(i){var o=i.getNode();BX.addClass(o,"task-list-item-highlighted");setTimeout((function(){BX.removeClass(o,"task-list-item-highlighted")}),1e3);if(e===true){o.scrollIntoView(false)}}}};BX.Tasks.QuickForm.Notification=function(t){this.form=t;this.taskId=0;this.layout={block:BX("task-new-item-notification"),message:BX("task-new-item-message"),openLink:BX("task-new-item-open"),highlightLink:BX("task-new-item-highlight"),hideLink:BX("task-new-item-notification-hide")};BX.bind(this.layout.hideLink,"click",BX.proxy(this.hide,this));BX.bind(this.layout.highlightLink,"click",BX.proxy(this.highlight,this))};BX.Tasks.QuickForm.Notification.prototype.show=function(t,e,s,i){this.taskId=t;this.layout.message.innerHTML=e;this.layout.openLink.href=s;if(i){this.layout.highlightLink.style.display="inline"}else{this.layout.highlightLink.style.display="none"}BX.addClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.hide=function(){BX.removeClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.highlight=function(){this.form.highlight(this.taskId,true)};BX.Tasks.QuickForm.ProjectSelector=function(t,e){this.id=t;this.form=e;this.projectName=this.form.layout.projectLink.innerHTML;this.projectId=parseInt(this.form.layout.projectId.value,10);this.isProjectEnabled=Boolean(this.form.isProjectEnabled);this.projectFeatureId=BX.type.isNotEmptyString(this.form.projectFeatureId)?this.form.projectFeatureId:"";BX.bind(this.form.layout.projectLink,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.projectClearing,"click",BX.proxy(this.clearProject,this));this.projectDialog=new BX.UI.EntitySelector.Dialog({targetNode:this.form.layout.projectLink,enableSearch:true,multiple:false,context:"TASKS_QUICK_FORM_PROJECT",entities:[{id:"project"}],events:{"Item:onSelect":function(t){var e=t.getData().item;this.onSelect(e)}.bind(this),"Item:onDeselect":function(t){this.clearProject()}.bind(this)}})};BX.Tasks.QuickForm.ProjectSelector.prototype.openDialog=function(t){if(this.isProjectEnabled){this.projectDialog.show()}else{this.showProjectLimit()}if(t){BX.PreventDefault(t)}};BX.Tasks.QuickForm.ProjectSelector.prototype.showProjectLimit=function(){BX.Runtime.loadExtension("tasks.limit").then((t=>{const{Limit:e}=t;e.showInstance({featureId:this.projectFeatureId,limitAnalyticsLabels:{module:"tasks",source:"quickForm"}})}))};BX.Tasks.QuickForm.ProjectSelector.prototype.onSelect=function(t){this.projectId=t.getId();this.projectName=t.getTitle();this.form.layout.projectId.value=this.projectId;this.form.layout.projectLink.textContent=this.projectName;BX.addClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active")};BX.Tasks.QuickForm.ProjectSelector.prototype.clearProject=function(){this.form.layout.projectLink.innerHTML=this.form.messages.taskInProject;this.form.layout.projectId.value=0;this.projectId=0;this.projectName="";BX.removeClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");this.projectDialog.deselectAll();this.projectDialog.hide()};BX.Tasks.QuickForm.UserSelector=function(t,e){this.id=t;this.form=e;this.userId=this.form.layout.responsibleId.value;this.userNameFormatted=this.form.layout.responsible.value;this.userEmail="";this.userName="";this.userLastName="";BX.bind(this.form.layout.responsible,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"keyup",(function(t){BX.PreventDefault(t)}));BX.bind(this.form.layout.responsible,"keydown",(function(t){BX.PreventDefault(t)}))};BX.Tasks.QuickForm.UserSelector.prototype.getUserId=function(){return this.userId};BX.Tasks.QuickForm.UserSelector.prototype.getUserEmail=function(){return this.userEmail};BX.Tasks.QuickForm.UserSelector.prototype.getUserName=function(){return this.userName};BX.Tasks.QuickForm.UserSelector.prototype.getUserLastName=function(){return this.userLastName};BX.Tasks.QuickForm.UserSelector.prototype.openDialog=function(t){BX.calendar.get().Close();BX.PreventDefault(t);this.initDialog();this.userDialog.show()};BX.Tasks.QuickForm.UserSelector.prototype.initDialog=function(){if(this.userDialog){return}this.userDialog=new BX.UI.EntitySelector.Dialog({targetNode:this.form.layout.responsible,enableSearch:true,multiple:false,context:"TASKS_QUICK_FORM_RESPONSIBLE",preselectedItems:[["user",this.userId]],entities:[{id:"user",options:{emailUsers:true,networkUsers:this.form.parameters.networkEnabled,extranetUsers:true,inviteGuestLink:true,myEmailUsers:true,analyticsSource:"tasks"}},{id:"department"}],events:{"Item:onSelect":function(t){var e=t.getData().item;this.onSelect(e)}.bind(this),"Item:onDeselect":function(t){this.form.layout.responsible.value=""}.bind(this)}})};BX.Tasks.QuickForm.UserSelector.prototype.onBeforeSelectItemFocus=function(t){if(t.id===this.id){t.blockFocus=true}};BX.Tasks.QuickForm.UserSelector.prototype.onSelect=function(t,e,s){this.userId=t.getId();this.userNameFormatted=BX.util.htmlspecialcharsback(t.getTitle());var i=t.getCustomData();this.userEmail=i.get("email");this.userName=i.get("name");this.userLastName=i.get("lastName");this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId;this.userDialog.hide()};BX.Tasks.QuickForm.UserSelector.prototype.setCurrentUser=function(t){if(!t){return}this.userId=t.id;this.userNameFormatted=t.fullName;this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId;if(!this.userDialog){return}var e=this.userDialog.getItem({id:this.userId,entityId:"user"});e&&e.select();this.userDialog.hide()}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?1745563967192574";s:6:"source";s:67:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.map.js";}"*/
(function(exports,ui_cnt,ui_dialogs_checkboxList,main_core,main_core_events,main_loader,main_popup){"use strict";(function(){BX.namespace("BX.Grid");BX.Grid.ActionPanel=function(t,e,i){this.parent=null;this.rel={};this.actions=null;this.types=null;this.lastActivated=[];this.init(t,e,i);this.button=[];this.elements=[];this.buttonOnChange=[];this.buttonData={}};BX.Grid.ActionPanel.prototype={init(parent,actions,types){this.parent=parent;this.actions=eval(actions);this.types=eval(types);BX.addCustomEvent(window,"Dropdown::change",BX.proxy(this._dropdownEventHandle,this));BX.addCustomEvent(window,"Dropdown::load",BX.proxy(this._dropdownEventHandle,this));const panel=this.getPanel();BX.bind(panel,"change",BX.delegate(this._checkboxChange,this));BX.bind(panel,"click",BX.delegate(this._clickOnButton,this));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this._gridUpdatedEventHandle,this))},destroy(){BX.removeCustomEvent(window,"Dropdown::change",BX.proxy(this._dropdownEventHandle,this));BX.removeCustomEvent(window,"Dropdown::load",BX.proxy(this._dropdownEventHandle,this));BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this._gridUpdatedEventHandle,this))},_gridUpdatedEventHandle(){const t=BX("grid_cancel_button");t&&BX.fireEvent(BX.firstChild(t),"click")},_dropdownEventHandle(t,e,i,s){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,i,s)},resetForAllCheckbox(){const t=this.getForAllCheckbox();if(BX.type.isDomNode(t)){t.checked=null}},getForAllCheckbox(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classForAllCheckbox"),true)},getPanel(){return BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classActionPanel"),true)},getApplyButton(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelApplyButton"),true)},isPanelControl(t){return BX.hasClass(t,this.parent.settings.get("classPanelControl"))},getTextInputs(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="text"]')},getHiddenInputs(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="hidden"]')},getSelects(){return BX.Grid.Utils.getBySelector(this.getPanel(),"select")},getDropdowns(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classDropdown"))},getCheckboxes(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelCheckbox"))},getButtons(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelButton"))},isDropdown(t){return BX.hasClass(t,this.parent.settings.get("classDropdown"))},isCheckbox(t){return BX.hasClass(t,this.parent.settings.get("classPanelCheckbox"))},isTextInput(t){return t.type==="text"},isHiddenInput(t){return t.type==="hidden"},isSelect(t){return t.tagName==="SELECT"},createDropdown(t,e){const i=t.EMPTY_TEXT||"";const s=t.MULTIPLE==="Y";const n=this.createContainer(t.ID,e,{});const o=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:`${t.ID}_control`},attrs:{name:t.NAME,"data-name":t.NAME,"data-empty-text":i,"data-multiple":s?"Y":"N","data-items":JSON.stringify(t.ITEMS),"data-value":s?"":t.ITEMS[0].VALUE,"data-popup-position":"fixed"},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:s?i:t.ITEMS[0].NAME})]});n.appendChild(o);return n},createCheckbox(t,e){const i=this.createContainer(t.ID,e,{});const s=BX.create("span",{props:{className:"main-grid-checkbox-container"}});const n=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}});const o=BX.create("input",{props:{type:"checkbox",className:`${this.parent.settings.get("classPanelCheckbox")} main-grid-checkbox`,id:`${t.ID}_control`},attrs:{value:t.VALUE||"",title:t.TITLE||"",name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE)}});o.checked=t.CHECKED||null;i.appendChild(s);i.appendChild(n);s.appendChild(o);s.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{for:`${t.ID}_control`,title:t.TITLE}}));n.appendChild(BX.create("label",{attrs:{for:`${t.ID}_control`,title:t.TITLE},html:t.LABEL}));return i},createText(t,e){const i=this.createContainer(t.ID,e,{});const s=BX.type.isNotEmptyString(t.TITLE)?t.TITLE:"";if(s!==""){i.appendChild(BX.create("label",{attrs:{title:s,for:`${t.ID}_control`},text:s}))}i.appendChild(BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:`${t.ID}_control`},attrs:{name:t.NAME,title:s,placeholder:t.PLACEHOLDER||"",value:t.VALUE||"",type:"text","data-onchange":JSON.stringify(t.ONCHANGE||[])}}));return i},createHidden(t,e){const i=this.createContainer(t.ID,e,{CLASS:"main-grid-panel-hidden-control-container"});i.appendChild(BX.create("input",{props:{id:`${t.ID}_control`,type:"hidden"},attrs:{name:t.NAME,value:t.VALUE||""}}));return i},createButton(t,e){this.buttonOnChange=t.ONCHANGE||[];this.buttonData=t;this.button=this.createButtonNode(t);BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this));if(this.buttonData.SETTINGS&&t.ID===this.buttonData.SETTINGS.buttonId){BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this))}this.prepareButton();const i=this.createContainer(t.ID,e,{});i.appendChild(this.button);return i},createButtonNode(t){return BX.create("button",{props:{className:`ui-btn${t.CLASS?` ${t.CLASS}`:""}`,id:`${t.ID}_control`,title:BX.type.isNotEmptyString(t.TITLE)?t.TITLE:""},attrs:{name:t.NAME||""},html:t.TEXT})},prepareButton(){if(this.isSetButtonDisabled()){BX.Dom.attr(this.button,"data-onchange",[]);BX.Dom.addClass(this.button,"ui-btn-disabled")}else{BX.Dom.attr(this.button,"data-onchange",this.buttonOnChange);BX.Dom.removeClass(this.button,"ui-btn-disabled")}},isSetButtonDisabled(){return Boolean(this.buttonData.SETTINGS&&this.buttonData.SETTINGS.minSelectedRows&&this.getSelectedIds().length<this.buttonData.SETTINGS.minSelectedRows)},createLink(t,e){const i=this.createContainer(t.ID,e,{});const s=BX.create("a",{props:{className:`main-grid-link${t.CLASS?` ${t.CLASS}`:""}`,id:`${t.ID}_control`},attrs:{href:t.HREF||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});i.appendChild(s);return i},createCustom(t,e){const i=this.createContainer(t.ID,e,{CLASS:"main-grid-panel-hidden-control-container"});const s=BX.create("div",{props:{className:`main-grid-panel-custom${t.CLASS?` ${t.CLASS}`:""}`},html:t.VALUE});i.appendChild(s);return i},createContainer(t,e,i){t=t.replace("_control","");e=e.replace("_control","");i=i||{};return BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer")+(i.CLASS?` ${i.CLASS}`:""),id:t},attrs:{"data-relative":e}})},removeItemsRelativeCurrent(t){let e=t;const i=[t.id];const s=[];let n;while(e){n=BX.data(e,"relative");if(i.includes(n)){i.push(e.id);s.push(e)}e=e.nextElementSibling}s.forEach((t=>{BX.remove(t)}))},validateData(t){return"ONCHANGE"in t&&BX.type.isArray(t.ONCHANGE)},activateControl(t){const e=BX(t);if(BX.type.isDomNode(e)){BX.removeClass(e,this.parent.settings.get("classDisable"));e.disabled=null}},deactivateControl(t){const e=BX(t);if(BX.type.isDomNode(e)){BX.addClass(e,this.parent.settings.get("classDisable"));e.disabled=true}},showControl(t){const e=BX(t);e&&BX.show(e)},hideControl(t){const e=BX(t);e&&BX.hide(e)},validateActionObject(t){return BX.type.isPlainObject(t)&&"ACTION"in t&&BX.type.isNotEmptyString(t.ACTION)&&(t.ACTION===this.actions.RESET_CONTROLS||"DATA"in t&&BX.type.isArray(t.DATA))},validateControlObject(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"ID"in t},createDate(t,e){const i=this.createContainer(t.ID,e,{});const s=BX.decl({block:"main-ui-date",mix:["main-grid-panel-date"],calendarButton:true,valueDelete:true,placeholder:"PLACEHOLDER"in t?t.PLACEHOLDER:"",name:"NAME"in t?`${t.NAME}_from`:"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUE"in t?t.VALUE:"",enableTime:"TIME"in t?t.TIME?"true":"false":"false"});i.appendChild(s);return i},createControl(t,e){let i=null;switch(t.TYPE){case this.types.DROPDOWN:i=this.createDropdown(t,e);break;case this.types.CHECKBOX:i=this.createCheckbox(t,e);break;case this.types.TEXT:i=this.createText(t,e);break;case this.types.HIDDEN:i=this.createHidden(t,e);break;case this.types.BUTTON:i=this.createButton(t,e);break;case this.types.LINK:i=this.createLink(t,e);break;case this.types.CUSTOM:i=this.createCustom(t,e);break;case this.types.DATE:i=this.createDate(t,e);break}return i},onChangeHandler(container,actions,isPseudo){let newElement;let callback;const self=this;if(BX.type.isDomNode(container)&&BX.type.isArray(actions)){actions.forEach((function(action){if(self.validateActionObject(action)){if(action.ACTION===self.actions.CREATE){self.removeItemsRelativeCurrent(container);const t=BX.Runtime.clone(action.DATA).reverse();t.forEach((t=>{if(self.validateControlObject(t)){newElement=self.createControl(t,container.id||BX.data(container,"relative"));if(BX.type.isDomNode(newElement)){BX.insertAfter(newElement,container);if("ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED){self.onChangeHandler(newElement,t.ONCHANGE)}if(t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length>0&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)){self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)}}}}))}if(action.ACTION===self.actions.ACTIVATE){self.removeItemsRelativeCurrent(container);if(BX.type.isArray(action.DATA)){action.DATA.forEach((t=>{self.lastActivated.push(t.ID);self.activateControl(t.ID)}))}}if(action.ACTION===self.actions.SHOW&&BX.type.isArray(action.DATA)){action.DATA.forEach((t=>{self.showControl(t.ID)}))}if(action.ACTION===self.actions.HIDE&&BX.type.isArray(action.DATA)){action.DATA.forEach((t=>{self.hideControl(t.ID)}))}if(action.ACTION===self.actions.HIDE_ALL_EXPECT&&BX.type.isArray(action.DATA)){(self.getControls()||[]).forEach((t=>{if(!action.DATA.some((e=>e.ID===t.id))){self.hideControl(t.id)}}))}if(action.ACTION===self.actions.SHOW_ALL){(self.getControls()||[]).forEach((t=>{self.showControl(t.id)}))}if(action.ACTION===self.actions.REMOVE&&BX.type.isArray(action.DATA)){action.DATA.forEach((t=>{BX.remove(BX(t.ID))}))}if(action.ACTION===self.actions.CALLBACK){this.confirmDialog(action,BX.delegate((()=>{if(BX.type.isArray(action.DATA)){action.DATA.forEach((currentCallback=>{if(currentCallback.JS.includes("Grid.")){callback=currentCallback.JS.replace("Grid","self.parent");callback=callback.replace("()","");callback+=".apply(self.parent, [container])";try{eval(callback)}catch(t){throw new Error(t)}}else if(BX.type.isNotEmptyString(currentCallback.JS)){try{eval(currentCallback.JS)}catch(t){throw new Error(t)}}}))}}),this))}if(action.ACTION===self.actions.RESET_CONTROLS){this.removeItemsRelativeCurrent(container)}}}),this)}else{if(!isPseudo){this.removeItemsRelativeCurrent(container)}self.lastActivated.forEach((t=>{self.deactivateControl(t)}));self.lastActivated=[]}},confirmDialog(t,e,i){this.parent.confirmDialog(t,e,i)},_dropdownChange(t,e,i,s){const n=BX(t);const o=n.parentNode;const a=s&&"ONCHANGE"in s?s.ONCHANGE:null;const r=s&&"PSEUDO"in s&&s.PSEUDO!==false;this.onChangeHandler(o,a,r)},_checkboxChange(event){let onChange;try{onChange=eval(BX.data(event.target,"onchange"))}catch{onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),event.target.checked||event.target.id.includes("actallrows_")?onChange:null)},_clickOnButton(event){let onChange;if(this.isButton(event.target)){event.preventDefault();try{onChange=eval(BX.data(event.target,"onchange"))}catch{onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),onChange)}},isButton(t){return BX.hasClass(t,this.parent.settings.get("classPanelButton"))},getSelectedIds(){const t=this.parent.getRows().getSelected().filter((t=>t.isShown()));return t.map((t=>t.getId()))},getControls(){return BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},true,true)},getValues(){const t={};const e=this;const i=[].concat(this.getDropdowns(),this.getTextInputs(),this.getHiddenInputs(),this.getSelects(),this.getCheckboxes(),this.getButtons());(i||[]).forEach((i=>{if(BX.type.isDomNode(i)){if(e.isDropdown(i)){let e=BX.data(i,"value");const s=BX.data(i,"multiple")==="Y";e=e!==null&&e!==undefined?e:"";t[BX.data(i,"name")]=s?e.split(","):e}if(e.isSelect(i)){t[i.getAttribute("name")]=i.options[i.selectedIndex].value}if(e.isCheckbox(i)&&i.checked){t[i.getAttribute("name")]=i.value}if(e.isTextInput(i)||e.isHiddenInput(i)){t[i.getAttribute("name")]=i.value}if(e.isButton(i)){const e=BX.data(i,"name");let s=BX.data(i,"value");s=s!==null&&s!==undefined?s:"";if(e){t[e]=s}}}}));return t}}})();(function(){BX.namespace("BX.Grid");BX.Grid.BaseClass=function(t){this.parent=t};BX.Grid.BaseClass.prototype={getParent(){return this.parent}}})();class CellActionState{}CellActionState.SHOW_BY_HOVER="main-grid-cell-content-action-by-hover";CellActionState.ACTIVE="main-grid-cell-content-action-active";const namespace=main_core.Reflection.namespace("BX.Grid");namespace.CellActionState=CellActionState;class CellActions{}CellActions.PIN="main-grid-cell-content-action-pin";CellActions.MUTE="main-grid-cell-content-action-mute";const namespace$1=main_core.Reflection.namespace("BX.Grid");namespace$1.CellActions=CellActions;(function(){BX.namespace("BX.Grid");BX.Grid.ColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};BX.Grid.ColsSortable.prototype={init(t){this.parent=t;this.colsList=this.getColsList();this.rowsList=this.getRowsList();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::updated",BX.proxy(this.reinit,this));BX.addCustomEvent("Grid::headerUpdated",BX.proxy(this.reinit,this))}this.registerObjects()},destroy(){BX.removeCustomEvent("Grid::updated",BX.proxy(this.reinit,this));this.unregisterObjects()},reinit(){this.unregisterObjects();this.reset();this.init(this.parent)},reset(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.fixedTableColsList=null},isActive(){return this.isDrag},registerObjects(){this.unregisterObjects();this.getColsList().forEach(this.register,this);this.getFixedHeaderColsList().forEach(this.register,this)},unregisterObjects(){this.getColsList().forEach(this.unregister,this);this.getFixedHeaderColsList().forEach(this.unregister,this)},unregister(t){jsDD.unregisterObject(t)},register(t){t.onbxdragstart=BX.proxy(this._onDragStart,this);t.onbxdrag=BX.proxy(this._onDrag,this);t.onbxdragstop=BX.proxy(this._onDragEnd,this);jsDD.registerObject(t)},getColsList(){if(!this.colsList){this.colsList=BX.Grid.Utils.getByTag(this.parent.getRows().getHeadFirstChild().getNode(),"th");this.colsList=this.colsList.filter((function(t){return!this.isStatic(t)}),this)}return this.colsList},getFixedHeaderColsList(){if(!this.fixedTableColsList&&this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTableColsList=BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"th");this.fixedTableColsList=this.fixedTableColsList.filter((function(t){return!this.isStatic(t)}),this)}return this.fixedTableColsList||[]},getRowsList(){let t=this.parent.getRows().getSourceRows();if(this.parent.getParam("ALLOW_PIN_HEADER")){t=t.concat(BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"tr"))}return t},isStatic(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))&&!BX.hasClass(t,"main-grid-fixed-column")},getDragOffset(){const t=this.parent.getScrollContainer().scrollLeft-this.startScrollOffset;return jsDD.x-this.startDragOffset-this.dragRect.left+t},getColumn(t){let e=[];if(t instanceof HTMLTableCellElement){e=this.rowsList.map((e=>e.cells[t.cellIndex]))}return e},_onDragStart(){if(this.parent.getParam("ALLOW_PIN_HEADER")&&this.parent.getPinHeader().isPinned()){this.colsList=this.getFixedHeaderColsList()}else{this.colsList=this.getColsList()}this.startScrollOffset=this.parent.getScrollContainer().scrollLeft;this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=Math.ceil(this.dragRect.width);this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem);this.parent.preventSortableClick=true},isDragToRight(t,e){const i=t.getBoundingClientRect();const s=Math.ceil(i.left+i.width/2+BX.scrollLeft(window));const n=this.dragIndex;const o=jsDD.x;return e>n&&o>s},isDragToLeft(t,e){const i=t.getBoundingClientRect();const s=Math.ceil(i.left+i.width/2+BX.scrollLeft(window));const n=this.dragIndex;const o=jsDD.x;return e<n&&o<s},isDragToBack(t,e){const i=t.getBoundingClientRect();const s=Math.ceil(i.left+i.width/2+BX.scrollLeft(window));const n=this.dragIndex;const o=jsDD.x;return e>n&&o<s||e<n&&o>s},isMovedToRight(t){return t.style.transform===`translate3d(${-this.offset}px, 0px, 0px)`},isMovedToLeft(t){return t.style.transform===`translate3d(${this.offset}px, 0px, 0px)`},isMoved(t){return t.style.transform!=="translate3d(0px, 0px, 0px)"&&t.style.transform!==""},moveColumn(t,e,i){i=BX.type.isNumber(i)?i:300;BX.Grid.Utils.styleForEach(t,{transition:`${i}ms`,transform:`translate3d(${e}px, 0px, 0px)`})},_onDrag(){this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;const t=-this.offset;const e=this.offset;const i=0;const s=0;this.moveColumn(this.dragColumn,this.dragOffset,s);[].forEach.call(this.colsList,(function(s,n){if(s&&!s.classList.contains("main-grid-cell-static")){if(this.isDragToRight(s,n)&&!this.isMovedToRight(s)){this.targetColumn=this.getColumn(s);this.moveColumn(this.targetColumn,t)}if(this.isDragToLeft(s,n)&&!this.isMovedToLeft(s)){this.targetColumn=this.getColumn(s);this.moveColumn(this.targetColumn,e)}if(this.isDragToBack(s,n)&&this.isMoved(s)){this.targetColumn=this.getColumn(s);this.moveColumn(this.targetColumn,i)}}}),this)},_onDragEnd(){[].forEach.call(this.dragColumn,(function(t,e){BX.Grid.Utils.collectionSort(t,this.targetColumn[e])}),this);this.rowsList.forEach((t=>{BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})}));this.reinit();const t=this.colsList.map((t=>BX.data(t,"name")));this.parent.getUserOptions().setColumns(t);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent]);setTimeout((()=>{this.parent.preventSortableClick=false}),10)}}})();class Counters{}Counters.Type={LEFT:"left",LEFT_ALIGNED:"left-aligned",RIGHT:"right"};Counters.Color={DANGER:"ui-counter-danger",SUCCESS:"ui-counter-success",PRIMARY:"ui-counter-primary",GRAY:"ui-counter-gray",LIGHT:"ui-counter-light",DARK:"ui-counter-dark",WARNING:"ui-counter-warning"};Counters.Size={LARGE:"ui-counter-lg",MEDIUM:"ui-counter-md"};const namespace$2=main_core.Reflection.namespace("BX.Grid");namespace$2.Counters=Counters;(function(){BX.namespace("BX.Grid");const t=window.parent.BX.ajax.UpdatePageData;function e(){window.parent.BX.ajax.UpdatePageData=function(){}}function i(){window.parent.BX.ajax.UpdatePageData=t}BX.Grid.Data=function(t){this.parent=t;this.reset()};BX.Grid.Data.prototype.reset=function(){this.response=null;this.xhr=null;this.headRows=null;this.bodyRows=null;this.footRows=null;this.moreButton=null;this.pagination=null;this.counterDisplayed=null;this.counterSelected=null;this.counterTotal=null;this.limit=null;this.actionPanel=null;this.rowsByParentId={};this.rowById={};this.isValidResponse=null};BX.Grid.Data.prototype.getParent=function(){return this.parent};BX.Grid.Data.prototype.validateResponse=function(){if(!BX.type.isBoolean(this.isValidResponse)){this.isValidResponse=Boolean(this.getResponse())&&Boolean(BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classContainer"),true))}return this.isValidResponse};BX.Grid.Data.prototype.request=function(t,s,n,o,a,r){if(!BX.type.isString(t)){t=""}if(!BX.type.isNotEmptyString(s)){s="GET"}if(!BX.type.isPlainObject(n)){n={}}const l={gridId:this.parent.getId(),url:t,method:s,data:n};this.parent.disableCheckAllCheckboxes();BX.onCustomEvent(window,"Grid::beforeRequest",[this,l]);if(l.hasOwnProperty("cancelRequest")&&l.cancelRequest===true){return}t=l.url;if(!BX.type.isNotEmptyString(t)){t=this.parent.baseUrl}t=BX.Grid.Utils.addUrlParams(t,{sessid:BX.bitrix_sessid(),internal:"true",grid_id:this.parent.getId()});if("apply_filter"in n&&n.apply_filter==="Y"){t=BX.Grid.Utils.addUrlParams(t,{apply_filter:"Y"})}else{t=BX.util.remove_url_param(t,"apply_filter")}if("clear_nav"in n&&n.clear_nav==="Y"){t=BX.Grid.Utils.addUrlParams(t,{clear_nav:"Y"})}else{t=BX.util.remove_url_param(t,"clear_nav")}t=BX.Grid.Utils.addUrlParams(t,{grid_action:o||"showpage"});s=l.method;n=l.data;this.reset();const d=this;setTimeout((()=>{const l=BX.Http.Data.convertObjectToFormData(n);e();var h=BX.ajax({url:BX.Grid.Utils.ajaxUrl(t,d.getParent().getAjaxId()),data:l,method:s,dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:d.getParent().getAjaxId()},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:o||"showpage"})}],processData:true,scriptsRunFirst:false,start:false,preparePost:false,onsuccess(t){d.response=BX.create("div",{html:t});d.response=d.response.querySelector(`#${d.parent.getContainerId()}`);d.xhr=h;if(d.parent.getParam("HANDLE_RESPONSE_ERRORS")){let e;try{e=JSON.parse(t)}catch{e={messages:[]}}if(e.messages.length>0){d.parent.arParams.MESSAGES=e.messages;d.parent.messages.show();d.parent.tableUnfade();if(BX.type.isFunction(r)){BX.delegate(r,d)(h)}return}}if(BX.type.isFunction(a)){d.parent.enableCheckAllCheckboxes();BX.delegate(a,d)(t,h)}i()},onerror(t){d.error=r;d.xhr=h;if(BX.type.isFunction(r)){d.parent.enableCheckAllCheckboxes();BX.delegate(r,d)(h,t)}}});h.send(l)}),0)};BX.Grid.Data.prototype.getResponse=function(){return this.response};BX.Grid.Data.prototype.getContainer=function(){const t=this.getParent().settings.get("classContainer");if(BX.Dom.hasClass(this.getResponse(),t)){return this.getResponse()}return BX.Grid.Utils.getByClass(this.getResponse(),t,true)};BX.Grid.Data.prototype.getHeadRows=function(){if(!this.headRows){this.headRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classHeadRow"))}return this.headRows};BX.Grid.Data.prototype.getBodyRows=function(){if(!this.bodyRows){this.bodyRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classBodyRow"))}return this.bodyRows};BX.Grid.Data.prototype.getRowsByParentId=function(t){if(!(t in this.rowsByParentId)){this.rowsByParentId[t]=BX.Grid.Utils.getBySelector(this.getResponse(),`.${this.getParent().settings.get("classBodyRow")}[data-parent-id="${t}"]`)}return this.rowsByParentId[t]};BX.Grid.Data.prototype.getRowById=function(t){if(!(t in this.rowById)){this.rowById[t]=BX.Grid.Utils.getBySelector(this.getResponse(),`.${this.getParent().settings.get("classBodyRow")}[data-id="${t}"]`,true)}return this.rowById[t]};BX.Grid.Data.prototype.getFootRows=function(){if(!this.footRows){this.footRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classFootRow"))}return this.footRows};BX.Grid.Data.prototype.getMoreButton=function(){if(!this.moreButton){this.moreButton=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classMoreButton"),true)}return this.moreButton};BX.Grid.Data.prototype.getPagination=function(){if(!this.pagination){this.pagination=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPagination"),true);if(BX.type.isDomNode(this.pagination)){this.pagination=BX.firstChild(this.pagination)}}return this.pagination};BX.Grid.Data.prototype.getCounterDisplayed=function(){if(!this.counterDisplayed){this.counterDisplayed=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterDisplayed"),true)}return this.counterDisplayed};BX.Grid.Data.prototype.getCounterSelected=function(){if(!this.counterSelected){this.counterSelected=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterSelected"),true)}return this.counterSelected};BX.Grid.Data.prototype.getCounterTotal=function(){if(!BX.type.isDomNode(this.counterTotal)){const t=`.${this.getParent().settings.get("classCounterTotal")} .${this.getParent().settings.get("classPanelCellContent")}`;this.counterTotal=BX.Grid.Utils.getBySelector(this.getResponse(),t,true)}return this.counterTotal};BX.Grid.Data.prototype.getLimit=function(){if(!this.limit){this.limit=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPageSize"),true)}return this.limit};BX.Grid.Data.prototype.getPageSize=function(){return this.getLimit()};BX.Grid.Data.prototype.getActionPanel=function(){if(!this.actionPanel){this.actionPanel=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classActionPanel"),true)}return this.actionPanel}})();(function(){BX.namespace("BX.Main");BX.Main.dropdown=function(t){this.id=null;this.dropdown=null;this.items=null;this.value=null;this.menuId=null;this.menu=null;this.menuItems=null;this.multiple=null;this.emptyText=null;this.dataItems="items";this.dataValue="value";this.dataPseudo="pseudo";this.dropdownItemClass="main-dropdown-item";this.activeClass="main-dropdown-active";this.selectedClass="main-dropdown-item-selected";this.notSelectedClass="main-dropdown-item-not-selected";this.lockedClass="main-dropdown-item-locked";this.menuItemClass="menu-popup-item";this.init(t)};BX.Main.dropdown.prototype={init(t){this.id=t.id;this.dropdown=t;this.items=this.getItems();this.value=this.getValue();this.menuId=this.getMenuId();this.multiple=this.getMultiple();this.emptyText=this.getEmptyText();this.menu=this.createMenu();this.menu.popupWindow.show();this.adjustPosition();BX.bind(this.dropdown,"click",BX.delegate(this.showMenu,this))},getMenuId(){return`${this.id}_menu`},getItems(){let t;try{const e=this.dropdown.dataset[this.dataItems];t=JSON.parse(e);t=t.map((t=>{t.VALUE=String(t.VALUE);return t}))}catch{t=[]}return t},getValue(){return this.dropdown.dataset[this.dataValue]},getValueItem(){const t=this.getValue();return this.items.find((e=>e.VALUE===t))},getValueAsArray(){let t=this.getValue();if(t===undefined){t=""}return t.toString().split(",").filter((t=>t!==""))},getValueItems(){const t=this.getValueAsArray();return this.items.filter((e=>t.includes(e.VALUE)))},toggleValue(t){if(this.multiple){if(t||t===0||t==="0"){const e=this.getValueAsArray();const i=e.indexOf(t);if(i<0){e.push(t)}else{e.splice(i,1)}this.dropdown.dataset[this.dataValue]=e.join(",")}else{this.dropdown.dataset[this.dataValue]=null}}else{this.dropdown.dataset[this.dataValue]=t}},getValueText(){if(this.multiple){return this.getValueItems().map((t=>t.NAME)).filter((t=>Boolean(t))).join(", ")||this.emptyText}const t=this.getValueItem();return t?t.NAME:this.emptyText},getMultiple(){return this.dropdown.dataset.multiple==="Y"},getEmptyText(){return this.dropdown.dataset.emptyText||null},prepareMenuItems(){const t=this;let e;let i;const s=this.multiple?this.getValueAsArray():this.getValue();function n(o){const a=t.dropdown.dataset.htmlEntity==="true";return o.map((o=>{e={};e[`data-${t.dataValue}`]=o.VALUE;e[`data-${t.dataPseudo}`]="PSEUDO"in o&&o.PSEUDO?"true":"false";i=BX.create("div",{children:[BX.create("span",{props:{className:t.dropdownItemClass},attrs:e,html:a?o.NAME:null,text:a?null:o.NAME})]});const r=t.multiple?s.includes(o.VALUE):s===o.VALUE;return{html:i.innerHTML,className:r?t.selectedClass:t.notSelectedClass,delimiter:o.DELIMITER,items:"ITEMS"in o?n(o.ITEMS):null}}))}const o=n(this.items);BX.onCustomEvent(window,"Dropdown::onPrepareItems",[this.id,this.menuId,o]);return o},createMenu(){const t=this;return BX.PopupMenu.create(this.getMenuId(),this.dropdown,this.prepareMenuItems(),{autoHide:true,offsetTop:-8,offsetLeft:Number(this.dropdown.dataset.menuOffsetLeft||40),maxHeight:Number(this.dropdown.dataset.menuMaxHeight||170),events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow(){t._onShowMenu()}}})},showMenu(){this.menu=BX.PopupMenu.getMenuById(this.menuId);if(!this.menu){this.menu=this.createMenu();this.menu.popupWindow.show()}this.adjustPosition()},adjustPosition(){if(this.dropdown.dataset.popupPosition==="fixed"){const t=this.menu.popupWindow.popupContainer;t.style.setProperty("top","auto");t.style.setProperty("bottom","45px");t.style.setProperty("left","0px");this.dropdown.appendChild(t)}},getSubItem(t){return BX.Grid.Utils.getByClass(t,this.dropdownItemClass,true)},refresh(t){const e=this.getSubItem(t);let i=BX.data(e,this.dataValue);if(BX.Type.isUndefined(i)){i=""}this.toggleValue(i);if(this.dropdown.dataset.htmlEntity==="true"){BX.firstChild(this.dropdown).innerHTML=this.getValueText()}else{BX.firstChild(this.dropdown).innerText=this.getValueText()}},selectItem(t){const e=this;(this.menu.menuItems||[]).forEach((i=>{if(e.multiple){if(t===i.layout.item){if(BX.hasClass(t,e.selectedClass)){BX.addClass(i.layout.item,e.notSelectedClass);BX.removeClass(i.layout.item,e.selectedClass)}else{BX.removeClass(i.layout.item,e.notSelectedClass);BX.addClass(i.layout.item,e.selectedClass)}}return}BX.removeClass(i.layout.item,e.selectedClass);if(t===i.layout.item){BX.removeClass(i.layout.item,e.notSelectedClass);BX.addClass(i.layout.item,e.selectedClass)}else{BX.addClass(i.layout.item,e.notSelectedClass)}}))},lockedItem(t){BX.addClass(t,this.lockedClass)},getDataItemIndexByValue(t,e){if(BX.type.isArray(t)){t.map(((t,i)=>{if(t.VALUE===e){return false}}))}return false},getDataItemByValue(t){const e=this.items.filter((e=>e.VALUE===t));return e.length>0?e[0]:null},_onShowMenu(){const t=this;BX.addClass(this.dropdown,this.activeClass);(this.menu.menuItems||[]).forEach((e=>{BX.bind(e.layout.item,"click",BX.delegate(t._onItemClick,t))}))},_onCloseMenu(){BX.removeClass(this.dropdown,this.activeClass);BX.PopupMenu.destroy(this.menuId)},_onItemClick(t){const e=this.getMenuItem(t.target);let i;let s;const n=this.getSubItem(e);const o=BX.data(n,"pseudo");if(o==="true"){i=BX.data(n,"value");s=this.getDataItemByValue(i)}else{this.refresh(e);this.selectItem(e);if(!this.multiple){this.menu.popupWindow.close()}i=this.getValue();s=this.getDataItemByValue(i)}t.stopPropagation();BX.onCustomEvent(window,"Dropdown::change",[this.dropdown.id,t,e,s,i])},getMenuItem(t){let e=t;if(!BX.hasClass(e,this.menuItemClass)){e=BX.findParent(e,{class:this.menuItemClass})}return e}}})();(function(){BX.namespace("BX.Main");BX.Main.dropdownManager={dropdownClass:"main-dropdown",data:{},init(){const self=this;let result;let onLoadItems;let items;BX.bind(document,"click",BX.delegate((function(t){if(BX.hasClass(t.target,this.dropdownClass)){t.preventDefault();result=this.getById(t.target.id);if(result&&result.dropdown===t.target){self.push(t.target.id,this.getById(t.target.id))}else{self.push(t.target.id,new BX.Main.dropdown(t.target))}}}),this));onLoadItems=BX.Grid.Utils.getByClass(document.body,this.dropdownClass);if(BX.type.isArray(onLoadItems)){onLoadItems.forEach((current=>{result=self.getById(current.id);try{items=eval(BX.data(current,"items"))}catch{}BX.onCustomEvent(window,"Dropdown::load",[current.id,{},null,BX.type.isArray(items)&&items.length>0?items[0]:[],BX.data(current,"value")])}))}},push(t,e){this.data[t]=e},getById(t){return t in this.data?this.data[t]:null}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Element=function(t,e){this.node=null;this.href=null;this.parent=null;this.init(t,e)};BX.Grid.Element.prototype={init(t,e){this.node=t;this.parent=e;this.resetOnclickAttr()},getParent(){return this.parent},load(){BX.addClass(this.getNode(),this.getParent().settings.get("classLoad"))},unload(){BX.removeClass(this.getNode(),this.getParent().settings.get("classLoad"))},isLoad(){return BX.hasClass(this.getNode(),this.getParent().settings.get("classLoad"))},resetOnclickAttr(){if(BX.type.isDomNode(this.getNode())){this.getNode().onclick=null}},getObserver(){return BX.Grid.observer},getNode(){return this.node},getLink(){let t;try{t=this.getNode().href}catch{t=null}return t}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Fader=function(t){this.parent=null;this.table=null;this.container=null;this.init(t)};BX.Grid.Fader.prototype={init(t){this.parent=t;this.table=this.parent.getTable();this.container=this.table.parentNode;this.scrollStartEventName=this.parent.isTouch()?"touchstart":"mouseenter";this.scrollEndEventName=this.parent.isTouch()?"touchend":"mouseleave";if(this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTable=this.parent.getPinHeader().getFixedTable()}this.debounceScrollHandler=BX.debounce(this._onWindowScroll,400,this);BX.bind(window,"resize",BX.proxy(this.toggle,this));document.addEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.addEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.addCustomEvent(window,"Grid::resize",BX.proxy(this.toggle,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.addCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.bind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.bind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.bind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.bind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.toggle();this.adjustEarOffset(true)},destroy(){BX.unbind(window,"resize",BX.proxy(this.toggle,this));document.removeEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.removeEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.removeCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.unbind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.unbind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.unbind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.unbind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.hideLeftEar();this.hideRightEar();this.stopScroll()},_onHeaderUpdated(){if(this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTable=this.parent.getPinHeader().getFixedTable()}},_onMouseoverLeft(t){this.parent.isTouch()&&t.preventDefault();this.startScrollByDirection("left")},_onMouseoverRight(t){this.parent.isTouch()&&t.preventDefault();this.startScrollByDirection("right")},stopScroll(){clearTimeout(this.scrollTimer);clearInterval(this.scrollInterval)},startScrollByDirection(t){const e=this.container;let i=e.scrollLeft;const s=this;const n=8;const o=1e3/60/2;this.scrollTimer=setTimeout((()=>{s.scrollInterval=setInterval((()=>{e.scrollLeft=t=="right"?i+=n:i-=n}),o)}),100)},getEarLeft(){if(!this.earLeft){this.earLeft=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarLeft"),true)}return this.earLeft},getEarRight(){if(!this.earRight){this.earRight=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarRight"),true)}return this.earRight},getShadowLeft(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-left")},getShadowRight(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-right")},adjustEarOffset(t){if(t){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead)}let e=window.scrollY;if(this.parent.isIE()){e=document.documentElement.scrollTop}let i=e+this.windowHeight-this.tbodyPos.top;let s=e-this.tbodyPos.top;if(i>this.tbodyPos.bottom-this.tbodyPos.top){i=this.tbodyPos.bottom-this.tbodyPos.top}if(s<this.headerPos.height){s=this.headerPos.height}else{i-=s;i+=this.headerPos.height}BX.Grid.Utils.requestAnimationFrame(BX.proxy((function(){if(s!==this.lastPosTop){const t=`translate3d(0px, ${s}px, 0)`;this.getEarLeft().style.transform=t;this.getEarRight().style.transform=t}if(i!==this.lastBottomPos){this.getEarLeft().style.height=`${i}px`;this.getEarRight().style.height=`${i}px`}this.lastPosTop=s;this.lastBottomPos=i}),this))},_onWindowScroll(){this.adjustEarOffset()},hasScroll(){return this.table.offsetWidth>this.container.clientWidth},hasScrollLeft(){return this.container.scrollLeft>0},hasScrollRight(){return this.table.offsetWidth>Math.round(this.container.scrollLeft+this.container.clientWidth)},showLeftEar(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.addClass(this.getEarLeft(),this.parent.settings.get("classShow"))},hideLeftEar(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.removeClass(this.getEarLeft(),this.parent.settings.get("classShow"))},showRightEar(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.addClass(this.getEarRight(),this.parent.settings.get("classShow"))},hideRightEar(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.removeClass(this.getEarRight(),this.parent.settings.get("classShow"))},adjustFixedTablePosition(){const t=this.container.scrollLeft;BX.Grid.Utils.requestAnimationFrame(BX.delegate((function(){this.fixedTable.style.marginLeft=`${-t}px`}),this))},toggle(){this.adjustEarOffset(true);this.fixedTable&&this.adjustFixedTablePosition();if(this.hasScroll()){this.hasScrollLeft()?this.showLeftEar():this.hideLeftEar();this.hasScrollRight()?this.showRightEar():this.hideRightEar()}else{this.hideLeftEar();this.hideRightEar()}}}})();(function(){BX.namespace("BX.Main");BX.Main.grid=function(t,e,i,s,n,o,a,r,l){BX.Event.EventEmitter.makeObservable(this,"BX.Main.Grid");this.settings=null;this.containerId="";this.container=null;this.wrapper=null;this.fadeContainer=null;this.scrollContainer=null;this.pagination=null;this.moreButton=null;this.table=null;this.rows=null;this.history=false;this.userOptions=null;this.checkAll=null;this.sortable=null;this.updater=null;this.data=null;this.fader=null;this.editor=null;this.isEditMode=null;this.pinHeader=null;this.pinPanel=null;this.arParams=null;this.resize=null;this.editableRows=[];this.init(t,e,i,s,n,o,a,r,l)};BX.Main.grid.prototype={init(t,e,i,s,n,o,a,r,l){this.baseUrl=window.location.pathname+window.location.search;this.container=BX(t);if(!BX.type.isNotEmptyString(t)){throw"BX.Main.grid.init: parameter containerId is empty"}if(BX.type.isPlainObject(e)){this.arParams=e}else{throw new TypeError("BX.Main.grid.init: arParams isn't object")}this.settings=new BX.Grid.Settings;this.containerId=t;this.userOptions=new BX.Grid.UserOptions(this,i,s,n);this.gridSettings=new BX.Grid.SettingsWindow.Manager(this);this.messages=new BX.Grid.Message(this,l);this.cache=new BX.Cache.MemoryCache;if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=new BX.Grid.PinHeader(this);BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.bindOnCheckAll,this))}this.bindOnCheckAll();if(this.getParam("ALLOW_HORIZONTAL_SCROLL")){this.fader=new BX.Grid.Fader(this)}this.pageSize=new BX.Grid.Pagesize(this);this.editor=new BX.Grid.InlineEditor(this,r);if(this.getParam("SHOW_ACTION_PANEL")){this.actionPanel=new BX.Grid.ActionPanel(this,o,a);this.pinPanel=new BX.Grid.PinPanel(this)}this.isEditMode=false;if(!BX.type.isDomNode(this.getContainer())){throw`BX.Main.grid.init: Failed to find container with id ${this.getContainerId()}`}if(!BX.type.isDomNode(this.getTable())){throw"BX.Main.grid.init: Failed to find table"}this.bindOnRowEvents();if(this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();if(this.getParam("ALLOW_ROWS_SORT")){this.initRowsDragAndDrop()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.initColsDragAndDrop()}this.getRows().initSelected();this.adjustEmptyTable(this.getRows().getSourceBodyChild());BX.onCustomEvent(this.getContainer(),"Grid::ready",[this]);BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this._onGridUpdated,this));window.frames[this.getFrameId()].onresize=BX.throttle(this._onFrameResize,20,this);if(this.getParam("ALLOW_STICKED_COLUMNS")){this.initStickedColumns()}},destroy(){BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::headerPinned",BX.proxy(this.bindOnCheckAll,this));BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this._onGridUpdated,this));this.getPinHeader()&&this.getPinHeader().destroy();this.getFader()&&this.getFader().destroy();this.getResize()&&this.getResize().destroy();this.getColsSortable()&&this.getColsSortable().destroy();this.getRowsSortable()&&this.getRowsSortable().destroy();this.getSettingsWindow()&&this.getSettingsWindow().destroy();this.getActionsPanel()&&this.getActionsPanel().destroy();this.getPinPanel()&&this.getPinPanel().destroy();this.getPageSize()&&this.getPageSize().destroy()},_onFrameResize(){BX.onCustomEvent(window,"Grid::resize",[this])},_onGridUpdated(){this.initStickedColumns();this.adjustFadePosition(this.getFadeOffset())},getFrameId(){return`main-grid-tmp-frame-${this.getContainerId()}`},enableActionsPanel(){if(this.getParam("SHOW_ACTION_PANEL")){const t=this.getActionsPanel().getPanel();if(BX.type.isDomNode(t)){BX.removeClass(t,this.settings.get("classDisable"))}}},disableActionsPanel(){if(this.getParam("SHOW_ACTION_PANEL")){const t=this.getActionsPanel().getPanel();if(BX.type.isDomNode(t)){BX.addClass(t,this.settings.get("classDisable"))}}},getSettingsWindow(){return this.gridSettings},_onUnselectRows(){const t=this.getActionsPanel();let e;if(t instanceof BX.Grid.ActionPanel){e=t.getForAllCheckbox();if(BX.type.isDomNode(e)){e.checked=null;this.disableForAllCounter()}}this.adjustCheckAllCheckboxes()},isIE(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},isTouch(){if(!BX.type.isBoolean(this.touch)){this.touch=BX.hasClass(document.documentElement,"bx-touch")}return this.touch},getParam(t,e){if(e===undefined){e=null}return this.arParams.hasOwnProperty(t)?this.arParams[t]:e},getCounterTotal(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterTotal"),true)},getActionKey(){return`action_button_${this.getId()}`},getPinHeader(){if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=this.pinHeader||new BX.Grid.PinHeader(this)}return this.pinHeader},getResize(){if(!(this.resize instanceof BX.Grid.Resize)&&this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}return this.resize},confirmForAll(t){let e;const i=this;if(BX.type.isDomNode(t)){e=BX.Grid.Utils.getByTag(t,"input",true)}if(e.checked){this.getActionsPanel().confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.arParams.CONFIRM_FOR_ALL_MESSAGE},(()=>{if(BX.type.isDomNode(e)){e.checked=true}i.selectAllCheckAllCheckboxes();i.getRows().selectAll();i.enableForAllCounter();i.updateCounterDisplayed();i.updateCounterSelected();i.enableActionsPanel();i.adjustCheckAllCheckboxes();i.lastRowAction=null;BX.onCustomEvent(window,"Grid::allRowsSelected",[])}),(()=>{if(BX.type.isDomNode(e)){e.checked=null;i.disableForAllCounter();i.updateCounterDisplayed();i.updateCounterSelected();i.adjustCheckAllCheckboxes();i.lastRowAction=null}}))}else{this.unselectAllCheckAllCheckboxes();this.adjustCheckAllCheckboxes();this.getRows().unselectAll();this.disableForAllCounter();this.updateCounterDisplayed();this.updateCounterSelected();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}},disableCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().disabled=true}))},enableCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().disabled=false}))},indeterminateCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().indeterminate=true}))},determinateCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().indeterminate=false}))},editSelected(){this.disableCheckAllCheckboxes();this.getRows().editSelected();if(this.getParam("ALLOW_PIN_HEADER")){this.getPinHeader()._onGridUpdate()}BX.onCustomEvent(window,"Grid::resize",[this])},editSelectedSave(){const t={FIELDS:this.getRows().getEditSelectedValues(true)};if(this.getParam("ALLOW_VALIDATE")){this.tableFade();t[this.getActionKey()]="validate";this.getData().request("","POST",t,"validate",(e=>{e=JSON.parse(e);if(e.messages.length>0){this.arParams.MESSAGES=e.messages;this.messages.show();const t=this.getActionsPanel().getButtons().find((t=>t.id==="grid_edit_button_control"));this.tableUnfade();BX.fireEvent(t,"click")}else{t[this.getActionKey()]="edit";this.reloadTable("POST",t)}}));return}if(this.getParam("HANDLE_RESPONSE_ERRORS")){t[this.getActionKey()]="edit";const e=this;this.tableFade();this.getData().request("","POST",t,"",(function(t){try{t=JSON.parse(t)}catch{t={messages:[]}}if(t.messages.length>0){e.arParams.MESSAGES=t.messages;e.messages.show();const i=e.getActionsPanel().getButtons().find((t=>t.id==="grid_edit_button_control"));e.tableUnfade();BX.fireEvent(i,"click");return}e.getRows().reset();const i=this.getBodyRows();e.getUpdater().updateContainer(this.getContainer());e.getUpdater().updateHeadRows(this.getHeadRows());e.getUpdater().updateBodyRows(i);e.getUpdater().updateFootRows(this.getFootRows());e.getUpdater().updatePagination(this.getPagination());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updateCounterTotal(this.getCounterTotal());e.adjustEmptyTable(i);e.bindOnRowEvents();e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnClickHeader();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();e.disableActionsPanel();e.disableForAllCounter();if(e.getParam("SHOW_ACTION_PANEL")){e.getUpdater().updateGroupActions(this.getActionPanel())}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}e.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[e])}),(t=>{const i=e.getActionsPanel().getButtons().find((t=>t.id==="grid_edit_button_control"));e.tableUnfade();BX.fireEvent(i,"click")}));return}t[this.getActionKey()]="edit";this.reloadTable("POST",t)},getForAllKey(){return`action_all_rows_${this.getId()}`},updateRow(t,e,i,s){const n=this.getRows().getById(t);if(n instanceof BX.Grid.Row){n.update(e,i,s)}},removeRow(t,e,i,s){const n=this.getRows().getById(t);if(n instanceof BX.Grid.Row){n.remove(e,i,s)}},addRow(t,e,i){const s=this.getUserOptions().getAction("GRID_ADD_ROW");const n={action:s,data:t};const o=this;this.tableFade();this.getData().request(e,"POST",n,null,(function(){const e=this.getBodyRows();o.getUpdater().updateBodyRows(e);o.tableUnfade();o.getRows().reset();o.getUpdater().updateFootRows(this.getFootRows());o.getUpdater().updatePagination(this.getPagination());o.getUpdater().updateMoreButton(this.getMoreButton());o.getUpdater().updateCounterTotal(this.getCounterTotal());o.bindOnRowEvents();o.adjustEmptyTable(e);o.bindOnMoreButtonEvents();o.bindOnClickPaginationLinks();o.updateCounterDisplayed();o.updateCounterSelected();if(o.getParam("ALLOW_COLUMNS_SORT")){o.colsSortable.reinit()}if(o.getParam("ALLOW_ROWS_SORT")){o.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowAdded",[{data:t,grid:o,response:this}]);BX.onCustomEvent(window,"Grid::updated",[o]);if(BX.type.isFunction(i)){i({data:t,grid:o,response:this})}}))},editSelectedCancel(){this.getRows().editSelectedCancel();this.enableCheckAllCheckboxes();if(this.getParam("ALLOW_PIN_HEADER")){this.getPinHeader()._onGridUpdate()}},removeSelected(){const t={ID:this.getRows().getSelectedIds()};const e=this.getActionsPanel().getValues();t[this.getActionKey()]="delete";t[this.getForAllKey()]=this.getForAllKey()in e?e[this.getForAllKey()]:"N";this.reloadTable("POST",t)},sendSelected(){const t=this.getActionsPanel().getValues();const e=this.getRows().getSelectedIds();const i={rows:e,controls:t};this.reloadTable("POST",i)},sendRowAction(t,e){if(!BX.type.isPlainObject(e)){e={}}e[this.getActionKey()]=t;this.reloadTable("POST",e)},getActionsPanel(){return this.actionPanel},getPinPanel(){return this.pinPanel},getApplyButton(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanelButton"),true)},getEditor(){return this.editor},reload(t){this.reloadTable("GET",{},null,t)},getPanels(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanels"),true)},getEmptyBlock(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classEmptyBlock"),true)},adjustEmptyTable(t){function e(t){const e=t.currentTarget;BX.style(s,"transform",`translate3d(${BX.scrollLeft(e)}px, 0px, 0`)}const i=t.filter((t=>BX.Dom.attr(t,"data-id")!=="template_0"&&!BX.Dom.hasClass(t,"main-grid-hide")));if(!BX.hasClass(document.documentElement,"bx-ie")&&i.length===1&&BX.hasClass(i[0],this.settings.get("classEmptyRows"))){const t=BX.pos(this.getContainer());const i=BX.scrollTop(window)+BX.height(window);const n=t.bottom-i;const o=BX.height(this.getPanels());var s=this.getEmptyBlock();const a=BX.width(this.getContainer());if(a){BX.width(s,a)}BX.style(s,"transform",`translate3d(${BX.scrollLeft(this.getScrollContainer())}px, 0px, 0`);BX.unbind(this.getScrollContainer(),"scroll",e);BX.bind(this.getScrollContainer(),"scroll",e);let r=this.getContainer();let l=0;while(r=r.parentElement){const t=parseFloat(BX.style(r,"padding-top"));const e=parseFloat(BX.style(r,"padding-bottom"));if(!isNaN(t)){l+=t}if(!isNaN(e)){l+=e}}if(n>0){BX.style(this.getTable(),"min-height",`${t.height-n-o-l}px`)}else if(Math.abs(n)===i){BX.style(this.getTable(),"min-height","")}else{BX.style(this.getTable(),"min-height",`${t.height+Math.abs(n)-o-l}px`)}BX.Dom.addClass(this.getContainer(),"main-grid-empty-stub");if(this.getCurrentPage()<=1){this.hidePanels()}}else{BX.style(this.getTable(),"min-height","");BX.style(this.getTable(),"height","1px");requestAnimationFrame((()=>{BX.style(this.getTable(),"height","1px")}));this.showPanels();BX.Dom.removeClass(this.getContainer(),"main-grid-empty-stub")}},reloadTable(t,e,i,s){let n;if(!BX.type.isNotEmptyString(t)){t="GET"}if(!BX.type.isPlainObject(e)){e={}}const o=this;this.tableFade();if(!BX.type.isString(s)){s=""}this.getData().request(s,t,e,"",(function(){BX.onCustomEvent(window,"BX.Main.Grid:onBeforeReload",[o]);o.getRows().reset();n=this.getBodyRows();o.getUpdater().updateContainer(this.getContainer());o.getUpdater().updateHeadRows(this.getHeadRows());o.getUpdater().updateBodyRows(n);o.getUpdater().updateFootRows(this.getFootRows());o.getUpdater().updatePagination(this.getPagination());o.getUpdater().updateMoreButton(this.getMoreButton());o.getUpdater().updateCounterTotal(this.getCounterTotal());o.adjustEmptyTable(n);o.bindOnRowEvents();o.bindOnMoreButtonEvents();o.bindOnClickPaginationLinks();o.bindOnClickHeader();o.bindOnCheckAll();o.updateCounterDisplayed();o.updateCounterSelected();o.disableActionsPanel();o.disableForAllCounter();if(o.getParam("SHOW_ACTION_PANEL")){o.getUpdater().updateGroupActions(this.getActionPanel())}if(o.getParam("ALLOW_COLUMNS_SORT")){o.colsSortable.reinit()}if(o.getParam("ALLOW_ROWS_SORT")){o.rowsSortable.reinit()}o.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[o]);if(BX.type.isFunction(i)){i()}if(o.getParam("ALLOW_PIN_HEADER")){o.getPinHeader()._onGridUpdate()}}))},getGroupEditButton(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupEditButton"),true)},getGroupDeleteButton(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupDeleteButton"),true)},enableGroupActions(){const t=this.getGroupEditButton();const e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.removeClass(e,this.settings.get("classGroupActionsDisabled"))}},disableGroupActions(){const t=this.getGroupEditButton();const e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.addClass(e,this.settings.get("classGroupActionsDisabled"))}},closeActionsMenu(){const t=this.getRows().getRows();for(let e=0,i=t.length;e<i;e++){t[e].closeActionsMenu()}},getPageSize(){return this.pageSize},getFader(){return this.fader},getData(){this.data=this.data||new BX.Grid.Data(this);return this.data},getUpdater(){this.updater=this.updater||new BX.Grid.Updater(this);return this.updater},isSortableHeader(t){return BX.hasClass(t,this.settings.get("classHeaderSortable"))},isNoSortableHeader(t){return BX.hasClass(t,this.settings.get("classHeaderNoSortable"))},bindOnClickHeader(){const t=this;let e;BX.bind(this.getContainer(),"click",(i=>{e=BX.findParent(i.target,{tag:"th"},true,false);if(e&&t.isSortableHeader(e)&&!t.preventSortableClick){const s=new BX.Event.BaseEvent({data:{grid:t,columnName:BX.data(e,"name")}});BX.Event.EventEmitter.emit("BX.Main.grid:onBeforeSort",s);if(s.isDefaultPrevented()){return}t.preventSortableClick=false;t._clickOnSortableHeader(e,i)}}))},enableEditMode(){this.isEditMode=true},disableEditMode(){this.isEditMode=false},isEditMode(){return this.isEditMode},getColumnHeaderCellByName(t){return BX.Grid.Utils.getBySelector(this.getContainer(),`#${this.getId()} th[data-name="${t}"]`,true)},getColumnByName(t){const e=this.getParam("DEFAULT_COLUMNS");return Boolean(t)&&t in e?e[t]:null},adjustIndex(t){const e=this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;return t+e},getColumnByIndex(t){t=this.adjustIndex(t);return this.getAllRows().reduce(((e,i)=>{if(!i.classList.contains("main-grid-row-custom")&&!i.classList.contains("main-grid-row-empty")){e.push(i.children[t])}return e}),[])},getAllRows(){const t=[].slice.call(this.getTable().rows);const e=this.getContainer().parentElement.querySelector(".main-grid-fixed-bar table");if(e){t.push(e.rows[0])}return t},hasEmptyRow(){return this.getAllRows().some((t=>BX.hasClass(t,"main-grid-row-empty")))},initStickedColumns(){if(this.hasEmptyRow()){return}[].slice.call(this.getAllRows()[0].children).forEach((function(t,e){if(t.classList.contains("main-grid-sticked-column")){this.stickyColumnByIndex(e)}}),this);if(this.getParam("ALLOW_COLUMNS_RESIZE")){this.getResize().destroy();this.getResize().init(this)}},setStickedColumns(t){if(BX.type.isArray(t)){const e=this.getUserOptions();const i=[{action:e.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:t}];e.batch(i,(()=>{this.reloadTable()}))}},getStickedColumns(){const t=[].slice.call(this.getHead().querySelectorAll(".main-grid-cell-head"));return t.reduce(((t,e)=>{if(BX.hasClass(e,"main-grid-fixed-column")&&!BX.hasClass(e,"main-grid-cell-checkbox")&&!BX.hasClass(e,"main-grid-cell-action")){t.push(e.dataset.name)}return t}),[])},stickyColumnByIndex(t){const e=this.getColumnByIndex(t);const i=e[0].clientWidth;const s=e.map((t=>BX.height(t)));e.forEach((function(t,e){t.style.minWidth=`${i}px`;t.style.width=`${i}px`;t.style.minHeight=`${s[e]}px`;const n=BX.clone(t);const o=this.getLastStickyCellFromRowByIndex(e);if(o){let e=parseInt(BX.style(o,"left"));let i=parseInt(BX.style(o,"width"));e=isNaN(e)?0:e;i=isNaN(i)?0:i;t.style.left=`${e+i}px`}t.classList.add("main-grid-fixed-column");t.classList.add("main-grid-cell-static");n.classList.add("main-grid-cell-static");if(this.getColsSortable()){this.getColsSortable().unregister(t);this.getColsSortable().unregister(n)}BX.insertAfter(n,t)}),this);this.adjustFadePosition(this.getFadeOffset())},adjustFixedColumnsPosition(){const t=this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;const e=[].slice.call(this.getAllRows()[0].children).reduce(((t,e,i,s)=>{let n;let o;if(s[i-1]&&s[i-1].classList.contains("main-grid-fixed-column")){n=parseInt(BX.style(s[i-1],"left"));o=parseInt(BX.style(s[i-1],"width"));n=isNaN(n)?0:n;o=isNaN(o)?0:o;t.push({index:i+1,left:n+o})}return t}),[]);e.forEach((function(i){const s=this.getColumnByIndex(i.index-t);s.forEach((t=>{if(i.index!==e[e.length-1].index){t.style.left=`${i.left}px`}}))}),this);this.getAllRows().forEach((t=>{const e=BX.height(t);const i=[].slice.call(t.children);i.forEach((t=>{t.style.minHeight=`${e}px`}))}))},getLastStickyCellFromRowByIndex(t){return[].slice.call(this.getAllRows()[t].children).reduceRight(((t,e)=>{if(!t&&e.classList.contains("main-grid-fixed-column")){t=e}return t}),null)},getFadeOffset(){let t=0;const e=this.getLastStickyCellFromRowByIndex(0);if(e){let i=parseInt(BX.style(e,"left"));let s=e.offsetWidth;i=isNaN(i)?0:i;s=isNaN(s)?0:s;t=i+s}return t},adjustFadePosition(t){const e=this.getFader().getEarLeft();const i=this.getFader().getShadowLeft();e.style.left=`${t}px`;i.style.left=`${t}px`},sortByColumn(t){let e=null;let i=null;if(BX.type.isPlainObject(t)){i=t;i.sort_url=this.prepareSortUrl(t)}else{e=this.getColumnHeaderCellByName(t);i=this.getColumnByName(t)}if(i&&(Boolean(e)&&!BX.hasClass(e,this.settings.get("classLoad"))||!e)){Boolean(e)&&BX.addClass(e,this.settings.get("classLoad"));this.tableFade();const t=this;this.getUserOptions().setSort(i.sort_by,i.sort_order,(()=>{t.getData().request(i.sort_url,null,null,"sort",(function(){t.rows=null;t.getUpdater().updateHeadRows(this.getHeadRows());t.getUpdater().updateBodyRows(this.getBodyRows());t.getUpdater().updatePagination(this.getPagination());t.getUpdater().updateMoreButton(this.getMoreButton());t.bindOnRowEvents();t.bindOnMoreButtonEvents();t.bindOnClickPaginationLinks();t.bindOnCheckAll();t.updateCounterDisplayed();t.updateCounterSelected();t.disableActionsPanel();t.disableForAllCounter();if(t.getParam("SHOW_ACTION_PANEL")){t.getActionsPanel().resetForAllCheckbox()}if(t.getParam("ALLOW_ROWS_SORT")){t.rowsSortable.reinit()}if(t.getParam("ALLOW_COLUMNS_SORT")){t.colsSortable.reinit()}BX.onCustomEvent(window,"BX.Main.grid:sort",[i,t]);BX.onCustomEvent(window,"Grid::updated",[t]);t.tableUnfade()}))}))}},prepareSortUrl(t){let e=window.location.toString();if("sort_by"in t){e=BX.util.add_url_param(e,{by:t.sort_by})}if("sort_order"in t){e=BX.util.add_url_param(e,{order:t.sort_order})}return e},_clickOnSortableHeader(t,e){e.preventDefault();this.sortByColumn(BX.data(t,"name"))},getObserver(){return BX.Grid.observer},initRowsDragAndDrop(){this.rowsSortable=new BX.Grid.RowsSortable(this)},initColsDragAndDrop(){this.colsSortable=new BX.Grid.ColsSortable(this)},getRowsSortable(){return this.rowsSortable},getColsSortable(){return this.colsSortable},getUserOptionsHandlerUrl(){return this.userOptionsHandlerUrl||""},getUserOptions(){return this.userOptions},getCheckAllCheckboxes(){const t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCheckAllCheckboxes"));return t.map((t=>new BX.Grid.Element(t)))},selectAllCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().checked=true}))},unselectAllCheckAllCheckboxes(){this.getCheckAllCheckboxes().forEach((t=>{t.getNode().checked=false}))},adjustCheckAllCheckboxes(){const t=this.getRows().getBodyChild().filter((t=>t.isShown()&&Boolean(t.getCheckbox()))).length;const e=this.getRows().getSelected().filter((t=>t.isShown())).length;if(t>0&&e>0&&t===e){this.selectAllCheckAllCheckboxes()}else{this.unselectAllCheckAllCheckboxes()}if(e>0&&e<t){this.indeterminateCheckAllCheckboxes()}else{this.determinateCheckAllCheckboxes()}},bindOnCheckAll(){const t=this;this.getCheckAllCheckboxes().forEach((e=>{e.getObserver().add(e.getNode(),"change",t._clickOnCheckAll,t)}))},_clickOnCheckAll(t){t.preventDefault();this.toggleSelectionAll();this.determinateCheckAllCheckboxes()},toggleSelectionAll(){if(!this.getRows().isAllSelected()&&(this.lastRowAction==="select"||!this.lastRowAction)){this.getRows().selectAll();this.selectAllCheckAllCheckboxes();this.enableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsSelected",[this])}else{this.getRows().unselectAll();this.unselectAllCheckAllCheckboxes();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[this])}delete this.lastRowAction;this.updateCounterSelected()},bindOnClickPaginationLinks(){const t=this;this.getPagination().getLinks().forEach((e=>{e.getObserver().add(e.getNode(),"click",t._clickOnPaginationLink,t)}))},bindOnMoreButtonEvents(){const t=this;this.getMoreButton().getObserver().add(this.getMoreButton().getNode(),"click",t._clickOnMoreButton,t)},bindOnRowEvents(){const t=this.getObserver();const e=this.getParam("SHOW_ROW_CHECKBOXES");const i=this.getParam("ENABLE_COLLAPSIBLE_ROWS");this.getRows().getBodyChild().forEach((function(s){e&&t.add(s.getNode(),"click",this._onClickOnRow,this);s.getDefaultAction()&&t.add(s.getNode(),"dblclick",this._onRowDblclick,this);s.getActionsButton()&&t.add(s.getActionsButton(),"click",this._clickOnRowActionsButton,this);i&&s.getCollapseButton()&&t.add(s.getCollapseButton(),"click",this._onCollapseButtonClick,this)}),this)},_onCollapseButtonClick(t){t.preventDefault();t.stopPropagation();const e=this.getRows().get(t.currentTarget);e.toggleChildRows();if(e.isCustom()){this.getUserOptions().setCollapsedGroups(this.getRows().getIdsCollapsedGroups())}else{this.getUserOptions().setExpandedRows(this.getRows().getIdsExpandedRows())}BX.fireEvent(document.body,"click")},_clickOnRowActionsButton(t){const e=this.getRows().get(t.target);t.preventDefault();if(e.actionsMenuIsShown()){e.closeActionsMenu()}else{e.showActionsMenu()}},_onRowDblclick(event){event.preventDefault();const row=this.getRows().get(event.target);let defaultJs="";if(!row.isEdit()){clearTimeout(this.clickTimer);this.clickPrevent=true;try{defaultJs=row.getDefaultAction();eval(defaultJs)}catch(t){console.warn(t)}}},_onClickOnRow(t){const e=50;const i=window.getSelection();if(t.target.nodeName==="LABEL"){t.preventDefault()}if(t.shiftKey||i.toString().length===0){if(t.shiftKey){i.removeAllRanges()}this.clickTimer=setTimeout(BX.delegate((function(){if(!this.clickPrevent){s.apply(this,[t])}this.clickPrevent=false}),this),e)}function s(t){let e;let i;let s;let n;let o;let a;let r=true;if(t.target.nodeName!=="A"&&t.target.nodeName!=="INPUT"){i=this.getRows().get(t.target);if(i){a=i.getContentContainer(t.target);if(BX.type.isDomNode(a)&&t.target.nodeName!=="TD"&&t.target!==a){r=BX.data(a,"prevent-default")==="true"}if(r){if(i.getCheckbox()){e=[];this.currentIndex=0;this.getRows().getRows().forEach((function(t,e){if(t===i){this.currentIndex=e}}),this);this.lastIndex=this.lastIndex||this.currentIndex;if(t.shiftKey){n=Math.min(this.currentIndex,this.lastIndex);o=Math.max(this.currentIndex,this.lastIndex);while(n<=o){e.push(this.getRows().getRows()[n]);n++}s=e.some((t=>!t.isSelected()));if(s){e.forEach((t=>{t.select()}));this.lastRowAction="select";BX.onCustomEvent(window,"Grid::selectRows",[e,this])}else{e.forEach((t=>{t.unselect()}));this.lastRowAction="unselect";BX.onCustomEvent(window,"Grid::unselectRows",[e,this])}}else if(i.isSelected()){this.lastRowAction="unselect";i.unselect();BX.onCustomEvent(window,"Grid::unselectRow",[i,this])}else{this.lastRowAction="select";i.select();BX.onCustomEvent(window,"Grid::selectRow",[i,this])}this.updateCounterSelected();this.lastIndex=this.currentIndex}this.adjustRows();this.adjustCheckAllCheckboxes()}}}}},adjustRows(){if(this.getRows().isSelected()){BX.onCustomEvent(window,"Grid::thereSelectedRows",[this]);this.enableActionsPanel()}else{BX.onCustomEvent(window,"Grid::noSelectedRows",[]);this.disableActionsPanel()}},getPagination(){return new BX.Grid.Pagination(this)},getState(){return window.history.state},tableFade(){BX.addClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().show();BX.onCustomEvent("Grid::disabled",[this])},tableUnfade(){BX.removeClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().hide();BX.onCustomEvent("Grid::enabled",[this])},_clickOnPaginationLink(t){t.preventDefault();const e=this;const i=this.getPagination().getLink(t.target);if(!i.isLoad()){this.getUserOptions().resetExpandedRows();i.load();this.tableFade();this.getData().request(i.getLink(),null,null,"pagination",(function(){e.rows=null;e.getUpdater().updateBodyRows(this.getBodyRows());e.getUpdater().updateHeadRows(this.getHeadRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());e.bindOnRowEvents();e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();e.disableActionsPanel();e.disableForAllCounter();if(e.getParam("SHOW_ACTION_PANEL")){e.getActionsPanel().resetForAllCheckbox()}if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}i.unload();e.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[e])}))}},_clickOnMoreButton(t){t.preventDefault();const e=this;const i=this.getMoreButton();i.load();this.getData().request(i.getLink(),null,null,"more",(function(){e.getUpdater().appendBodyRows(this.getBodyRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());e.getRows().reset();e.bindOnRowEvents();e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();if(e.getParam("ALLOW_PIN_HEADER")){e.getPinHeader()._onGridUpdate()}if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}e.unselectAllCheckAllCheckboxes();BX.onCustomEvent(window,"Grid::updated",[e])}))},getAjaxId(){return BX.data(this.getContainer(),this.settings.get("ajaxIdDataProp"))},update(t,e){let i;let s;let n;let o;let a;let r;if(!BX.type.isNotEmptyString(t)){return}o=BX.Grid.Utils.getByTag(this.getTable(),"tbody",true);a=BX.Grid.Utils.getByTag(this.getTable(),"thead",true);r=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classNavPanel"),true);t=BX.create("div",{html:t});s=BX.Grid.Utils.getByClass(t,this.settings.get("classHeadRow"));i=BX.Grid.Utils.getByClass(t,this.settings.get("classDataRows"));n=BX.Grid.Utils.getByClass(t,this.settings.get("classNavPanel"),true);if(e===this.settings.get("updateActionMore")){this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionPagination")){BX.cleanNode(o);this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionSort")){BX.cleanNode(a);BX.cleanNode(o);a.appendChild(s[0]);this.getRows().addRows(i)}r.innerHTML=n.innerHTML;this.bindOnRowEvents();this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();this.bindOnCheckAll();this.updateCounterDisplayed();this.updateCounterSelected();this.sortable.reinit()},getCounterDisplayed(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterDisplayed"))},getCounterSelected(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterSelected"))},updateCounterDisplayed(){const t=this.getCounterDisplayed();let e;if(BX.type.isArray(t)){e=this.getRows();t.forEach((t=>{if(BX.type.isDomNode(t)){t.innerText=e.getCountDisplayed()}}))}},updateCounterSelected(){const t=this.getCounterSelected();let e;if(BX.type.isArray(t)){e=this.getRows();t.forEach((t=>{if(BX.type.isDomNode(t)){t.innerText=e.getCountSelected()}}))}},getContainerId(){return this.containerId},getId(){return this.containerId},getContainer(){return BX(this.getContainerId())},getCounter(){if(!this.counter){this.counter=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounter"))}return this.counter},enableForAllCounter(){const t=this.getCounter();if(BX.type.isArray(t)){t.forEach((function(t){BX.addClass(t,this.settings.get("classForAllCounterEnabled"))}),this)}},disableForAllCounter(){const t=this.getCounter();if(BX.type.isArray(t)){t.forEach((function(t){BX.removeClass(t,this.settings.get("classForAllCounterEnabled"))}),this)}},getScrollContainer(){if(!this.scrollContainer){this.scrollContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classScrollContainer"),true)}return this.scrollContainer},getWrapper(){if(!this.wrapper){this.wrapper=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classWrapper"),true)}return this.wrapper},getFadeContainer(){if(!this.fadeContainer){this.fadeContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classFadeContainer"),true)}return this.fadeContainer},getTable(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classTable"),true)},getHeaders(){return BX.Grid.Utils.getBySelector(this.getWrapper(),`.main-grid-header[data-relative="${this.getContainerId()}"]`)},getHead(){return BX.Grid.Utils.getByTag(this.getContainer(),"thead",true)},getBody(){return BX.Grid.Utils.getByTag(this.getContainer(),"tbody",true)},getFoot(){return BX.Grid.Utils.getByTag(this.getContainer(),"tfoot",true)},getRows(){if(!(this.rows instanceof BX.Grid.Rows)){this.rows=new BX.Grid.Rows(this)}return this.rows},getMoreButton(){const t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classMoreButton"),true);return new BX.Grid.Element(t,this)},getLoader(){if(!(this.loader instanceof BX.Grid.Loader)){this.loader=new BX.Grid.Loader(this)}return this.loader},blockSorting(){const t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell"));t.forEach((function(t){if(this.isSortableHeader(t)){BX.removeClass(t,this.settings.get("classHeaderSortable"));BX.addClass(t,this.settings.get("classHeaderNoSortable"))}}),this)},unblockSorting(){const t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell"));t.forEach((function(t){if(this.isNoSortableHeader(t)&&t.dataset.sortBy){BX.addClass(t,this.settings.get("classHeaderSortable"));BX.removeClass(t,this.settings.get("classHeaderNoSortable"))}}),this)},confirmDialog(t,e,i){let s;let n;let o;let a;if("CONFIRM"in t&&t.CONFIRM){t.CONFIRM_MESSAGE=t.CONFIRM_MESSAGE||this.arParams.CONFIRM_MESSAGE;t.CONFIRM_APPLY_BUTTON=t.CONFIRM_APPLY_BUTTON||this.arParams.CONFIRM_APPLY;t.CONFIRM_CANCEL_BUTTON=t.CONFIRM_CANCEL_BUTTON||this.arParams.CONFIRM_CANCEL;s=new BX.PopupWindow(`${this.getContainerId()}-confirm-dialog`,null,{content:`<div class="main-grid-confirm-content">${t.CONFIRM_MESSAGE}</div>`,titleBar:"CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"",autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:false,closeByEsc:true,events:{onClose(){BX.unbind(window,"keydown",r);s.destroy()}},buttons:[new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,id:`${this.getContainerId()}-confirm-dialog-apply-button`,events:{click(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogApply",[this]);BX.unbind(window,"keydown",r)}}}),new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,id:`${this.getContainerId()}-confirm-dialog-cancel-button`,events:{click(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogCancel",[this]);BX.unbind(window,"keydown",r)}}})]});if(!s.isShown()){s.show();n=s.popupContainer;BX.removeClass(n,this.settings.get("classCloseAnimation"));BX.addClass(n,this.settings.get("classShowAnimation"));o=BX(`${this.getContainerId()}-confirm-dialog-apply-button`);a=BX(`${this.getContainerId()}-confirm-dialog-cancel-button`);BX.bind(window,"keydown",r)}}else{BX.type.isFunction(e)?e():null}function r(t){if(t.code==="Enter"){t.preventDefault();t.stopPropagation();BX.fireEvent(o,"click")}if(t.code==="Escape"){t.preventDefault();t.stopPropagation();BX.fireEvent(a,"click")}}},getCurrentPage(){const t=parseInt(this.arParams.CURRENT_PAGE);if(BX.Type.isNumber(t)){return t}return 0},getEmptyStub(){return this.getTable().querySelector(".main-grid-row-empty")},showEmptyStub(){const t=this.getEmptyStub();if(t){BX.Dom.attr(t,"hidden",null);BX.Dom.addClass(this.getContainer(),"main-grid-empty-stub");if(this.getCurrentPage()<=1){this.hidePanels()}}},hideEmptyStub(){const t=this.getEmptyStub();if(t){BX.Dom.attr(t,"hidden",true);BX.Dom.removeClass(this.getContainer(),"main-grid-empty-stub");BX.Dom.style(this.getTable(),"min-height",null);this.showPanels()}},showPanels(){BX.Dom.show(this.getPanels());if(this.getPanels().offsetHeight>0){BX.Dom.removeClass(this.getContainer(),"main-grid-empty-footer")}},hidePanels(){BX.Dom.hide(this.getPanels());BX.Dom.addClass(this.getContainer(),"main-grid-empty-footer")},getTemplateRow(){const t=BX.Runtime.clone(this.getRows().getBodyChild(true).find((t=>t.getId()==="template_0")));const e=BX.Runtime.clone(t.getNode());BX.Dom.prepend(e,this.getBody());const i=e.querySelector('[type="checkbox"]');if(i){BX.Dom.attr(i,"disabled",null);BX.Dom.attr(i,"data-disabled",null)}return new BX.Grid.Row(this,e)},getRowEditorValue(t){this.rows=null;return this.getRows().getSelected(t).map((t=>t.getEditorValue()))},getRowEditorActionPanel(){if(!this.rowEditorActionPanel){this.rowEditorActionPanel=BX.Dom.create({tag:"div",props:{className:"main-ui-grid-row-editor-actions-panel"},children:[BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-success"},text:this.arParams.SAVE_BUTTON_LABEL,events:{click:this.saveRows.bind(this)}}),BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-link"},text:this.arParams.CANCEL_BUTTON_LABEL,events:{click:this.hideRowsEditor.bind(this)}})]})}return this.rowEditorActionPanel},showRowEditorActionsPanel(){const t=this.getRowEditorActionPanel();BX.Dom.append(t,this.actionPanel.getPanel())},hideRowEditorActionsPanel(){BX.Dom.remove(this.getRowEditorActionPanel())},prependRowEditor(){return this.addRowEditor("prepend")},appendRowEditor(){return this.addRowEditor("append")},addRowEditor(t="prepend"){BX.Dom.style(this.getTable(),"min-height",null);const e=this.getTemplateRow();this.editableRows.push(e);if(t==="prepend"){e.prependTo(this.getBody())}else{e.appendTo(this.getBody())}e.show();e.select();e.edit();this.getRows().reset();if(this.getParam("ALLOW_ROWS_SORT")){this.rowsSortable.reinit()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.colsSortable.reinit()}this.hideEmptyStub();return e},hideRowsEditor(){this.editableRows.forEach((t=>{BX.Dom.remove(t.getNode())}));this.editableRows=[]},saveRows(){const t=this.getRowEditorValue(true);this.emitAsync("onAddRowsAsync",{rows:t}).then((t=>{t.forEach(((t,e)=>{const i=this.editableRows[e];if(i){i.editCancel();i.unselect();i.makeCountable();i.setId(t.id);i.setActions(t.actions);i.setCellsContent(t.columns)}}));this.bindOnRowEvents();this.updateCounterDisplayed();this.updateCounterSelected();this.editableRows=[]}))},getRealtime(){return this.cache.remember("realtime",(()=>new BX.Grid.Realtime({grid:this})))}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Updater=function(t){this.parent=t};BX.Grid.Updater.prototype.getParent=function(){return this.parent};BX.Grid.Updater.prototype.updateHeadRows=function(t){let e;if(BX.type.isArray(t)&&t.length>0){e=this.getParent().getHeaders();e.forEach((e=>{e=BX.cleanNode(e);t.forEach((t=>{if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}}))}))}};BX.Grid.Updater.prototype.appendHeadRows=function(t){let e;if(BX.type.isArray(t)&&t.length>0){e=this.getParent().getHeaders();e.forEach((e=>{t.forEach((t=>{if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}}))}))}};BX.Grid.Updater.prototype.prependHeadRows=function(t){let e;if(BX.type.isArray(t)&&t.length>0){e=this.getParent().getHeaders();e.forEach((e=>{e=BX.cleanNode(e);t.forEach((t=>{if(BX.type.isDomNode(t)){e.prepend(BX.clone(t))}}))}))}};BX.Grid.Updater.prototype.updateBodyRowById=function(t,e){if((BX.type.isNumber(t)||BX.type.isNotEmptyString(t))&&BX.type.isDomNode(e)){const i=this.getParent().getRows().getById(t);if(i){const t=i.getNode();BX.insertAfter(e,t);BX.remove(t)}}};BX.Grid.Updater.prototype.updateBodyRows=function(t){if(BX.type.isArray(t)){const e=this.getParent().getBody();e.innerHTML="";t.forEach((t=>{Boolean(t)&&e.appendChild(t)}))}};BX.Grid.Updater.prototype.appendBodyRows=function(t){let e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach((t=>{if(BX.type.isDomNode(t)){e.appendChild(t)}}))}};BX.Grid.Updater.prototype.prependBodyRows=function(t){let e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach((t=>{if(BX.type.isDomNode(t)){BX.prepend(e,t)}}))}};BX.Grid.Updater.prototype.updateFootRows=function(t){let e;if(BX.type.isArray(t)){e=BX.cleanNode(this.getParent().getFoot());t.forEach((t=>{if(BX.type.isDomNode(t)){e.appendChild(t)}}))}};BX.Grid.Updater.prototype.updateCounterTotal=function(t){let e;if(BX.type.isDomNode(t)){e=BX.cleanNode(this.getParent().getCounterTotal());e.appendChild(t)}};BX.Grid.Updater.prototype.updatePagination=function(t){const e=this.getParent().getPagination().getContainer();if(e){e.innerHTML="";if(BX.type.isDomNode(t)){e.appendChild(t)}}};BX.Grid.Updater.prototype.updateMoreButton=function(t){if(BX.type.isDomNode(t)){const e=BX.Grid.Utils.closestParent(this.getParent().getMoreButton().getNode());e.innerHTML="";e.appendChild(t)}};BX.Grid.Updater.prototype.updateGroupActions=function(t){const e=this.parent.getActionsPanel();if(Boolean(e)&&BX.type.isDomNode(t)){const i=e.getPanel();if(BX.type.isDomNode(i)){i.innerHTML="";const e=BX.firstChild(t);if(BX.type.isDomNode(e)){i.appendChild(e)}}}};BX.Grid.Updater.prototype.updateContainer=function(t){if(BX.Type.isDomNode(t)){this.getParent().getContainer().className=t.className}}})();(function(){BX.Reflection.namespace("BX.Grid");BX.Grid.ImageField=function(t,e){this.parent=t;this.options=e;this.cache=new BX.Cache.MemoryCache};BX.Grid.ImageField.prototype={getPreview(){return this.cache.remember("preview",(()=>BX.create("img",{props:{className:"main-grid-image-editor-preview"},attrs:{src:this.options.VALUE}})))},getFileInput(){return this.cache.remember("fileInput",(()=>BX.create("input",{props:{className:"main-grid-image-editor-file-input"},attrs:{type:"file",accept:"image/*",name:this.options.NAME},events:{change:function(t){const e=new FileReader;e.onload=function(t){this.getPreview().src=t.currentTarget.result}.bind(this);e.readAsDataURL(t.target.files[0]);BX.Dom.remove(this.getFakeField());BX.Dom.append(this.getFileInput(),this.getLayout());BX.Dom.removeClass(this.getRemoveButton(),"ui-btn-disabled");BX.Dom.style(this.getPreview(),null)}.bind(this)}})))},getUploadButton(){return this.cache.remember("uploadButton",(()=>BX.create("button",{props:{className:"ui-btn ui-btn-xs"},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_EDIT"),events:{click:function(t){t.preventDefault();this.getFileInput().click()}.bind(this)}})))},getRemoveButton(){return this.cache.remember("removeButton",(()=>BX.create("button",{props:{className:"ui-btn ui-btn-xs ui-btn-danger"},events:{click:function(t){t.preventDefault();BX.Dom.append(this.getFakeField(),this.getLayout());BX.Dom.remove(this.getFileInput());BX.Dom.addClass(this.getRemoveButton(),"ui-btn-disabled");BX.Dom.style(this.getPreview(),{opacity:.4})}.bind(this)},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_REMOVE")})))},getFakeField(){return this.cache.remember("deleted",(()=>BX.create("input",{props:{className:"main-grid-image-editor-fake-file-input"},attrs:{type:"hidden",name:this.options.NAME,value:"null"}})))},getLayout(){return this.cache.remember("layout",(()=>BX.create("div",{props:{className:"main-grid-image-editor main-grid-editor"},attrs:{name:this.options.NAME},children:[BX.create("div",{props:{className:"main-grid-image-editor-left"},children:[this.getPreview()]}),BX.create("div",{props:{className:"main-grid-image-editor-right"},children:[this.getUploadButton(),this.getRemoveButton()]}),this.getFileInput()]})))}}})();let _=t=>t,_t,_t2;(function(){BX.namespace("BX.Grid");BX.Grid.InlineEditor=function(t,e){this.parent=null;this.types=null;this.isDropdownChangeEventSubscribed=false;this.init(t,e)};BX.Grid.InlineEditor.prototype={init(parent,types){this.parent=parent;try{this.types=eval(types)}catch{this.types=null}},createContainer(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea(t,e){return BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:`height:${e}px`},html:t.VALUE||""})},createInput(t){let e=this.parent.settings.get("classEditorText");const i={value:t.VALUE!==undefined&&t.VALUE!==null?BX.util.htmlspecialcharsback(t.VALUE):"",name:t.NAME!==undefined&&t.NAME!==null?t.NAME:""};if(t.TYPE===this.types.CHECKBOX){e=this.parent.settings.get("classEditorCheckbox");i.type="checkbox";i.checked=i.value=="Y"}if(t.TYPE===this.types.DATE){e=[e,this.parent.settings.get("classEditorDate")].join(" ")}if(t.TYPE===this.types.NUMBER){e=[e,this.parent.settings.get("classEditorNumber")].join(" ");i.type="number"}if(t.TYPE===this.types.RANGE){e=[e,this.parent.settings.get("classEditorRange")].join(" ");i.type="range";if(BX.type.isPlainObject(t.DATA)){i.min=t.DATA.MIN||"0";i.max=t.DATA.MAX||99999;i.step=t.DATA.STEP||""}}if(BX.type.isNotEmptyString(t.PLACEHOLDER)){i.placeholder=BX.util.htmlspecialchars(t.PLACEHOLDER)}if(t.DISABLED){i.disabled=true}e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("input",{props:{className:e,id:`${t.NAME}_control`},attrs:i})},createCustom(t){let e=this.parent.settings.get("classEditorCustom");e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("div",{props:{className:e},attrs:{"data-name":t.NAME},html:t.VALUE||""})},createMoney(t){const e=t.VALUE;const i=[];const s=e.PRICE||{};s.PLACEHOLDER=t.PLACEHOLDER||"";i.push(this.createMoneyPrice(s));if(BX.type.isArray(t.CURRENCY_LIST)&&t.CURRENCY_LIST.length>0){const s=e.CURRENCY||{};s.DATA={ITEMS:t.CURRENCY_LIST};s.HTML_ENTITY=t.HTML_ENTITY||false;i.push(this.createMoneyCurrency(s))}if(BX.type.isNotEmptyObject(e.HIDDEN)){for(const t in e.HIDDEN){if(e.HIDDEN.hasOwnProperty(t)&&BX.type.isNotEmptyString(t)){const s=this.createInput({NAME:t,VALUE:e.HIDDEN[t],TYPE:this.types.TEXT});s.type="hidden";i.push(s)}}}let n=this.parent.settings.get("classEditorMoney");n=[this.parent.settings.get("classEditor"),n].join(" ");const o=e.ATTRIBUTES||{};o["data-name"]=t.NAME;return BX.create("div",{props:{className:n},attrs:o,children:i})},createMoneyPrice(t){t.TYPE=this.types.NUMBER;const e=this.createInput(t);e.classList.add("main-grid-editor-money-price");main_core.Event.bind(e,"change",(t=>{const e=t.target.parentNode;const i=e.querySelector(".main-grid-editor-money-currency");const s={field:e,values:{price:t.target.value||"",currency:i.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",s)}));return e},createMoneyCurrency(t){const e=this.createDropdown(t);e.dataset.menuOffsetLeft=15;e.dataset.menuMaxHeight=200;e.classList.add("main-grid-editor-money-currency");if(t.DISABLED===true){e.classList.remove("main-dropdown");e.dataset.disabled=true}if(!this.isDropdownChangeEventSubscribed){this.isDropdownChangeEventSubscribed=true;main_core_events.EventEmitter.subscribe("Dropdown::change",(t=>{const[e]=t.getData();if(!BX.type.isNotEmptyString(e)){return}const i=BX.Main.dropdownManager.getById(e);if(i.dropdown&&i.dropdown.classList.contains("main-grid-editor-money-currency")){const t=i.dropdown.parentNode;const e=t.querySelector(".main-grid-editor-money-price");const s={field:t,values:{price:e.value||"",currency:i.dropdown.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",s)}}))}return e},createOutput(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{for:`${t.NAME}_control`},text:t.VALUE||""})},getDropdownValueItemByValue(t,e){const i=String(e);const s=t.filter((t=>String(t.VALUE)===i));return s.length>0?s[0]:t[0]},createDropdown(t){const e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE);const i="HTML_ENTITY"in t&&t.HTML_ENTITY===true;return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:`${t.NAME}_control`},attrs:{name:t.NAME,tabindex:"0","data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE,"data-html-entity":t.HTML_ENTITY},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:i?e.NAME:null,text:i?null:e.NAME})]})},createMultiselect(t){const e=[];const i=(()=>{if(BX.Type.isArrayFilled(t.VALUE)){return t.VALUE.map((i=>{var s;const n=this.getDropdownValueItemByValue(t.DATA.ITEMS,i);e.push(n);const o=(s=n.HTML)!=null?s:BX.util.htmlspecialchars(n.NAME);const a=BX.Tag.render(_t||(_t=_`
							<span class="main-ui-square">
								<span class="main-ui-square-item">${0}</span>
								<span class="main-ui-item-icon main-ui-square-delete"></span>
							</span>
						`),o);BX.Dom.attr(a,"data-item",n);return a}))}return[]})();const s=BX.Tag.render(_t2||(_t2=_`
				<div
					class="main-grid-editor main-ui-control main-ui-multi-select"
					name="${0}"
					id="${0}"
				>
					<span class="main-ui-square-container">${0}</span>
					<span class="main-ui-hide main-ui-control-value-delete">
						<span class="main-ui-control-value-delete-item"></span>
					</span>
					<span class="main-ui-square-search">
						<input type="text" class="main-ui-square-search-item">
					</span>
				</div>
			`),BX.Text.encode(t.NAME),`${BX.Text.encode(t.NAME)}_control`,i);BX.Dom.attr(s,{"data-params":{isMulti:true},"data-items":t.DATA.ITEMS,"data-value":e});return s},validateEditObject(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t&&(!("items"in t)||BX.type.isArray(t.items)&&t.items.length)},initCalendar(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange(t,e){function i(t,e){BX.html(e,t.value);const i=parseFloat(t.value);const s=parseFloat(t.getAttribute("max"));const n=parseFloat(t.getAttribute("min"));const o=16;const a=s-n;const r=(i-n)/a*100;const l=Math.round(o*r/100)-o/2;e.style.left=`${r}%`;e.style.marginLeft=`${-l}px`}setTimeout((()=>{i(t,e)}),0);BX.bind(t,"input",(()=>{i(t,e)}))},createImageEditor(t){return new BX.Grid.ImageField(this.parent,t).getLayout()},getEditor(t,e){let i;let s;const n=this.createContainer();if(this.validateEditObject(t)){t.VALUE=t.VALUE===null?"":t.VALUE;switch(t.TYPE){case this.types.TEXT:{i=this.createInput(t);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DATE:{i=this.createInput(t);BX.bind(i,"click",this.initCalendar);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.NUMBER:{i=this.createInput(t);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.RANGE:{i=this.createInput(t);s=this.createOutput(t);this.bindOnRangeChange(i,s);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CHECKBOX:{i=this.createInput(t);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.TEXTAREA:{i=this.createTextarea(t,e);BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DROPDOWN:{i=this.createDropdown(t);break}case this.types.MULTISELECT:{i=this.createMultiselect(t);break}case this.types.IMAGE:{i=this.createImageEditor(t);break}case this.types.MONEY:{i=this.createMoney(t);BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CUSTOM:{i=this.createCustom(t);requestAnimationFrame((()=>{const e=t.HTML||t.VALUE||null;if(e){const t=BX.processHTML(e);t.SCRIPT.forEach((t=>{if(t.isInternal&&t.JS){BX.evalGlobal(t.JS)}}))}}));BX.bind(i,"click",(t=>{t.stopPropagation()}));BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}default:{break}}}if(BX.type.isDomNode(s)){n.appendChild(s)}if(BX.type.isDomNode(i)){n.appendChild(i)}return n},_onControlKeydown(t){if(t.code==="Enter"){t.preventDefault();const e=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",true);if(e){BX.fireEvent(e,"click")}}}}})();class Label{}Label.Color={DEFAULT:"ui-label-default",DANGER:"ui-label-danger",SUCCESS:"ui-label-success",WARNING:"ui-label-warning",PRIMARY:"ui-label-primary",SECONDARY:"ui-label-secondary",LIGHTGREEN:"ui-label-lightgreen",LIGHTBLUE:"ui-label-lightblue",LIGHT:"ui-label-light"};Label.RemoveButtonType={INSIDE:"main-grid-tag-remove-inside",OUTSIDE:"main-grid-tag-remove-outside"};const namespace$3=main_core.Reflection.namespace("BX.Grid");namespace$3.Label=Label;(function(){BX.namespace("BX.Grid");BX.Grid.Loader=function(t){this.parent=null;this.container=null;this.windowHeight=null;this.tbodyPos=null;this.headerPos=null;this.lastPosTop=null;this.lastBottomPos=null;this.table=null;this.loader=null;this.adjustLoaderOffset=this.adjustLoaderOffset.bind(this);this.init(t)};BX.Grid.Loader.prototype={init(t){this.parent=t;this.table=this.parent.getTable();this.loader=new BX.Loader({target:this.getContainer()})},adjustLoaderOffset(){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead);let t=window.scrollY;if(this.parent.isIE()){t=document.documentElement.scrollTop}let e=t+this.windowHeight-this.tbodyPos.top;let i=t-this.tbodyPos.top;if(e>this.tbodyPos.bottom-this.tbodyPos.top){e=this.tbodyPos.bottom-this.tbodyPos.top}if(i<this.headerPos.height){i=this.headerPos.height}else{e-=i;e+=this.headerPos.height}requestAnimationFrame((()=>{if(i!==this.lastPosTop){this.getContainer().style.transform=`translate3d(0px, ${i}px, 0)`}if(e!==this.lastBottomPos){this.getContainer().style.height=`${e}px`}this.lastPosTop=i;this.lastBottomPos=e}))},getContainer(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classLoader"),true)}return this.container},show(){if(!this.loader.isShown()){this.adjustLoaderOffset();this.getContainer().style.display="block";this.getContainer().style.opacity="1";this.getContainer().style.visibility="visible";const t=this.parent.getRows().getCountDisplayed();if(t>0&&t<=2){this.loader.setOptions({size:60});this.loader.show()}else{this.loader.setOptions({size:110});this.loader.show()}}},hide(){if(this.loader.isShown()){this.adjustLoaderOffset();this.loader.hide().then((()=>{this.getContainer().style.display="none"}))}}}})();(function(){BX.namespace("BX.Main");if(BX.Main.gridManager){return}BX.Main.gridManager={data:[],push(t,e){if(BX.type.isNotEmptyString(t)&&e){const i={id:t,instance:e,old:null};if(this.getById(t)===null){this.data.push(i)}else{this.data[0]=i}}},getById(t){const e=this.data.filter((e=>e.id===t||e.id.replace("main_grid_","")===t));return e.length===1?e[0]:null},getInstanceById(t){const e=this.getById(t);return BX.type.isPlainObject(e)?e.instance:null},reload(t,e){const i=this.getInstanceById(t);if(i){i.reload(e)}},getDataIndex(t){let e=null;this.data.forEach(((i,s)=>{if(i.id===t){e=s}}));return e},destroy(t){if(BX.type.isNotEmptyString(t)){const e=this.getInstanceById(t);if(e instanceof BX.Main.grid){e.destroy();const i=this.getDataIndex(t);if(i!==null){delete this.data[i]}}}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Message=function(t,e){this.parent=null;this.types=null;this.messages=null;this.popup=null;this.init(t,e)};BX.Grid.Message.prototype={init(t,e){this.parent=t;this.types=e;this.show();BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onUpdated,this))},onUpdated(){this.show()},getData(){return this.parent.arParams.MESSAGES},isNeedShow(){return this.getData().length>0},show(){if(this.isNeedShow()){this.getPopup().setContent(this.getContent());this.getPopup().show()}},getContent(){const t=this.getData();let e=null;if(BX.type.isArray(t)&&t.length>0){const i={block:"main-grid-messages",content:[]};t.forEach((t=>{const e={block:"main-grid-message",mix:`main-grid-message-${t.TYPE.toLowerCase()}`,content:[]};if(BX.type.isNotEmptyString(t.TITLE)){e.content.push({block:"main-grid-message-title",content:BX.create("div",{html:t.TITLE}).innerText})}if(BX.type.isNotEmptyString(t.TEXT)){e.content.push({block:"main-grid-message-text",content:BX.create("div",{html:t.TEXT}).innerText})}i.content.push(e)}));e=BX.decl(i)}return e},getPopup(){if(this.popup===null){this.popup=new BX.PopupWindow(this.getPopupId(),null,{autoHide:true,overlay:.3,minWidth:400,maxWidth:800,contentNoPaddings:true,closeByEsc:true,buttons:[new BX.PopupWindowButton({text:this.parent.getParam("CLOSE"),className:"webform-small-button-blue webform-small-button",events:{click(){this.popupWindow.close()}}})]})}return this.popup},getPopupId(){return`${this.parent.getContainerId()}-main-grid-message`}}})();(function(){BX.namespace("BX.Grid");BX.Grid.observer={handlers:[],add(t,e,i,s){BX.bind(t,e,s?BX.proxy(i,s):i)}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Pagesize=function(t){this.parent=null;this.init(t)};BX.Grid.Pagesize.prototype={init(t){this.parent=t;BX.addCustomEvent("Dropdown::change",BX.proxy(this.onChange,this))},destroy(){BX.removeCustomEvent("Dropdown::change",BX.proxy(this.onChange,this))},onChange(t,e,i,s,n){const o=this;if(t===`${this.parent.getContainerId()}_${this.parent.settings.get("pageSizeId")}`&&n>=0){this.parent.tableFade();this.parent.getUserOptions().setPageSize(n,(()=>{o.parent.reloadTable();BX.onCustomEvent(o.parent.getContainer(),"Grid::pageSizeChanged",[o.parent])}))}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Pagination=function(t){this.parent=null;this.container=null;this.links=null;this.init(t)};BX.Grid.Pagination.prototype={init(t){this.parent=t},getParent(){return this.parent},getContainer(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.getParent().getContainer(),this.getParent().settings.get("classPagination"),true)}return this.container},getLinks(){const t=this;const e=BX.Grid.Utils.getByTag(this.getContainer(),"a");this.links=[];if(e){this.links=e.map((e=>new BX.Grid.Element(e,t.getParent())))}return this.links},getLink(t){let e=null;let i;if(BX.type.isDomNode(t)){i=this.getLinks().filter((e=>t===e.getNode()));if(i.length>0){e=i[0]}}return e}}})();(function(){BX.namespace("BX.Grid");BX.Grid.PinHeader=function(t){this.parent=null;this.table=null;this.header=null;this.container=null;this.parentNodeResizeObserver=null;const e=this.getAdminPanel();if(e){this.mo=new MutationObserver(this.onAdminPanelMutation.bind(this));this.mo.observe(document.documentElement,{attributes:true})}this.init(t)};BX.Grid.PinHeader.prototype={init(t){this.parent=t;this.rect=BX.pos(this.parent.getHead());this.gridRect=BX.pos(this.parent.getTable());let e=BX.Grid.Utils.getBySelector(document,"#workarea-content",true);if(!e){e=this.parent.getContainer().parentNode;e=e?e.parentNode:e}if(e){this.parentNodeResizeObserver=new BX.ResizeObserver(BX.proxy(this.refreshRect,this));this.parentNodeResizeObserver.observe(e)}this.create(true);document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}));document.addEventListener("resize",BX.proxy(this._onResize,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent("Grid::updated",BX.proxy(this._onGridUpdate,this));BX.addCustomEvent("Grid::resize",BX.proxy(this._onGridUpdate,this));BX.bind(window,"resize",BX.proxy(this._onGridUpdate,this))},refreshRect(){this.gridRect=BX.pos(this.parent.getTable());this.rect=BX.pos(this.parent.getHead())},_onGridUpdate(){const t=this.isPinned();BX.remove(this.getContainer());this.create();t&&this.pin();this.table=null;this.refreshRect();this._onScroll();BX.onCustomEvent(window,"Grid::headerUpdated",[])},create(t){const e=BX.Grid.Utils.getByTag(this.parent.getHead(),"th");const i=BX.clone(this.parent.getHead());const s=BX.Grid.Utils.getByTag(i,"th");const n=function(){e.forEach(((t,i)=>{let n=BX.width(t);if(i>0){n-=parseInt(BX.style(t,"border-left-width"));n-=parseInt(BX.style(t,"border-right-width"))}s[i].firstElementChild&&(s[i].firstElementChild.style.width=`${n}px`);if(e.length-1>i){s[i].style.width=`${n}px`}}))};t?setTimeout(n,0):n();this.container=BX.decl({block:"main-grid-fixed-bar",mix:"main-grid-fixed-top",attrs:{style:`width: ${BX.width(this.parent.getContainer())}px`},content:{block:"main-grid-table",tag:"table",content:i}});this.container.hidden=true;this.parent.getWrapper().appendChild(this.container)},getContainer(){return this.container},getFixedTable(){return this.table||(this.table=BX.Grid.Utils.getByTag(this.getContainer(),"table",true))},getAdminPanel(){if(!this.adminPanel){this.adminPanel=document.querySelector(".adm-header")}return this.adminPanel},isAdminPanelPinned(){return BX.hasClass(document.documentElement,"adm-header-fixed")},getPinOffset(){const t=this.getAdminPanel();if(t&&this.isAdminPanelPinned()){return BX.Text.toNumber(BX.style(t,"height"))}return 0},pin(){const t=this.getContainer();if(t){t.hidden=false}BX.onCustomEvent(window,"Grid::headerPinned",[])},unpin(){const t=this.getContainer();if(t){t.hidden=true}BX.onCustomEvent(window,"Grid::headerUnpinned",[])},stopPin(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"absolute",top:`${this.gridRect.bottom-this.rect.height-this.gridRect.top}px`,"box-shadow":"none"})},startPin(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"fixed",top:`${this.getPinOffset()}px`,"box-shadow":""})},isPinned(){return!this.getContainer().hidden},_onScroll(){let t=0;if(this.scrollRect){t=this.scrollRect.scrollTop}else if(document.scrollingElement){this.scrollRect=document.scrollingElement}else if(document.documentElement.scrollTop>0){this.scrollRect=document.documentElement}else if(document.body.scrollTop>0){this.scrollRect=document.body}if(this.gridRect.bottom>t+this.rect.height){this.startPin();const e=this.getPinOffset();if(this.rect.top-e<=t){!this.isPinned()&&this.pin()}else{this.isPinned()&&this.unpin()}}else{this.stopPin()}},onAdminPanelMutation(){this._onScroll()},_onResize(){this.rect=BX.pos(this.parent.getHead())}}})();(function(){BX.namespace("BX.Grid");BX.Grid.PinPanel=function(t){this.parent=null;this.panel=null;this.isSelected=null;this.offset=null;this.animationDuration=null;this.pinned=false;this.init(t)};BX.Grid.PinPanel.prototype={init(t){this.parent=t;this.offset=10;this.animationDuration=200;this.panel=this.getPanel();this.bindOnRowsEvents()},destroy(){this.unbindOnRowsEvents()},bindOnRowsEvents(){BX.addCustomEvent("Grid::thereSelectedRows",BX.proxy(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::allRowsSelected",BX.proxy(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::noSelectedRows",BX.proxy(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::allRowsUnselected",BX.proxy(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::updated",BX.proxy(this._onNoSelectedRows,this))},unbindOnRowsEvents(){BX.removeCustomEvent("Grid::thereSelectedRows",BX.proxy(this._onThereSelectedRows,this));BX.removeCustomEvent("Grid::allRowsSelected",BX.proxy(this._onThereSelectedRows,this));BX.removeCustomEvent("Grid::noSelectedRows",BX.proxy(this._onNoSelectedRows,this));BX.removeCustomEvent("Grid::allRowsUnselected",BX.proxy(this._onNoSelectedRows,this));BX.removeCustomEvent("Grid::updated",BX.proxy(this._onNoSelectedRows,this))},bindOnWindowEvents(){BX.bind(window,"resize",BX.proxy(this._onResize,this));document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},unbindOnWindowEvents(){BX.unbind(window,"resize",BX.proxy(this._onResize,this));document.removeEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},getPanel(){this.panel=this.panel||this.parent.getActionsPanel().getPanel();return this.panel},getScrollBottom(){return BX.scrollTop(window)+this.getWindowHeight()},getPanelRect(){if(!BX.type.isPlainObject(this.panelRect)){this.panelRect=BX.pos(this.getPanel())}return this.panelRect},getPanelPrevBottom(){const t=BX.previousSibling(this.getPanel());return BX.pos(t).bottom+parseFloat(BX.style(t,"margin-bottom"))},getWindowHeight(){this.windowHeight=this.windowHeight||BX.height(window);return this.windowHeight},pinPanel(t){const e=this.getPanel();const i=BX.width(this.getPanel().parentNode);const s=BX.height(this.getPanel().parentNode);const n=BX.pos(this.parent.getBody());const o=this.getStartDiffPanelPosition();e.parentNode.style.setProperty("height",`${s}px`);e.style.setProperty("transform",`translateY(${o}px)`);e.classList.add("main-grid-fixed-bottom");e.style.setProperty("width",`${i}px`);e.style.removeProperty("position");e.style.removeProperty("top");requestAnimationFrame((()=>{if(t!==false){e.style.setProperty("transition","transform 200ms ease")}e.style.setProperty("transform","translateY(0)")}));if(this.isNeedPinAbsolute()&&!this.absolutePin){this.absolutePin=true;e.style.removeProperty("transition");e.style.setProperty("position","absolute");e.style.setProperty("top",`${n.top}px`)}if(!this.isNeedPinAbsolute()&&this.absolutePin){this.absolutePin=false}this.adjustPanelPosition();this.pinned=true},unpinPanel(t){const e=this.getPanel();const i=BX.pos(e);const s=BX.pos(e.parentNode);const n=Math.abs(i.bottom-s.bottom);if(t!==false){e.style.setProperty("transition","transform 200ms ease")}const o=n<i.height?`${n}px`:"100%";e.style.setProperty("transform",`translateY(${o})`);const a=function(e,i){if(t!==false){return setTimeout(e,i)}e()};a((()=>{e.parentNode.style.removeProperty("height");e.classList.remove("main-grid-fixed-bottom");e.style.removeProperty("transition");e.style.removeProperty("transform");e.style.removeProperty("width");e.style.removeProperty("position");e.style.removeProperty("top")}),t===false?0:200);this.pinned=false},isSelectedRows(){return this.isSelected},isNeedPinAbsolute(){return BX.pos(this.parent.getBody()).top+this.getPanelRect().height>=this.getScrollBottom()},isNeedPin(){return this.getScrollBottom()-this.getPanelRect().height<=this.getPanelPrevBottom()},adjustPanelPosition(){const t=window.pageXOffset;this.lastScrollX=this.lastScrollX===null?t:this.lastScrollX;BX.Grid.Utils.requestAnimationFrame(BX.proxy((function(){if(t!==this.lastScrollX){const e=this.getPanelRect();BX.style(this.getPanel(),"left",`${e.left-t}px`)}}),this));this.lastScrollX=t},pinController(t){if(this.getPanel()){if(!this.isPinned()&&this.isNeedPin()&&this.isSelectedRows()){return this.pinPanel(t)}if(this.isPinned()&&!this.isNeedPin()||!this.isSelectedRows()){this.unpinPanel(t)}}},getEndDiffPanelPosition(){const t=BX.pos(this.getPanel());const e=BX.pos(BX.previousSibling(this.getPanel()));const i=BX.scrollTop(window);const s=i+BX.height(window);let n=t.height+this.offset;const o=e.bottom+parseFloat(BX.style(this.getPanel(),"margin-top"));if(o<s&&o+t.height>s){n=Math.abs(s-(o+t.height))}return n},getStartDiffPanelPosition(){const t=BX.pos(this.getPanel());const e=BX.scrollTop(window);const i=e+BX.height(window);let s=t.height;if(t.bottom>i&&t.top<i){s=t.bottom-i}return s},isPinned(){return this.pinned},_onThereSelectedRows(){this.bindOnWindowEvents();this.isSelected=true;if(this.lastIsSelected){this.pinController()}else{this.lastIsSelected=true;this.pinController()}},_onNoSelectedRows(){this.unbindOnWindowEvents();this.isSelected=false;this.pinController();this.lastIsSelected=false},_onScroll(){this.pinController(false)},_onResize(){this.windowHeight=BX.height(window);this.panel=this.parent.getActionsPanel().getPanel();this.panelRect=this.getPanel().getBoundingClientRect();this.pinController(false)}}})();let _$1=t=>t,_t$1,_t2$1,_t3,_t4,_t5;class Realtime extends main_core_events.EventEmitter{constructor(t){super();this.setEventNamespace("BX.Grid.Realtime");this.options={...t}}addRow(t){const{grid:e}=this.options;const i=e.getTemplateRow();i.makeCountable();e.hideEmptyStub();if(main_core.Type.isNumber(t.id)||main_core.Type.isStringFilled(t.id)){i.setId(t.id)}else{throw new ReferenceError("id is not number or string")}if(main_core.Type.isArrayFilled(t.actions)){i.setActions(t.actions)}if(main_core.Type.isPlainObject(t.columns)){i.setCellsContent(t.columns)}if(main_core.Type.isPlainObject(t.cellActions)){i.setCellActions(t.cellActions)}if(main_core.Type.isPlainObject(t.counters)){const e=Object.entries(t.counters).reduce(((t,[e,i])=>{if(main_core.Type.isPlainObject(i)){var s;t[e]={...i,isDouble:(s=i.isDouble)!=null?s:false,secondaryColor:i.secondaryColor,animation:main_core.Text.toBoolean(i.animation)}}return t}),{});i.setCounters(e)}if(t.prepend===true){i.prependTo(e.getBody())}else if(t.append===true){i.appendTo(e.getBody())}else if(main_core.Type.isNumber(t.insertBefore)||main_core.Type.isStringFilled(t.insertBefore)){const s=e.getRows().getById(t.insertBefore);if(s){BX.Dom.insertBefore(i.getNode(),s.getNode())}}else if(main_core.Type.isNumber(t.insertAfter)||main_core.Type.isStringFilled(t.insertAfter)){const s=e.getRows().getById(t.insertAfter);if(s){BX.Dom.insertAfter(i.getNode(),s.getNode())}}else{throw new ReferenceError("prepend, append, insertBefore or insertAfter not filled")}i.show();if(t.animation!==false){i.enableAbsolutePosition();const t=e.getRows().getSourceBodyChild().filter((t=>t.rowIndex>i.getIndex()));const s=document.createElement("tr");main_core.Dom.style(s,{height:"0px",transition:"200ms height linear"});main_core.Dom.append(s,e.getBody());const n=i.getHeight();main_core.Dom.style(s,"height",`${n}px`);t.forEach((t=>{main_core.Dom.style(t,{transition:"200ms transform linear",transform:`translateY(${n}px) translateZ(0)`})}));main_core.Dom.addClass(i.getNode(),"main-ui-grid-show-new-row");main_core.Event.bind(i.getNode(),"animationend",(e=>{if(e.animationName==="showNewRow"){t.forEach((t=>{main_core.Dom.style(t,{transition:null,transform:null})}));main_core.Dom.remove(s);i.disableAbsolutePosition();main_core.Dom.removeClass(i.getNode(),"main-ui-grid-show-new-row")}}))}e.getRows().reset();e.bindOnRowEvents();e.updateCounterDisplayed();e.updateCounterSelected();if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}}showStub(t={}){const e=document.createElement("tr");main_core.Dom.addClass(e,"main-grid-row main-grid-row-empty main-grid-row-body");const i=document.createElement("td");main_core.Dom.addClass(i,"main-grid-cell main-grid-cell-center");const s=this.options.grid.getRows().getHeadFirstChild().getCells().length;main_core.Dom.attr(i,"colspan",s);const n=(()=>{if(main_core.Type.isPlainObject(t.content)){const e=[];if(main_core.Type.isStringFilled(t.content.title)){e.push(main_core.Tag.render(_t$1||(_t$1=_$1`
							<div class="main-grid-empty-block-title">
								${0}
							</div>
						`),t.content.title))}if(main_core.Type.isStringFilled(t.content.description)){e.push(main_core.Tag.render(_t2$1||(_t2$1=_$1`
							<div class="main-grid-empty-block-description">
								${0}
							</div>
						`),t.content.description))}return e}if(main_core.Type.isStringFilled(t.content)||main_core.Type.isDomNode(t.content)){return t.content}return[main_core.Tag.render(_t3||(_t3=_$1`<div class="main-grid-empty-image"></div>`)),main_core.Tag.render(_t4||(_t4=_$1`<div class="main-grid-empty-text">${0}</div>`),this.options.grid.getParam("EMPTY_STUB_TEXT"))]})();const o=main_core.Tag.render(_t5||(_t5=_$1`
			<div class="main-grid-empty-block">
				<div class="main-grid-empty-inner">
					${0}
				</div>
			</div>
		`),n);main_core.Dom.append(o,i);main_core.Dom.append(i,e);const a=this.options.grid.getBody().querySelector(".main-grid-row-empty");if(a){main_core.Dom.remove(a)}main_core.Dom.append(e,this.options.grid.getBody());this.options.grid.getRows().getBodyChild().forEach((t=>{t.hide()}));this.options.grid.adjustEmptyTable(this.options.grid.getRows().getSourceBodyChild())}}const namespace$4=main_core.Reflection.namespace("BX.Grid");namespace$4.Realtime=Realtime;(function(){BX.namespace("BX.Grid");BX.Grid.Resize=function(t){this.parent=null;this.lastRegisterButtons=null;this.init(t)};BX.Grid.Resize.prototype={init(t){this.parent=t;BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));this.registerTableButtons();this.registerPinnedTableButtons()},destroy(){BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.forEach(jsDD.unregisterObject);(this.getButtons()||[]).forEach(jsDD.unregisterObject)},registerTableButtons(){(this.getButtons()||[]).forEach(this.register,this);this.registerPinnedTableButtons()},register(t){if(BX.type.isDomNode(t)){t.onbxdragstart=BX.delegate(this._onDragStart,this);t.onbxdragstop=BX.delegate(this._onDragEnd,this);t.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(t)}},registerPinnedTableButtons(){if(this.parent.getParam("ALLOW_PIN_HEADER")){const t=this.getPinnedTableButtons();if(BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.length>0){this.lastRegisterButtons.forEach(jsDD.unregisterObject)}this.lastRegisterButtons=t;(this.getPinnedTableButtons()||[]).forEach(this.register,this)}},getButtons(){return BX.Grid.Utils.getByClass(this.parent.getRows().getHeadFirstChild().getNode(),this.parent.settings.get("classResizeButton"))},getPinnedTableButtons(){return BX.Grid.Utils.getByClass(this.parent.getPinHeader().getFixedTable(),this.parent.settings.get("classResizeButton"))},_onDragStart(){const t=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")});const e=this.parent.getRows().getHeadFirstChild().getCells();const i=Object.keys(e);let s;this.__overlay=BX.create("div",{props:{className:"main-grid-cell-overlay"}});BX.append(this.__overlay,t);this.__resizeCell=t.cellIndex;i.forEach((t=>{if(!BX.hasClass(e[t],"main-grid-special-empty")){let i=BX.width(e[t]);if(t>0){i-=parseInt(BX.style(e[t],"border-left-width"));i-=parseInt(BX.style(e[t],"border-right-width"))}BX.width(e[t],i);s=BX.firstChild(e[t]);BX.width(s,i)}}))},_onDrag(t){const e=this.parent.getTable();const i=this.parent.getParam("ALLOW_PIN_HEADER")?this.parent.getPinHeader().getFixedTable():null;const s=e.rows[0].cells[this.__resizeCell];let n;let o;const a=BX.pos(s);const r=parseFloat(s.style.width);let l;t-=a.left;l=t;if(a.width>r){t=a.width}t=l>t?l:t;t=Math.max(t,80);if(t!==a.width){const e=this.parent.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;let s=this.parent.getColumnByIndex(this.__resizeCell-e);s.forEach((e=>{e.style.width=`${t}px`;e.style.minWidth=`${t}px`;e.style.maxWidth=`${t}px`;BX.Dom.style(e.firstElementChild,"width",`${t}px`)}));if(s[0].classList.contains("main-grid-fixed-column")){s=this.parent.getColumnByIndex(this.__resizeCell-e+1);s.forEach((e=>{e.style.width=`${t}px`;e.style.minWidth=`${t}px`;e.style.maxWidth=`${t}px`}))}this.parent.adjustFixedColumnsPosition();this.parent.adjustFadePosition(this.parent.getFadeOffset());if(BX.type.isDomNode(i)&&BX.type.isDomNode(i.rows[0])){n=i.rows[0].cells[this.__resizeCell];o=BX.firstChild(n);o.style.width=`${t}px`;o.style.minWidth=`${t}px`;n.style.width=`${t}px`;n.style.minWidth=`${t}px`}}BX.onCustomEvent(window,"Grid::columnResize",[])},_onDragEnd(){this.saveSizes();const t=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")});const e=t.querySelector(".main-grid-cell-overlay");if(e){BX.Dom.remove(e)}},getColumnSizes(){const t=this.parent.getRows().getHeadFirstChild().getCells();const e={};let i;[].forEach.call(t,(t=>{i=BX.data(t,"name");if(BX.type.isNotEmptyString(i)){e[i]=BX.width(t)}}),this);return e},saveSizes(){this.parent.getUserOptions().setColumnSizes(this.getColumnSizes(),1)}}})();let _$2=t=>t,_t$2,_t2$2,_t3$1,_t4$1,_t5$1,_t6,_t7,_t8,_t9,_t10,_t11,_t12,_t13,_t14,_t15,_t16;(function(){BX.namespace("BX.Grid");BX.Grid.Row=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.depth=null;this.parentId=null;this.editData=null;this.custom=null;this.onElementClick=this.onElementClick.bind(this);this.init(t,e);this.initElementsEvents()};BX.Grid.Row.prototype={init(t,e){if(BX.type.isDomNode(e)){this.node=e;this.parent=t;this.settings=new BX.Grid.Settings;this.bindNodes=[];if(this.isBodyChild()){this.bindNodes=[].slice.call(this.node.parentNode.querySelectorAll(`tr[data-bind="${this.getId()}"]`));if(this.bindNodes.length>0){this.node.addEventListener("mouseover",this.onMouseOver.bind(this));this.node.addEventListener("mouseleave",this.onMouseLeave.bind(this));this.bindNodes.forEach((function(t){t.addEventListener("mouseover",this.onMouseOver.bind(this));t.addEventListener("mouseleave",this.onMouseLeave.bind(this));t.addEventListener("click",(()=>{if(this.isSelected()){this.unselect()}else{this.select()}}))}),this)}}if(this.parent.getParam("ALLOW_CONTEXT_MENU")){BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this))}}},onMouseOver(){this.node.classList.add("main-grid-row-over");this.bindNodes.forEach((t=>{t.classList.add("main-grid-row-over")}))},onMouseLeave(){this.node.classList.remove("main-grid-row-over");this.bindNodes.forEach((t=>{t.classList.remove("main-grid-row-over")}))},isCustom(){if(this.custom===null){this.custom=BX.hasClass(this.getNode(),this.parent.settings.get("classRowCustom"))}return this.custom},_onRightClick(t){t.preventDefault();if(!this.isHeadChild()){this.showActionsMenu(t)}},getDefaultAction(){return BX.data(this.getNode(),"default-action")},getEditorValue(){const t=this;const e=this.getCells();const i={};let s;[].forEach.call(e,(e=>{s=t.getCellEditorValue(e);if(BX.type.isArray(s)){s.forEach((t=>{i[t.NAME]=t.VALUE===undefined?"":t.VALUE;if(t.hasOwnProperty("RAW_NAME")&&t.hasOwnProperty("RAW_VALUE")){i[`${t.NAME}_custom`]=i[`${t.NAME}_custom`]||{};i[`${t.NAME}_custom`][t.RAW_NAME]=i[`${t.NAME}_custom`][t.RAW_NAME]||t.RAW_VALUE}}))}else if(s){i[s.NAME]=s.VALUE===undefined?"":s.VALUE}}));return i},editGetValues(){return this.getEditorValue()},getCellEditorValue(t){const e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditor"),true);let i=null;if(BX.type.isDomNode(e)){if(BX.hasClass(e,"main-grid-editor-checkbox")){i={NAME:e.getAttribute("name"),VALUE:e.checked?"Y":"N"}}else if(BX.hasClass(e,"main-grid-editor-custom")){i=this.getCustomValue(e)}else if(BX.hasClass(e,"main-grid-editor-money")){i=this.getMoneyValue(e)}else if(BX.hasClass(e,"main-ui-multi-select")){i=this.getMultiSelectValues(e)}else{i=this.getImageValue(e)}}return i},isEdit(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show(){BX.Dom.attr(this.getNode(),"hidden",null);BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},isNotCount(){return BX.hasClass(this.getNode(),this.parent.settings.get("classNotCount"))},getContentContainer(t){if(BX.Type.isDomNode(t)){const e=t.closest(".main-grid-cell");if(BX.Type.isDomNode(e)){return e.querySelector(".main-grid-cell-content")}}return t},getContent(t){const e=this.getContentContainer(t);let i;if(BX.type.isDomNode(e)){i=BX.html(e)}return i},getMoneyValue(t){const e=[];const i={PRICE:{},CURRENCY:{},HIDDEN:{}};const s=t.getAttribute("data-name");const n=[].slice.call(t.querySelectorAll("input"));n.forEach((t=>{e.push({NAME:s,RAW_NAME:t.name,RAW_VALUE:t.value||"",VALUE:t.value||""});if(t.classList.contains("main-grid-editor-money-price")){i.PRICE={NAME:t.name,VALUE:t.value}}else if(t.type===" hidden"){i.HIDDEN[t.name]=t.value}}));const o=t.querySelector(".main-grid-editor-dropdown");if(o){const t=o.getAttribute("name");if(BX.type.isNotEmptyString(t)){e.push({NAME:s,RAW_NAME:t,RAW_VALUE:o.dataset.value||"",VALUE:o.dataset.value||""});i.CURRENCY={NAME:t,VALUE:o.dataset.value}}}e.push({NAME:s,VALUE:i});return e},getCustomValue(t){const e=new Map;const i=t.getAttribute("data-name");const s=[].slice.call(t.querySelectorAll("input, select, textarea"));s.forEach((t=>{if(t.name===""){return}if(t.hasAttribute("data-ignore-field")){return}let s={NAME:i,RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value};switch(t.tagName){case"SELECT":if(t.multiple){const i=[];t.querySelectorAll("option").forEach((t=>{if(t.selected){i.push(t.value)}}));s.RAW_VALUE=i;s.VALUE=i;e.set(t.name,s)}else{e.set(t.name,s)}break;case"INPUT":switch(t.type.toUpperCase()){case"RADIO":if(t.checked){e.set(t.name,s)}break;case"CHECKBOX":if(t.checked){if(this.isMultipleCustomValue(t.name)){if(e.has(t.name)){s=e.get(t.name);s.RAW_VALUE.push(t.value);s.VALUE.push(t.value)}else{s.RAW_VALUE=[t.value];s.VALUE=[t.value]}}e.set(t.name,s)}break;case"FILE":s.RAW_VALUE=t.files[0];s.VALUE=t.files[0];e.set(t.name,s);break;default:if(this.isMultipleCustomValue(t.name)){if(e.has(t.name)){s=e.get(t.name);s.RAW_VALUE.push(t.value);s.VALUE.push(t.value)}else{s.RAW_VALUE=[t.value];s.VALUE=[t.value]}}e.set(t.name,s)}break;default:e.set(t.name,s);break}}));const n=[];e.forEach((t=>{n.push(t)}));return n},isMultipleCustomValue(t){return t.length>2&&t.lastIndexOf("[]")===t.length-2},getImageValue(t){let e=null;if(BX.hasClass(t,"main-grid-image-editor")){const i=t.querySelector(".main-grid-image-editor-file-input");if(i){e={NAME:i.name,VALUE:i.files[0]}}else{const i=t.querySelector(".main-grid-image-editor-fake-file-input");if(i){e={NAME:i.name,VALUE:i.value}}}}else if(t.value){e={NAME:t.getAttribute("name"),VALUE:t.value}}else{e={NAME:t.getAttribute("name"),VALUE:BX.data(t,"value")}}return e},getMultiSelectValues(t){const e=JSON.parse(BX.data(t,"value"));return{NAME:t.getAttribute("name"),VALUE:main_core.Type.isArrayFilled(e)?e:""}},getEditorContainer(t){return BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditorContainer"),true)},getCollapseButton(){if(!this.collapseButton){this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),true)}return this.collapseButton},stateLoad(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId(){if(this.parentId===null){this.parentId=BX.data(this.getNode(),"parent-id");if(typeof this.parentId!=="undefined"&&this.parentId!==null){this.parentId=this.parentId.toString()}}return this.parentId},getDataset(){return this.getNode().dataset},getDepth(){if(this.depth===null){this.depth=BX.data(this.getNode(),"depth")}return this.depth},setDepth(t){t=parseInt(t);if(BX.type.isNumber(t)){const e=t-parseInt(this.getDepth());const i=this.parent.getRows();this.getDataset().depth=t;this.getShiftCells().forEach((e=>{BX.data(e,"depth",t);BX.style(e,"padding-left",`${t*20}px`)}));i.getRowsByParentId(this.getId(),true).forEach((t=>{const i=parseInt(e)+parseInt(t.getDepth());t.getDataset().depth=i;t.getShiftCells().forEach((t=>{BX.data(t,"depth",i);BX.style(t,"padding-left",`${i*20}px`)}))}))}},setParentId(t){this.getDataset().parentId=t},getShiftCells(){return BX.Grid.Utils.getBySelector(this.getNode(),'td[data-shift="true"]')},showChildRows(){const t=this.getChildren();const e=this.isCustom();t.forEach((t=>{t.show();if(!e&&t.isExpand()){t.showChildRows()}}));this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},getChildren(){const t=this.isCustom()?"getRowsByGroupId":"getRowsByParentId";const e=this.isCustom()?this.getGroupId():this.getId();return this.parent.getRows()[t](e,true)},hideChildRows(){const t=this.getChildren();t.forEach((t=>{t.hide()}));this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},isChildsLoaded(){if(!BX.type.isBoolean(this.childsLoaded)){this.childsLoaded=this.isCustom()||BX.data(this.getNode(),"child-loaded")==="true"}return this.childsLoaded},expand(){const t=this;this.stateExpand();if(this.isChildsLoaded()){this.showChildRows()}else{this.stateLoad();this.loadChildRows((e=>{e.reverse().forEach((e=>{BX.insertAfter(e,t.getNode())}));t.parent.getRows().reset();t.parent.bindOnRowEvents();if(t.parent.getParam("ALLOW_ROWS_SORT")){t.parent.getRowsSortable().reinit()}if(t.parent.getParam("ALLOW_COLUMNS_SORT")){t.parent.getColsSortable().reinit()}t.stateUnload();BX.data(t.getNode(),"child-loaded","true");t.parent.updateCounterDisplayed();t.parent.updateCounterSelected();t.parent.adjustCheckAllCheckboxes()}))}},collapse(){this.stateCollapse();this.hideChildRows()},isExpand(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows(){if(this.isExpand()){this.collapse()}else{this.expand()}},loadChildRows(t){if(BX.type.isFunction(t)){const e=this;let i=parseInt(this.getDepth());const s=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");i=BX.type.isNumber(i)?i+1:1;this.parent.getData().request("","POST",{action:s,parent_id:this.getId(),depth:i},null,(function(){const i=this.getRowsByParentId(e.getId());t.apply(null,[i])}))}},update(t,e,i){t=t||"";const s=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW");const n=this.getDepth();const o=this.getId();const a=this.getParentId();const r={id:o,parentId:a,action:s,depth:n,data:t};const l=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,(function(){const e=this.getBodyRows();l.parent.getUpdater().updateBodyRows(e);l.stateUnload();l.parent.getRows().reset();l.parent.getUpdater().updateFootRows(this.getFootRows());l.parent.getUpdater().updatePagination(this.getPagination());l.parent.getUpdater().updateMoreButton(this.getMoreButton());l.parent.getUpdater().updateCounterTotal(this.getCounterTotal());l.parent.bindOnRowEvents();l.parent.adjustEmptyTable(e);l.parent.bindOnMoreButtonEvents();l.parent.bindOnClickPaginationLinks();l.parent.updateCounterDisplayed();l.parent.updateCounterSelected();if(l.parent.getParam("ALLOW_COLUMNS_SORT")){l.parent.colsSortable.reinit()}if(l.parent.getParam("ALLOW_ROWS_SORT")){l.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowUpdated",[{id:o,data:t,grid:l.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[l.parent]);if(BX.type.isFunction(i)){i({id:o,data:t,grid:l.parent,response:this})}}))},remove(t,e,i){t=t||"";const s=this.parent.getUserOptions().getAction("GRID_DELETE_ROW");const n=this.getDepth();const o=this.getId();const a=this.getParentId();const r={id:o,parentId:a,action:s,depth:n,data:t};const l=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,(function(){const e=this.getBodyRows();l.parent.getUpdater().updateBodyRows(e);l.stateUnload();l.parent.getRows().reset();l.parent.getUpdater().updateFootRows(this.getFootRows());l.parent.getUpdater().updatePagination(this.getPagination());l.parent.getUpdater().updateMoreButton(this.getMoreButton());l.parent.getUpdater().updateCounterTotal(this.getCounterTotal());l.parent.bindOnRowEvents();l.parent.adjustEmptyTable(e);l.parent.bindOnMoreButtonEvents();l.parent.bindOnClickPaginationLinks();l.parent.updateCounterDisplayed();l.parent.updateCounterSelected();if(l.parent.getParam("ALLOW_COLUMNS_SORT")){l.parent.colsSortable.reinit()}if(l.parent.getParam("ALLOW_ROWS_SORT")){l.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowRemoved",[{id:o,data:t,grid:l.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[l.parent]);if(BX.type.isFunction(i)){i({id:o,data:t,grid:l.parent,response:this})}}))},editCancel(){const t=this.getCells();const e=this;let i;[].forEach.call(t,(t=>{i=e.getEditorContainer(t);if(BX.type.isDomNode(i)){BX.remove(e.getEditorContainer(t));BX.show(e.getContentContainer(t))}}));BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex(t){return this.getCells()[t]},getEditDataByCellIndex(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex(t){return BX.data(this.getCellByIndex(t),"name")},resetEditData(){this.editData=null},setEditData(t){this.editData=t},getEditData(){if(this.editData===null){const t=this.parent.getParam("EDITABLE_DATA");const e=this.getId();if(BX.type.isPlainObject(t)&&e in t){this.editData=t[e]}else{this.editData={}}}return this.editData},getCellEditDataByCellIndex(t){const e=this.getEditData();let i=null;t=parseInt(t);if(BX.type.isNumber(t)&&BX.type.isPlainObject(e)){const s=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(t);if(BX.type.isPlainObject(s)){i=s;i.VALUE=e[s.NAME]}}return i},edit(){const t=this.getCells();const e=this;let i;let s;let n;let o;[].forEach.call(t,((t,a)=>{if(t.dataset.editable==="true"){try{i=e.getCellEditDataByCellIndex(a)}catch(t){throw new Error(t)}if(e.parent.getEditor().validateEditObject(i)){o=e.getContentContainer(t);n=BX.height(o);s=e.parent.getEditor().getEditor(i,n);if(!e.getEditorContainer(t)&&BX.type.isDomNode(s)){t.appendChild(s);BX.hide(o)}}}}));BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable(t){if(t){BX.removeClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().register(this.getNode())}else{BX.addClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().unregister(this.getNode())}},isDraggable(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classDisableDrag"))},getNode(){return this.node},getIndex(){return this.getNode().rowIndex},getId(){return String(BX.data(this.getNode(),"id"))},getGroupId(){return BX.data(this.getNode(),"group-id").toString()},getObserver(){return BX.Grid.observer},getCheckbox(){if(!this.checkbox){this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),true)}return this.checkbox},hasActionsButton(){return BX.Type.isDomNode(this.getActionsButton())},getActionsMenu(){if(!this.actionsMenu&&this.hasActionsButton()){const t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create(`main-grid-actions-menu-${this.getId()}`,this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:BX.delegate(this._onPopupShow,this)}});BX.addCustomEvent("Grid::updated",(()=>{if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}}));BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate((function(t){const e=this.getActionsMenu();if(e){const i=BX.getEventTarget(t);const s=BX.findParent(i,{className:"menu-popup-item"},10);if(!s||!s.dataset.preventCloseContextMenu){e.close()}}}),this))}return this.actionsMenu},_onCloseMenu(){},_onPopupShow(t){t.setBindElement(this.getActionsButton())},actionsMenuIsShown(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu(t){BX.fireEvent(document.body,"click");this.getActionsMenu().popupWindow.show();if(t){this.getActionsMenu().popupWindow.popupContainer.style.top=`${t.pageY-25+BX.PopupWindow.getOption("offsetTop")}px`;this.getActionsMenu().popupWindow.popupContainer.style.left=`${t.pageX+20+BX.PopupWindow.getOption("offsetLeft")}px`}},closeActionsMenu(){if(this.actionsMenu&&this.actionsMenu.popupWindow){this.actionsMenu.popupWindow.close()}},getMenuItems(){return this.getActions()||[]},getActions(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch{this.actions=null}return this.actions},getActionsButton(){if(!this.actionsButton){this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),true)}return this.actionsButton},initSelect(){if(this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))}},getParentNode(){let t;try{t=this.getNode().parentNode}catch{t=null}return t},getParentNodeName(){let t;try{t=this.getParentNode().nodeName}catch{t=null}return t},isSelectable(){return!this.isEdit()||this.parent.getParam("ALLOW_EDIT_SELECTION")},select(){let t;if(this.isSelectable()&&(this.parent.getParam("ADVANCED_EDIT_MODE")||!this.parent.getRows().hasEditable())){t=this.getCheckbox();if(t&&!BX.data(t,"disabled")){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach((function(t){BX.addClass(t,this.settings.get("classCheckedRow"))}),this);t.checked=true}}},unselect(){if(this.isSelectable()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach((function(t){BX.removeClass(t,this.settings.get("classCheckedRow"))}),this);if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells(){return this.getNode().cells},isSelected(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))},prependTo(t){BX.Dom.prepend(this.getNode(),t)},appendTo(t){BX.Dom.append(this.getNode(),t)},setId(t){BX.Dom.attr(this.getNode(),"data-id",t)},setActions(t){const e=this.getNode().querySelector(".main-grid-cell-action");if(e){let i=e.querySelector(".main-grid-row-action-button");if(!i){i=BX.Dom.create({tag:"div",props:{className:"main-grid-row-action-button"}});const t=this.getContentContainer(e);BX.Dom.append(i,t)}BX.Dom.attr(i,{href:"#","data-actions":t});this.actions=t;if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}}},makeCountable(){BX.Dom.removeClass(this.getNode(),"main-grid-not-count")},makeNotCountable(){BX.Dom.addClass(this.getNode(),"main-grid-not-count")},getColumnOptions(t){const e=this.parent.getParam("COLUMNS_ALL");if(BX.Type.isPlainObject(e)&&Reflect.has(e,t)){return e[t]}return null},setCellsContent(t){const e=this.parent.getRows().getHeadFirstChild();[...this.getCells()].forEach(((i,s)=>{const n=e.getCellNameByCellIndex(s);if(Reflect.has(t,n)){const e=this.getColumnOptions(n);const s=this.getContentContainer(i);const o=t[n];if(e.type==="labels"&&BX.Type.isArray(o)){const t=o.map((t=>{const e=BX.Tag.render(_t$2||(_t$2=_$2`
								<span class="ui-label ${0}"></span>
							`),t.color);if(t.light!==true){BX.Dom.addClass(e,"ui-label-fill")}if(BX.Type.isPlainObject(t.events)){if(Reflect.has(t.events,"click")){BX.Dom.addClass(e,"ui-label-link")}this.bindOnEvents(e,t.events)}const i=(()=>{if(BX.Type.isStringFilled(t.html)){return t.html}return t.text})();const s=BX.Tag.render(_t2$2||(_t2$2=_$2`
								<span class="ui-label-inner">${0}</span>
							`),i);BX.Dom.append(s,e);if(BX.Type.isPlainObject(t.removeButton)){const i=(()=>{if(t.removeButton.type===BX.Grid.Label.RemoveButtonType.INSIDE){return BX.Tag.render(_t3$1||(_t3$1=_$2`
											<span class="ui-label-icon"></span>
										`))}return BX.Tag.render(_t4$1||(_t4$1=_$2`
										<span class="main-grid-label-remove-button ${0}"></span>
									`),t.removeButton.type)})();if(BX.Type.isPlainObject(t.removeButton.events)){this.bindOnEvents(i,t.removeButton.events)}BX.Dom.append(i,e)}return e}));const e=BX.Tag.render(_t5$1||(_t5$1=_$2`
							<div class="main-grid-labels">${0}</div>
						`),t);BX.Dom.clean(s);const i=s.querySelector(".main-grid-labels");if(BX.Type.isDomNode(i)){BX.Dom.replace(i,e)}else{BX.Dom.append(e,s)}}else if(e.type==="tags"&&BX.Type.isPlainObject(o)){const t=o.items.map((t=>{const e=BX.Tag.render(_t6||(_t6=_$2`
								<span class="main-grid-tag"></span>
							`));this.bindOnEvents(e,t.events);if(t.active===true){BX.Dom.addClass(e,"main-grid-tag-active")}const i=(()=>{if(BX.Type.isStringFilled(t.html)){return t.html}return BX.Text.encode(t.text)})();const s=BX.Tag.render(_t7||(_t7=_$2`
								<span class="main-grid-tag-inner">${0}</span>
							`),i);BX.Dom.append(s,e);if(t.active===true){const i=BX.Tag.render(_t8||(_t8=_$2`
									<span class="main-grid-tag-remove"></span>
								`));BX.Dom.append(i,e);if(BX.Type.isPlainObject(t.removeButton)){this.bindOnEvents(i,t.removeButton.events)}}return e}));const e=BX.Tag.render(_t9||(_t9=_$2`
							<span class="main-grid-tags">${0}</span>
						`),t);const i=BX.Tag.render(_t10||(_t10=_$2`
							<span class="main-grid-tag-add"></span>
						`));if(BX.Type.isPlainObject(o.addButton)){this.bindOnEvents(i,o.addButton.events)}BX.Dom.append(i,e);const n=s.querySelector(".main-grid-tags");if(BX.Type.isDomNode(n)){BX.Dom.replace(n,e)}else{BX.Dom.append(e,s)}}else if(BX.Type.isDomNode(o)){BX.Dom.append(o,s)}else{BX.Runtime.html(s,o)}}}))},getCellById(t){const e=this.parent.getRows().getHeadFirstChild();return[...this.getCells()].find(((i,s)=>e.getCellNameByCellIndex(s)===t))},isTemplate(){return this.isBodyChild()&&/^template_\d$/.test(this.getId())},enableAbsolutePosition(){const t=[...this.parent.getRows().getHeadFirstChild().getCells()];const e=t.map((t=>BX.Dom.style(t,"width")));const i=this.getCells();e.forEach(((t,e)=>{BX.Dom.style(i[e],"width",t)}));BX.Dom.style(this.getNode(),"position","absolute")},disableAbsolutePosition(){BX.Dom.style(this.getNode(),"position",null)},getHeight(){return BX.Text.toNumber(BX.Dom.style(this.getNode(),"height"))},setCellActions(t){Object.entries(t).forEach((([t,e])=>{const i=this.getCellById(t);if(i){const t=i.querySelector(".main-grid-cell-inner");if(t){const i=(()=>{const e=t.querySelector(".main-grid-cell-content-actions");if(e){BX.Dom.clean(e);return e}const i=BX.Tag.render(_t11||(_t11=_$2`
								<div class="main-grid-cell-content-actions"></div>
							`));BX.Dom.append(i,t);return i})();if(BX.Type.isArrayFilled(e)){e.forEach((t=>{const e=(()=>{if(BX.Type.isArrayFilled(t.class)){return t.class.join(" ")}return t.class})();const s=BX.Tag.render(_t12||(_t12=_$2`
									<span class="main-grid-cell-content-action ${0}"></span>
								`),e);if(BX.Type.isPlainObject(t.events)){this.bindOnEvents(s,t.events)}if(BX.Type.isPlainObject(t.attributes)){BX.Dom.attr(s,t.attributes)}BX.Dom.append(s,i)}))}}}}))},initElementsEvents(){const buttons=[...this.getNode().querySelectorAll(".main-grid-cell [data-events]")];if(BX.Type.isArrayFilled(buttons)){buttons.forEach((button=>{const events=eval(BX.Dom.attr(button,"data-events"));if(BX.Type.isPlainObject(events)){BX.Dom.attr(button,"data-events",null);this.bindOnEvents(button,events)}}))}},onElementClick(t){t.stopPropagation()},bindOnEvents(button,events){if(BX.Type.isDomNode(button)&&BX.Type.isPlainObject(events)){BX.Event.bind(button,"click",this.onElementClick.bind(this));const target=(()=>{const t=BX.Dom.attr(button,"data-target");if(t){return button.closest(t)}return button})();const event=new BX.Event.BaseEvent({data:{button:button,target:target,row:this}});event.setTarget(target);Object.entries(events).forEach((([eventName,handler])=>{const preparedHandler=eval(handler);BX.Event.bind(button,eventName,preparedHandler.bind(null,event))}))}},setCounters(t){if(BX.Type.isPlainObject(t)){Object.entries(t).forEach((([t,e])=>{const i=this.getCellById(t);if(BX.Type.isDomNode(i)){const t=i.querySelector(".main-grid-cell-inner");const s=(()=>{const t=i.querySelector(".main-grid-cell-counter");if(BX.Type.isDomNode(t)){return t}return BX.Tag.render(_t13||(_t13=_$2`
								<span class="main-grid-cell-counter"></span>
							`))})();const n=(()=>{const t=s.querySelector(".ui-counter");if(BX.Type.isDomNode(t)){return t}const e=BX.Tag.render(_t14||(_t14=_$2`
								<span class="ui-counter"></span>
							`));BX.Dom.append(e,s);return e})();if(BX.Type.isPlainObject(e.events)){this.bindOnEvents(n,e.events)}const o=(()=>{const t=n.querySelector(".ui-counter-inner");if(BX.Type.isDomNode(t)){return t}const e=BX.Tag.render(_t15||(_t15=_$2`
								<span class="ui-counter-inner"></span>
							`));BX.Dom.append(e,n);return e})();if(e.isDouble){const t=(()=>{const t=n.querySelector(".ui-counter-secondary");if(BX.Type.isDomNode(t)){return t}const e=BX.Tag.render(_t16||(_t16=_$2`
									<span class="ui-counter-secondary"></span>
								`));BX.Dom.append(e,n);return e})();if(BX.Type.isStringFilled(e.secondaryColor)){Object.values(BX.Grid.Counters.Color).forEach((e=>{BX.Dom.removeClass(t,e)}));BX.Dom.addClass(t,e.secondaryColor)}}if(BX.Type.isStringFilled(e.type)){Object.values(BX.Grid.Counters.Type).forEach((t=>{BX.Dom.removeClass(s,`main-grid-cell-counter-${t}`)}));BX.Dom.addClass(s,`main-grid-cell-counter-${e.type}`)}if(BX.Type.isStringFilled(e.color)){Object.values(BX.Grid.Counters.Color).forEach((t=>{BX.Dom.removeClass(n,t)}));BX.Dom.addClass(n,e.color)}if(BX.Type.isStringFilled(e.size)){Object.values(BX.Grid.Counters.Size).forEach((t=>{BX.Dom.removeClass(n,t)}));BX.Dom.addClass(n,e.size)}if(BX.Type.isStringFilled(e.class)){BX.Dom.addClass(n,e.class)}if(BX.Type.isStringFilled(e.value)||BX.Type.isNumber(e.value)){const t=BX.Text.toNumber(o.innerText);const i=BX.Text.toNumber(e.value);if(i>0){if(i<100){o.innerText=e.value}else{o.innerText="99+"}if(e.animation!==false){if(i!==t){if(i>t){BX.Dom.addClass(o,"ui-counter-plus")}else{BX.Dom.addClass(o,"ui-counter-minus")}}BX.Event.bindOnce(o,"animationend",(t=>{if(t.animationName==="uiCounterPlus"||t.animationName==="uiCounterMinus"){BX.Dom.removeClass(o,["ui-counter-plus","ui-counter-minus"])}}))}}}if(BX.Text.toNumber(e.value)>0){const i=e.type===BX.Grid.Counters.Type.RIGHT?"right":"left";if(i==="left"){BX.Dom.prepend(s,t)}else if(i==="right"){BX.Dom.append(s,t)}}else{const t=`main-grid-cell-counter-${BX.Grid.Counters.Type.LEFT_ALIGNED}`;if(BX.Dom.hasClass(s,t)){BX.remove(n)}else{BX.remove(s)}}}}))}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Rows=function(t){this.parent=null;this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null;this.init(t)};BX.Grid.Rows.prototype={init:function(t){this.parent=t},reset:function(){this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null},enableDragAndDrop:function(){this.parent.arParams["ALLOW_ROWS_SORT"]=true;if(!(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable)){this.parent.rowsSortable=new BX.Grid.RowsSortable(this.parent)}},disableDragAndDrop:function(){this.parent.arParams["ALLOW_ROWS_SORT"]=false;if(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable){this.parent.getRowsSortable().destroy();this.parent.rowsSortable=null}},getFootLastChild:function(){return this.getLast(this.getFootChild())},getFootFirstChild:function(){return this.getFirst(this.getFootChild())},getBodyLastChild:function(){return this.getLast(this.getBodyChild())},getBodyFirstChild:function(){return this.getFirst(this.getBodyChild())},getHeadLastChild:function(){return this.getLast(this.getHeadChild())},getHeadFirstChild:function(){return this.getFirst(this.getHeadChild())},getEditSelectedValues:function(t){var e=this.getSelected(t);var i={};e.forEach((function(t){i[t.getId()]=t.editGetValues()}));return i},getSelectedIds:function(t){return this.getSelected(t).map((function(t){return t.getId()}))},initSelected:function(){var t=this.getSelected();if(BX.type.isArray(t)&&t.length){t.forEach((function(t){t.initSelect()}));this.parent.enableActionsPanel()}},editSelected:function(){this.getSelected().forEach((function(t){t.edit()}));BX.onCustomEvent(window,"Grid::thereEditedRows",[])},editSelectedCancel:function(t){this.getSelected(t).forEach((function(t){t.editCancel()}));BX.onCustomEvent(window,"Grid::noEditedRows",[])},isSelected:function(){return this.getBodyChild().some((function(t){return t.isShown()&&t.isSelected()}))},isAllSelected:function(){return!this.getBodyChild().filter((function(t){return!!t.getCheckbox()&&t.getCheckbox().disabled!==true})).some((function(t){return!t.isSelected()}))},getParent:function(){return this.parent},getCountSelected:function(){var t;try{t=this.getSelected().filter((function(t){return!t.isNotCount()&&t.isShown()})).length}catch(e){t=0}return t},getCountDisplayed:function(){var t;try{t=this.getBodyChild().filter((function(t){return t.isShown()&&!t.isNotCount()})).length}catch(e){t=0}return t},addRows:function(t){var e=BX.findChild(this.getParent().getTable(),{tag:"TBODY"},true,false);t.forEach((function(t){e.appendChild(t)}))},getRows:function(){var t;var e=this;if(!this.rows){t=[].slice.call(this.getParent().getTable().querySelectorAll("tr[data-id], thead > tr"));this.rows=t.map((function(t){return new BX.Grid.Row(e.parent,t)}))}return this.rows},getSelected:function(t){return this.getBodyChild(t).filter((function(t){return t.isShown()&&t.isSelected()}))},normalizeNode:function(t){if(!BX.hasClass(t,this.getParent().settings.get("classBodyRow"))){t=BX.findParent(t,{className:this.getParent().settings.get("classBodyRow")},true,false)}return t},getById:function(t){return this.getBodyChild().find((function(e){return String(e.getId())===String(t)}))||null},get:function(t){if(BX.Type.isDomNode(t)){const e=t.closest(".main-grid-row");if(BX.Type.isDomNode(e)){const t=this.getRows().find((t=>t.getNode()===e));if(t){return t}}}return null},getLast:function(t){var e;try{e=t[t.length-1]}catch(t){e=null}return e},getFirst:function(t){var e;try{e=t[0]}catch(t){e=null}return e},getHeadChild:function(){this.headChild=this.headChild||this.getRows().filter((function(t){return t.isHeadChild()}));return this.headChild},getBodyChild:function(t){return this.getRows().filter((function(e){return e.isBodyChild()&&(!e.isTemplate()||t)}))},getFootChild:function(){this.footChild=this.footChild||this.getRows().filter((function(t){return t.isFootChild()}));return this.footChild},selectAll:function(){this.getRows().map((function(t){t.isShown()&&t.select()}))},unselectAll:function(){this.getRows().map((function(t){t.unselect()}))},getByIndex:function(t){var e=this.getBodyChild().filter((function(t){return t})).filter((function(e){return e.getNode().rowIndex===t}));return e.length?e[0]:null},getRowsByParentId:function(t,e){var i=[];var s=this;if(!t){return i}t=t.toString();function n(t){s.getBodyChild().forEach((function(s){if(s.getParentId()===t){i.push(s);e&&n(s.getId())}}),s)}n(t);return i},getRowsByGroupId:function(t){var e=[];var i=this;if(!t){return e}t=t.toString();function s(t){i.getBodyChild().forEach((function(i){if(i.getGroupId()===t&&!i.isCustom()){e.push(i)}}),i)}s(t);return e},getExpandedRows:function(){return this.getRows().filter((function(t){return t.isShown()&&t.isExpand()}))},getIdsExpandedRows:function(){return this.getExpandedRows().map((function(t){return t.getId()}))},getIdsCollapsedGroups:function(){return this.getRows().filter((function(t){return t.isCustom()&&!t.isExpand()})).map((function(t){return t.getId()}))},getSourceRows:function(){return BX.Grid.Utils.getBySelector(this.getParent().getTable(),[".main-grid-header > tr",".main-grid-header + tbody > tr"].join(", "))},getSourceBodyChild:function(){return this.getSourceRows().filter((function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TBODY"}))},getSourceHeadChild:function(){return this.getSourceRows().filter((function(t){return BX.Grid.Utils.closestParent(t).nodeName==="THEAD"}))},getSourceFootChild:function(){return this.getSourceRows().filter((function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TFOOT"}))},hasEditable:function(){return this.getBodyChild().some((function(t){return t.isEdit()}))},insertAfter:function(t,e){const i=this.getById(t);const s=this.getById(e);if(i&&s){BX.Dom.insertAfter(i.getNode(),s.getNode());this.reset()}},insertBefore:function(t,e){const i=this.getById(t);const s=this.getById(e);if(i&&s){BX.Dom.insertBefore(i.getNode(),s.getNode());this.reset()}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.RowDragEvent=function(t){this.allowMoveRow=true;this.allowInsertBeforeTarget=true;this.dragItem=null;this.targetItem=null;this.eventName=t||"";this.errorMessage=""};BX.Grid.RowDragEvent.prototype={allowMove(){this.allowMoveRow=true;this.errorMessage=""},allowInsertBefore(){this.allowInsertBeforeTarget=true},disallowMove(t){this.allowMoveRow=false;this.errorMessage=t||""},disallowInsertBefore(){this.allowInsertBeforeTarget=false},getDragItem(){return this.dragItem},getTargetItem(){return this.targetItem},getEventName(){return this.eventName},setDragItem(t){return this.dragItem=t},setTargetItem(t){return this.targetItem=t},setEventName(t){return this.eventName=t},isAllowedMove(){return this.allowMoveRow},isAllowedInsertBefore(){return this.allowInsertBeforeTarget},getErrorMessage(){return this.errorMessage}};BX.Grid.RowsSortable=function(t){this.parent=null;this.list=null;this.setDefaultProps();this.init(t)};BX.Grid.RowsSortable.prototype={init(t){this.parent=t;this.list=this.getList();this.prepareListItems();jsDD.Enable();if(!this.inited){this.inited=true;this.onscrollDebounceHandler=BX.debounce(this._onWindowScroll,300,this);if(!this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",false)){BX.addCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.addCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))}document.addEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}))}},destroy(){if(!this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",false)){BX.removeCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.removeCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))}document.removeEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}));this.unregisterObjects()},_onWindowScroll(){this.windowScrollTop=BX.scrollTop(window);this.rowsRectList=null},disable(){this.unregisterObjects()},enable(){this.reinit()},reinit(){this.unregisterObjects();this.setDefaultProps();this.init(this.parent)},getList(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects(){this.list.forEach(this.unregister,this)},prepareListItems(){this.list.forEach(this.register,this)},register(t){const e=this.parent.getRows();const i=e.get(t);if(i&&i.isDraggable()){t.onbxdragstart=BX.delegate(this._onDragStart,this);t.onbxdrag=BX.delegate(this._onDrag,this);t.onbxdragstop=BX.delegate(this._onDragEnd,this);jsDD.registerObject(t)}},unregister(t){jsDD.unregisterObject(t)},getIndex(t){return BX.Grid.Utils.getIndex(this.list,t)},calcOffset(){let t=this.dragRect.height;if(this.additionalDragItems.length>0){this.additionalDragItems.forEach((e=>{t+=e.clientHeight}))}return t},getTheadCells(t){return[].map.call(t,((e,i)=>({block:"",tag:"th",attrs:{style:`width: ${BX.width(t[i])}px;`}})))},createFake(){const t=[];this.cloneDragItem=BX.clone(this.dragItem);this.cloneDragAdditionalDragItems=[];this.cloneDragAdditionalDragItemRows=[];const e=this.getTheadCells(this.dragItem.cells);t.push(this.cloneDragItem);this.additionalDragItems.forEach((function(e){const i=BX.clone(e);t.push(i);this.cloneDragAdditionalDragItems.push(i);this.cloneDragAdditionalDragItemRows.push(new BX.Grid.Row(this.parent,i))}),this);const i=BX.width(this.parent.getTable());this.fake=BX.decl({block:"main-grid-fake-container",attrs:{style:`position: absolute; top: ${this.getDragStartRect().top}px; width: ${i}px`},content:{block:"main-grid-table",mix:"main-grid-table-fake",tag:"table",attrs:{style:`width: ${i}px`},content:[{block:"main-grid-header",tag:"thead",content:{block:"main-grid-row-head",tag:"tr",content:e}},{block:"",tag:"tbody",content:t}]}});BX.insertAfter(this.fake,this.parent.getTable());this.cloneDragItem=new BX.Grid.Row(this.parent,this.cloneDragItem);return this.fake},getDragStartRect(){return BX.pos(this.dragItem,this.parent.getTable())},_onDragStart(){this.moved=false;this.dragItem=jsDD.current_node;this.targetItem=this.dragItem;this.additionalDragItems=this.getAdditionalDragItems(this.dragItem);this.dragIndex=this.getIndex(this.dragItem);this.dragRect=this.getRowRect(this.dragItem,this.dragIndex);this.offset=this.calcOffset();this.dragStartOffset=jsDD.start_y-this.dragRect.top;this.dragEvent=new BX.Grid.RowDragEvent;this.dragEvent.setEventName("BX.Main.grid:rowDragStart");this.dragEvent.setDragItem(this.dragItem);this.dragEvent.setTargetItem(this.targetItem);this.dragEvent.allowInsertBefore();const t=this.parent.getRows().get(this.dragItem);this.startDragDepth=t.getDepth();this.startDragParentId=t.getParentId();this.createFake();BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.addClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.onCustomEvent(window,"BX.Main.grid:rowDragStart",[this.dragEvent,this.parent])},getAdditionalDragItems(t){const e=this.parent.getRows();return e.getRowsByParentId(e.get(t).getId(),true).map((t=>t.getNode()))},moveRow(t,e,i){if(t){const s=BX.type.isNumber(i)?i:300;t.style.transition=`${s}ms`;t.style.transform=`translate3d(0px, ${e}px, 0px)`}},getDragOffset(){return jsDD.y-this.dragRect.top-this.dragStartOffset},getWindowScrollTop(){if(this.windowScrollTop===null){this.windowScrollTop=BX.scrollTop(window)}return this.windowScrollTop},getSortOffset(){return jsDD.y},getRowRect(t,e){if(!this.rowsRectList){this.rowsRectList={};this.list.forEach((function(t,e){this.rowsRectList[e]=t.getBoundingClientRect()}),this)}return this.rowsRectList[e]},getRowCenter(t,e){const i=this.getRowRect(t,e);return i.top+this.getWindowScrollTop()+i.height/2},isDragToBottom(t,e){const i=this.getRowCenter(t,e);const s=this.getSortOffset();return e>this.dragIndex&&i<s},isMovedToBottom(t){return t.style.transform===`translate3d(0px, ${-this.offset}px, 0px)`},isDragToTop(t,e){const i=this.getRowCenter(t,e);const s=this.getSortOffset();return e<this.dragIndex&&i>s},isMovedToTop(t){return t.style.transform===`translate3d(0px, ${this.offset}px, 0px)`},isDragToBack(t,e){const i=this.getRowCenter(t,e);const s=this.dragIndex;const n=jsDD.y;return e>s&&n<i||e<s&&n>i},isMoved(t){return t.style.transform!=="translate3d(0px, 0px, 0px)"&&t.style.transform!==""},_onDrag(){const t=0;const e=0;this.moveRow(this.dragItem,this.getDragOffset(),t);this.moveRow(this.fake,this.getDragOffset(),t);BX.Grid.Utils.styleForEach(this.additionalDragItems,{transition:`${t}ms`,transform:`translate3d(0px, ${this.getDragOffset()}px, 0px)`});this.list.forEach((function(t,i){if(Boolean(t)&&t!==this.dragItem&&!this.additionalDragItems.includes(t)){if(this.isDragToTop(t,i)&&!this.isMovedToTop(t)){this.targetItem=t;this.moveRow(t,this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=true;this.moved=true}if(this.isDragToBottom(t,i)&&!this.isMovedToBottom(t)){this.targetItem=this.findNextVisible(this.list,i);this.moveRow(t,-this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=false;if(this.targetItem){this.moved=true}}if(this.isDragToBack(t,i)&&this.isMoved(t)){this.moveRow(t,e);this.targetItem=t;if(this.isDragetToTop){this.targetItem=this.findNextVisible(this.list,i)}this.moved=true;this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem)}}}),this)},createError(t,e){const i=BX.decl({block:"main-grid-error",content:e||""});Boolean(t)&&t.appendChild(i);setTimeout((()=>{BX.addClass(i,"main-grid-error-show")}),0);return i},checkError(t){if(!t.isAllowedMove()&&!this.error){this.error=this.createError(this.fake,t.getErrorMessage())}if(t.isAllowedMove()&&this.error){BX.remove(this.error);this.error=null}},findNextVisible(t,e){let i=null;const s=this.parent.getRows();t.forEach(((t,n)=>{if(!i&&n>e){const e=s.get(t);if(e&&e.isShown()){i=t}}}));return i},updateProperties(t,e){const i=this.parent.getRows();const s=i.get(t);let n=0;let o=0;if(e){const t=i.get(e);n=t.getDepth();o=t.getParentId()}s.setDepth(n);s.setParentId(o);this.cloneDragItem.setDepth(n);this.cloneDragAdditionalDragItemRows.forEach((function(t,e){t.setDepth(BX.data(this.additionalDragItems[e],"depth"))}),this)},resetDragProperties(){const t=this.parent.getRows().get(this.dragItem);t.setDepth(this.startDragDepth);t.setParentId(this.startDragParentId)},_onDragOver(){},_onDragLeave(){},_onDragEnd(){BX.onCustomEvent(window,"BX.Main.grid:rowDragEnd",[this.dragEvent,this.parent]);BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.Grid.Utils.styleForEach(this.list,{transition:"",transform:""});if(this.dragEvent.isAllowedMove()){this.sortRows(this.dragItem,this.targetItem);this.sortAdditionalDragItems(this.dragItem,this.additionalDragItems);this.list=this.getList();this.parent.getRows().reset();const t=this.parent.getRows().get(this.dragItem);const e=this.parent.getRows().getBodyChild().map((t=>t.getId()));if(this.parent.getParam("ALLOW_ROWS_SORT_INSTANT_SAVE",true)){this.saveRowsSort(e)}BX.onCustomEvent(window,"Grid::rowMoved",[e,t,this.parent])}else{this.resetDragProperties()}BX.remove(this.fake);this.setDefaultProps()},sortAdditionalDragItems(t,e){e.reduce(((t,e)=>{Boolean(e)&&BX.insertAfter(e,t);return e}),t)},sortRows(t,e){if(e){e.parentNode.insertBefore(t,e)}else if(this.moved){t.parentNode.appendChild(t)}},saveRowsSort(t){const e={ids:t,action:this.parent.getUserOptions().getAction("GRID_SAVE_ROWS_SORT")};this.parent.getData().request(null,"POST",e)},setDefaultProps(){this.moved=false;this.dragItem=null;this.targetItem=null;this.dragRect=null;this.dragIndex=null;this.offset=null;this.realX=null;this.realY=null;this.dragStartOffset=null;this.windowScrollTop=null;this.rowsRectList=null;this.error=false}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Settings=function(){this.settings={};this.defaultSettings={classContainer:"main-grid",classWrapper:"main-grid-wrapper",classTable:"main-grid-table",classScrollContainer:"main-grid-container",classFadeContainer:"main-grid-fade",classFadeContainerRight:"main-grid-fade-right",classFadeContainerLeft:"main-grid-fade-left",classNavPanel:"main-grid-nav-panel",classActionPanel:"main-grid-action-panel",classCursor:"main-grid-cursor",classRowCustom:"main-grid-row-custom",classMoreButton:"main-grid-more-btn",classRow:"main-grid-row",classHeadRow:"main-grid-row-head",classBodyRow:"main-grid-row-body",classFootRow:"main-grid-row-foot",classDataRows:"main-grid-row-data",classPanels:"main-grid-bottom-panels",classCellHeadContainer:"main-grid-cell-head-container",classCellHeadOndrag:"main-grid-cell-head-ondrag",classEmptyRows:"main-grid-row-empty",classEmptyBlock:"main-grid-empty-block",classCheckAllCheckboxes:"main-grid-check-all",classCheckedRow:"main-grid-row-checked",classRowCheckbox:"main-grid-row-checkbox",classPagination:"main-grid-panel-cell-pagination",classActionCol:"main-grid-cell-action",classCounterDisplayed:"main-grid-counter-displayed",classCounterSelected:"main-grid-counter-selected",classCounterTotal:"main-grid-panel-total",classTableFade:"main-grid-table-fade",classDragActive:"main-grid-on-row-drag",classResizeButton:"main-grid-resize-button",classOnDrag:"main-grid-ondrag",classDisableDrag:"main-grid-row-drag-disabled",classPanelCellContent:"main-grid-panel-content",classCollapseButton:"main-grid-plus-button",classRowStateLoad:"main-grid-load-row",classRowStateExpand:"main-grid-row-expand",classHeaderSortable:"main-grid-col-sortable",classHeaderNoSortable:"main-grid-col-no-sortable",classCellStatic:"main-grid-cell-static",classHeadCell:"main-grid-cell-head",classPageSize:"main-grid-panel-select-pagesize",classGroupEditButton:"main-grid-control-panel-action-edit",classGroupDeleteButton:"main-grid-control-panel-action-remove",classGroupActionsDisabled:"main-grid-control-panel-action-icon-disable",classPanelButton:"ui-btn",classPanelApplyButton:"main-grid-control-panel-apply-button",classPanelCheckbox:"main-grid-panel-checkbox",classEditor:"main-grid-editor",classEditorContainer:"main-grid-editor-container",classEditorText:"main-grid-editor-text",classEditorDate:"main-grid-editor-date",classEditorNumber:"main-grid-editor-number",classEditorRange:"main-grid-editor-range",classEditorCheckbox:"main-grid-editor-checkbox",classEditorTextarea:"main-grid-editor-textarea",classEditorCustom:"main-grid-editor-custom",classEditorMoney:"main-grid-editor-money",classCellContainer:"main-grid-cell-content",classEditorOutput:"main-grid-editor-output",classSettingsWindow:"main-grid-settings-window",classSettingsWindowColumn:"main-grid-settings-window-list-item",classSettingsWindowColumnLabel:"main-grid-settings-window-list-item-label",classSettingsWindowColumnEditState:"main-grid-settings-window-list-item-edit",classSettingsWindowColumnEditInput:"main-grid-settings-window-list-item-edit-input",classSettingsWindowColumnEditButton:"main-grid-settings-window-list-item-edit-button",classSettingsWindowColumnCheckbox:"main-grid-settings-window-list-item-checkbox",classSettingsWindowShow:"main-grid-settings-window-show",classSettingsWindowSelectAll:"main-grid-settings-window-select-all",classSettingsWindowUnselectAll:"main-grid-settings-window-unselect-all",classSettingsWindowSearchSectionsWrapper:"main-grid-settings-window-search-section-wrapper",classSettingsWindowSearchActiveSectionIcon:"main-grid-settings-window-search-section-item-icon-active",classSettingsWindowSearchSectionInput:"main-grid-settings-window-search-section-input",classSettingsWindowSearchSectionItemHidden:"main-grid-settings-window-list-item-hidden",classSettingsWindowSearchSectionItemVisible:"main-grid-settings-window-list-item-visible",classSettingsButton:"main-grid-interface-settings-icon",classSettingsButtonActive:"main-grid-interface-settings-icon-active",classSettingsWindowClose:"main-grid-settings-window-actions-item-close",classSettingsWindowReset:"main-grid-settings-window-actions-item-reset",classSettingsWindowColumnChecked:"main-grid-settings-window-list-item-checked",classShowAnimation:"main-grid-show-popup-animation",classCloseAnimation:"main-grid-close-popup-animation",classLoader:"main-grid-loader-container",classLoaderShow:"main-grid-show-loader",classLoaderHide:"main-grid-hide-loader",classRowError:"main-grid-error",loaderHideAnimationName:"hideLoader",classHide:"main-grid-hide",classEar:"main-grid-ear",classEarLeft:"main-grid-ear-left",classEarRight:"main-grid-ear-right",classNotCount:"main-grid-not-count",classCounter:"main-grid-panel-counter",classForAllCounterEnabled:"main-grid-panel-counter-for-all-enable",classLoad:"load",classRowActionButton:"main-grid-row-action-button",classDropdown:"main-dropdown",classPanelControl:"main-grid-panel-control",classPanelControlContainer:"main-grid-panel-control-container",classForAllCheckbox:"main-grid-for-all-checkbox",classDisable:"main-grid-disable",dataActionsKey:"actions",updateActionMore:"more",classShow:"show",classGridShow:"main-grid-show",updateActionPagination:"pagination",updateActionSort:"sort",ajaxIdDataProp:"ajaxid",pageSizeId:"grid_page_size",sortableRows:true,sortableColumns:true,animationDuration:300};this.prepare()};BX.Grid.Settings.prototype={prepare(){this.settings=this.defaultSettings},getDefault(){return this.defaultSettings},get(t){let e;try{e=this.getDefault()[t]}catch{e=null}return e},getList(){return this.getDefault()}}})();const namespace$5=main_core.Reflection.namespace("BX.Grid.SettingsWindow");const SAVE_FOR_ALL="forAll";const SAVE_FOR_ME="forMe";class CheckboxList{constructor(t){this.params={};this.options={};this.stickyColumns=new Set;this.popup=null;this.popupItems=null;this.params=t;this.grid=t.grid;this.parent=t.parent;this.options=this.grid.arParams.CHECKBOX_LIST_OPTIONS;this.useSearch=Boolean(this.grid.arParams.ENABLE_FIELDS_SEARCH);this.useSectioning=main_core.Type.isArrayFilled(this.options.sections);this.isForAllValue=false}getPopup(){if(!this.popup){this.createPopup()}return this.popup}createPopup(){if(this.popup){return}const{useSearch:t,useSectioning:e,params:{title:i,placeholder:s,emptyStateTitle:n,emptyStateDescription:o,allSectionsDisabledTitle:a}}=this;const r={parentType:"grid"};this.popup=new ui_dialogs_checkboxList.CheckboxList({context:r,popupOptions:{width:1100},columnCount:4,lang:{title:i,placeholder:s,emptyStateTitle:n,emptyStateDescription:o,allSectionsDisabledTitle:a},sections:this.getSections(),categories:this.getCategories(),options:this.getOptions(),events:{onApply:t=>this.onApply(t),onDefault:t=>this.onDefault(t)},params:{useSearch:t,useSectioning:e,destroyPopupAfterClose:false,closeAfterApply:false,isEditableOptionsTitle:true},customFooterElements:this.getCustomFooterElements()})}getSections(){var t;const e=(t=this.options.sections)!=null?t:[];const i=[];e.forEach((t=>{const{id:e,name:s,selected:n}=t;i.push({key:e,title:s,value:n})}));return i}getCategories(){var t;const e=(t=this.options.categories)!=null?t:[];const i=[];if(e.length===0){this.getSections().forEach((t=>{const{key:e,title:s}=t;i.push({key:e,title:s,sectionKey:e})}));return i}e.forEach((t=>{const{title:e,sectionKey:s,key:n}=t;i.push({title:e,sectionKey:s,key:n})}));return i}getOptions(){var t,e,i,s;const n=this.options;const o=(t=n.columns)!=null?t:[];const a=(e=n.columnsWithSections)!=null?e:[];const r=[];const l=(i=(s=this.grid.getUserOptions().getCurrentOptions())==null?void 0:s.custom_names)!=null?i:{};if(this.useSectioning){for(const t in a){a[t].forEach((e=>{const{id:i,default:s}=e;let{name:n}=e;if(main_core.Type.isPlainObject(l)&&Object.hasOwn(l,"id")){n=l[i]}r.push({title:main_core.Text.decode(n),value:this.isChecked(i),categoryKey:t,defaultValue:s,id:i});this.prepareColumnParams(e)}))}return r}o.forEach((t=>{const{id:e,name:i,default:s}=t;r.push({title:main_core.Text.decode(i),value:this.isChecked(e),defaultValue:s,id:e});this.prepareColumnParams(t)}));return r}isChecked(t){var e;const i=(e=this.options.checked)!=null?e:[];return i.includes(t)}prepareColumnParams(t){const{sticked:e,id:i}=t;if(e){this.stickyColumns.add(i)}}getCustomFooterElements(){if(this.isAdmin()){const{arParams:t,containerId:e}=this.parent;return[{type:"textToggle",id:`${e}-${SAVE_FOR_ALL}`,title:t.SETTINGS_FOR_LABEL,dataItems:[{value:SAVE_FOR_ME,label:t.SETTINGS_FOR_FOR_ME_LABEL},{value:SAVE_FOR_ALL,label:t.SETTINGS_FOR_FOR_ALL_LABEL}],onClick:t=>{this.isForAllValue=t===SAVE_FOR_ALL}}]}return[]}show(){this.popup.show()}getStickedColumns(){const{ALLOW_STICKED_COLUMNS:t,HAS_STICKED_COLUMNS:e}=this.parent.arParams;if(t&&e){return this.stickyColumns.values()}return[]}onApply(t){const{fields:e,data:i}=t.data;if(this.isForAll()){const t={CONFIRM:true,CONFIRM_MESSAGE:this.grid.getParam("SETTINGS_FOR_ALL_CONFIRM_MESSAGE")};this.grid.confirmDialog(t,(()=>this.saveColumnsAndHidePopup(e,i)))}else{this.saveColumnsAndHidePopup(e,i)}}saveColumnsAndHidePopup(t,e){this.saveColumns(t,e);this.popup.hide()}prepareOrderedColumnsList(t){if(main_core.Type.isArray(t)){var e;const i=this.grid.getUserOptions().getCurrentOptions();const s=i==null?void 0:(e=i.columns)==null?void 0:e.split==null?void 0:e.split(",");if(main_core.Type.isArray(s)){const e=s.filter((e=>t.includes(e)));const i=t.filter((t=>!e.includes(t)));return[...e,...i]}}return t}saveColumns(t,e){const i=this.grid.getUserOptions();const s=this.getColumnNames(e);const n=this.getStickedColumns();const o=this.prepareOrderedColumnsList(t);const a=[{action:i.getAction("GRID_SET_COLUMNS"),columns:o.join(",")},{action:i.getAction("SET_CUSTOM_NAMES"),custom_names:s},{action:i.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:n}];if(this.isForAll()){a.push({action:i.getAction("GRID_SAVE_SETTINGS"),view_id:"default",set_default_settings:"Y",delete_user_settings:"Y"})}i.batch(a,(()=>this.grid.reloadTable()))}getColumnNames(t){var e;const i=this.options;const s=(e=i.columns)!=null?e:[];const n={};const{titles:o}=t;if(!main_core.Type.isObjectLike(o)){return{}}s.forEach((t=>{const e=t.id;if(main_core.Type.isStringFilled(o[e])&&o[e]!==t.name){n[e]=o[e]}else if(main_core.Type.isStringFilled(this.parent.arParams.DEFAULT_COLUMNS[e].name)&&this.parent.arParams.DEFAULT_COLUMNS[e].name!==t.name){n[e]=t.name}}));return n}onDefault(t){const e={CONFIRM:true,CONFIRM_MESSAGE:this.grid.arParams.CONFIRM_RESET_MESSAGE};this.grid.confirmDialog(e,(()=>{this.grid.getUserOptions().reset(this.isForAll(),(()=>{this.reset();this.grid.reloadTable(null,null,(()=>{this.popup.options.forEach((t=>{this.grid.gridSettings.select(t.id,t.defaultValue===true)}))}))}))}));t.preventDefault();return t}sortItems(){}reset(){this.options.checked=[];this.popup.options.filter((t=>t.defaultValue)).forEach((t=>{this.options.checked.push(t.id)}));this.close()}getSelectedColumns(){return this.getPopup().getSelectedOptions()}close(){var t;(t=this.popup)==null?void 0:t.destroy()}isForAll(){return this.isForAllValue}isAdmin(){var t;return Boolean((t=this.parent.arParams.IS_ADMIN)!=null?t:false)}getPopupItems(){return this.options.columns}getItems(){return this.getPopup().getOptions()}select(t,e=true){var i,s;if(((i=this.getPopup())==null?void 0:(s=i.selectOption)==null?void 0:s.length)===1&&e===false){return}this.getPopup().selectOption(t,e)}saveColumnsByNames(t,e){this.getItems().filter((e=>t.includes(e.id))).forEach((t=>this.select(t.id)));this.getPopup().apply();if(main_core.Type.isFunction(e)){e()}}}namespace$5.CheckboxList=CheckboxList;(function(){BX.namespace("BX.Grid.SettingsWindow");BX.Grid.SettingsWindow.Column=function(t,e){this.node=null;this.label=null;this.checkbox=null;this.editButton=null;this.settings=null;this.parent=null;this.default=null;this.defaultTitle=null;this.state=null;this.lastTitle=null;this.init(t,e)};BX.Grid.SettingsWindow.Column.inited={};BX.Grid.SettingsWindow.Column.prototype={init:function(t,e){this.parent=t;this.node=e;try{this.lastTitle=e.querySelector("label").innerText.trim()}catch(t){}this.updateState();if(!BX.Grid.SettingsWindow.Column.inited[this.getId()]){BX.Grid.SettingsWindow.Column.inited[this.getId()]=true;BX.bind(this.getEditButton(),"click",BX.proxy(this.onEditButtonClick,this));BX.bind(this.getStickyButton(),"click",BX.proxy(this.onStickyButtonClick,this))}},getStickyButton:function(){return this.node.querySelector(".main-grid-settings-window-list-item-sticky-button")},isSticked:function(){return this.node.classList.contains("main-grid-settings-window-list-item-sticked")},onStickyButtonClick:function(){if(this.isSticked()){this.unstick()}else{this.stick()}},stick:function(){this.node.classList.add("main-grid-settings-window-list-item-sticked")},unstick:function(){this.node.classList.remove("main-grid-settings-window-list-item-sticked")},onEditButtonClick:function(t){t.stopPropagation();this.isEditEnabled()?this.disableEdit():this.enableEdit()},setState:function(t){this.state=t},getState:function(){return this.state},updateState:function(){this.setState({selected:this.isSelected(),sticked:this.isSticked(),title:this.getTitle()})},restoreState:function(){var t=this.getState();t.selected?this.select():this.unselect();t.sticked?this.stick():this.unstick();this.setTitle(t.title)},getId:function(){return this.getNode().dataset.name},getTitle:function(){return this.getLabel().innerText},setTitle:function(t){this.getLabel().innerText=!!t&&t!=="undefined"?t:this.getDefaultTitle()},isEdited:function(){return this.getTitle()!==this.getDefaultTitle()},getSettings:function(){if(this.settings===null){var t=this.parent.getParam("DEFAULT_COLUMNS");this.settings=this.getId()in t?t[this.getId()]:{}}return this.settings},isDefault:function(){if(this.default===null){var t=this.getSettings();this.default="default"in t?t.default:false}return this.default},restore:function(){this.isDefault()?this.select():this.unselect();this.setTitle(this.getDefaultTitle());this.node.dataset.stickedDefault==="true"?this.stick():this.unstick();this.disableEdit();this.updateState()},getDefaultTitle:function(){if(this.defaultTitle===null){var t=this.getSettings();this.defaultTitle="name"in t?t.name:this.lastTitle}return this.defaultTitle},getNode:function(){return this.node},getLabel:function(){if(this.label===null){this.label=BX.Grid.Utils.getByTag(this.getNode(),"label",true);BX.Event.bind(this.label,"paste",this.onLabelPaste.bind(this));BX.Event.bind(this.label,"keydown",this.onLabelKeydown.bind(this))}return this.label},onLabelPaste:function(t){t.preventDefault();if(t.clipboardData&&t.clipboardData.getData){var e=t.clipboardData.getData("text/plain");var i=BX.Text.encode(e);var s=i.trim().replace(new RegExp("\t","g")," ").replace(new RegExp("\n","g")," ").replace(/ +(?= )/g,"");document.execCommand("insertHTML",false,s)}},onLabelKeydown:function(t){if(t.keyCode===13){t.preventDefault()}},getCheckbox:function(){if(this.checkbox===null){this.checkbox=BX.Grid.Utils.getBySelector(this.getNode(),'input[type="checkbox"]',true)}return this.checkbox},getEditButton:function(){if(this.editButton===null){this.editButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classSettingsWindowColumnEditButton"),true)}return this.editButton},enableEdit:function(){this.getLabel().contentEditable=true;this.getCheckbox().disabled=true;this.adjustCaret()},disableEdit:function(){this.getLabel().contentEditable=false;this.getCheckbox().disabled=false},isEditEnabled:function(){return this.getLabel().isContentEditable},isSelected:function(){return this.getCheckbox().checked},select:function(){this.getCheckbox().checked=true},unselect:function(){this.getCheckbox().checked=false},adjustCaret:function(){var t=document.createRange();var e=window.getSelection();var i=this.getLabel().innerText.length;var s=this.getLabel().childNodes;var n=s[s.length-1];t.setStart(n,i);t.setEnd(n,i);t.collapse(true);e.removeAllRanges();e.addRange(t);BX.fireEvent(this.getNode(),"focus")}}})();let _$3=t=>t,_t$3;(function(){BX.namespace("BX.Grid.SettingsWindow");BX.Grid.SettingsWindow.Manager=function(t){this.parent=null;this.fieldsSettingsInstance=null;this.init(t)};BX.Grid.SettingsWindow.Manager.prototype={init(t){this.parent=t;BX.bind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.addCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this))},destroy(){BX.unbind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.removeCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this));this.getPopup().close()},_onContainerClick(t){if(BX.hasClass(t.target,this.parent.settings.get("classSettingsButton"))){this._onSettingsButtonClick(t)}},_onSettingsButtonClick(){this.getFieldsSettingsInstance().then((t=>{this.fieldsSettingsInstance=t;this.fieldsSettingsInstance.show();BX.onCustomEvent(window,"BX.Grid.SettingsWindow:show",[this.fieldsSettingsInstance])}))},getFieldsSettingsInstance(){if(this.fieldsSettingsInstance){return Promise.resolve(this.fieldsSettingsInstance)}return new Promise((t=>{const e=this.createFieldsSettingsInstance();t(e)}))},createFieldsSettingsInstance(){let t=null;const{parent:e}=this;const i={grid:e,parent:e,isUseLazyLoadColumns:this.useLazyLoadColumns(),title:this.getPopupTitle(),placeholder:e.getParam("SETTINGS_FIELD_SEARCH_PLACEHOLDER"),emptyStateTitle:e.getParam("SETTINGS_FIELD_SEARCH_EMPTY_STATE_TITLE"),emptyStateDescription:e.getParam("SETTINGS_FIELD_SEARCH_EMPTY_STATE_DESCRIPTION"),allSectionsDisabledTitle:e.getParam("SETTINGS_FIELD_SEARCH_ALL_SECTIONS_DISABLED")};if(this.useCheckboxList()){t=new BX.Grid.SettingsWindow.CheckboxList(i)}else{t=new BX.Grid.SettingsWindow.Popup(i)}t.createPopup();BX.onCustomEvent(window,"BX.Grid.SettingsWindow:init",[t]);return t},useCheckboxList(){var t;return Boolean(this.parent.getParam("USE_CHECKBOX_LIST_FOR_SETTINGS_POPUP"))&&main_core.Type.isFunction((t=BX.UI)==null?void 0:t.CheckboxList)},useLazyLoadColumns(){return Boolean(this.parent.getParam("LAZY_LOAD"))},_onColumnMoved(){this.sortItems();this.reset()},sortItems(){this.getPopup().sortItems()},reset(){this.getPopup().reset()},getSelectedColumns(){return this.getPopup().getSelectedColumns()},getPopup(){if(this.fieldsSettingsInstance===null){this.fieldsSettingsInstance=this.createFieldsSettingsInstance()}return this.fieldsSettingsInstance},getPopupTitle(){const t=this.parent.getParam("SETTINGS_WINDOW_TITLE");const e=this.parent.getParam("SETTINGS_TITLE");const i=main_core.Tag.render(_t$3||(_t$3=_$3`<div></div>`));if(main_core.Type.isStringFilled(t)){i.innerHTML=`<span>${e} &laquo;${t}&raquo;</span>`;return i.firstChild.innerText}const s=BX.Main.gridManager.data.length;if(s===1){const t=t=>{const e=document.getElementById(t);return main_core.Type.isDomNode(e)&&main_core.Type.isStringFilled(e.innerText)?main_core.Text.encode(e.innerText):""};const s=t("pagetitle");const n=t("pagetitle_btn_wrapper");const o=`${s} ${n}`.trim();i.innerHTML=`<span>${e} &laquo;${o}&raquo;</span>`;return i.firstChild.innerText}return e},getShowedColumns(){const t=[];const e=this.parent.getRows().getHeadFirstChild().getCells();[].slice.call(e).forEach((e=>{if("name"in e.dataset){t.push(e.dataset.name)}}));return t},getItems(){return this.getPopup().getItems()},saveColumns(t,e){this.getPopup().saveColumnsByNames(t,e)},select(t,e=true){this.getPopup().select(t,e)}}})();let _$4=t=>t,_t$4,_t2$3;const namespace$6=main_core.Reflection.namespace("BX.Grid.SettingsWindow");class Popup{constructor(t){this.options={};this.items=null;this.popupItems=null;this.popup=null;this.filterSectionsSearchInput=null;this.filterSections=null;this.allColumns=null;this.applyButton=null;this.resetButton=null;this.cancelButton=null;this.selectAllButton=null;this.unselectAllButton=null;this.options=t;this.grid=t.grid;this.parent=t.parent}getPopup(){if(!this.popup){this.createPopup()}return this.popup}createPopup(){if(this.popup){return}const t=20;const e=20;const i=document.body.offsetWidth>1e3?1e3:document.body.offsetWidth-t-e;const{title:s}=this.options;this.popup=new main_popup.Popup(this.getPopupId(),null,{titleBar:s,autoHide:false,overlay:.6,width:i,closeIcon:true,closeByEsc:true,contentNoPaddings:true,content:this.getSourceContent(),events:{onPopupClose:this.onPopupClose.bind(this)}});this.getItems().forEach((t=>{main_core.Event.bind(t.getNode(),"click",this.onItemClick.bind(this));main_core.Event.bind(t.getNode(),"animationend",this.onAnimationEnd.bind(this,t.getNode()))}));main_core.Event.bind(this.getResetButton(),"click",this.onResetButtonClick.bind(this));main_core.Event.bind(this.getApplyButton(),"click",this.onApplyButtonClick.bind(this));main_core.Event.bind(this.getCancelButton(),"click",this.popup.close.bind(this.popup));main_core.Event.bind(this.getSelectAllButton(),"click",this.onSelectAll.bind(this));main_core.Event.bind(this.getUnselectAllButton(),"click",this.onUnselectAll.bind(this));if(main_core.Type.isObjectLike(this.grid.arParams.COLUMNS_ALL_WITH_SECTIONS)&&Object.keys(this.grid.arParams.COLUMNS_ALL_WITH_SECTIONS).length>0){this.prepareFilterSections()}if(this.grid.arParams.ENABLE_FIELDS_SEARCH){this.prepareFilterSectionsSearchInput()}}show(){this.popup.show()}close(){this.onPopupClose()}onPopupClose(){this.emitSaveEvent();this.restoreLastColumns();this.disableAllColumnsLabelEdit();this.adjustActionButtonsState()}emitSaveEvent(){main_core_events.EventEmitter.emit(window,"BX.Grid.SettingsWindow:close",[this,this.parent])}restoreLastColumns(){this.getItems().forEach((t=>t.restoreState()))}disableAllColumnsLabelEdit(){this.getItems().forEach((t=>t.disableEdit()))}getPopupId(){return`${this.grid.getContainerId()}-grid-settings-window`}getSourceContent(){const t=this.grid.settings.get("classSettingsWindow");const e=this.grid.getContainer().querySelector(`.${t}`);if(!this.options.isUseLazyLoadColumns){return e}const i=e.querySelector(".main-grid-settings-window-list");i.innerHTML="";const s=new main_loader.Loader({target:i});void s.show();this.fetchColumns().then((t=>{t.forEach((t=>{this.prepareColumnOptions(t);main_core.Dom.append(this.createColumnElement(t),i)}));this.hideAndDestroyLoader();this.reset();this.getItems().forEach((t=>{main_core.Event.bind(t.getNode(),"click",this.onItemClick)}));const s=main_core.Tag.render(_t$4||(_t$4=_$4`
					<div class="main-grid-popup-window-buttons-wrapper"></div>
				`));main_core.Dom.append(e.querySelector(".popup-window-buttons"),s);requestAnimationFrame((()=>{main_core.Dom.style(s,{width:`${this.getPopupContainer().clientWidth}px`});main_core.Dom.append(s,this.getPopupContainer())}))})).catch((t=>{console.error(t)}));return e}fetchColumns(){const t=new BX.Promise;const e=this.grid.getParam("LAZY_LOAD");const i=this.grid.getId();if(main_core.Type.isPlainObject(e)){const{controller:s,GET_LIST:n}=e;if(main_core.Type.isNil(s)){ajax({url:n,method:"GET",dataType:"json",onsuccess:t.fulfill.bind(t)})}else{main_core.ajax.runAction(`${s}.getColumnsList`,{method:"GET",data:{gridId:i}}).then(t.fulfill.bind(t))}}return t}prepareColumnOptions(t){if(!main_core.Type.isPlainObject(t)){return}const e=this.grid.getUserOptions().getCurrentOptions().custom_names;if(main_core.Type.isPlainObject(e)&&t.id in e){t.name=e[t.id]}if(this.grid.getColumnHeaderCellByName(t.id)){t.selected=true}}createColumnElement(t){const e=`${t.id}-checkbox`;const i=t.selected?" checked":"";return main_core.Tag.render(_t2$3||(_t2$3=_$4`
			<div data-name=${0} class='main-grid-settings-window-list-item'>
				<input
					id='${0}'
					type='checkbox'
					class='main-grid-settings-window-list-item-checkbox${0})'
				>
				<label
					for='${0}'
					class='main-grid-settings-window-list-item-label'
				>
					${0}
				</label>
				<span class='main-grid-settings-window-list-item-edit-button'></span>
			</div>
		`),t.id,e,i,e,t.name)}hideAndDestroyLoader(t){void t.hide().then((()=>t.destroy()))}onItemClick(){this.adjustActionButtonsState()}onAnimationEnd(t){const e=main_core.Dom.hasClass(t,this.grid.settings.get("classSettingsWindowSearchSectionItemHidden"))?"none":"inline-block";main_core.Dom.style(t,{display:e})}adjustActionButtonsState(){if(this.getSelectedColumns().length>0){this.enableActions();return}this.disableActions()}getSelectedColumns(){const t=[];this.getItems().forEach((e=>{if(e.isSelected()){t.push(e.getId())}}));return t}getItems(){if(this.items===null){const{grid:t}=this;const e=this.getPopupItems();this.items=[...e].map((e=>new BX.Grid.SettingsWindow.Column(t,e)))}return this.items}getPopupItems(){if(!this.popupItems){const t=this.getPopupContentContainer();const e=this.grid.settings.get("classSettingsWindowColumn");this.popupItems=t.getElementsByClassName(e)}return this.popupItems}enableActions(){const t=this.getApplyButton();if(t){main_core.Dom.removeClass(t,this.grid.settings.get("classDisable"))}}prepareFilterSectionsSearchInput(){const t=this.getFilterSectionsSearchInput();main_core.Event.bind(t,"input",this.onFilterSectionSearchInput.bind(this));main_core.Event.bind(t.previousElementSibling,"click",this.onFilterSectionSearchInputClear.bind(this))}getFilterSectionsSearchInput(){if(!this.filterSectionsSearchInput){const t=this.grid.settings.get("classSettingsWindowSearchSectionInput");this.filterSectionsSearchInput=this.getPopupContentContainer().querySelector(`.${t}`)}return this.filterSectionsSearchInput}onFilterSectionSearchInput(){let t=this.filterSectionsSearchInput.value;if(t.length>0){t=t.toLowerCase()}this.items.forEach((e=>{const i=e.lastTitle.toLowerCase();const s=e.getNode();if(t.length>0&&!i.includes(t)){main_core.Dom.removeClass(s,this.grid.settings.get("classSettingsWindowSearchSectionItemVisible"));main_core.Dom.addClass(s,this.grid.settings.get("classSettingsWindowSearchSectionItemHidden"))}else{main_core.Dom.removeClass(s,this.grid.settings.get("classSettingsWindowSearchSectionItemHidden"));main_core.Dom.addClass(s,this.grid.settings.get("classSettingsWindowSearchSectionItemVisible"));main_core.Dom.style(s,{display:"inline-block"})}}))}onFilterSectionSearchInputClear(){this.filterSectionsSearchInput.value="";this.onFilterSectionSearchInput()}getResetButton(){if(this.resetButton===null){this.resetButton=document.getElementById(this.getResetButtonId())}return this.resetButton}getResetButtonId(){return`${this.grid.getContainerId()}-grid-settings-reset-button`}onResetButtonClick(){const t={CONFIRM:true,CONFIRM_MESSAGE:this.grid.arParams.CONFIRM_RESET_MESSAGE};this.grid.confirmDialog(t,(()=>{this.enableWait(this.getApplyButton());this.grid.getUserOptions().reset(this.isForAll(),(()=>{this.grid.reloadTable(null,null,(()=>{this.restoreColumns();this.disableWait(this.getApplyButton());this.popup.close()}))}))}))}restoreColumns(){this.getItems().forEach((t=>t.restore()));this.sortItems();this.reset()}sortItems(){const t=this.getShowedColumns();const e={};this.getAllColumns().forEach((t=>{e[t]=t}));let i=0;Object.keys(e).forEach((s=>{if(this.isShowedColumn(s)){e[s]=t[i];i++}const n=this.getColumnByName(e[s]);if(n){main_core.Dom.append(n,n.parentNode)}}))}getShowedColumns(){return this.parent.gridSettings.getSelectedColumns()}getColumnByName(t){return BX.Grid.Utils.getBySelector(this.getPopupContainer(),`.${this.grid.settings.get("classSettingsWindowColumn")}[data-name="${t}"]`,true)}isShowedColumn(t){return this.getSelectedColumns().includes(t)}getAllColumns(){if(!this.allColumns){this.allColumns=this.getItems().map((t=>t.getId()))}return this.allColumns}reset(){this.popupItems=null;this.allColumns=null;this.items=null}getApplyButton(){if(this.applyButton===null){this.applyButton=document.getElementById(this.getApplyButtonId())}return this.applyButton}getApplyButtonId(){return`${this.grid.getContainerId()}-grid-settings-apply-button`}onApplyButtonClick(){const t={CONFIRM:this.isForAll(),CONFIRM_MESSAGE:this.grid.getParam("SETTINGS_FOR_ALL_CONFIRM_MESSAGE")};this.grid.confirmDialog(t,(()=>this.onApplyConfirmDialogButton()),(()=>this.unselectForAllCheckbox()))}onApplyConfirmDialogButton(){this.enableWait(this.getApplyButton());this.saveColumns(this.getSelectedColumns(),(()=>{this.popup.close();this.disableWait(this.getApplyButton());this.unselectForAllCheckbox()}));this.emitSaveEvent()}enableWait(t){main_core.Dom.addClass(t,"ui-btn-wait");main_core.Dom.removeClass(t,"popup-window-button")}disableWait(t){main_core.Dom.removeClass(t,"ui-btn-wait");main_core.Dom.addClass(t,"popup-window-button")}saveColumns(t,e){const i=this.grid.getUserOptions();const s=this.getColumnNames();const n=this.getStickedColumns();const o=[{action:i.getAction("GRID_SET_COLUMNS"),columns:t.join(",")},{action:i.getAction("SET_CUSTOM_NAMES"),custom_names:s},{action:i.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:n}];if(this.isForAll()){o.push({action:i.getAction("GRID_SAVE_SETTINGS"),view_id:"default",set_default_settings:"Y",delete_user_settings:"Y"})}i.batch(o,(()=>this.grid.reloadTable(null,null,e)));this.updateColumnsState()}getColumnNames(){const t={};this.getItems().forEach((e=>{if(e.isEdited()){t[e.getId()]=e.getTitle()}}));return t}getStickedColumns(){return this.getItems().reduce(((t,e)=>{if(e.isSticked()){t.push(e.getId())}return t}),[])}updateColumnsState(){this.getItems().forEach((t=>t.updateState()))}isForAll(){const t=this.getForAllCheckbox();return t&&Boolean(t.checked)}unselectForAllCheckbox(){const t=this.getForAllCheckbox();if(t){t.checked=null}}getForAllCheckbox(){return this.getPopupContainer().querySelector(".main-grid-settings-window-for-all-checkbox")}getPopupContainer(){return this.getPopup().getPopupContainer()}getPopupContentContainer(){return this.getPopup().getContentContainer()}getCancelButton(){if(this.cancelButton===null){this.cancelButton=document.getElementById(this.getCancelButtonId())}return this.cancelButton}getCancelButtonId(){return`${this.grid.getContainerId()}-grid-settings-cancel-button`}getSelectAllButton(){if(!this.selectAllButton){const t=this.grid.settings.get("classSettingsWindowSelectAll");this.selectAllButton=this.getPopupContentContainer().querySelector(`.${t}`)}return this.selectAllButton}onSelectAll(){this.selectAll();this.enableActions()}selectAll(){this.getItems().forEach((t=>t.select()))}getUnselectAllButton(){if(!this.unselectAllButton){const t=this.grid.settings.get("classSettingsWindowUnselectAll");this.unselectAllButton=this.getPopupContentContainer().querySelector(`.${t}`)}return this.unselectAllButton}onUnselectAll(){this.unselectAll();this.disableActions()}disableActions(){const t=this.getApplyButton();if(t){main_core.Dom.addClass(t,this.grid.settings.get("classDisable"))}}unselectAll(){this.getItems().forEach((t=>t.unselect()))}prepareFilterSections(){const t=this.getFilterSections();for(const e of t){main_core.Event.bind(e,"click",this.onFilterSectionClick.bind(this,e))}}getFilterSections(){if(!this.filterSections){var t;const e=this.grid.settings.get("classSettingsWindowSearchSectionsWrapper");const i=this.getPopupContentContainer().querySelector(`.${e}`);this.filterSections=(t=i.children)!=null?t:new HTMLCollection}return this.filterSections}onFilterSectionClick(t){var e;const i=this.grid.settings.get("classSettingsWindowSearchActiveSectionIcon");const s=(e=t.dataset)==null?void 0:e.uiGridFilterSectionButton;const n=document.querySelector(`[data-ui-grid-filter-section='${s}']`);if(main_core.Dom.hasClass(t.firstChild,i)){main_core.Dom.removeClass(t.firstChild,i);main_core.Dom.hide(n)}else{main_core.Dom.addClass(t.firstChild,i);main_core.Dom.show(n)}}select(t,e=true){const i=this.getItems().find((e=>e.getId()===t));if(e){i==null?void 0:i.select()}else{i==null?void 0:i.unselect()}}saveColumnsByNames(t,e){this.saveColumns(t,e)}}namespace$6.Popup=Popup;(function(){BX.namespace("BX.Grid");BX.Grid.UserOptions=function(t,e,i,s){this.options=null;this.actions=null;this.parent=null;this.url=null;this.init(t,e,i,s)};BX.Grid.UserOptions.prototype={init(parent,userOptions,userOptionsActions,url){this.url=url;this.parent=parent;try{this.options=eval(userOptions)}catch{console.warn("BX.Grid.UserOptions.init: Failed parse user options json string")}try{this.actions=eval(userOptionsActions)}catch{console.warn("BX.Grid.UserOptions.init: Failed parse user options actions json string")}},getCurrentViewName(){const t=this.getOptions();return"current_view"in t?t.current_view:null},getViewsList(){const t=this.getOptions();return"views"in t?t.views:{}},getCurrentOptions(){const t=this.getCurrentViewName();const e=this.getViewsList();let i=null;if(t in e){i=e[t]}if(!BX.type.isPlainObject(i)){i={}}return i},getUrl(t){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getContainerId(),bxajaxid:this.parent.getAjaxId(),action:t})},getOptions(){return this.options||{}},getActions(){return this.actions},getAction(t){let e=null;try{e=this.getActions()[t]}catch{e=null}return e},update(t){this.options=t},setColumns(t,e){const i=this.getCurrentOptions();if(BX.type.isPlainObject(i)){i.columns=t.join(",");this.save(this.getAction("GRID_SET_COLUMNS"),{columns:i.columns},e)}return this},setColumnsNames(t,e){const i={view_id:"default"};if(BX.type.isPlainObject(i)){i.custom_names=t;this.save(this.getAction("SET_CUSTOM_NAMES"),i,e)}return this},setColumnSizes(t,e){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:t,expand:e})},reset(t,e){let i={};if(t){i={view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()}}this.save(this.getAction("GRID_RESET"),i,e)},setSort(t,e,i){if(t&&e){this.save(this.getAction("GRID_SET_SORT"),{by:t,order:e},i)}return this},setPageSize(t,e){if(BX.type.isNumber(parseInt(t))){this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:t},e)}},setExpandedRows(t,e){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_EXPANDED_ROWS"),{ids:t},e)},setCollapsedGroups(t,e){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_COLLAPSED_GROUPS"),{ids:t},e)},resetExpandedRows(){this.save(this.getAction("GRID_RESET_EXPANDED_ROWS"),{})},saveForAll(t){this.save(this.getAction("GRID_SAVE_SETTINGS"),{view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()},t)},batch(t,e){this.save(this.getAction("GRID_SAVE_BATH"),{bath:t},e)},save(t,e,i){const s=this;BX.ajax.post(this.getUrl(t),e,(t=>{try{t=JSON.parse(t);if(!t.error){s.update(t);if(BX.type.isFunction(i)){i(t)}BX.onCustomEvent(s.parent.getContainer(),"Grid::optionsChanged",[s.parent])}}catch{}}))}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Utils={ajaxUrl(t,e){return this.addUrlParams(t,{bxajaxid:e})},addUrlParams(t,e){return BX.util.add_url_param(t,e)},arrayMove(t,e,i){if(i>=t.length){let e=i-t.length;while(e--+1){t.push(undefined)}}t.splice(i,0,t.splice(e,1)[0]);return t},getIndex(t,e){return[].indexOf.call(t||[],e)},getNext(t){if(t){return t.nextElementSibling||null}},getPrev(t){if(t){return t.previousElementSibling||null}},closestParent(t,e){if(t){if(!e){return t.parentNode||null}return BX.findParent(t,{className:e})}},closestChilds(t){if(t){return t.children||null}},collectionSort(t,e){let i;let s;let n;let o;let a;if(t&&e&&t!==e&&t.parentNode===e.parentNode){i=this.closestParent(e);s=this.closestChilds(i);n=s.length;o=this.getIndex(s,t);a=this.getIndex(s,e);if(n===a){i.appendChild(e)}if(o>a){i.insertBefore(t,e)}if(o<a&&n!==a){i.insertBefore(t,this.getNext(e))}}},getColumn(t,e){const i=this.getIndex(this.closestChilds(this.closestParent(e)),e);const s=[];[].forEach.call(t.rows,(t=>{s.push(t.cells[i])}));return s},styleForEach(t,e){e=BX.type.isPlainObject(e)?e:null;const i=Object.keys(e);[].forEach.call(t||[],(t=>{i.forEach((i=>{BX.style(t,i,e[i])}))}))},requestAnimationFrame(){const t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};t.apply(window,arguments)},getByClass(t,e,i){let s=[];if(e){s=t?t.getElementsByClassName(e):[];if(i){s=s.length>0?s[0]:null}else{s=[].slice.call(s)}}return s},getByTag(t,e,i){let s=[];if(e){s=t?t.getElementsByTagName(e):[];if(i){s=s.length>0?s[0]:null}else{s=[].slice.call(s)}}return s},getBySelector(t,e,i){let s=[];if(e){if(i){s=t?t.querySelector(e):null}else{s=t?t.querySelectorAll(e):[];s=[].slice.call(s)}}return s},listenerParams(t){try{window.addEventListener("test",null,t)}catch{t=false}return t}}})()})(this.window=this.window||{},BX.UI,BX.UI,BX,BX.Event,BX,BX.Main);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?17455640712527*/
; /* /bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1745564054580*/
; /* /bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?174556408054031*/
; /* /bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js?17455640807131*/
; /* /bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?17455640801711*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?174556408060*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?174556396763408*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1745563967575*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?17455640803754*/
; /* /bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?17455640807131*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1745563967189470*/
; /* /bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?17455640801339*/
; /* /bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js?174556408119966*/
; /* /bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17455640301655*/
; /* /bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js?17455640803916*/
; /* /bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?174556408114970*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?1745563967192574*/

//# sourceMappingURL=page_278781d483019f0959ed8d312dd29dff.map.js