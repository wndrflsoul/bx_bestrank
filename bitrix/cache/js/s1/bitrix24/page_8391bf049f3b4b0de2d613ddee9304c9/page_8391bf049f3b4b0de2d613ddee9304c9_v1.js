
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?174556396763408";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeparator="main-buttons-submenu-delimiter";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="--over";this.classMenuShown="--menu-shown";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="--locked";this.classExtraItemLink="";this.classExtraItemText="";this.classExtraItemIcon="";this.classExtraItemCounter="";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classDefaultSubmenuDelimimeter="popup-window-delimiter-section";this.classInner="main-buttons-inner-container";this.listContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.enableItemMouseEnter=true;this.menuShowTimeout=null;this.isMoreMenuShown=false;this.onDragStarted=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.isEditEnabledState=false;this.theme=BX.Type.isStringFilled(e.theme)?e.theme:"default";this.maxItemLength=BX.Type.isNumber(e.maxItemLength)&&e.maxItemLength>6?e.maxItemLength:20;this.tmp={};this.itemData=new WeakMap;this.handleMoreMenuItemMouseEnter=this.handleMoreMenuItemMouseEnter.bind(this);this.init(t,e);return{addMenuItem:this.addMenuItem.bind(this),deleteMenuItem:this.deleteMenuItem.bind(this),updateMenuItemText:this.updateMenuItemText.bind(this),getItemById:this.getItemById.bind(this),getAllItems:this.getAllItems.bind(this),getHiddenItems:this.getHiddenItems.bind(this),getVisibleItems:this.getVisibleItems.bind(this),getDisabledItems:this.getDisabledItems.bind(this),getMoreButton:this.getMoreButton.bind(this),adjustMoreButtonPosition:this.adjustMoreButtonPosition.bind(this),getItemData:this.getItemData.bind(this),getSubmenu:this.getMoreMenu.bind(this),showSubmenu:this.showMoreMenu.bind(this),closeSubmenu:this.closeMoreMenu.bind(this),refreshSubmenu:this.refreshMoreMenu.bind(this),getMoreMenu:this.getMoreMenu.bind(this),showMoreMenu:this.showMoreMenu.bind(this),closeMoreMenu:this.closeMoreMenu.bind(this),refreshMoreMenu:this.refreshMoreMenu.bind(this),getCurrentSettings:this.getCurrentSettings.bind(this),saveSettings:this.saveSettings.bind(this),updateCounter:this.updateCounter.bind(this),getActive:this.getActive.bind(this),isDisabled:this.isDisabled.bind(this),isVisibleItem:this.isVisibleItem.bind(this),isEditEnabled:this.isEditEnabled.bind(this),isActiveInMoreMenu:this.isActiveInMoreMenu.bind(this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,menuShown:this.classMenuShown,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.Type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.Type.isStringFilled(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.Type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.Type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.Type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.Type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};this.initItems();this.adjustMoreButtonPosition();this.bindEventsOnMoreButton();this.bindOnResize();BX.Event.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}const s=this.getHomeItem();if(s){const{url:t}=s;this.lastHomeLink=t}const i=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));i.forEach((function(t){const e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;const t=e.closest(".main-buttons-item-child-button-cloned");if(t){this.clonedChildButton=t}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))}),this)},calculateChildListWidth:function(){if(this.realChildButton){const t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");const e=10;return Array.from(t).reduce((function(t,e){const s=BX.Text.toNumber(BX.Dom.style(e,"width"));const i=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));const n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+s+i+n}),e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}const e=this.realChildButton.querySelector(".main-buttons-item-child-list");this.enableItemMouseEnter=false;setTimeout((()=>{this.enableItemMouseEnter=true}),200);const s=BX.Dom.attr(this.realChildButton,"data-child-items");const i=BX.Dom.attr(this.realChildButton,"data-is-opened");let n={};if(i){BX.Dom.attr(this.realChildButton,"data-is-opened",null);s.forEach((function(t){const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}}),this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);s.forEach((t=>{const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}}));setTimeout((()=>{BX.Dom.style(e,"overflow","unset")}),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout((()=>{this._onResizeHandler()}),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);const e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout((()=>{BX.Dom.style(this.clonedChildButton,"transition",null)}),0)},_onDocumentClick:function(t){if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}let e=this.getItem(t);if(BX.Type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isEditButton(t.target)){this.handleEditButtonClick(t);return false}if(this.isSetHide(e)){const t=this.getVisibleItems();const e=BX.Type.isArray(t)?t.length:null;const s=this.editItemData.ID.replace(this.listContainer.id+"_","");let i=this.getItemById(s);const n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&e>2){this.disableItem(n)}if(e===1){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshMoreMenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){const t=this.editItemData.ID.replace(this.listContainer.id+"_","");const e=this.getItemById(t);const s=this.getItemAlias(e);if(this.isDisabled(s)){this.enableItem(s)}this.listContainer.insertBefore(e,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshMoreMenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(!this.isDragButton(t.target)&&!this.isEditButton(t.target)){const s=this.getItemData(e);let i=s["ON_CLICK"];if(this.isSublink(t.target)){i=BX.Type.isPlainObject(s["SUB_LINK"])?s["SUB_LINK"]["ON_CLICK"]:""}if(BX.Type.isStringFilled(i)){t.preventDefault();this.execScript(i,t)}}}if(this.isEditEnabled()&&this.getMoreMenu()){this.getMoreMenu().getPopupWindow().setAutoHide(false)}},isActiveInMoreMenu:function(){const t=this.getHiddenItems();const e=this.getDisabledItems();const s=t.concat(e);return s.some((function(t){const e=this.getItemData(t);return e["IS_ACTIVE"]===true}),this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){const t=e[BX.message("SITE_ID")];for(const e in t){if(t.hasOwnProperty(e)){this.updateCounter(e,t[e])}}}},getActive:function(){let t=this.getAllItemsData();let e=null;let s=null;while(BX.Type.isArrayFilled(t)){const i=t.shift();if(i["IS_ACTIVE"]===true){if(s===null){s=i}e=i;t=BX.Type.isArrayFilled(i["ITEMS"])?[...i["ITEMS"]]:null}}if(e!==null&&s!==null){const t=BX(s.ID);if(BX.Type.isDomNode(t)){e.NODE=t}else{e.NODE=null}}return e},isSetHome:function(t){return BX.Dom.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.Dom.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(false);BX.Dom.addClass(e.getPopupContainer(),this.classEditState)}BX.Dom.addClass(this.listContainer,this.classEditState);this.isEditEnabledState=true},disableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(true);BX.Dom.removeClass(e.getPopupContainer(),this.classEditState)}BX.Dom.removeClass(this.listContainer,this.classEditState);this.isEditEnabledState=false;this.destroyItemEditMenu()},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.Type.isPlainObject(t)&&"ID"in t){const s=[this.listContainer.id,"_edit_item"].join("");let i=BX.Main.MenuManager.getMenuById(s);if(i){BX.Main.MenuManager.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},destroyItemEditMenu:function(){const t=[this.listContainer.id,"_edit_item"].join("");const e=BX.Main.MenuManager.getMenuById(t);if(e){BX.Main.MenuManager.destroy(t)}},getContainer:function(){if(!BX.Type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode.parentNode}return this.container},getItemEditMenu:function(){return BX.Main.MenuManager.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){const i=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];const n=t["ID"].replace(this.listContainer.id+"_","");const o=this.getItemById(n);if(this.isDisabled(o)){i.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{i.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}if(t["IS_PINNED"]){const e=this.getParentItem(t["ID"]);i.push({text:this.message("MIB_UNPIN_ITEM").replace("#NAME#",e?e["TEXT"]:""),onclick:(e,s)=>{this.handleItemUnpin(t,o);s.getMenuWindow().close()}})}const a=BX.pos(s);const u={menuId:e,anchor:s,menuItems:i,settings:{autoHide:true,offsetTop:0,offsetLeft:a.width/2,zIndex:20,angle:{position:"top",offset:a.width/2}}};const r=BX.Main.MenuManager.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in r&&BX.Type.isArray(r.menuItems)){r.menuItems.forEach((function(t){BX.Event.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))}),this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[r,t,this]);this.editMenu=r;return r},prepareMenuItemData:function(t){const e={CLASS:"",CLASS_SUBMENU_ITEM:"",COUNTER:0,COUNTER_ID:t.counterId,DATA_ID:t.dataId,HAS_CHILD:false,HAS_MENU:false,HTML:"",ID:t.id,IS_ACTIVE:false,IS_DISABLED:"false",IS_LOCKED:false,IS_PASSIVE:false,MAX_COUNTER_SIZE:99,NODE:BX.Tag.render`<div id="${t.id}" class="main-buttons-item"></div>`,ON_CLICK:t.onClick,SUB_LINK:false,SUPER_TITLE:false,TEXT:t.text,TITLE:"",URL:t.url};return e},addMenuItem:function(t){const e=this.getCurrentSettings();const s=Object.keys(e);const i=this.prepareMenuItemData(t);const n=this.createRootItem(i);const o=this.getItemById(s[s.length-1]);BX.Dom.insertAfter(n,o);this.initItems()},deleteMenuItem:function(t){this.itemData.delete(t);BX.Dom.remove(t)},updateMenuItemText:function(t,e){if(!t||!e){return}const s=this.getItemData(t);s.TEXT=e;const i=this.getItemById(s.ID);const n="main-buttons-item-text-box";const o=BX.Buttons.Utils.getByClass(i,n);o.innerText=e},getHomeItem:function(){const t=this.getVisibleItems();const e=BX.Type.isArray(t)&&t.length>0?t[0]:null;if(!e){return null}const s=this.getItemData(e);const i=this.normalizeUrl(s["URL"]);if(this.canBeHomed(i,s)){return{itemData:s,url:i,firstVisibleItem:e}}if(BX.Type.isArrayFilled(s["ITEMS"])){for(let t=0;t<s["ITEMS"].length;t++){const i=s["ITEMS"][t];if(i["IS_PINNED"]||i["IS_DISBANDED"]||i["IS_DELIMITER"]){continue}const n=this.normalizeUrl(i["URL"]);if(this.canBeHomed(n,i)){return{itemData:i,url:n,firstVisibleItem:e}}}}return null},normalizeUrl:function(t){if(!BX.Type.isStringFilled(t)){return""}if(t.charAt(0)==="?"){const e=document.createElement("a");e.href=t;t=e.pathname+e.search}return t},canBeHomed:function(t,e){if(!BX.Type.isStringFilled(t)||BX.Type.isStringFilled(e["ON_CLICK"])){return false}if(BX.Reflection.getClass("BX.SidePanel.Instance")){const e=BX.SidePanel.Instance.getUrlRule(t);if(e){return false}}const s=new BX.Event.BaseEvent({data:{itemLink:t,itemData:e}});BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onBeforeFirstItemChange",s);return!s.isDefaultPrevented()},isEditButton:function(t){return BX.Dom.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.Dom.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){const t=this.getAllItems().map((function(t){const e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)}));return Math.max.apply(Math,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){let e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.Type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classMenuShown=t.menuShown||this.classMenuShown;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeparator=t.separator||this.classSeparator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked;this.classExtraItemLink=t.extraItemLink||this.classExtraItemLink;this.classExtraItemText=t.extraItemText||this.classExtraItemText;this.classExtraItemIcon=t.extraItemIcon||this.classExtraItemIcon;this.classExtraItemCounter=t.extraItemCounter||this.classExtraItemCounter},setMessages:function(t){if(!BX.Type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.Type.isStringFilled(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){let e=null;if(BX.Type.isStringFilled(t)){const s=t.startsWith(this.listContainer.id)?t:this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s.replaceAll(":","\\:"))}return e},getItemCounterObject:function(t){let e=null;if(BX.Type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}this.updateItemsByCounterId(this.getAllItemsData(),t,e);this.updateMoreButtonCounter()},updateItemsByCounterId:function(t,e,s,i=[]){for(let n=0;n<t.length;n++){const o=t[n];if(o["COUNTER_ID"]===e){o["COUNTER"]=Number(s);this.setCounterValueById(e,o["COUNTER"]);for(let t=i.length-1;t>=0;t--){const e=i[t];e["COUNTER"]=e["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(e["COUNTER_ID"],e["COUNTER"])}}if(o["ITEMS"]){this.updateItemsByCounterId(o["ITEMS"],e,s,[...i,o])}}},recalculateItemsCounters:function(t,e=[]){let s=0;for(let i=0;i<t.length;i++){const n=t[i];if(n["ITEMS"]){n["COUNTER"]=this.recalculateItemsCounters(n["ITEMS"],[...e,n])}const o=n["IS_PINNED"]===true;s+=BX.Type.isNumber(n["COUNTER"])&&!o?n["COUNTER"]:0}for(let t=e.length-1;t>=0;t--){const s=e[t];s["COUNTER"]=s["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(s["COUNTER_ID"],s["COUNTER"])}return s},setCounterValueById:function(t,e){if(!BX.Type.isStringFilled(t)){return}const s=e>99?"99+":e>0?e:"";const i=document.querySelectorAll(`[data-mib-counter-id="${t}"]`);Array.from(i).forEach((t=>{t.textContent=s}))},setMoreButtonCounter:function(t){const e=this.getItemCounterObject(this.moreButton);e.textContent=t>99?"99+":t>0?t:""},bindEventsOnMoreButton:function(){BX.Event.bind(this.moreButton,"click",this.handleMoreButtonClick.bind(this));BX.Event.bind(this.moreButton,"mouseenter",this.handleMoreButtonMouseEnter.bind(this));BX.Event.bind(this.moreButton,"mouseleave",this.handleMoreButtonMouseLeave.bind(this))},bindOnResize:function(){const t=BX.Runtime.throttle(this._onResizeHandler,100,this);const e=new ResizeObserver(t);e.observe(this.listContainer.closest(".main-buttons"));BX.Event.bind(window,"resize",t)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getAllItemsData:function(){return this.getAllItems().map((t=>this.getItemData(t)))},getVisibleItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getHiddenItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>!this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getDisabledItems:function(){return this.getAllItems().filter((t=>this.isDisabled(t)))},getMoreButton:function(){const t=this.getContainer().getElementsByClassName(this.classItemMore);return t[0]||null},getLastVisibleItem:function(){const t=this.getVisibleItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},getLastDisabledItem:function(){const t=this.getDisabledItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){this.updateMoreButtonCounter();this.getHiddenItems().forEach((t=>{BX.Dom.removeClass(t,"--hidden")}));this.getHiddenItems().forEach((t=>{BX.Dom.addClass(t,"--hidden")}));if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},getMoreMenuId:function(t){let e="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){let t="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getMenuItemText:function(t,e=null){const s=BX.Type.isElementNode(t)?this.getItemData(t):t;return BX.Tag.render`
				<span class="main-buttons-menu-popup-item">${[BX.Tag.render`<span class="${this.classItemIcon}"></span>`,this.createItemText(s),this.createItemCounter(s),e&&this.isEditEnabled()?this.createItemPin(s,e):""]}</span>
			`},createRootItem:function(t){let e=this.classItem;e+=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";if(t["IS_PASSIVE"]){e+=" --passive"}else if(t["IS_ACTIVE"]){if(BX.Type.isStringFilled(this.classItemActive)){e+=" "+this.classItemActive}else{e+=" main-buttons-item-active"}}if(t["HAS_MENU"]){e+=" --has-menu"}if(t["IS_LOCKED"]){e+=" --locked"}const s=BX.Tag.render`
				<div
					id="${t["ID"]}"
					class="${e}"
					data-disabled="${t["IS_DISABLED"]}"
					data-class="${t["CLASS_SUBMENU_ITEM"]}"
					data-id="${t["DATA_ID"]}"
					data-top-menu-id="${this.getId()}"
					title=""
				>${[this.createItemLink(t,true),BX.Type.isPlainObject(t["SUB_LINK"])?this.createItemSubLink(t["SUB_LINK"]):""]}</div>
			`;this.setItemData(s,t);return s},createItemLink:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};let s;const i=["main-buttons-item-link",this.classExtraItemLink].join(" ").trim();if(BX.Type.isStringFilled(t["URL"])){s=BX.Tag.render`<a class="${i}" href="${BX.Text.encode(t["URL"])}"></a>`}else{s=BX.Tag.render`<span class="${i}"></span>`}BX.Dom.append(this.createItemIcon(t),s);BX.Dom.append(this.createItemText(t,e),s);BX.Dom.append(this.createItemCounter(t),s);return s},createItemSubLink:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";const s=BX.Type.isStringFilled(t["URL"])?BX.Text.encode(t["URL"]):"";return BX.Tag.render`
				<a class="${this.classItemSublink}${e}" href="${s}"></a>
			`},createItemIcon:function(t){const e=[this.classItemIcon,this.classExtraItemIcon].join(" ").trim();return BX.Tag.render`<span class="${e}"></span>`},createItemText:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};const s=[this.classItemText,this.classExtraItemText].join(" ").trim();let i=BX.Type.isStringFilled(t["TEXT"])?t["TEXT"]:"";if(e&&i.length>this.maxItemLength){i=i.substring(0,this.maxItemLength-3)+"..."}let n="";if(BX.Type.isPlainObject(t["SUPER_TITLE"])){let{TEXT:e,CLASS:s,COLOR:i}=t["SUPER_TITLE"];s=BX.Type.isStringFilled(s)?` ${s}`:"";const o=BX.Type.isStringFilled(i)?` style="color:${i}"`:"";n=BX.Tag.render`
					<span class="main-buttons-item-super-title${s}"${o}>${e}</span>
				`}return BX.Tag.render`
				<span class="${s}">${[BX.Tag.render`<span 
						class="main-buttons-item-drag-button"
						onclick="${this.handleDragButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,n,BX.Tag.render`
						<span class="main-buttons-item-text-title">
							<span class="main-buttons-item-text-box">${BX.Text.encode(i)}<span class="main-buttons-item-menu-arrow"></span></span>
						</span>
					`,BX.Tag.render`<span 
						class="main-buttons-item-edit-button"
						onclick="${this.handleEditButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,BX.Tag.render`<span class="main-buttons-item-text-marker"></span>`]}</span>
			`},createItemCounter:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=[this.classItemCounter,this.classExtraItemCounter].join(" ").trim();let s="";const i=BX.Type.isNumber(t["MAX_COUNTER_SIZE"])?t["MAX_COUNTER_SIZE"]:99;if(BX.Type.isNumber(t["COUNTER"])&&t["COUNTER"]>0){s=t["COUNTER"]>i?`${i}+`:t["COUNTER"]}const n=BX.Type.isStringFilled(t["COUNTER_ID"])?t["COUNTER_ID"]:"";return BX.Tag.render`<span data-mib-counter-id="${n}" class="${e}">${s}</span>`},createItemPin:function(t,e){return BX.Tag.render`
				<span class="main-buttons-item-pin" 
					data-slider-ignore-autobinding="true"
					onclick="${this.handleItemPin.bind(this,t,e)}"
					onmouseenter="${this.handleItemPinEnter.bind(this)}"
					onmouseleave="${this.handleItemPinLeave.bind(this)}"
				></span>
			`},getLockedClass:function(t){let e="";if(BX.Type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getMoreMenuItems:function(){const t=this.getAllItems();const e=this.getHiddenItems();const s=this.getDisabledItems();const i=[];if(t.length){t.forEach((t=>{if(e.indexOf(t)===-1&&s.indexOf(t)===-1){const e=this.getItemData(t);i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}}))}if(e.length){e.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}if(this.isSettingsEnabled){i.push({delimiter:true,html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classManage].join(" ")});i.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});const t=["ui-btn",this.theme==="default"?"ui-btn-sm":"ui-btn-xs","ui-btn-success-light","ui-btn-no-caps","ui-btn-round","ui-btn-icon-main-buttons-apply"];i.push({html:`\n\t\t\t\t\t<span class="${t.join(" ")}">\n\t\t\t\t\t\t<span class="ui-btn-text">${this.message("MIB_APPLY_SETTING_MENU_ITEM")}</span>\n\t\t\t\t\t</span>`,className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")});i.push({delimiter:true,html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}}return i},getMenuItems:function(t){return this.createMenuItems(this.getItemData(t),t)},getMoreMenuSubItems:function(t){return this.createMenuItems(this.getItemData(t),null)},createMenuItems:function(t,e=null){if(!BX.Type.isArrayFilled(t["ITEMS"])){return[]}const s=t["ITEMS"];const i=[];for(let t=0;t<s.length;t++){const n=s[t];if(n["IS_PINNED"]||n["IS_DISBANDED"]){continue}const o=n["IS_DELIMITER"]===true;if(o){const t=i.length===0;const e=i[i.length-1];if(t||e&&e["delimiter"]===true){continue}}const a=["menu-popup-no-icon","main-buttons-menu-item"];if(n["IS_ACTIVE"]===true){a.push("main-buttons-menu-item-active")}const u=BX.Text.toBoolean(n["IS_LOCKED"]);if(u){a.push(this.classItemLocked)}if(this.isEditEnabled()){a.push(this.classEditState)}let r;if(o){r={delimiter:true,className:a.join(" "),text:n["TEXT"]}}else{r={html:this.getMenuItemText(n,e),href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],className:a.join(" ")}}const l=n.hasOwnProperty("AJAX_OPTIONS");if(l){r.cacheable=true;r.events=this._getEvents(n["AJAX_OPTIONS"]);r.items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}else if(BX.Type.isArrayFilled(n["ITEMS"])&&!this.isEditEnabled()){const t=this.createMenuItems(n,e);if(t.length){r.items=t}}i.push(r)}if(i.length&&i[i.length-1]["delimiter"]===true){i.pop()}return i},_setAjaxMode:function(t){for(let e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){return{onSubMenuShow:()=>{if(this.subMenuLoaded){return}const e=this.getSubMenu();e.removeMenuItem("loading");const s=e.getMenuItem("loading");this.getSubItems(t).then((t=>{this._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()})).catch((t=>{if(s){s.getLayout().text.innerText=t}}))}}},getSubItems:function(t){return new Promise((function(e,s){if(this.progress){s(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then((t=>{this.progress=false;e(t.data)}))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then((t=>{this.progress=false;e(t.data)}))}}))},getMoreMenuArgs:function(){const t=this.getMoreMenuId();const e=this.moreButton;const s=this.getMoreMenuItems();const i={autoHide:false,compatibleMode:false,maxHeight:800,offsetTop:4,cacheable:false,bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this)},subMenuOptions:{events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}}};let n=null;if(this.theme==="default"){const t=350;const s=25;n={className:"main-buttons-menu-popup main-buttons-more-menu-popup",offsetLeft:-s,minWidth:240,maxWidth:t,subMenuOptions:{className:"main-buttons-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:150,maxWidth:t},events:{onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,e)}}}else if(this.theme==="air"){const t=350;n={className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",offsetLeft:-10,offsetTop:-5,minWidth:240,maxWidth:t,subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu"}}}else{const t=this.moreButton.querySelector(".main-buttons-item-text-title");const e=t.offsetWidth;const s=250;const i=e/2-s/2+BX.Main.Popup.getOption("angleLeftOffset");const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");const a=s/2-o;n={className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",offsetLeft:i,minWidth:s,maxWidth:s,angle:{position:"top",offset:a},subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu"}}}n=BX.Runtime.merge(i,n);if(this.isEditEnabled()){n.className+=" "+this.classEditState}return[t,e,s,n]},getChildMenuArgs:function(t){const e={autoHide:false,compatibleMode:false,offsetTop:4,cacheable:false,maxHeight:800,bindOptions:{position:"bottom",forceTop:true},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t)},subMenuOptions:{minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}}};let s=null;if(this.theme==="default"){const e=25;s={className:"main-buttons-menu-popup",maxWidth:350,minWidth:t.offsetWidth+e*2+30,offsetLeft:-e,events:{onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,t)},subMenuOptions:{className:"main-buttons-menu-popup --sub-menu"}}}else if(this.theme==="air"){s={className:"main-buttons-default-menu-popup",offsetTop:-5,offsetLeft:-10,maxWidth:350,minWidth:200,subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu"}}}else{const e=250;s={className:"main-buttons-default-menu-popup",maxWidth:e,minWidth:Math.min(t.offsetWidth+25*2+30,e),subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu"}}}return BX.Runtime.merge(e,s)},centerPopupArrow(t,e){const s=e.offsetWidth;const i=t.getPopupContainer().offsetWidth;const n=s/2-i/2;const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-o});t.setOffset({offsetLeft:n+BX.Main.Popup.getOption("angleLeftOffset")})},visibleControlMoreButton:function(){const t=this.getHiddenItems();if(!t.length){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createMoreMenu:function(){const t=BX.Main.MenuManager.create(...this.getMoreMenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.getMenuItems().forEach((function(t){const e=t.getLayout().item;BX.Event.bind(e,"click",BX.delegate(this._onDocumentClick,this))}),this);return t},createChildMenu:function(t){const e=this.getMenuItems(t);if(e.length){const s=BX.Main.MenuManager.create(this.getChildMenuId(),t,e,this.getChildMenuArgs(t));if(!this.isEditEnabled()&&this.isSettingsEnabled){const e=()=>{this.showMoreMenu();this.enableEdit();this.destroyChildMenu();this.showChildMenu(t)};s.getMenuItems().forEach((t=>{const s=t.getLayout().item;s.draggable=true;BX.Event.bind(s,"dragstart",e)}))}return s}return null},showMoreMenu:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.closeChildMenu()}let t=this.getMoreMenu();if(t!==null){t.getPopupWindow().show()}else{this.destroyMoreMenu();t=this.createMoreMenu();t.getPopupWindow().show()}this.setMoreMenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.getPopupWindow().setAutoHide(false)}},showChildMenu:function(t){clearTimeout(this.childMenuLeaveTimeout);if(!this.isEditEnabled()){this.closeMoreMenu()}if(!this.isVisibleItem(t)){return}const e=BX.Main.MenuManager.getMenuById(this.getChildMenuId());if(e&&e.bindElement===t){e.getPopupWindow().show();this.destroyItemEditMenu()}else{this.destroyChildMenu(t);const e=this.createChildMenu(t);if(e){e.getPopupWindow().show();this.destroyItemEditMenu()}}},closeMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}t.getPopupWindow().close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setMoreMenuShown(false)},closeChildMenu:function(){const t=this.getChildMenu();if(t===null){return}this.closePinHint();t.close()},getMoreMenu:function(){return BX.Main.MenuManager.getMenuById(this.getMoreMenuId())},getChildMenu:function(){return BX.Main.MenuManager.getMenuById(this.getChildMenuId())},destroyMoreMenu:function(){BX.Main.MenuManager.destroy(this.getMoreMenuId())},destroyChildMenu:function(){BX.Main.MenuManager.destroy(this.getChildMenuId())},refreshMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}const e=this.getMoreMenuArgs();if(BX.Type.isArray(e)){this.destroyMoreMenu();this.createMoreMenu();this.showMoreMenu()}},setMoreMenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}if(this.isSubmenuShown){BX.Dom.addClass(this.moreButton,this.classMenuShown)}else{BX.Dom.removeClass(this.moreButton,this.classMenuShown)}},activateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(!BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){const t={};this.getAllItems().forEach(((e,s)=>{t[e.id]={sort:s,isDisabled:this.isDisabled(e),isPinned:this.isPinned(e)}}));return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.Type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}const t={};this.optionsToSave.forEach((function(e){t[e.name]=e.value}));this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);return BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){const t=this.getCurrentSettings();const e="settings";if(!BX.Type.isPlainObject(t)){return}if(BX.Type.isDomNode(this.listContainer)&&"id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));const s=this.getHomeItem();if(s){const{itemData:t,url:e,firstVisibleItem:i}=s;if(t){if(this.lastHomeLink!==e){this.saveOptions("firstPageLink",e);this.sendOptions();BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[e,i])}this.lastHomeLink=e}}}},resetSettings:function(){let t=null;const e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:()=>{if(BX.Dom.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.Dom.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings((s=>{if(s){BX.Dom.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");this.sendOptions().then((function(){window.location.reload()})).catch((function(){window.location.reload()}))}}))}}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){const e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);let s=new BX.Promise;const i=s;for(let t=0;t<e.length;t++){s=s.then(e[t])}s.then((function(e){t(null,e)}),(function(e){t(e,null)}));i.fulfill()},moveButtonAlias:function(t,e){if(!t||!this.dragItem){return}const s=this.getItemAlias(this.dragItem);const i=this.getItemAlias(t);if(this.isListItem(s)){if(i){if(e){BX.Dom.insertAfter(s,i)}else{this.listContainer.insertBefore(s,i)}}else{this.listContainer.appendChild(s)}}if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},moveButton:function(t,e){if(!BX.Type.isDomNode(t)||!BX.Type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.Type.isDomNode(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.listContainer.insertBefore(this.dragItem,t)}}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.getMoreMenuContainer().insertBefore(this.dragItem,t)}}},getMoreMenuContainer:function(){const t=this.getMoreMenu();let e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){const s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.Dom.hasClass(t,e)&&t!==s){return t}}else{return null}}return null},findChildrenByClassName:function(t,e){let s=null;if(BX.Type.isDomNode(t)&&BX.Type.isStringFilled(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},initItems:function(){this.getAllItems().forEach((t=>{this.initItem(t)}))},initItem:function(t){if(this.isSettingsEnabled){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");BX.Event.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t,"drop",BX.delegate(this._onDrop,this));t.dataset.link="item-"+BX.Text.getRandom().toLowerCase()}BX.Event.bind(t,"click",this._handleItemClick.bind(this));BX.Event.bind(t,"mouseenter",this.handleItemMouseEnter.bind(this));BX.Event.bind(t,"mouseleave",this.handleItemMouseLeave.bind(this))},dragAndDropInitInSubmenu:function(){const t=this.getMoreMenu();if(!t){return}const e=t.menuItems;e.forEach((t=>{if(this.isSeparator(t.layout.item)||this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=false}else{t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.Event.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.Dom.hasClass(t.layout.item,this.classHiddenLabel)||BX.Dom.hasClass(t.layout.item,this.classManage)){BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}}))},getItem:function(t){if(!BX.Type.isDomNode(t)){if(!t||!BX.Type.isDomNode(t.target)){return null}}else{t={target:t}}let e=t.target.closest("."+this.classItem);if(!BX.Type.isDomNode(e)){e=t.target.closest("."+this.classDefaultSubmenuItem+", ."+this.classDefaultSubmenuDelimimeter)}return e},getItemData:function(t){if(!BX.Type.isDomNode(t)){return{}}const e=this.itemData.get(t);if(e){return e}let s;try{s=JSON.parse(t.dataset.item)}catch(t){s={}}this.setItemData(t,s);return s},setItemData(t,e){if(BX.Type.isElementNode(t)&&BX.Type.isPlainObject(e)){e.NODE=t;this.itemData.set(t,e)}},setOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity",.5)},unsetOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.Dom.addClass(this.listContainer,this.classOnDrag);BX.Dom.addClass(BX(this.getMoreMenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){const t=this.getMoreMenu();this.getAllItems().forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t,this.classItemOver)}));if(t&&BX.Type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t.layout.item,this.classItemOver)}))}BX.Dom.removeClass(this.listContainer,this.classOnDrag);BX.Dom.removeClass(BX(this.getMoreMenuId(true)),this.classOnDrag)},getIconClass:function(t){let e="";if(BX.Type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.Type.isStringFilled(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){const e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){let e;if(!BX.Type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.Dom.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.Type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){let e=null;if(!BX.Type.isDomNode(t)){return e}const s=this.getAllItems();const i=this.isSubmenuItem(t);const n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach((function(s){BX.Dom.hasClass(t,this.getAliasLink(s))&&(e=s)}),this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.Dom.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.Dom.removeClass(t,this.classSecret)},fakeDragItem:function(){if(!BX.Type.isDomNode(this.dragItem)||!BX.Type.isDomNode(this.overItem)){return}let t=null;if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateMoreMenuItems:function(){const t=this.getMoreMenu();if(t===null){return}const e=t.menuItems;if(!BX.Type.isArray(e)||!e.length){return}const s=this.getHiddenItems();const i=this.getDisabledItems();const n=i.concat(s);e.forEach((t=>{const e=[].some.call(n,(e=>BX.Dom.hasClass(t.layout.item,this.dataValue(e,"link"))||this.isDisabled(t.layout.item)||this.isSeparator(t.layout.item)||this.isDropzone(t.layout.item)));if(e||(this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)||this.isNotHiddenItem(t.layout.item)||this.isSeparator(t.layout.item)||t.layout.item===this.dragItem)&&!this.isMoreButton(t.layout.item)){this.showItem(t.layout.item)}else{this.hideItem(t.layout.item)}}))},isNotHiddenItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.Type.isDomNode(t)&&!BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.removeClass(t,this.classItemOver)}},dataValue:function(t,e){let s="";if(BX.Type.isDomNode(t)){const i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(t,e){if(BX.Type.isStringFilled(t)){const s=new Function("event",t);s(e)}},showLicenseWindow:function(){if(!B24.licenseInfoPopup){return}const t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_handleItemClick:function(t){if(!this.isEditEnabled()){const e=this.getItem(t);this.showChildMenu(e)}},handleEditButtonClick:function(t){t.preventDefault();t.stopPropagation();let e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}const s=this.getItemData(e);const i=this.getItemEditMenu();if(i&&i.popupWindow.isShown()&&this.lastEditNode===e){i.popupWindow.close()}else{this.showItemEditMenu(s,t.target)}this.lastEditNode=e},handleDragButtonClick:function(t){t.preventDefault();t.stopPropagation()},handleItemPinEnter:function(t){const e=this.getChildMenu();if(e){this.showPinHint(t.currentTarget)}},showPinHint:function(t){const e=48;const s=BX.Main.PopupManager.create({id:"main-buttons-pin-hint",closeByEsc:true,padding:15,className:"main-buttons-pin-hint-popup",height:e,cacheable:false,autoHide:true,bindOptions:{forceBindPosition:true},content:this.message("MIB_PIN_HINT"),darkMode:true,events:{onAfterShow:function(e){const s=e.getTarget();const i=BX.Dom.getPosition(t);const n=BX.Dom.getPosition(s.getPopupContainer());if(n.left<i.left+i.width){s.setAngle({position:"top",offset:0});s.setOffset({offsetLeft:20,offsetTop:5});s.adjustPosition()}}}});s.setAngle({position:"left",offset:0});s.setOffset({offsetLeft:t.offsetWidth+5,offsetTop:-t.offsetHeight/2-e/2-2});s.setBindElement(t);s.show();s.adjustPosition()},closePinHint:function(){const t=BX.Main.PopupManager.getPopupById("main-buttons-pin-hint");if(t){t.close()}},handleItemPinLeave:function(t){this.closePinHint()},handleItemPin:function(t,e,s){s.stopPropagation();s.preventDefault();const i=this.createRootItem(t);BX.Dom.addClass(i,"main-buttons-item-insert-animation");BX.Dom.insertBefore(i,e);requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(i,{width:i.scrollWidth+"px",opacity:1})}))}));const n=()=>{BX.Dom.removeClass(i,"main-buttons-item-insert-animation");BX.Dom.style(i,"width",null);BX.Dom.style(i,"opacity",null);const t=this.getItemData(e);this.recalculateItemsCounters([t]);this.adjustMoreButtonPosition();this.showMoreMenu();this.updateMoreButtonCounter();this.showChildMenu(e);this.saveSettings()};setTimeout(n,300);this.initItem(i);this.pinItem(t);this.destroyMoreMenu();this.destroyChildMenu()},handleItemUnpin:function(t,e){BX.Dom.style(e,{width:e.offsetWidth+"px"});BX.Dom.addClass(e,"main-buttons-item-insert-animation");requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(e,{width:0,margin:0,opacity:0})}))}));const s=()=>{BX.Dom.remove(e);this.adjustMoreButtonPosition();this.showMoreMenu();this.updateMoreButtonCounter();this.saveSettings()};setTimeout(s,300);this.pinItem(t,false);const i=[];let n="";const o=t["ID"].split(":");o.forEach((t=>{n+=`${n===""?"":":"}${t}`;const e=this.getItemById(n);if(e){i.push(this.getItemData(e))}}));this.destroyMoreMenu();this.recalculateItemsCounters(i)},pinItem:function(t,e=true){const s=t["ID"];const i=s.split(":");let n="";i.forEach(((t,o)=>{n+=`${n===""?"":":"}${t}`;const a=this.getItemById(n);if(!a){return}const u=this.getItemData(a);let r=u["ITEMS"];let l=n;const h=i.slice(o+1);const m=[u];while(BX.Type.isArrayFilled(h)&&BX.Type.isArrayFilled(r)){l=l+":"+h.shift();for(let t=0;t<r.length;t++){const i=r[t];if(i["ID"]===s){i["IS_PINNED"]=e;for(let t=m.length-1;t>=0;t--){const s=m[t];const i=t===0;if(e){const t=s["ITEMS"].some((t=>{const e=t["IS_PINNED"]===true;const s=t["IS_DISBANDED"]===true;const i=t["IS_DELIMITER"]===true;return!e&&!s&&!i}));if(!t){s["IS_DISBANDED"]=true;if(i){a.dataset.disbanded=true}}}else{if(i){a.dataset.disbanded=false}s["IS_DISBANDED"]=false}const n=s["ITEMS"].some((t=>t["IS_ACTIVE"]===true&&t["IS_PINNED"]!==true&&t["IS_DELIMITER"]!==true));if(n){s["IS_ACTIVE"]=true;if(i){this.activateItem(a)}}else{s["IS_ACTIVE"]=false;if(i){this.deactivateItem(a)}}}return}else if(i["ID"]===l){r=i["ITEMS"];l=i["ID"];m.push(i);break}}}}))},getParentItem:function(t){const e=t.split(":");let s="";for(let i=0;i<e.length;i++){s+=`${s===""?"":":"}${e[i]}`;const n=this.getItemById(s);if(!n){continue}const o=this.getItemData(n);let a=o["ITEMS"];let u=s;const r=e.slice(i+1);let l=null;while(BX.Type.isArrayFilled(r)&&BX.Type.isArrayFilled(a)){u=u+":"+r.shift();for(let e=0;e<a.length;e++){const s=a[e];if(s["ID"]===t){return l===null?o:l}else if(s["ID"]===u){a=s["ITEMS"];u=s["ID"];l=s;break}}}}return null},_onDragStart:function(t){const e=this.getVisibleItems();const s=BX.Type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.Type.isDomNode(this.dragItem)){return}if(s===1&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.onDragStarted=true;this.closeChildMenu();this.destroyItemEditMenu();if(this.isListItem(this.dragItem)){this.showMoreMenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();const e=this.getItem(t);this.onDragStarted=false;if(!BX.Type.isDomNode(e)){return}this.unsetDragStyles();this.refreshMoreMenu();if(!this.isEditEnabled()){this.closeMoreMenu()}const s=BX.findNextSibling(this.dragItem,(t=>this.isVisibleItem(t)));const i=BX.findPreviousSibling(this.dragItem,(t=>this.isVisibleItem(t)));if(BX.Dom.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i)||this.isDisabled(s)&&this.isSubmenuItem(s)){this.disableItem(this.dragItem);this.refreshMoreMenu()}if(this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){let t=this.getHiddenItems();const e=this.getDisabledItems();t=t.concat(e);let s=0;if(BX.Type.isArray(t)){t.forEach((t=>{const e=this.getItemData(t);const i=BX.Type.isNumber(e["COUNTER"])&&e["COUNTER"]>0?e["COUNTER"]:0;s+=i}))}if(BX.Type.isNumber(s)){this.setMoreButtonCounter(s)}},_onDragEnter:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();this.overItem=this.getItem(t);if(!BX.Type.isDomNode(this.overItem)||!BX.Type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();const e=this.isNext(t);const s=this.isGoodPosition(t);if(e&&s){let t;let e=false;if(this.isListItem(this.overItem)){t=this.findNextSiblingByClass(this.overItem,this.classItem);if(t===null&&this.getLastVisibleItem()===this.overItem){t=this.overItem;e=true}}else{t=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem);if(this.isSettings(t)||this.isApplySettingsButton(t)||this.isResetSettingsButton(t)){return}if(t===null&&this.getItemAlias(this.getLastDisabledItem())===this.overItem){t=this.overItem;e=true}}if(BX.Type.isDomNode(t)){this.moveButton(t,e);this.moveButtonAlias(t,e);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}}else if(!e&&s&&!BX.Dom.hasClass(this.overItem,this.classHiddenLabel)){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}},_onDragLeave:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){const e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}const s=this.getItemAlias(this.dragItem);if(this.isListItem(s)){s.dataset.disabled="false"}this.unsetDragStyles();t.preventDefault()},handleMoreMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this.handleMoreMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this.handleMoreMenuMouseLeave.bind(this))},handleMoreMenuMouseEnter:function(){clearTimeout(this.submenuLeaveTimeout)},handleMoreMenuMouseLeave:function(){this.tryCloseMoreMenuOnTimeout()},tryCloseMoreMenuOnTimeout:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.submenuLeaveTimeout=setTimeout((()=>{this.closeMoreMenu()}),500)}},handleMoreMenuShow:function(t){BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuShow",{event:t});setTimeout((()=>{if(!this.isEditEnabled()){t.getTarget().setAutoHide(true)}}),500)},handleMoreMenuClose:function(){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuClose");this.setMoreMenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}this.destroyItemEditMenu()},_onChildMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this._onChildMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this._onChildMenuMouseLeave.bind(this))},_onChildMenuMouseEnter:function(){clearTimeout(this.childMenuLeaveTimeout)},_onChildMenuMouseLeave:function(){this.tryCloseChildMenuOnTimeout()},tryCloseChildMenuOnTimeout:function(){if(this.isEditEnabled()){return}clearTimeout(this.childMenuLeaveTimeout);this.childMenuLeaveTimeout=setTimeout((()=>{this.closeChildMenu()}),500)},_onChildMenuShow:function(t,e){BX.Dom.addClass(t,this.classMenuShown);BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuShow",{item:t,event:e});if(this.theme!=="default"&&this.theme!=="air"){this.centerPopupArrow(e.getTarget(),t)}setTimeout((()=>{e.getTarget().setAutoHide(true)}),500)},_onChildMenuClose:function(t){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuClose");BX.Dom.removeClass(t,this.classMenuShown);this.closePinHint()},handleAdjustPosition:function(t,e){const s=25;const i=BX.Dom.getPosition(t);const n=e.getTarget();if(e.left<i.left-s){const t=n.getPopupContainer().offsetWidth;const o=i.right-t+s;if(o>0){e.left=o;BX.Dom.addClass(n.getPopupContainer(),"--left-handed")}}else{BX.Dom.removeClass(n.getPopupContainer(),"--left-handed")}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.closeChildMenu();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},handleMoreButtonClick:function(t){t.preventDefault();this.showMoreMenu()},handleMoreButtonMouseEnter:function(t){if(this.enableItemMouseEnter){clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showMoreMenu()}),100)}clearTimeout(this.submenuLeaveTimeout)},handleMoreButtonMouseLeave:function(){clearTimeout(this.menuShowTimeout);this.tryCloseMoreMenuOnTimeout()},handleItemMouseEnter:function(t){if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);clearTimeout(this.childMenuLeaveTimeout);clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showChildMenu(e)}),100);BX.Dom.addClass(e,this.classItemOver)},handleItemMouseLeave:function(t){clearTimeout(this.menuShowTimeout);if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);BX.Dom.removeClass(e,this.classItemOver);this.tryCloseChildMenuOnTimeout()},handleMoreMenuItemMouseEnter:function(t){if(this.isEditEnabled()){t.preventDefault()}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsResetButton)},isDisabled:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.Dom.hasClass(t,this.classItemDisabled)}return e},isPinned:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.getItemData(t)["IS_PINNED"]===true}return e},isSettings:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.Dom.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.Dom.hasClass(t,this.classDropzone)},isNext:function(t){const e=this.dragItem.getBoundingClientRect();const s=this.overItem.getBoundingClientRect();const i=getComputedStyle(this.dragItem);const n=parseInt(i.marginRight.replace("px",""));let o=null;if(this.isListItem(this.overItem)){o=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){o=t.clientY>e.top}return o},isGoodPosition:function(t){const e=this.overItem;if(!BX.Type.isDomNode(e)){return false}let s;const i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.Type.isDomNode(t)){return false}return t.offsetTop===0&&!BX.Dom.hasClass(t,"--hidden")},isMoreButton:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSeparator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){let e=null;if(!BX.Type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.Type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate((function(){e=BX(t.containerId);if(!BX.Type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}),this))}},getById:function(t){let e=null;if(BX.type.isString(t)&&BX.Type.isStringFilled(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1745563967575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?17455640712527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17455640895071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/script.min.js?174556403021613";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/script.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Manager){return}e.Manager=function(e){this.init(e)};e.Manager.prototype={init:function(t){this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.canEditProfile=t.canEditProfile==="Y";this.userId=t.userId||"";this.userStatus=t.userStatus||"";this.isIntegratorUser=t.isIntegratorUser==="Y";this.isOwnProfile=t.isOwnProfile==="Y";this.isSessionAdmin=t.isSessionAdmin==="Y";this.urls=t.urls;this.isExtranetUser=t.isExtranetUser==="Y";this.adminRightsRestricted=t.adminRightsRestricted==="Y";this.delegateAdminRightsRestricted=t.delegateAdminRightsRestricted==="Y";this.isFireUserEnabled=t.isFireUserEnabled==="Y";this.showSonetAdmin=t.showSonetAdmin==="Y";this.languageId=t.languageId;this.initialFields=t.initialFields;this.siteId=t.siteId;this.isCloud=t.isCloud==="Y";this.isRusCloud=t.isRusCloud==="Y";this.isCurrentUserIntegrator=t.isCurrentUserIntegrator==="Y";this.personalMobile=this.initialFields["PERSONAL_MOBILE"];this.isCurrentUserAdmin=t.isCurrentUserAdmin;this.avatarUri=BX.type.isNotEmptyString(this.initialFields.PHOTO)?this.initialFields.PHOTO:null;this.userpicUploadAttribute=t.userpicUploadAttribute??"";this.entityEditorInstance=new e.EntityEditor({managerInstance:this,params:t});BX.ready(function(){this.tagsManagerInstance=new e.Tags({managerInstance:this,inputNode:document.getElementById("intranet-user-profile-tags-input"),tagsNode:document.getElementById("intranet-user-profile-tags")});this.stressLevelManagerInstance=new e.StressLevel({managerInstance:this,options:t});this.gratsManagerInstance=new e.Grats({managerInstance:this,options:t});this.profilePostManagerInstance=new e.ProfilePost({managerInstance:this,options:t});this.initAvatar();this.initAvailableActions();this.initAvatarLoader();if(this.isCloud){this.initGdpr()}var i=BX("intranet-user-profile-subordinate-more");if(BX.type.isDomNode(i)){BX.bind(i,"click",function(){this.loadMoreUsers(i)}.bind(this))}var o=BX("intranet-user-profile-manages-more");if(BX.type.isDomNode(i)){BX.bind(o,"click",function(){this.loadMoreUsers(o)}.bind(this))}var n=document.querySelector(".intranet-user-profile-bottom-controls");var s=document.getElementById("intranet-user-profile_buttons");if(BX.type.isDomNode(n)&&BX.type.isDomNode(s)){var r=s.querySelector(".ui-entity-settings-link");r.setAttribute("class","ui-btn ui-btn-sm ui-btn-light-border ui-btn-themes");s.parentNode.removeChild(s);n.appendChild(r)}}.bind(this))},initAvatar(){const e={size:212,userpicPath:this.avatarUri};if(this.userStatus==="collaber"){this.avatar=new BX.UI.AvatarRoundGuest(e)}else if(this.userStatus==="extranet"){this.avatar=new BX.UI.AvatarRoundExtranet(e)}else{this.avatar=new BX.UI.AvatarRound(e)}const t=BX.Tag.render`<div class="intranet-user-profile-photo" id="intranet-user-profile-photo"></div>`;this.avatar.renderTo(t);const i=BX("intranet-user-profile-userpic-avatar");BX.Dom.append(t,i);if(this.canEditProfile||this.isOwnProfile){BX.Dom.append(this.getAvatarEditorButtons(),i);BX.Dom.append(this.getAvatarRemoveButton(),i)}},getAvatarEditorButtons(){return BX.Tag.render`
				<div class="intranet-user-profile-userpic-load">
					<div class="intranet-user-profile-userpic-create" id="intranet-user-profile-photo-camera">
						${BX.message("INTRANET_USER_PROFILE_AVATAR_CAMERA")}
					</div>
					<div class="intranet-user-profile-userpic-upload" id="intranet-user-profile-photo-file" ${this.userpicUploadAttribute}>
						${BX.message("INTRANET_USER_PROFILE_AVATAR_LOAD")}
					</div>
				</div>
			`},getAvatarRemoveButton(){return BX.Tag.render`
				<div class="intranet-user-profile-userpic-remove" id="intranet-user-profile-photo-remove"
					${this.initialFields.PERSONAL_PHOTO?"":"hidden"}>
				</div>
			`},initAvailableActions:function(){if(!this.canEditProfile){return}var e=document.querySelector("[data-role='user-profile-actions-button']");if(BX.type.isDomNode(e)){BX.bind(e,"click",BX.proxy((function(){this.showActionPopup(BX.proxy_context)}),this))}},initGdpr:function(){var e=document.querySelectorAll("[data-role='gdpr-input']");e.forEach(function(e,t,i){BX.bind(e,"change",function(){this.changeGdpr(e)}.bind(this))}.bind(this));var t=document.querySelector(".intranet-user-profile-column-block-title-dropdown");BX.bind(t,"click",function(){this.animateGdprBlock(t)}.bind(this))},initAvatarLoader:function(){if(BX("intranet-user-profile-photo-camera")&&BX("intranet-user-profile-photo-file")){if(BX.AvatarEditor){setTimeout((function(){if(BX.AvatarEditor.isCameraAvailable()!==true){BX.hide(BX("intranet-user-profile-photo-camera"))}}),0);var e=function(){var e=BX.AvatarEditor.getInstanceById("intranet-user-profile-photo-file");if(e===null){e=BX.AvatarEditor.createInstance("intranet-user-profile-photo-file",{enableCamera:true,enableMask:true});e.subscribeOnFormIsReady("newPhoto",this.changePhoto.bind(this))}return e}.bind(this);BX.bind(BX("intranet-user-profile-photo-camera"),"click",(function(){e().show("camera")}));BX.bind(BX("intranet-user-profile-photo-file"),"click",(function(){e().show("file")}));BX.bind(BX("intranet-user-profile-photo-mask"),"click",(function(){e().show("mask")}))}else{BX.hide(BX("intranet-user-profile-photo-camera"));BX.hide(BX("intranet-user-profile-photo-file"));BX.hide(BX("intranet-user-profile-photo-mask"))}}BX.bind(BX("intranet-user-profile-photo-remove"),"click",(()=>{if(this.avatar.picPath){this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_PHOTO_DELETE_CONFIRM"),this.deletePhoto.bind(this))}}))},showActionPopup:function(e){var t=[];if(this.showSonetAdmin){t.push({text:BX.message(this.isSessionAdmin?"INTRANET_USER_PROFILE_QUIT_ADMIN_MODE":"INTRANET_USER_PROFILE_ADMIN_MODE"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();__SASSetAdmin()}})}if(this.userStatus==="admin"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REMOVE_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.removeAdminRights()}),this)})}if(this.userStatus==="employee"&&this.canEditProfile&&!this.isOwnProfile&&!this.isCurrentUserIntegrator){var i=BX.message("INTRANET_USER_PROFILE_SET_ADMIN_RIGHTS");if(this.delegateAdminRightsRestricted){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({html:i,onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();if(this.adminRightsRestricted){if(this.delegateAdminRightsRestricted){top.BX.UI.InfoHelper.show("limit_admin_admins")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_CONFIRM"),this.setAdminRights.bind(this))}}else if(this.isCloud){this.getAdminConfirmPopup().show()}else{this.setAdminRights()}}),this)})}if(this.isCurrentUserAdmin==="Y"&&this.userStatus!=="fired"&&this.userStatus!=="waiting"&&!this.isOwnProfile&&!BX.util.in_array(this.userStatus,["email","shop"])){i=BX.message("INTRANET_USER_PROFILE_FIRE");if(!this.isFireUserEnabled&&!this.isIntegratorUser){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({text:i,className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();if(!this.isFireUserEnabled&&!this.isIntegratorUser){top.BX.UI.InfoHelper.show("limit_dismiss")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_FIRE_CONFIRM"),this.fireUser.bind(this))}}),this)})}if(this.isCurrentUserAdmin==="Y"&&this.userStatus==="fired"&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_HIRE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_HIRE_CONFIRM"),this.hireUser.bind(this))}),this)})}if(this.isCurrentUserAdmin==="Y"&&this.userStatus==="waiting"&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_ACTION_CONFIRM"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.confirmUserRequest("Y")}),this)});t.push({text:BX.message("INTRANET_USERPROFILE_ACTION_REFUSE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.confirmUserRequest("N")}),this)})}if(this.userStatus==="invited"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REINVITE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.reinviteUser()}),this)});t.push({text:BX.message("INTRANET_USER_PROFILE_DELETE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_DELETE_CONFIRM"),this.deleteUser.bind(this))}),this)})}if(this.isExtranetUser&&this.canEditProfile&&!this.isOwnProfile&&this.isCloud){t.push({text:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.moveToIntranet()}),this)})}if(this.isCloud&&this.canEditProfile&&!this.isOwnProfile&&!this.isIntegratorUser&&this.userStatus!=="fired"&&this.userStatus!=="waiting"){t.push({text:BX.message("INTRANET_USER_PROFILE_SET_INEGRATOR_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_SET_INTEGRATOR_RIGHTS_CONFIRM"),this.setIntegratorRights.bind(this))}),this)})}BX.PopupMenu.show("user-profile-action-popup",e,t,{offsetTop:0,offsetLeft:10,angle:true,events:{onPopupClose:function(){BX.PopupMenu.destroy()}}})},showConfirmPopup:function(e,t){BX.PopupWindowManager.create({id:"intranet-user-profile-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(e,i){t();i.stopPropagation();this.context.close()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})],events:{onPopupClose:function(){this.destroy()}}}).show()},getAdminConfirmPopup:function(){const e=BX.PopupWindowManager.create({id:"intranet-user-profile-admin-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_SECURITY_CONFIRM_DESCRIPTION_MSGVER_1")}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_SECURITY_CONFIRM_TITLE"),contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_YES_MSGVER_1"),events:{click:(t,i)=>{this.setAdminRights();i.stopPropagation();e.close()}}}),new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_YES_INTEGRATOR"),events:{click:()=>{this.setIntegratorRights();e.close()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_NO_MSGVER_1"),events:{click:()=>{e.close()}}})],events:{onPopupClose:()=>{e.destroy()}}});return e},showFireInvitedUserPopup:function(e){BX.PopupWindowManager.create({id:"intranet-user-profile-fire-invited-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_FIRE_INVITED_USER")}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(t){t.setWaiting();this.context.close();e()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})]}).show()},showIntegratorPartnerErrorPopup:function(){const e=BX.PopupWindowManager.create("popup-message",null,{id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_INTEGRATOR_ERROR_NOT_PARTNER")}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_INTEGRATOR_ERROR_NOT_PARTNER_CLOSE"),events:{click(){this.context.close()}}})]});e.show()},showErrorPopup:function(e){if(!e){return}BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10}).show()},loadMoreUsers:function(e){if(!BX.type.isDomNode(e)){return}var t=e.parentNode;var i=t.querySelectorAll("[data-role='user-profile-item']");var o=i.length;for(var n=0;n<4&&n<o;n++){i[n].style.display="inline-block";i[n].setAttribute("data-role","")}if(o-4<=0){e.style.display="none"}else{BX.findChild(e).innerHTML=o-4}},changePhoto(e){const t=e.getData().form;const i=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:t}).then((e=>{if(e.data){(top||window).BX.onCustomEvent("BX.Intranet.UserProfile:Avatar:changed",[{userId:this.userId,url:e.data}]);this.avatar.setUserPic(encodeURI(e.data))}this.hideLoader({loader:i})})).catch((e=>{this.hideLoader({loader:i});this.showErrorPopup(e.errors[0].message)}));BX("intranet-user-profile-photo-remove").hidden=false},deletePhoto(){const e=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((t=>{this.avatar.removeUserPic();this.hideLoader({loader:e});BX("intranet-user-profile-photo-remove").hidden=true})).catch((t=>{this.hideLoader({loader:e});this.showErrorPopup(t.errors[0].message)}))},setAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});BX.UI.Notification.Center.notify({content:"Error",position:"top-right",autoHideDelay:1e4});BX.PopupWindowManager.getPopupById("intranet-user-profile-confirm-popup").close()}}.bind(this)).catch(function(t){this.hideLoader({loader:e});BX.UI.Notification.Center.notify({content:t["errors"][0].message,position:"top-right",autoHideDelay:1e4});BX.PopupWindowManager.getPopupById("intranet-user-profile-confirm-popup").close()}.bind(this))},setIntegratorRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setIntegratorRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),function(t){this.hideLoader({loader:e});if(t["errors"][0].code==="INTEGRATOR_ERROR_NOT_PARTNER"){this.showIntegratorPartnerErrorPopup()}else{this.showErrorPopup(t["errors"][0].message)}}.bind(this))},removeAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"removeAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},fireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"fireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},hireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"hireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),function(t){this.hideLoader({loader:e})}.bind(this))},confirmUserRequest:function(e){const t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{signedParameters:this.signedParameters,data:{userId:this.userId,isAccept:e}}).then((function(i){if(i.data===true){if(e!=="Y"){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}else{location.reload()}}else{this.hideLoader({loader:t});this.showErrorPopup("Error")}}),function(e){this.hideLoader({loader:t})}.bind(this))},deleteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deleteUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),function(t){this.hideLoader({loader:e});this.showFireInvitedUserPopup(this.fireUser.bind(this))}.bind(this))},reinviteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:this.userId,extranet:this.isExtranetUser=="Y"?"Y":"N"}}}).then(function(t){this.hideLoader({loader:e});if(t.data.result){BX.PopupWindowManager.create("intranet-user-profile-invited-popup",null,{content:"<p>"+BX.message("INTRANET_USER_PROFILE_REINVITE_SUCCESS")+"</p>",offsetLeft:27,offsetTop:7,autoHide:true}).show();BX.SidePanel.Instance.postMessageTop(window,"BX.Bitrix24.EmailConfirmation:showPopup")}}.bind(this),function(t){this.hideLoader({loader:e})}.bind(this))},moveToIntranet:function(e){if(e!==true)e=false;BX.PopupWindowManager.create("BXExtranet2Intranet",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET_TITLE"),closeIcon:false,width:"auto",buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_MOVE"),events:{click:BX.proxy((function(){var t=BX.proxy_context;BX.addClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)){BX.ajax.runComponentAction(this.componentName,"moveToIntranet",{signedParameters:this.signedParameters,mode:"ajax",data:{departmentId:BX("toIntranetDepartment").value,isEmail:e?"Y":"N"}}).then((function(e){if(e.data){t.context.setContent(e.data);t.context.setButtons([new BX.UI.CloseButton({events:{click:function(){location.reload()}}})])}}),function(e){BX.removeClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)&&!BX("moveToIntranetError")){var o=BX.create("div",{attrs:{id:"moveToIntranetError",class:"ui-alert ui-alert-danger ui-alert-icon-danger"},children:[BX.create("span",{attrs:{class:"ui-alert-message"},html:e["errors"][0].message})]});i.insertBefore(o,BX.findChild(i))}}.bind(this))}}),this)}}),new BX.UI.CancelButton({events:{click:function(){this.context.close()}}})],events:{onAfterPopupShow:BX.proxy((function(){var t=BX.proxy_context;t.setContent('<div style="width:450px;height:230px"></div>');var i=this.showLoader({node:t.contentContainer,loader:null,size:100});BX.ajax.post("/bitrix/tools/b24_extranet2intranet.php",{USER_ID:this.userId,IS_EMAIL:e?"Y":"N"},BX.proxy((function(e){this.hideLoader({loader:i});t.setContent(e)}),this))}),this)}}).show()},showLoader:function(e){var t=null;if(e.node){if(e.loader===null){t=new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40})}else{t=e.loader}t.show()}return t},hideLoader:function(e){if(e.loader!==null){e.loader.hide()}if(e.node){BX.cleanNode(e.node)}if(e.loader!==null){e.loader=null}},processSliderCloseEvent:function(e){BX.addCustomEvent("SidePanel.Slider:onMessage",function(t){if(t.getSlider()!=BX.SidePanel.Instance.getSliderByWindow(window)){return}if(t.getEventId()!="SidePanel.Wrapper:onClose"){return}var i=t.getData();if(!BX.type.isNotEmptyObject(i.sliderData)){return}var o=i.sliderData.get("entityType"),n=i.sliderData.get("entityId");if(BX.type.isNotEmptyString(o)&&o==e.entityType&&n==this.userId){e.callback()}}.bind(this))},changeGdpr:function(e){var t={type:e.name,value:e.checked?"Y":"N"};BX.ajax.runComponentAction(this.componentName,"changeGdpr",{signedParameters:this.signedParameters,mode:"class",data:t}).then((function(e){}),function(e){}.bind(this))},animateGdprBlock:function(e){var t=document.querySelector('[data-role="'+e.getAttribute("for")+'"]');if(e.classList.contains("intranet-user-profile-column-block-title-dropdown--open")){e.classList.remove("intranet-user-profile-column-block-title-dropdown--open");t.style.height=null}else{e.classList.add("intranet-user-profile-column-block-title-dropdown--open");t.style.height=t.firstElementChild.offsetHeight+"px"}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/utils.min.js?1745564030734";s:6:"source";s:78:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/utils.js";s:3:"min";s:82:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/utils.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/utils.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.Utils){return}t.Utils={processAjaxBlock:function(t){if(!BX.type.isNotEmptyObject(t)){return}var e=t.data,a=t.containerNode,s=BX.type.isNotEmptyString(t.className)?t.className:"";if(!BX.type.isNotEmptyObject(e)||!BX(a)){return}var r=false;var i=false;l(o);n(c);function n(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function c(){a.appendChild(BX.create("DIV",{props:{className:s},html:e.CONTENT}));r=true;if(i){o()}}function l(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function o(){i=true;if(r){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML"})}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/stresslevel.min.js?17455640307949";s:6:"source";s:84:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/stresslevel.js";s:3:"min";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/stresslevel.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/stresslevel.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.StressLevel){return}e.StressLevel=function(e){this.init(e)};e.StressLevel.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.loader=null;this.stressLevel={value:null,type:null,typeDescription:null,comment:null,hash:null};this.noResultNode=BX("intranet-user-profile-stresslevel-noresult");this.resultNode=BX("intranet-user-profile-stresslevel-result");if(!this.resultNode||!this.noResultNode){return}this.resultStatusInfoNode=BX("intranet-user-profile-stresslevel-status-info");this.permsOpenNode=BX("intranet-user-profile-stresslevel-result-perms-open");this.permsCloseNode=BX("intranet-user-profile-stresslevel-result-perms-close");this.checkNode=BX("intranet-user-profile-stresslevel-check");this.widgetNode=BX("intranet-user-profile-stresslevel-widget");this.widgetNoResultNode=BX("intranet-user-profile-stresslevel-noresult-widget");this.resultCommentNode=BX("intranet-user-profile-stresslevel-comment");this.resultCopyLinkNode=BX("intranet-user-profile-stresslevel-status-copy");this.widgetLayout={container:null,arrow:null,level:null,content:null,title:null,progress:null};this.url={};this.measurementId=null;this.classes={widget:"intranet-stress-level-widget",widgetArrow:"intranet-stress-level-widget-arrow",widgetContent:"intranet-stress-level-widget-content",widgetContentTitle:"intranet-stress-level-widget-content-title",widgetContentProgress:"intranet-stress-level-widget-content-progress",widgetContentProgressEmpty:"intranet-stress-level-widget-content-progress-empty"};BX.UI.Hint.init(this.noResultNode);BX.UI.Hint.init(this.resultNode);this.getData();if(this.managerInstance.canEditProfile){this.getOpenPerms()}BX.bind(this.permsOpenNode,"click",function(){this.setOpenPerms({value:true})}.bind(this));BX.bind(this.permsCloseNode,"click",function(){this.setOpenPerms({value:false})}.bind(this));BX.bind(this.checkNode,"click",function(){this.openSlider({page:""})}.bind(this));BX.bind(this.resultStatusInfoNode,"click",function(){this.openSlider({page:"result"})}.bind(this));if(this.resultCopyLinkNode){var t=navigator.userAgent.match(/chrome\/(\d+)/i);if(t&&parseInt(t[1])>=76){BX.bind(this.resultCopyLinkNode,"click",function(){if(this.measurementId){this.copyToBuffer()}}.bind(this))}else{this.resultCopyLinkNode.style.display="none"}}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runAction("socialnetwork.api.user.stresslevel.get",{signedParameters:this.managerInstance.signedParameters,data:{c:"bitrix:intranet.user.profile",fields:{userId:this.managerInstance.userId}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});if(BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyObject(e.data.url)){this.url=e.data.url}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.id!="undefined"){this.measurementId=parseInt(e.data.id)}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.value!="undefined"){this.showData(e.data)}else if(BX.message("USER_ID")==this.managerInstance.userId){this.showEmpty()}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader})}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)&&typeof e.value!="undefined"){if(this.noResultNode){this.resultNode.style.display="none"}if(!this.resultNode){return}this.stressLevel.value=parseInt(e.value)>0?parseInt(e.value):0;this.stressLevel.comment=BX.type.isNotEmptyString(e.comment)?e.comment:"";this.stressLevel.type=BX.type.isNotEmptyString(e.type)?e.type:"";this.stressLevel.typeDescription=BX.type.isNotEmptyString(e.typeDescription)?e.typeDescription:"";this.stressLevel.hash=BX.type.isNotEmptyString(e.hash)?e.hash:"";this.resultNode.style.display="block";this.renderData()}},showEmpty:function(){if(this.noResultNode){this.noResultNode.style.display="block"}if(this.resultNode){this.resultNode.style.display="none"}this.renderEmptyData()},getOpenPerms:function(){BX.ajax.runAction("socialnetwork.api.user.stresslevel.getaccess",{data:{fields:{userId:this.managerInstance.userId}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},setOpenPerms:function(e){if(!BX.type.isNotEmptyObject(e)){e={}}if(!BX.type.isBoolean(e.value)){e.value=false}BX.ajax.runAction("socialnetwork.api.user.stresslevel.setaccess",{data:{fields:{userId:this.managerInstance.userId,value:e.value?"Y":"N"}}}).then(function(e){if(BX.type.isNotEmptyString(e.data.value)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},showOpenPerms:function(e){if(e=="Y"){this.permsCloseNode.style.display="block";this.permsOpenNode.style.display="none"}else{this.permsCloseNode.style.display="none";this.permsOpenNode.style.display="block"}},openSlider:function(e){var t=BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyString(e.page)?e.page:"";var s="";if(t=="result"&&BX.type.isNotEmptyString(this.url.result)){s=this.url.result}else if(BX.type.isNotEmptyString(this.url.check)){s=this.url.check}if(BX.type.isNotEmptyString(s)){BX.SidePanel.Instance.open(s,{cacheable:false,data:{},width:500})}},renderData:function(){if(!this.widgetNode){return}this.widgetNode.appendChild(this.getRenderContainer());this.afterRender();if(this.resultCommentNode&&BX.type.isNotEmptyString(this.stressLevel.comment)){this.resultCommentNode.innerHTML=BX.util.htmlspecialchars(this.stressLevel.comment)}if(BX.type.isNotEmptyString(this.stressLevel.type)&&BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type)){BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).style.display="inline-block";BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).innerHTML=BX.util.htmlspecialchars(this.stressLevel.typeDescription)}},renderEmptyData:function(){if(!this.widgetNoResultNode){return}this.widgetNoResultNode.appendChild(this.getRenderContainer());this.afterRender()},getRenderContainer:function(){if(!this.widgetLayout.container){this.widgetLayout.container=BX.create("DIV",{props:{className:this.classes.widget},children:[this.getRenderArrowContainer(),this.getRenderContentContainer()]})}return this.widgetLayout.container},getRenderArrowContainer:function(){if(!this.widgetLayout.arrow){this.widgetLayout.arrow=BX.create("DIV",{props:{className:this.classes.widgetArrow}})}return this.widgetLayout.arrow},getRenderContentContainer:function(){if(!this.widgetLayout.content){this.widgetLayout.content=BX.create("DIV",{props:{className:this.classes.widgetContent},children:[this.widgetLayout.title=BX.create("DIV",{props:{className:this.classes.widgetContentTitle},text:BX.message("INTRANET_USER_PROFILE_STRESSLEVEL_NORESULT_INDICATOR_TEXT")}),this.widgetLayout.progress=BX.create("DIV",{props:{className:this.classes.widgetContentProgress},text:"?"})]})}return this.widgetLayout.content},afterRender:function(){if(!this.stressLevel.value){this.widgetLayout.progress.classList.add(this.classes.widgetContentProgressEmpty);this.getRenderArrowContainer().style.transform="rotate(90deg)";return}setTimeout(function(){this.animateRenderNumber();this.getRenderArrowContainer().style.transform="rotate("+this.getRenderProgressScale()+"deg)"}.bind(this),1e3)},animateRenderNumber:function(){var e=0;var t=600/this.stressLevel.value;var s=setInterval(function(){e++;this.widgetLayout.progress.innerHTML=e;e===this.stressLevel.value?clearInterval(s):null}.bind(this),t)},getRenderProgressScale:function(){return 1.8*this.stressLevel.value},copyToBuffer:function(){if(!this.measurementId){return}var e="/bitrix/components/bitrix/intranet.user.profile/stresslevel_img.php";fetch(e).then(function(e){return e.blob()}).then(function(e){navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:true}))])}).catch(function(e){})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/grats.min.js?17455640307585";s:6:"source";s:78:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/grats.js";s:3:"min";s:82:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/grats.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/grats.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Grats){return}e.Grats=function(e){this.init(e)};e.Grats.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.initBadges(this.options.badgesData);this.postListPageSize=parseInt(this.options.gratPostListPageSize);this.postListPageNum=1;this.loader=null;this.badgesWrapperNode=BX("intranet-user-profile-thanks");this.postsWrapperNode=BX("intranet-user-profile-thanks-users-wrapper");this.moreLinkNode=BX("intranet-user-profile-load-users-link");this.loaderNode=BX("intranet-user-profile-thanks-users-loader");this.classes={item:"intranet-user-profile-thanks-item",itemActive:"intranet-user-profile-thanks-item-active",itemCounter:"intranet-user-profile-thanks-item-counter",badgesDisabled:"intranet-user-profile-thanks-disabled"};if(this.moreLinkNode){BX.bind(this.moreLinkNode,"click",function(){this.getData()}.bind(this))}this.getData();this.managerInstance.processSliderCloseEvent({entityType:"gratPost",callback:function(){BX.cleanNode(this.postsWrapperNode);this.postListPageNum=1;this.getData()}.bind(this)});if(this.badgesWrapperNode){BX.bind(this.badgesWrapperNode,"click",function(e){this.openGratSlider(e)}.bind(this))}},initBadges:function(e){this.badgesData={};for(var t in e){if(!e.hasOwnProperty(t)){continue}this.badgesData[e[t].ID]={CODE:e[t].CODE,NAME:e[t].NAME}}},showMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="block"}},hideMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="none"}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});this.showBadgesLoader();BX.ajax.runComponentAction(this.managerInstance.componentName,"getGratitudePostList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{pageSize:this.postListPageSize,pageNum:this.postListPageNum}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();if(BX.type.isNotEmptyObject(e.data)){if(typeof e.data.POSTS_COUNT!="undefined"&&this.postListPageSize*this.postListPageNum>=parseInt(e.data.POSTS_COUNT)){this.hideMoreLink()}else{this.showMoreLink()}this.showData(e.data);this.postListPageNum++}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();this.showMoreLink()}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)){if(BX.type.isNotEmptyObject(e.BADGES)){this.showBadges(e.BADGES)}if(BX.type.isNotEmptyObject(e.POSTS)){this.showPosts(e.POSTS,BX.type.isNotEmptyObject(e.AUTHORS)?e.AUTHORS:{})}}},showBadges:function(e){if(!this.badgesWrapperNode){return}var t=BX.findChildren(this.badgesWrapperNode,{className:this.classes.item});if(t){var s=null;for(var i=0;i<t.length;i++){s=t[i].getAttribute("data-bx-grat-enum");if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyObject(e[s])&&typeof e[s].COUNT!="undefined"&&parseInt(e[s].COUNT)>0){t[i].appendChild(BX.create("DIV",{props:{className:this.classes.itemCounter},text:parseInt(e[s].COUNT)}));t[i].classList.add(this.classes.itemActive)}else{BX.cleanNode(t[i]);t[i].classList.remove(this.classes.itemActive)}}var a=BX.clone(t);a.sort(function(e,t){if(e.classList.contains(this.classes.itemActive)&&!t.classList.contains(this.classes.itemActive)){return-1}else if(!e.classList.contains(this.classes.itemActive)&&t.classList.contains(this.classes.itemActive)){return 1}else{return 0}}.bind(this));BX.cleanNode(this.badgesWrapperNode);for(i=0;i<a.length;i++){this.badgesWrapperNode.appendChild(a[i])}}},showBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.add(this.classes.badgesDisabled)},hideBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.remove(this.classes.badgesDisabled)},showPosts:function(e,t){if(!this.postsWrapperNode){return}var s=null,i=null,a=null;var r=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}r.push(e[n])}r.sort((function(e,t){if(e.DATE_PUBLISH_TS==t.DATE_PUBLISH_TS){return 0}return e.DATE_PUBLISH_TS<t.DATE_PUBLISH_TS?+1:-1}));for(var o=0;o<r.length;o++){s=r[o];i=BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-likes"},children:[]});if(BX.type.isNotEmptyObject(s.RATING_DATA)){a=BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-emodji"}});if(BX.type.isNotEmptyObject(s.RATING_DATA.REACTIONS_LIST)){for(var p in s.RATING_DATA.REACTIONS_LIST){if(!s.RATING_DATA.REACTIONS_LIST.hasOwnProperty(p)||parseInt(s.RATING_DATA.REACTIONS_LIST[p])<=0){continue}a.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-emoji intranet-user-profile-thanks-emoji-"+p}}))}}i.appendChild(a);if(typeof s.RATING_DATA.TOTAL_POSITIVE_VOTES!="undefined"&&parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)>0){i.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-counter"},text:parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)}))}}var d="",h="";if(typeof s.AUTHOR_ID!="undefined"&&parseInt(s.AUTHOR_ID)>0&&BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t[s.AUTHOR_ID])&&BX.type.isNotEmptyString(t[s.AUTHOR_ID].PHOTO)){d="background-size: cover; background-image: url('"+encodeURI(t[s.AUTHOR_ID].PHOTO)+"')";h=t[s.AUTHOR_ID].NAME+" "+t[s.AUTHOR_ID].LAST_NAME}this.postsWrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-avatar"},children:[BX.create("A",{attrs:{href:t[s.AUTHOR_ID].URL,"bx-tooltip-user-id":s.AUTHOR_ID},props:{className:"ui-icon ui-icon-common-user intranet-user-profile-thanks-user-userpic"},children:[BX.create("i",{props:{style:d},attrs:{title:h}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-picture"+(this.badgesData[s.BADGE_ID]?" intranet-user-profile-thanks-item-"+this.badgesData[s.BADGE_ID].CODE:"")}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content"},children:[BX.create("A",{attrs:{"bx-post-url":s.URL+(s.URL.indexOf("?")==-1?"?":"&")+"IFRAME=Y",href:"#"},props:{className:"intranet-user-profile-thanks-user-content-title"},html:s.TITLE,events:{click:function(e){BX.SidePanel.Instance.open(e.currentTarget.getAttribute("bx-post-url"),{width:1e3});e.stopPropagation();e.preventDefault()}}}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-info"},children:[BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-date"},text:BX.type.isNotEmptyString(s.DATE_FORMATTED)?s.DATE_FORMATTED:""}),typeof s.CONTENT_VIEW_CNT!="undefined"&&parseInt(s.CONTENT_VIEW_CNT)>0?BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-views"},text:s.CONTENT_VIEW_CNT}):null,i]})]})]}))}},openGratSlider:function(e){if(!this.badgesWrapperNode){return}var t=this.badgesWrapperNode.getAttribute("data-bx-grat-url");if(!BX.type.isNotEmptyString(t)){return}var s=null;if(e.target.classList.contains(this.classes.item)){s=e.target}if(!s){s=BX.findParent(e.target,{className:"intranet-user-profile-thanks-item"},this.badgesWrapperNode)}if(!s){return}var i=s.getAttribute("data-bx-grat-code");if(!BX.type.isNotEmptyString(i)){return}t+=(t.indexOf("?")==-1?"?":"&")+"gratUserId="+this.managerInstance.userId+"&gratCode="+i;BX.SidePanel.Instance.open(t,{cacheable:false,data:{entityType:"gratPost",entityId:this.managerInstance.userId},width:1e3})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/profilepost.min.js?17455640306180";s:6:"source";s:84:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/profilepost.js";s:3:"min";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/profilepost.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/profilepost.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.ProfilePost){return}t.ProfilePost=function(t){this.init(t)};t.ProfilePost.prototype={init:function(t){this.managerInstance=t.managerInstance;this.options=t.options;this.loaderNode=BX("intranet-user-profile-about-loader");this.wrapperNode=BX("intranet-user-profile-about-wrapper");this.containerNode=BX("intranet-user-profile-post-container");this.editLinkNode=BX("intranet-user-profile-post-edit-link");this.stubButtonNode=BX("intranet-user-profile-post-edit-stub-button");this.loader=null;this.LHEEventNode=BX("div"+this.options.profilePostData.lheId);this.getData();this.managerInstance.processSliderCloseEvent({entityType:"profilePost",callback:function(){BX.cleanNode(this.wrapperNode);this.getData()}.bind(this)});if(this.editLinkNode){BX.bind(this.editLinkNode,"click",function(){this.getFormData()}.bind(this))}if(this.stubButtonNode){BX.bind(this.stubButtonNode,"click",function(){this.getFormData()}.bind(this))}if(this.LHEEventNode){BX.addCustomEvent(this.LHEEventNode,"OnProfilePostFormAfterShow",function(t,e){this.OnProfilePostFormAfterShow(t,e)}.bind(this));BX.addCustomEvent(this.LHEEventNode,"OnClickSubmit",function(t){this.OnClickSubmit(t)}.bind(this));BX.addCustomEvent(this.LHEEventNode,"OnClickCancel",function(t){this.setContainerEditMode(false);this.showPostContainer(true)}.bind(this))}},getData:function(){BX.addClass(this.loaderNode,"intranet-user-profile-loader-getdata");this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getProfileBlogPost",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{}}).then(function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});BX.removeClass(this.loaderNode,"intranet-user-profile-loader-getdata");this.setContainerEmpty(!BX.type.isNotEmptyObject(t.data));if(BX.type.isNotEmptyObject(t.data)){this.showData(t.data)}}.bind(this),function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});BX.removeClass(this.loaderNode,"intranet-user-profile-loader-getdata")}.bind(this))},setContainerEmpty:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-empty")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-empty")}}},setContainerEditMode:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-editmode")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-editmode")}}},showData:function(t){if(!this.wrapperNode){return}this.showPostContainer(true);if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.additionalParams)&&BX.type.isNotEmptyObject(t.additionalParams.POST)){var e=t.additionalParams.POST;if(BX.type.isNotEmptyString(e.TITLE)){this.wrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-container-body-title"},html:e.TITLE}))}if(BX.type.isNotEmptyString(t.html)){var i=BX.create("DIV",{props:{className:"intranet-user-profile-about"}});this.wrapperNode.appendChild(i);BX.html(i,t.html)}if(BX.type.isNotEmptyObject(e.UF_RENDERED)){BX.Intranet.UserProfile.Utils.processAjaxBlock({data:e.UF_RENDERED,className:"intranet-user-profile-about-props",containerNode:this.wrapperNode})}}},getFormData:function(){this.showPostContainer(false);this.setContainerEditMode(true);this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getProfileBlogPostForm",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{}}).then(function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.showFormData(t.data)}.bind(this),function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.showPostContainer(true)}.bind(this))},showPostContainer:function(t){if(!this.wrapperNode){return}this.wrapperNode.style.display=!!t?"block":"none"},showFormData:function(t){if(this.LHEEventNode){BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["show"]);BX.onCustomEvent(this.LHEEventNode,"OnProfilePostFormAfterShow",[t])}},OnProfilePostFormAfterShow:function(t){t=!!t?t:{};var e=BX.type.isNotEmptyString(t.DETAIL_TEXT)?t.DETAIL_TEXT:"",i={};if(BX.type.isNotEmptyObject(t.UF)&&BX.type.isNotEmptyObject(t.UF.UF_BLOG_POST_FILE)){i["UF_BLOG_POST_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_BLOG_POST_FILE[]",VALUE:BX.clone(t.UF.UF_BLOG_POST_FILE.VALUE)}}LHEPostForm.reinitData(this.options.profilePostData.lheId,e,i)},OnClickSubmit:function(t){var e=t.oEditor.GetContent(),i=t.formID,o=BX.type.isNotEmptyString(i)?BX(i):null,n=BX.type.isNotEmptyString(i)?BX("lhe_button_submit_"+i):null;if(o){var a=BX.ajax.prepareForm(o);this.sendFormData({text:e,submitButton:n,additionalData:a.data})}},sendFormData:function(t){this.showButtonWait(t.submitButton,true);if(BX.type.isNotEmptyString(t.text)){BX.ajax.runComponentAction(this.managerInstance.componentName,"sendProfileBlogPostForm",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{text:t.text,additionalData:t.additionalData}}}).then(function(e){this.showButtonWait(t.submitButton,false);BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["hide"]);BX.cleanNode(this.wrapperNode);this.getData();this.setContainerEditMode(false)}.bind(this),function(e){this.setContainerEditMode(false);this.showButtonWait(t.submitButton,false)}.bind(this))}else{BX.ajax.runComponentAction(this.managerInstance.componentName,"deleteProfileBlogPost",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(e){this.showButtonWait(t.submitButton,false);BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["hide"]);BX.cleanNode(this.wrapperNode);this.getData();this.setContainerEditMode(false)}.bind(this),function(e){this.setContainerEditMode(false);this.showButtonWait(t.submitButton,false)}.bind(this))}},showButtonWait:function(t,e){if(t){if(!!e){BX.addClass(t,"ui-btn-clock")}else{BX.removeClass(t,"ui-btn-clock")}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags.min.js?174556403014879";s:6:"source";s:77:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags.js";s:3:"min";s:81:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.Tags){return}t.Tags=function(t){this.init(t);return this};t.Tags.prototype={init:function(t){this.tagsLoader=null;this.tagsLoaderNode=BX("intranet-user-profile-tags-loader");this.managerInstance=t.managerInstance;this.inputNode=t.inputNode;this.tagsNode=t.tagsNode;this.popup=null;this.popupContent=null;this.defferedTags=[];this.container={input:null,inputWrapper:null};this.popupContainer=null;this.initialized=null;this.tagsUsersPopupInstanceList={};this.getTagsData();this.containerNode=BX("intranet-user-profile-tags-container");this.editLinkNode=BX("intranet-user-profile-add-tags");this.stubButtonNode=BX("intranet-user-profile-interests-stub-button");if(this.editLinkNode){BX.bind(this.editLinkNode,"click",this.show.bind(this))}if(this.stubButtonNode){BX.bind(this.stubButtonNode,"click",this.show.bind(this))}BX.bind(window,"click",function(t){if(!BX.findParent(t.target,{className:"intranet-user-profile-tags-input-wrapper"})&&!BX.findParent(t.target,{className:"intranet-user-profile-tags-popup"})&&t.target!==this.editLinkNode&&t.target!==this.stubButtonNode){if(this.defferedTags.length>0){for(var e=0;e<this.defferedTags.length;e++){this.addTag({tag:this.defferedTags[e]})}this.reindexUser();this.defferedTags=[]}this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.hide();this.closePopup()}}.bind(this))},closePopup:function(){if(this.popup){this.popup.close()}},getTagsData:function(t){BX.addClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata");this.tagsLoader=this.managerInstance.showLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagsList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(t){this.managerInstance.hideLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.removeClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata");if(BX.type.isNotEmptyObject(t.data)){this.showTagsList(t.data)}}.bind(this),function(t){this.managerInstance.hideLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.removeClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata")}.bind(this))},showTagsList:function(t,e){for(var s in t){if(!t.hasOwnProperty(s)){continue}var i=this.getTagNode({tag:s,tagData:t[s],openListSlider:true});if(e){this.tagsNode.insertBefore(i,e);BX.cleanNode(e,true)}else{this.tagsNode.appendChild(i)}}this.checkEmptyTagsList()},getTagNode:function(e){var s=BX.create("DIV",{attrs:{"bx-data-user-tag":e.tag},props:{className:"intranet-user-profile-tags-item intranet-user-profile-tags-item-new"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-tags-item-title",title:e.tag},text:e.tag,events:e.openListSlider?{click:function(){BX.SidePanel.Instance.open(decodeURIComponent(this.managerInstance.urls.PathToTag).replace("#TAG#",e.tag),{cacheable:false,allowChangeHistory:true,width:1e3})}.bind(this)}:null}),this.managerInstance.isOwnProfile?BX.create("DIV",{props:{className:"intranet-user-profile-tags-item-remove"},events:{click:function(t){this.removeTag({tag:e.tag,node:s,checksum:e.tagData.CHECKSUM});this.reindexUser();t.stopPropagation();t.preventDefault()}.bind(this)}}):null,e.tagData?this.getTagUsersNode({tag:e.tag,checksum:e.tagData.CHECKSUM,usersObject:e.tagData.USERS}):null,e.tagData?this.getTagCounterNode(e.tagData.COUNT-e.tagData.USERS.length):null,e.tagData?BX.create("SPAN",{attrs:{id:"iup-tags-item-users-popup-container-"+e.tagData.CHECKSUM,style:"display: none;"},props:{className:"iup-tags-users-popup-cont"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup-outer"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-waiter"}})]}),BX.create("SPAN",{props:{className:"iup-tags-item-users-action"},children:[BX.create("SPAN",{props:{className:"ui-btn ui-btn-xs ui-btn-primary"},text:BX.message("INTRANET_USER_PROFILE_TAGS_POPUP_ADD")})]})]})]}):null]});if(e.tagData){this.tagsUsersPopupInstanceList[e.tagData.CHECKSUM]=new t.TagsUsersPopup({containerNodeId:"iup-tags-item-users-popup-container-"+e.tagData.CHECKSUM,tagsInstance:this,tag:e.tag,tagNode:s,checksum:e.tagData.CHECKSUM})}BX.bind(s,"animationend",(function(){s.classList.remove("intranet-user-profile-tags-item-new")}));return s},removeTag:function(t){var e=BX.type.isNotEmptyObject(t)?BX(t.node):null;var s=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.tag)?t.tag:null;var i=BX.type.isNotEmptyObject(t)&&BX.Type.isStringFilled(t.checksum)?t.checksum:null;if(!e||!BX.type.isNotEmptyString(s)){return}this.removeTagNode(e);if(i){var a=this.tagsUsersPopupInstanceList[i].popup;if(a){a.destroy()}}BX.ajax.runComponentAction(this.managerInstance.componentName,"removeTag",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:t.tag}}}).then(function(t){}.bind(this),function(t){}.bind(this))},removeTagNode:function(t){t.style.opacity="0";BX.bind(t,"transitionend",function(){if(t.parentNode){t.parentNode.removeChild(t)}this.checkEmptyTagsList()}.bind(this))},checkEmptyTagsList:function(){this.setContainerEmpty(!this.tagsNode.hasChildNodes())},getTagUsersNode:function(t){var e=BX.create("DIV",{props:{className:"intranet-user-profile-tags-users"},events:{mouseenter:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onMouseOver({event:e})}}.bind(this),mouseleave:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onMouseOut({event:e})}}.bind(this),click:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onClick({event:e})}}.bind(this)}});for(var s=0;s<t.usersObject.length;s++){var i=t.usersObject[s];e.appendChild(BX.create("DIV",{props:{className:"ui-icon ui-icon-common-user intranet-user-profile-tags-user"},children:[BX.create("i",{style:BX.type.isNotEmptyString(i.PERSONAL_PHOTO_SRC)?{backgroundImage:"url('"+encodeURI(i.PERSONAL_PHOTO_SRC)+"')"}:null})]}))}return e},getTagCounterNode:function(t){return t>0?BX.create("DIV",{props:{className:"intranet-user-profile-tags-users-counter"},text:parseInt(t)}):null},addTag:function(t){BX.ajax.runComponentAction(this.managerInstance.componentName,"addTag",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:t.tag,userId:typeof t.userId!="undefined"?parseInt(t.userId):null}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.showTagsList(e.data,BX.type.isDomNode(t.tagNode)?t.tagNode:null)}}.bind(this),function(t){}.bind(this))},reindexUser:function(t){if(!BX.type.isNotEmptyObject(t)){t={}}setTimeout(function(){BX.ajax.runComponentAction(this.managerInstance.componentName,"reindexUser",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{userId:typeof t.userId!="undefined"?parseInt(t.userId):null}}}).then(function(t){}.bind(this),function(t){}.bind(this))}.bind(this),1e3)},getInputValue:function(){return this.getInput().value},cleanInput:function(){this.getInput().value=""},focusInput:function(){this.getInput().focus()},getInputWrapper:function(){if(!this.container.inputWrapper){this.container.inputWrapper=BX.create("DIV",{props:{className:"intranet-user-profile-tags-input-wrapper"}});this.container.inputWrapper.appendChild(this.getInput())}return this.container.inputWrapper},parseLongString:function(){var t=this.getInputValue();if(t===""){return false}var e=t.split(/[\s\t]+/);if(BX.type.isArray(e)&&e.length>1){for(var s=0;s<e.length;s++){if(!BX.type.isNotEmptyString(e[s])){continue}this.addDeferredTag(e[s],this.getTagNode({tag:e[s]}))}return true}return false},checkDeferredTag:function(t){return BX.util.in_array(t,this.defferedTags)},addDeferredTag:function(t,e){if(!this.checkDeferredTag(t)){this.defferedTags.push(t);this.addDeferredTagNode(e)}},addDeferredTagNode:function(t){this.cleanInput();this.getInputWrapper().insertBefore(BX.create("div",{props:{className:"intranet-user-profile-tags-input-deferred"},children:[t]}),this.getInputWrapper().children[this.getInputWrapper().children.length-1])},removeDeferredTag:function(t){if(this.defferedTags.indexOf(t)!==-1){this.defferedTags.splice(this.defferedTags.indexOf(t),1)}},removeDeferredTagNode:function(t){this.getInputWrapper().removeChild(t)},getInput:function(){if(!this.container.input){this.container.input=BX.create("INPUT",{props:{type:"text",className:"intranet-user-profile-tags-input"},events:{keydown:function(t){if(t.code&&(t.code.toLowerCase()==="enter"||t.code.toLowerCase()==="numpadenter")||t.keyCode&&t.keyCode===13){if(this.defferedTags.length===0&&this.getInputValue()===""){return}if(this.parseLongString()){return}if(this.defferedTags.length>0){for(var e=0;e<this.defferedTags.length;e++){this.addTag({tag:this.defferedTags[e]})}this.reindexUser();this.defferedTags=[]}if(this.getInputValue()!==""){this.addTag({tag:this.getInputValue()});this.reindexUser()}this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.hide();this.closePopup()}else if(t.code&&t.code.toLowerCase()==="escape"||t.keyCode&&t.keyCode===27){this.hide();this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.defferedTags=[];this.closePopup();t.preventDefault();t.stopPropagation()}else if(t.code&&(t.code.toLowerCase()==="arrowdown"||t.code.toLowerCase()==="arrowup")||t.keyCode&&(t.keyCode===38||t.keyCode===40)){}else if((t.code&&t.code.toLowerCase()==="space"||t.keyCode&&t.keyCode===32)&&this.getInputValue()!==""){if(!this.parseLongString()){this.addDeferredTag(this.getInputValue(),this.getTagNode({tag:this.getInputValue()}))}this.cleanInput();BX.PreventDefault(t)}else if((t.code&&t.code.toLowerCase()==="backspace"||t.keyCode&&t.keyCode===8)&&this.getInputValue()===""&&this.defferedTags.length>0){var s=this.getInputWrapper().children[this.getInputWrapper().children.length-2];this.removeDeferredTag(this.defferedTags[this.defferedTags.length-1]);this.removeDeferredTagNode(s)}}.bind(this),input:BX.debounce((function(){if(this.getInputValue()!==""){BX.ajax.runComponentAction(this.managerInstance.componentName,"searchTags",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{searchString:this.getInputValue()}}}).then(function(t){if(BX.type.isNotEmptyObject(t.data)){this.getPopup({tags:t.data,mode:"search"}).show()}else{this.closePopup()}}.bind(this),function(t){this.closePopup()}.bind(this));return}this.getPopup().destroy();this.popup=null}),1e3,this)}})}return this.container.input},hide:function(){this.getInputWrapper().style.height=this.getInputWrapper().offsetHeight+"px";setTimeout(function(){this.getInputWrapper().classList.remove("intranet-user-profile-tags-input-show");this.getInputWrapper().classList.add("intranet-user-profile-tags-hide");this.getInputWrapper().style.height=null;this.setContainerEditMode(false)}.bind(this));this.initialized=false},show:function(){if(!this.initialized){this.inputNode.appendChild(this.getInputWrapper())}this.getInputWrapper().classList.remove("intranet-user-profile-tags-hide");setTimeout(function(){this.setContainerEditMode(true);this.getInputWrapper().classList.add("intranet-user-profile-tags-input-show");setTimeout(function(){this.getInputWrapper().style.height="auto"}.bind(this),400)}.bind(this));this.focusInput();this.getPopularTags();this.initialized=true},getPopup:function(t){var e=this.getInput();if(!BX.type.isNotEmptyObject(t)){t={}}if(!this.popup){this.popup=new BX.PopupWindow({className:"intranet-user-profile-tags-popup",bindElement:e,width:this.getInput().offsetWidth,content:this.getPopupContainer(t),animation:"fading-slide",offsetTop:5})}else{this.popup.setContent(this.getPopupContainer(t));this.popup.setBindElement(e)}this.popup.setBindElement(e);return this.popup},getPopupContainer:function(t){this.popupContent=BX.create("div",{props:{className:"intranet-user-profile-tags-popup"},children:[this.getPopupContentEmpty(t)]});return this.popupContent},getPopularTags:function(){BX.ajax.runComponentAction(this.managerInstance.componentName,"searchTags",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(t){if(BX.type.isNotEmptyObject(t.data)){setTimeout(function(){this.getPopup({tags:t.data,mode:"popular"}).show()}.bind(this),200)}}.bind(this),function(t){}.bind(this))},getPopupContentEmpty:function(t){var e=BX.type.isNotEmptyString(t.mode)?t.mode:"popular";this.popupContent=BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-cont"}});this.popupContainer=BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty"},children:[BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-title"},text:BX.message(e=="search"?"INTRANET_USER_PROFILE_TAGS_POPUP_SEARCH_TITLE":"INTRANET_USER_PROFILE_TAGS_POPUP_TITLE")}),this.popupContent,BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-text"},text:BX.message("INTRANET_USER_PROFILE_TAGS_POPUP_HINT_3")})]});var s=BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.tags)?t.tags:[],i=null,a=null;for(var n=0;n<s.length;n++){i=this.getTagNode({tag:s[n].NAME,tagData:s[n]});BX.bind(i,"click",function(t){a=t.currentTarget.getAttribute("bx-data-user-tag");if(BX.type.isNotEmptyString(a)){this.addDeferredTag(a,this.getTagNode({tag:a}))}this.focusInput()}.bind(this));this.popupContent.appendChild(i)}return this.popupContainer},getTagList:function(){var t=this.tags;var e=BX.create("DIV",{props:{className:"intranet-user-profile-tags-popup-list"}});for(var s=0;s<t.length;s++){var i=BX.create("DIV",{attrs:{"bx-data-user-tag":t[s].text},props:{className:"intranet-user-profile-tags-popup-list-item"},text:t[s].text,events:{click:function(t){this.addTag({tag:t.currentTarget.getAttribute("bx-data-user-tag")});this.reindexUser();this.cleanInput();this.closePopup()}.bind(this)}});e.appendChild(i)}return e},setActivePopularTag:function(t){t.classList.add("intranet-user-profile-tags-item-active")},resetActivePopularTag:function(t){t.classList.remove("intranet-user-profile-tags-item-active")},setInputValue:function(t){this.getInput().value=t},setContainerEmpty:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-empty")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-empty")}}},setContainerEditMode:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-editmode")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-editmode")}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:108:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags-users-popup.min.js?17455640305204";s:6:"source";s:89:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags-users-popup.js";s:3:"min";s:93:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags-users-popup.min.js";s:3:"map";s:93:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags-users-popup.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.TagsUsersPopup){return}t.TagsUsersPopup=function(t){setTimeout(function(){this.init(t)}.bind(this),0);return this};t.TagsUsersPopup.prototype={init:function(t){this.tagsInstance=t.tagsInstance;this.managerInstance=this.tagsInstance.managerInstance;this.tagNode=BX.type.isDomNode(t.tagNode)?t.tagNode:null;this.tag=t.tag;this.checksum=t.checksum;this.page=1;this.contentNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-popup"},true,false):null;this.actionNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-action"},true,false):null;this.popup=null;this.initialized=false;this.showPopupTimeoutId=null;this.hidePopupTimeoutId=null;this.leavePopupTimeoutId=null;this.popupUsersShownIdList=[];BX.bind(this.actionNode,"click",function(){this.tagsInstance.addTag({userId:BX.message("USER_ID"),tag:this.tag,tagNode:this.tagNode});this.tagsInstance.reindexUser({userId:BX.message("USER_ID")});this.popup.close()}.bind(this))},onMouseOver:function(t){if(this.tagsInstance.popupContent&&BX.findParent(t.event.target,{className:"intranet-user-profile-tags-popup-empty-cont"},this.tagsInstance.popupContent)){return}if(this.popup!==null&&this.popup.isShown()){clearTimeout(this.hidePopupTimeoutId);return}clearTimeout(this.showPopupTimeoutId);this.showPopupTimeoutId=setTimeout(function(){this.show({bindNode:t.event.target})}.bind(this),400)},onMouseOut:function(t){clearTimeout(this.showPopupTimeoutId);if(!this.popup){return}this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3)},onClick:function(t){clearTimeout(this.showPopupTimeoutId);this.show({bindNode:t.event.currentTarget})},show:function(t){this.open({bindNode:t.bindNode});if(!this.initialized){this.page=1;BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){this.buildContent(t.data);this.initialized=true}.bind(this),function(t){}.bind(this))}},open:function(t){if(this.popup==null){this.popup=new BX.PopupWindow("tags-users-popup-"+this.checksum,t.bindNode,{lightShadow:true,offsetLeft:-22,autoHide:true,closeByEsc:true,zIndex:2005,bindOptions:{position:"top"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}},events:{onPopupClose:function(){},onPopupDestroy:function(){}},content:BX("iup-tags-item-users-popup-container-"+this.checksum),className:"iup-tags-users-popup"});BX.bind(BX("tags-users-popup-"+this.checksum),"mouseleave",function(){clearTimeout(this.hidePopupTimeoutId);this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3)}.bind(this));BX.bind(BX("tags-users-popup-"+this.checksum),"mouseenter",function(){clearTimeout(this.hidePopupTimeoutId)}.bind(this))}this.popup.show();this.adjustPopup()},adjustPopup:function(){if(this.popup!=null&&this.popup.getPopupContainer()){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}},buildContent:function(t){if(BX.type.isArray(t.USERS)){if(this.page==1&&this.contentNode){this.contentNode.innerHTML=""}this.page+=1;var i=null;for(var e=0;e<t.USERS.length;e++){if(BX.util.in_array(t.USERS[e]["ID"],this.popupUsersShownIdList)){continue}this.popupUsersShownIdList.push(t.USERS[e]["ID"]);if(t.USERS[e].PERSONAL_PHOTO.SRC.length>0){i=BX.create("IMG",{attrs:{src:encodeURI(t.USERS[e].PERSONAL_PHOTO.SRC)},props:{className:"iup-tags-item-users-popup-avatar-img"}})}else{i=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"iup-tags-item-users-popup-avatar-img bx-contentview-popup-avatar-img-default"}})}this.contentNode.appendChild(BX.create("A",{attrs:{href:t.USERS[e]["URL"],target:"_blank",title:t.USERS[e]["NAME_FORMATTED"]},props:{className:"iup-tags-item-users-popup-img"+(!!t.USERS[e]["TYPE"]?" iup-tags-item-users-popup-img-"+t.USERS[e]["TYPE"]:"")},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup-avatar-new"},children:[i,BX.create("SPAN",{props:{className:"bx-contentview-popup-avatar-status-icon"}})]}),BX.create("SPAN",{attrs:{"bx-tooltip-user-id":t.USERS[e]["ID"]},props:{className:"iup-tags-item-users-popup-name-new"},html:t.USERS[e]["NAME_FORMATTED"]})]}))}this.adjustPopup();this.bindScroll()}if(BX.type.isNotEmptyString(t.CAN_ADD)&&t.CAN_ADD=="Y"){this.actionNode.classList.add("iup-tags-item-users-action-visible")}else{this.actionNode.classList.remove("iup-tags-item-users-action-visible")}},bindScroll:function(){BX.bind(this.contentNode,"scroll",function(t){var i=t.currentTarget;if(i.scrollTop>(i.scrollHeight-i.offsetHeight)/1.5){BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){if(BX.type.isArray(t.data.USERS)&&t.data.USERS.length>0){this.buildContent(t.data)}}.bind(this),function(t){}.bind(this));BX.unbindAll(i)}}.bind(this))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/form-entity.min.js?174556403017240";s:6:"source";s:84:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/form-entity.js";s:3:"min";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/form-entity.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/intranet.user.profile/templates/.default/js/form-entity.map.js";}"*/
(function(){"use strict";var t=BX.namespace("BX.Intranet.UserProfile");if(t.EntityEditor){return}t.EntityEditor=function(t){this.init(t)};t.EntityEditor.prototype={init:function(t){var e=t.params;this.managerInstance=t.managerInstance;this.signedParameters=e.signedParameters;this.componentName=e.componentName;this.initialFields=e.initialFields||{};this.isCloud=e.isCloud==="Y";this.isCurrentUserAdmin=e.isCurrentUserAdmin==="Y";this.gridId=e.gridId||null;this.voximplantEnablePhones=e.voximplantEnablePhones;BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",BX.proxy((function(t,e){e.methods["timezone"]=this.userProfileEntity.bind(this);e.methods["phone"]=this.userProfileEntity.bind(this)}),this));BX.addCustomEvent("BX.UI.EntityEditorAjax:onSubmit",BX.proxy((function(t){this.onAfterSubmit(t)}),this));if(!this.isCloud&&this.isCurrentUserAdmin){BX.addCustomEvent(window,"BX.UI.EntityEditor:onPrepareConfigMenuItems",function(t,e){e.push({id:"intranet-fields-link",text:BX.message("INTRANET_USER_FIILDS_SETTINGS"),onclick:function(){this.showFieldsSettings()}.bind(this),className:"menu-popup-item-none"})}.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditor:onUserFieldAdd",function(t,e){if(typeof e!=="object"||!e){return}BX.ajax.runComponentAction(this.componentName,"onUserFieldAdd",{signedParameters:this.signedParameters,mode:"ajax",data:{fieldName:e["FIELD"]}}).then((function(t){}),(function(t){}))}.bind(this))}if(document.querySelector("#show-ru-meta-notification")){var i=BX.debounce(function(t,e){var i=e._container.querySelector('[data-cid="UF_FACEBOOK"]');var n=false;if(i){n=i.style.display!=="none"&&!BX.hasClass(i,"ui-entity-card-content-hide")}document.querySelector("#show-ru-meta-notification").style.display=n?"inherit":"none"}.bind(this),100);["BX.UI.EntityEditor:onRefreshLayout","BX.UI.EntityEditor:onLayout","BX.UI.EntityEditorSection:onLayout","BX.UI.EntityEditorSection:onChildMenuItemSelect","BX.UI.EntityEditorField:onChildMenuItemDeselect"].forEach((t=>{BX.addCustomEvent(t,(function(){i.apply(this,[t,...arguments])}))}));BX.Event.EventEmitter.subscribe("BX.UI.EntityEditorFieldSelector:close",(t=>{if(Array.isArray(t.data.items)){t.data.items.forEach((t=>{if(t.sectionName==="contact"&&t.fieldName==="UF_FACEBOOK"){document.querySelector("#show-ru-meta-notification").style.display="inherit"}}))}}))}},userProfileEntity:function(t,e,i){if(t==="timezone"){return BX.Intranet.UserProfile.EntityEditorTimezone.create(e,i)}if(t==="phone"){i.model._settings["SHOW_PHONE_ICON"]=this.voximplantEnablePhones[e]=="Y"?"Y":"N";return BX.Intranet.UserProfile.EntityEditorPhone.create(e,i)}return null},onAfterSubmit:function(t){if(this.isCloud){var e=BX.prop.getString(t,"PERSONAL_MOBILE","");if(e&&this.initialFields["PERSONAL_MOBILE"]!=e){if(this.managerInstance.showSmsPopup instanceof Function){this.managerInstance.showSmsPopup(e)}this.managerInstance.personalMobile=e}}var i=BX.prop.getString(t,"NAME","");var n=BX.prop.getString(t,"LAST_NAME","");if(i&&this.initialFields["NAME"]!=i||n&&this.initialFields["LAST_NAME"]!=n){this.changePageTitle(BX.prop.getString(t,"FULL_NAME",""));(top||window).BX.onCustomEvent("BX.Intranet.UserProfile:Name:changed",[{fullName:BX.prop.getString(t,"FULL_NAME","")}])}this.reloadGrid()},reloadGrid:function(){if(!BX.type.isNotEmptyString(this.gridId)||!window.parent.BX.Main.gridManager){return}var t=window.parent.BX.Main.gridManager.getById(this.gridId);if(!t){return}let e=t.instance.getCurrentPage();if(BX.Type.isInteger(e)&&e>0){t.instance.reload("?page=page-"+e)}else{t.instance.reload()}},changePageTitle:function(t){if(!t){return}BX.html(BX("pagetitle"),t);document.title=t;if(BX.getClass("BX.SidePanel.Instance.updateBrowserTitle")){BX.SidePanel.Instance.updateBrowserTitle()}},showFieldsSettings:function(){BX.SidePanel.Instance.open("intranet:user-pfofile-fields-settings",{contentCallback:function(t){return new Promise(function(t,e){top.BX.ajax.runComponentAction(this.componentName,"fieldsSettings",{signedParameters:this.signedParameters,mode:"class",data:{}}).then((function(e){t({html:e.data.html})}))}.bind(this))}.bind(this),width:600})}};BX.load(["/bitrix/js/ui/entity-editor/js/editor.js"],(function(){if(typeof BX.Intranet.UserProfile.EntityEditorTimezone==="undefined"){BX.Intranet.UserProfile.EntityEditorTimezone=function(){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.constructor.apply(this);this._items=null;this._inputAutoTimeZone=null;this._inputTimeZone=null;this._selectAutoTimeZone=null;this._selectTimeZone=null;this._selectContainer=null;this._selectedValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._innerWrapper=null;this._isOpened=false};BX.Intranet.UserProfile.EntityEditorTimezone.create=function(t,e){var i=new BX.Intranet.UserProfile.EntityEditorTimezone;i.initialize(t,e);return i};BX.extend(BX.Intranet.UserProfile.EntityEditorTimezone,BX.UI.EntityEditorField);BX.Intranet.UserProfile.EntityEditorTimezone.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-select"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getTimeZoneItemByValue(n.timeZone);var o=this.getAutoTimeZoneItemByValue(n.autoTimeZone);var s=this.getDataBooleanParam("isHtml",false);var a={};var l={};this._selectedValueAutoTimeZone=n.autoTimeZone;this._selectedValueTimeZone=n.timeZone;this._selectAutoTimeZone=null;this._selectTimeZone=null;this._innerWrapper=null;if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputAutoTimeZone=BX.create("input",{attrs:{name:"AUTO_TIME_ZONE",type:"hidden",value:n.autoTimeZone}});this._inputTimeZone=BX.create("input",{attrs:{name:"TIME_ZONE",type:"hidden",value:n.timeZone}});this._wrapper.appendChild(this._inputAutoTimeZone);this._wrapper.appendChild(this._inputTimeZone);a={props:{className:"ui-ctl-element"}};if(s){a.html=o?o["NAME"]:n}else{a.text=o?o["NAME"]:n}this._selectAutoTimeZone=BX.create("div",a);BX.bind(this._selectAutoTimeZone,"click",BX.proxy((function(){this._selectorClickHandler("autoTimeZone")}),this));l={props:{className:"ui-ctl-element"}};if(s){l.html=r?r["NAME"]:n}else{l.text=r?r["NAME"]:n}this._selectTimeZone=BX.create("div",l);BX.bind(this._selectTimeZone,"click",BX.proxy((function(){this._selectorClickHandler("timeZone")}),this));var u=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-angle"}});this._selectContainerAutoTimeZone=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100"},children:[this._selectAutoTimeZone,u]});this._selectContainerTimeZone=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100",style:"margin-top: 10px;"+(n.autoTimeZone!=="N"?"display: none;":"")},children:[this._selectTimeZone,BX.clone(u)]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-card-content-block-inner"},children:[this._selectContainerAutoTimeZone,this._selectContainerTimeZone]});this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}this.registerLayout(t);this._hasLayout=true}else{}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getContentWrapper=function(){return this._innerWrapper};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.checkIfNotEmpty=function(t){return t!==""&&t!=="0"};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.doRegisterLayout=function(){};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.doClearLayout=function(t){this.closeMenu();this._input=null;this._select=null;this._innerWrapper=null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.refreshLayout.apply(this,arguments);return}var t=this.getValue();var e=this.getItemByValue(t);var i=e?BX.prop.getString(e,"NAME",t):t;if(this._mode===BX.Intranet.UserProfile.EntityEditorMode.edit){this._selectedValue=t;if(this._input){this._input.value=t}if(this._select){this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}}else if(this._mode===BX.Intranet.UserProfile.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.validate=function(t){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.Intranet.UserProfile.EntityEditorTimezone. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Intranet.UserProfile.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.showError=function(t,e){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"ui-entity-card-content-error")}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.clearError=function(){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-entity-card-content-error")}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onSelectorClick=function(t){if(!this._isOpened){this.openMenu(t)}else{this.closeMenu(t)}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.openMenu=function(t){if(this._isOpened){return}var e=[];if(t=="timeZone"){var i=this.getTimeZoneItems()}else{i=this.getAutoTimeZoneItems()}for(var n=0,r=i.length;n<r;n++){var o=i[n];if(!BX.prop.getBoolean(o,"IS_EDITABLE",true)){continue}var s=BX.prop.getString(o,"VALUE",n);var a=BX.prop.getString(o,"NAME",s);e.push({text:this.getDataBooleanParam("isHtml",false)?a:BX.util.htmlspecialchars(a),value:s,onclick:BX.delegate(t=="autoTimeZone"?this.onAutoTimeZoneItemSelect:this.onTimeZoneItemSelect,this)})}var l=t==="timeZone"?this._selectTimeZone:this._selectAutoTimeZone;BX.PopupMenu.show(this._id,l,e,{angle:false,width:l.offsetWidth+"px",maxHeight:300,events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(l)["width"])};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.closeMenu=function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onMenuShow=function(){BX.addClass(this._selectContainer,"ui-ctl-active");this._isOpened=true};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"ui-ctl-active");this._isOpened=false};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onAutoTimeZoneItemSelect=function(t,e){this.closeMenu();this._selectedValueAutoTimeZone=this._inputAutoTimeZone.value=e.value;var i=BX.prop.getString(this.getAutoTimeZoneItemByValue(this._selectedValueAutoTimeZone),"NAME",this._selectedValueAutoTimeZone);this._selectAutoTimeZone.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i);this.markAsChanged();BX.PopupMenu.destroy(this._id);this._selectContainerTimeZone.style.display=this._selectedValueAutoTimeZone==="N"?"block":"none"};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onTimeZoneItemSelect=function(t,e){this.closeMenu();this._selectedValueTimeZone=this._inputTimeZone.value=e.value;var i=BX.prop.getString(this.getTimeZoneItemByValue(this._selectedValueTimeZone),"NAME",this._selectedValueTimeZone);this._selectTimeZone.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i);this.markAsChanged();BX.PopupMenu.destroy(this._id)};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getTimeZoneItems=function(){if(!this._itemsAutoTimeZone){this._itemsAutoTimeZone=BX.prop.getArray(this._schemeElement.getData(),"timezone_items",[])}return this._itemsAutoTimeZone};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getAutoTimeZoneItems=function(){if(!this._itemsTimeZone){this._itemsTimeZone=BX.prop.getArray(this._schemeElement.getData(),"auto_timezone_items",[])}return this._itemsTimeZone};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getTimeZoneItemByValue=function(t){var e=this.getTimeZoneItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getAutoTimeZoneItemByValue=function(t){var e=this.getAutoTimeZoneItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getFirstItem=function(){var t=this.getItems();return t.length>0?t[0]:null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.save=function(){if(!this.isEditable()){return}var t={timeZone:this._selectedValueTimeZone,autoTimeZone:this._selectedValueAutoTimeZone};this._model.setField(this.getName(),t)};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getRuntimeValue=function(){return this._mode===BX.Intranet.UserProfile.EntityEditorMode.edit&&this._input?this._selectedValue:""}}if(typeof BX.Intranet.UserProfile.EntityEditorPhone==="undefined"){BX.Intranet.UserProfile.EntityEditorPhone=function(){BX.Intranet.UserProfile.EntityEditorPhone.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.Intranet.UserProfile.EntityEditorPhone.create=function(t,e){var i=new BX.Intranet.UserProfile.EntityEditorPhone;i.initialize(t,e);return i};BX.extend(BX.Intranet.UserProfile.EntityEditorPhone,BX.UI.EntityEditorField);BX.Intranet.UserProfile.EntityEditorPhone.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.Intranet.UserProfile.EntityEditorPhone.prototype.getContentWrapper=function(){return this._innerWrapper};BX.Intranet.UserProfile.EntityEditorPhone.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.Intranet.UserProfile.EntityEditorPhone.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.checkPhoneIcon();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var o=this.getCreationPlaceholder();if(o!==""){this._input.setAttribute("placeholder",o)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},children:[BX.create("span",{text:n}),r?BX.create("div",{props:{className:"intranet-user-profile-phone-icon"},events:{mouseup:function(t){t.preventDefault();t.stopPropagation();top.BXIM.phoneTo(n)}}}):""]})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.Intranet.UserProfile.EntityEditorPhone.prototype.checkPhoneIcon=function(t){return this._model._settings["SHOW_PHONE_ICON"]=="Y"}}}))})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17455640301655";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,n){n=n||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=n.sections||{};this.frequencyItem=n.frequencyItem||{};this.ajaxPath=n.ajaxPath||"";this.bindingId=n.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&BX(this.idTop).getAttribute("href")==="#"){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var n=0,e=i.length;n<e;n++){i[n]["text"]=i[n]["text"];if(typeof i[n]["items"]!=="undefined"){i[n]["items"]=this.buildMenu(i[n]["items"])}else if(!i[n]["system"]){i[n]["onclick"]=this.onItemClick.bind(this,i[n]["id"],i[n]["onclick"])}t.push(i[n])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false;if(i&&i.target){i.target.blur()}}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/intranet.apps/templates/.default/script.min.js?17455640301894";s:6:"source";s:68:"/bitrix/components/bitrix/intranet.apps/templates/.default/script.js";s:3:"min";s:72:"/bitrix/components/bitrix/intranet.apps/templates/.default/script.min.js";s:3:"map";s:72:"/bitrix/components/bitrix/intranet.apps/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(e,t,s,n){"use strict";var a=function(){function e(s){babelHelpers.classCallCheck(this,e);this.popup=null;this.personalMobile=t.Type.isStringFilled(s.personalMobile)?s.personalMobile:"";this.initAppsInstall()}babelHelpers.createClass(e,[{key:"initAppsInstall",value:function e(){var s=this;var n=document.querySelector("[data-role='profile-android-app']");if(t.Type.isDomNode(n)){n.addEventListener("click",(function(){s.showSmsPopup(s.personalMobile)}))}var a=document.querySelector("[data-role='profile-ios-app']");if(t.Type.isDomNode(a)){a.addEventListener("click",(function(){s.showSmsPopup(s.personalMobile)}))}}},{key:"showSmsPopup",value:function e(a){this.popup=s.PopupManager.create({id:"intranet-apps-widget-sms-popup",className:"intranet-apps-widget-popup",titleBar:t.Loc.getMessage("INTRANET_APPS_WIDGET_INSTALL"),cacheable:false,maxWidth:450,contentColor:"white",content:t.Dom.create("div",{children:[t.Dom.create("div",{props:{className:"intranet-apps-widget-popup-title"},html:t.Loc.getMessage("INTRANET_APPS_WIDGET_PHONE")}),t.Dom.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-wa"},children:[t.Dom.create("input",{props:{value:a,className:"ui-ctl-element",type:"text"},events:{input:function e(t){a=t.target.value}}})]}),t.Dom.create("div",{props:{className:"intranet-apps-widget-popup-text"},html:t.Loc.getMessage("INTRANET_APPS_WIDGET_INSTALL_TEXT")})]}),closeIcon:true,contentPadding:10,buttons:[new n.CreateButton({text:t.Loc.getMessage("INTRANET_APPS_WIDGET_SEND"),className:"ui-btn-primary",events:{click:function e(s){s.setWaiting();var n=s.context;t.ajax.runAction("intranet.controller.sms.sendsmsforapp",{data:{phone:a}}).then((function(){n.close()}),(function(){n.close()}))}}})]});this.popup.show()}}]);return e}();e.AppsWidget=a})(this.BX.Intranet=this.BX.Intranet||{},BX,BX.Main,BX.UI);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?174556396773565";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"]){return}this.BX=this.BX||{};(function(e,t,i,n,r){"use strict";var a=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","SomeParser");babelHelpers.defineProperty(this,"buttonParams",{name:"Some parser name",iconClassName:"some-parser-class",disabledForTextarea:false,src:"/icon.png",toolbarSort:205,compact:false});this.editor=t;this.htmlEditor=i;this.handler=this.handler.bind(this)}babelHelpers.createClass(e,[{key:"handler",value:function e(){}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){return""}},{key:"hasButton",value:function e(){return this.buttonParams!==null}},{key:"getButton",value:function e(){if(this.buttonParams===null){return null}return{id:this.id,name:this.buttonParams.name,iconClassName:this.buttonParams.iconClassName,disabledForTextarea:this.buttonParams.disabledForTextarea,src:this.buttonParams.src,toolbarSort:this.buttonParams.toolbarSort,compact:this.buttonParams.compact===true,handler:this.handler}}},{key:"getParser",value:function e(){var t=this;return{name:this.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:this.unparse.bind(this)}}}}]);return e}();var o=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++){a[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id","spoiler");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"buttonParams",{name:r.Loc.getMessage("MPF_SPOILER"),iconClassName:"spoiler",disabledForTextarea:false,src:r.Loc.getMessage("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.svg",toolbarSort:205});return i}babelHelpers.createClass(t,[{key:"handler",value:function e(){var t;if(!this.htmlEditor.bbCode||!this.htmlEditor.synchro.IsFocusedOnTextarea()){t=this.htmlEditor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=this.htmlEditor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}},{key:"parse",value:function e(t,i){if(/\[spoiler(([^\]])*)\]/gi.test(t)){t=t.replace(/[\x01-\x02]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"\x01$1\x01").replace(/\[\/spoiler]/gi,"\x02");var n=/(?:\x01([^\x01]*)\x01)([^\x01-\x02]+)\x02/gi;while(t.match(n)){t=t.replace(n,function(e,t,i){t=t.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'.concat(this.htmlEditor.SetBxTag(false,{tag:"spoiler"}),'" title="').concat(t,'">').concat(i,"</blockquote>")}.bind(this))}}t=t.replace(/\001([^\001]*)\001/gi,"[spoiler$1]").replace(/\002/gi,"[/spoiler]");return t}},{key:"unparse",value:function e(t,i){var n="";for(var r=0;r<i.node.childNodes.length;r++){n+=this.htmlEditor.bbParser.GetNodeHtml(i.node.childNodes[r])}n=n.trim();if(n!==""){return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}]);return t}(a);var s=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","postuser");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);t.EventEmitter.subscribe(n,"OnIframeKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyDownHandler){window.onKeyDownHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyUpHandler){window.onKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){if(window["BXfpdStopMent"+n.formID]){window["BXfpdStopMent"+n.formID]()}}));t.EventEmitter.subscribe(n,"OnTextareaKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnTextareaKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(i,n,n.formID)}}));return r}babelHelpers.createClass(i,[{key:"parse",value:function e(t,i){var n=this;t=t.replace(/\[USER\s*=\s*(\d+)\](.*?)\[\/USER\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,userId:t,userName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[PROJECT\s*=\s*(\d+)\](.*?)\[\/PROJECT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,projectId:t,projectName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[DEPARTMENT\s*=\s*(\d+)\](.*?)\[\/DEPARTMENT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,departmentId:t,departmentName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")}));return t}},{key:"unparse",value:function e(t,i){var n=this;var a="";i.node.childNodes.forEach((function(e){a+=n.htmlEditor.bbParser.GetNodeHtml(e)}));a=String(a).trim();var o="";if(r.Type.isStringFilled(a)){if(!r.Type.isUndefined(t.userId)){o="[USER=".concat(t.userId,"]").concat(a,"[/USER]")}else if(!r.Type.isUndefined(t.projectId)){o="[PROJECT=".concat(t.projectId,"]").concat(a,"[/PROJECT]")}else if(!r.Type.isUndefined(t.departmentId)){o="[DEPARTMENT=".concat(t.departmentId,"]").concat(a,"[/DEPARTMENT]")}}return o}}]);return i}(a);var l=function(){function e(i,n,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actionPool",[]);this.cid=i;this.container=n;this.editor=r;t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"BFileDLoadFormController",new t.BaseEvent({compatData:[i]}))}));t.EventEmitter.subscribe(r.getEventObject(),"onCollectControllers",(function(e){e.data[i]={values:[]}}))}babelHelpers.createClass(e,[{key:"exec",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t){this.actionPool.push(t)}if(this.isReady){try{var i;while((i=this.actionPool.shift())&&i){i.apply(this)}}catch(e){console.log("error in attachments controllers: ",e)}}}},{key:"getId",value:function e(){return this.cid}},{key:"getFieldName",value:function e(){return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}i.container.querySelector('inptut[name="'.concat(i.getFieldName(),'"]')).forEach((function(e){e.parentNode.removeChild(e)}))}))}},{key:"isReady",get:function e(){return true}}]);return e}();var d=function(e){babelHelpers.inherits(i,e);function i(e,n,r){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n,r));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfUploader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfHandler",null);var o=function e(i){a.diskUfUploader=i;a.exec();var n=function e(i){t.EventEmitter.emit(r.getEventObject(),"onUploadsHasBeenChanged",i)};t.EventEmitter.subscribe(a.diskUfUploader,"onFileIsInited",n);t.EventEmitter.subscribe(a.diskUfUploader,"ChangeFileInput",n)};if(BX.UploaderManager.getById(e)){o(BX.UploaderManager.getById(e))}t.EventEmitter.subscribeOnce(n.parentNode,"DiskDLoadFormControllerInit",(function(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];a.diskUfHandler=n;if(e===n.CID&&!a.diskUfUploader){o(n.agent)}}));t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"DiskLoadFormController",new t.BaseEvent({compatData:[i]}))}));return a}babelHelpers.createClass(i,[{key:"getFieldName",value:function e(){if(this.diskUfHandler){return this.diskUfHandler.params.controlName}return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}Array.from(i.container.querySelectorAll('inptut[name="'.concat(i.getFieldName(),'"]'))).forEach((function(e){e.parentNode.removeChild(e)}));var e=null;for(var n in t){if(t.hasOwnProperty(n)&&t[n]&&t[n]["USER_TYPE_ID"]==="disk_file"&&t[n]["FIELD_NAME"]===i.getFieldName()){e=t[n]["VALUE"]}}if(e){var r={};e.forEach((function(e){var t=document.querySelector("#disk-attach-"+e);if(t.tagName!=="A"){t=t.querySelector("img")}if(t){r["E"+e]={type:"file",id:e,name:t.getAttribute("data-bx-title")||t.getAttribute("data-title"),size:t.getAttribute("data-bx-size")||"",sizeInt:t.getAttribute("data-bx-size")||"",width:t.getAttribute("data-bx-width"),height:t.getAttribute("data-bx-height"),storage:"disk",previewUrl:t.tagName==="A"?"":t.getAttribute("data-bx-src")||t.getAttribute("data-src"),fileId:t.getAttribute("bx-attach-file-id")};if(t.hasAttribute("bx-attach-xml-id"))r["E"+e]["xmlId"]=t.getAttribute("bx-attach-xml-id");if(t.hasAttribute("bx-attach-file-type"))r["E"+e]["fileType"]=t.getAttribute("bx-attach-file-type")}}));i.diskUfHandler.selectFile({},{},r)}}))}},{key:"isReady",get:function e(){return!!this.diskUfUploader}}]);return i}(l);var c;var u=function(e){babelHelpers.inherits(i,e);function i(e,n){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"id","uploadfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"regexp",/\[FILE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"controllers",new Map);a.checkButtonsDebounced=r.Runtime.debounce(a.checkButtons,500,babelHelpers.assertThisInitialized(a));a.init();t.EventEmitter.subscribe(e.getEditor(),"OnContentChanged",a.checkButtons.bind(babelHelpers.assertThisInitialized(a)));t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.reinit(i,n)}));return a}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e,n){var r=e.id.replace("file-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new l(r,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,2),a=n[0].element_id,o=n[1],s=o.id,l=o.doc_prefix,d=o.CID;if(r===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],a=t[1].id;if(r===a&&i.values.has(n)){i.values["delete"](n);i.deleteFile([n])}}));if(n===0){t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();if(window["BfileFD"+r]){window["BfileFD"+r].agent.UploadDroppedFiles(babelHelpers.toConsumableArray(e.getData()))}}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=t.id.replace("wd-doc","");var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=function e(){i.insertFile(n,t)};var s=t.querySelector(".f-wrap");if(s){s.addEventListener("click",o);s.style.cursor="pointer";s.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img");if(l){l.addEventListener("click",o);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=l.rel||l.src;a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")}if(t instanceof HTMLTableRowElement&&t.querySelector(".files-info")){if(!a.buttonNode){a.buttonNode=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n<span type="button" onclick="','" data-role="button-insert" class="insert-btn">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text">',"</span>\n</span>"])),o,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));t.querySelector(".files-info").appendChild(a.buttonNode);this.checkButtonsDebounced()}}return[n,a]}},{key:"buildHTML",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t});var a='<span data-bx-file-id="'.concat(t,'" id="').concat(r,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(i.name,"</span>");if(i.image.src){var o=[];if(n){o.push('style="width:'.concat(n.width,"px;height:").concat(n.height,'px;"'))}else if(i.image.width&&i.image.height){o.push('style="width:'.concat(i.image.width,"px;height:").concat(i.image.height,'px;" '));o.push("onload=\"this.style.width='auto';this.style.height='auto';\"")}a='<img style="max-width: 90%;"  data-bx-file-id="'.concat(t,'" id="').concat(r,'" src="').concat(i.image.src,'" lowsrc="').concat(i.image.lowsrc,'" ').concat(o.join(" "),"/>")}return a}},{key:"buildText",value:function e(t,i){return"[FILE ID=".concat(t).concat(i||"","]")}},{key:"insertFile",value:function e(i,n){var r=this.values.get(String(i));if(r){t.EventEmitter.emit(this.editor.getEventObject(),"OnInsertContent",[this.buildText(i),this.buildHTML(i,r)])}}},{key:"deleteFile",value:function e(t){var i=this.htmlEditor.GetContent();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var r in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(r)&&babelHelpers["typeof"](this.htmlEditor.bxTags[r])==="object"&&this.htmlEditor.bxTags[r]["tag"]===this.id&&t.indexOf(String(this.htmlEditor.bxTags[r]["fileId"]))>=0&&n.getElementById(r)){var a=n.getElementById(r);a.parentNode.removeChild(a)}}this.htmlEditor.SaveContent()}else{var o=i.replace(this.regexp,(function(e,i){return t.indexOf(i)>=0?"":e}));this.htmlEditor.SetContent(o);this.htmlEditor.Focus()}}},{key:"checkButtons",value:function e(t){var i=t?t.compatData[0]:this.htmlEditor.GetContent();var n=babelHelpers.toConsumableArray(i.matchAll(this.regexp)).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return n}));this.values.forEach((function(e,t){if(!e.buttonNode){return}var i=n.indexOf(t)>=0;if(i===true&&e.buttonNode.className!=="insert-text"){e.buttonNode.className="insert-text";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="none";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display=""}else if(i!==true&&e.buttonNode.className!=="insert-btn"){e.buttonNode.className="insert-btn";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display="none"}}))}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t,i,n){if(this.values.has(t)){return this.buildHTML(t,this.values.get(t),i>0&&n>0?{width:i,height:n}:null)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var r=parseInt(n.hasAttribute("width")?n.getAttribute("width"):0);var a=parseInt(n.hasAttribute("height")?n.getAttribute("height"):0);var o="";if(r>0&&a>0){o=" WIDTH="+r+" HEIGHT="+a}var s=n.getAttribute("data-bx-file-id");return this.buildText(s,o)}}]);return i}(a);var f=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","uploadimage");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"regexp",/\[IMAGE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"controllers",new Map);r.init();console.log("PostImage: ");t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];r.reinit(i,n)}));return r}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e){var n=e.id.replace("file-selectdialog-","");var r=i.controllers.get(n);if(!r){r=new l(n,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var r=babelHelpers.slicedToArray(t.data,2),a=r[0].element_id,o=r[1],s=o.id,l=o.doc_prefix,d=o.CID;if(n===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),r=t[0],a=t[1].id;if(n===a&&i.values.has(r)){i.values["delete"](r)}}))}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=t.id.replace("wd-doc","");var n={id:i,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,image:{src:null,lowsrc:null,width:null,height:null}};return[i,n]}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){var n=i.node;return""}}]);return i}(a);var p;var h=function(e){babelHelpers.inherits(i,e);function i(){var e;var t;babelHelpers.classCallCheck(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(i)).call.apply(e,[this].concat(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id","diskfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);return t}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".diskuf-selectdialog")).forEach((function(e,n){var r=e.id.replace("diskuf-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new d(r,e,i.editor);i.controllers.set(r,a);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,3),r=n[0].element_id,o=n[1].CID,s=n[2];if(a.getId()!==o||i.values.has(r)){return}var l=i.parseFile(e.querySelector("#disk-edit-attach"+r)),d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];i.values.set(c,f);if(c!==u){i.values.set(u,f)}if(s&&s["insertImageAfterUpload"]&&f.image.src){i.insertFile(c,f.node)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],r=t[1].CID;if(a.getId()===r&&i.values.has(n)){var o=i.values.get(n);i.values["delete"](o.id);i.values["delete"](o.fileId);i.deleteFile([o.id,o.fileId])}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadFailed",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],r=t[1].CID,o=t[2];if(a.getId()===r&&o&&o["referrerToEditor"]){BX.onCustomEvent(o["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(i.editor,"OnImageDataUriCaughtFailed",[o["referrerToEditor"]])}}));if(n===0){b(i,a,e,i.editor);m(i,a,e,i.editor);t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();a.diskUfUploader.onChange(babelHelpers.toConsumableArray(e.getData()))}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,3),r=n[0],a=n[1],o=n[2];i.values.set(r,o);if(r!==a){i.values.set(a,o)}}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=String(t.id.replace("disk-edit-attach",""));var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,fileId:t.getAttribute("bx-attach-file-id"),node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=t.querySelector(".f-wrap");var s=function e(){i.insertFile(n,t)};if(o){o.addEventListener("click",s);o.style.cursor="pointer";o.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img.files-preview");if(l&&(l.src.indexOf("bitrix/tools/disk/uf.php")>=0||l.src.indexOf("/disk/showFile/")>=0)){l.addEventListener("click",s);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=(l.rel||l.getAttribute("data-bx-src")||l.src).replace(/&(width|height)=\d+/gi,"");var d=function e(){a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")};l.addEventListener("load",d);if(l.complete){d()}}if(t instanceof HTMLTableRowElement&&!a.buttonNode){a.buttonNode=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n<span class="insert-btn" data-role="button-insert" onclick="','">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text" style="display: none;">',"</span>\n</span>"])),s,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));setTimeout((function(){if(t.querySelector(".files-info")){t.querySelector(".files-info").appendChild(a.buttonNode);i.checkButtonsDebounced()}}))}return[n,a.fileId,a]}},{key:"buildText",value:function e(t,i){return"[DISK FILE ID=".concat(t).concat(i||"","]")}}]);return i}(u);function b(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnVideoHasCaught",(function(r){var a=r.getData();var o=function i(r){var o=babelHelpers.slicedToArray(r.data,3),s=o[0].element_id;babelHelpers.objectDestructuringEmpty(o[1]);var l=o[2];if(a===l&&e.values.has(s)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);e.insertFile(s,e.values.get(s).node)}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",o);i.exec((function(){i.diskUfUploader.onChange([a])}));r.stopImmediatePropagation()}))}function m(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnImageHasCaught",(function(r){r.stopImmediatePropagation();var a=r.getData();return new Promise((function(o,s){var l=function i(r){var s=babelHelpers.slicedToArray(r.data,3),l=s[0].element_id;babelHelpers.objectDestructuringEmpty(s[1]);var c=s[2];if(a===c&&e.values.has(l)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",d);var u=e.values.get(l);var f=e.buildHTML(l,u);o({image:u.image,html:f})}};var d=function e(i){var r=babelHelpers.slicedToArray(i.data,3),o=r[0];babelHelpers.objectDestructuringEmpty(r[1]);var d=r[2];if(a===d){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",e);s()}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.subscribe(n.parentNode,"OnFileUploadFailed",d);i.exec((function(){i.diskUfUploader.onChange([r.getData()])}))}))}))}var v=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id","ai-image-generator");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"buttonParams",{name:"AI image generator",iconClassName:"feed-add-post-editor-btn-ai-image",disabledForTextarea:false,toolbarSort:398,compact:true});return i}babelHelpers.createClass(t,[{key:"handler",value:function e(){var t=this;if(!this.editor.isImageCopilotEnabledBySettings()){top.BX.UI.InfoHelper.show("limit_copilot_off");return}r.Runtime.loadExtension("ai.picker").then((function(){var e=new BX.AI.Picker({moduleId:"main",contextId:"image_"+r.Loc.getMessage("USER_ID"),analyticLabel:"main_post_form_comments_ai_image",saveImages:false,history:true,onSelect:function e(i){fetch(i).then((function(e){return e.blob()})).then((function(e){BX.onCustomEvent(window,"onAddVideoMessage",[e,t.editor.getFormId()])}))}});e.setLangSpace(BX.AI.Picker.LangSpace.image);e.image()}))}},{key:"parse",value:function e(t,i){return t}},{key:"unparse",value:function e(t,i){return""}}]);return t}(a);function g(e,t,i){if(e==="Spoiler"){return new o(t,i)}if(e==="MentionUser"){return new s(t,i)}if(e==="UploadImage"){return new f(t,i)}if(e==="UploadFile"){return new u(t,i)}if(e==="AIImage"){return new v(t,i)}if(babelHelpers["typeof"](e)==="object"&&e["disk_file"]){return new h(t,i)}return null}function E(e,t){if(!t){return}BX.addCustomEvent(t,"onAutoSavePrepare",(function(t){t.FORM.setAttribute("bx-lhe-autosave-prepared","Y");setTimeout((function(){BX.addCustomEvent(e,"OnContentChanged",(function(e){t["mpfTextContent"]=e;t.Init()}))}),1500)}));BX.addCustomEvent(t,"onAutoSave",(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"]=e["mpfTextContent"]}));BX.addCustomEvent(t,"onAutoSaveRestore",(function(t,i){if(i["text"]&&/[^\s]+/gi.test(i["text"])){e.CheckAndReInit(i["text"])}}));if(t.hasAttribute("bx-lhe-autosave-prepared")&&t.BXAUTOSAVE){t.removeAttribute("bx-lhe-autosave-prepared");setTimeout(t.BXAUTOSAVE.Prepare,100)}}function y(e,t,i){var n=false;if(i.showPanelEditor!==true&&i.showPanelEditor!==false){i.showPanelEditor=!t.toolbar.IsShown();n=true}e.exec((function(){var n=e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]');if(i.showPanelEditor){t.dom.toolbarCont.style.opacity="inherit";t.toolbar.Show();if(n){n.classList.add("feed-add-post-form-btn-active")}}else{t.toolbar.Hide();if(n){n.classList.remove("feed-add-post-form-btn-active")}}}));if(n!==false){BX.userOptions.save("main.post.form","postEdit","showBBCode",i.showPanelEditor?"Y":"N")}}function w(e,t){if(!(t.urlPreviewId&&window["BXUrlPreview"]&&BX(t.urlPreviewId))){return}var i=new BXUrlPreview(BX(t.urlPreviewId));var n=function e(t){i.attachUrlPreview({url:t})};var r=function e(t,n,r,a){if(n==="createLink"&&BX.type.isPlainObject(a)&&a.hasOwnProperty("href")){i.attachUrlPreview({url:a.href})}};BX.addCustomEvent(e,"OnAfterUrlConvert",n);BX.addCustomEvent(e,"OnAfterLinkInserted",n);BX.addCustomEvent(e,"OnBeforeCommandExec",r);BX.addCustomEvent(e,"OnReinitialize",(function(e,t){i.detachUrlPreview();var n;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){n=t[r]["VALUE"];break}}if(n){i.attachUrlPreview({id:n})}}))}function B(e,t){e.exec((function(){t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:r.Loc.getMessage("BXEdDelFromText"),bbMode:true,ACTION:function e(){var i=t.contextMenu.GetTargetItem("postimage");if(!i)i=t.contextMenu.GetTargetItem("postdocument");if(!i)i=t.contextMenu.GetTargetItem("postfile");if(i&&i.element){t.selection.RemoveNode(i.element)}t.contextMenu.Hide()}}];if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}}))}function I(e){var i=document.querySelector("#lhe_button_submit_"+e.getFormId());if(i){i.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["submit"]);i.preventDefault();i.stopPropagation()}))}var n=document.querySelector("#lhe_button_cancel_"+e.getFormId());if(n){n.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["cancel"]);i.preventDefault();i.stopPropagation()}))}}function S(e,i){var n=e.getContainer().querySelector('[data-bx-role="toolbar"]');if(n.querySelector('[data-id="file"]')){var r=n.querySelector('[data-id="file"]');if(r){r.addEventListener("click",(function(){t.EventEmitter.emit(e.getEventObject(),"onShowControllers",r.hasAttribute("data-bx-button-status")?"hide":"show")}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers",(function(e){var t=e.data;if(t.toString()==="show"){r.setAttribute("data-bx-button-status","active")}else{r.removeAttribute("data-bx-button-status")}}));r.setAttribute("data-bx-files-count",0);t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Increment",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)+i,0);if(n>0){if(!r["counterObject"]){r["counterObject"]=new BX.UI.Counter({value:n,color:BX.UI.Counter.Color.GRAY,animate:true});var a=r.querySelector("span");a.appendChild(r["counterObject"].getContainer())}else{r["counterObject"].update(n)}}r.setAttribute("data-bx-files-count",n)}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Decrement",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)-i,0);r.setAttribute("data-bx-files-count",n);if(r["counterObject"]){r["counterObject"].update(n)}}))}}if(n.querySelector('[data-id="search-tag"]')){window["BXPostFormTags_"+e.getFormId()]=new BXPostFormTags(e.getFormId(),n.querySelector('[data-id="search-tag"]'))}if(n.querySelector('[data-id="create-link"]')){n.querySelector('[data-id="create-link"]').addEventListener("click",(function(e){i.toolbar.controls.InsertLink.OnClick(e)}))}if(n.querySelector('[data-id="video"]')){n.querySelector('[data-id="video"]').addEventListener("click",(function(e){i.toolbar.controls.InsertVideo.OnClick(e)}))}if(n.querySelector('[data-id="quote"]')){var a=n.querySelector('[data-id="quote"]');a.setAttribute("data-bx-type","action");a.setAttribute("data-bx-action","quote");a.addEventListener("mousedown",(function(e){i.toolbar.controls.Quote.OnMouseDown.apply(i.toolbar.controls.Quote,[e]);i.CheckCommand(a)}))}if(e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]')){e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]').addEventListener("click",(function(){e.showPanelEditor()}))}var o=n.querySelector('[data-id="copilot"]');if(o){o.addEventListener("click",(function(){if(!e.isTextCopilotEnabledBySettings()){top.BX.UI.InfoHelper.show("limit_copilot_off");return}e.showCopilot()}))}}var C;var T;function P(e,t){if(!T){T=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){T.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}}))}),{threshold:0})}e.observedCallback=t;T.observe(e)}var O=0;var x=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.container=i.querySelector('[data-bx-role="toolbar"]');this.adjustMorePosition=this.adjustMorePosition.bind(this);this.moreItem=i.querySelector('[data-bx-role="toolbar-item-more"]');this.moreItem.addEventListener("click",this.showSubmenu.bind(this));P(this.container,this.adjustMorePosition);window.addEventListener("resize",this.adjustMorePosition)}babelHelpers.createClass(e,[{key:"insertAfter",value:function e(t,i){if(!r.Type.isElementNode(t["BODY"])&&!r.Type.isStringFilled(t["BODY"])){return}var n=r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="main-post-form-toolbar-button" data-bx-role="toolbar-item"></div>'])));if(r.Type.isElementNode(t["BODY"])){n.appendChild(t["BODY"])}else{n.innerHTML=t["BODY"]}if(t["ID"]){n.setAttribute("data-id",t["ID"])}if(i!==null){var a=false;var o=null;Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(a===true&&o===null){o=e}else if(a===false&&e&&e.dataset&&e.dataset.id===i){a=true}}));if(o){o.parentNode.insertBefore(n,o)}}if(!n.parentNode){this.container.appendChild(n)}this.adjustMorePosition()}},{key:"getItems",value:function e(){return Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]'))}},{key:"getVisibleItems",value:function e(){var t=this;var i=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>t.container.clientHeight/2){i.push(e)}}));return i}},{key:"getHiddenItems",value:function e(){var t=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>0){t.push(e)}}));return t}},{key:"adjustMorePosition",value:function e(){var t=this.getVisibleItems().length;if(t<=0||t>=this.getItems().length){this.moreItem.style.display="none"}else{this.moreItem.style.display=""}}},{key:"getPopup",value:function e(){var t=this;if(!this.popup){this.popup=n.PopupManager.create({id:"main_post_form_toolbar_"+O++,className:"main-post-form-toolbar-popup",cacheable:false,content:this.getPopupContainer(),closeByEsc:true,autoHide:true,angle:true,bindElement:this.moreItem,offsetTop:-5,offsetLeft:5,events:{onClose:function e(){Array.from(t.getPopupContainer().querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){t.container.appendChild(e)}));delete t.popup}}})}return this.popup}},{key:"getPopupContainer",value:function e(){if(!this.popupContainer){this.popupContainer=document.createElement("DIV")}return this.popupContainer}},{key:"showSubmenu",value:function e(){var t=this;var i=this.getHiddenItems();if(i.length<=0){return}i.forEach((function(e){t.getPopupContainer().appendChild(e)}));this.getPopup().show()}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showPopup",value:function e(t){var i=n.PopupManager.getPopupById(this.getPopupId());if(!i){i=new n.Popup(this.getPopupId(),null,{content:this.getTasksLimitPopupContent(),lightShadow:false,offsetLeft:20,autoHide:false,angle:{position:"bottom"},closeByEsc:false,closeIcon:true})}i.setBindElement(t.bindPosition);i.show()}},{key:"getPopupId",value:function e(){return"bx-post-mention-tasks-limit-popup"}},{key:"getTasksLimitPopupContent",value:function e(){return r.Dom.create("DIV",{style:{width:"400px",padding:"10px"},children:[r.Dom.create("SPAN",{html:r.Loc.getMessage("MPF_MENTION_TASKS_LIMIT").replace("#A_BEGIN#",'<a href="javascript:void(0);" onclick="BX.Main.PostFormTasksLimit.onClickTasksLimitPopupSlider(this);">').replace("#A_END#","</a>")})]})}},{key:"onClickTasksLimitPopupSlider",value:function e(t){var i=this;BX.Runtime.loadExtension("ui.info-helper").then((function(e){var n=e.FeaturePromotersRegistry;if(n){n.getPromoter({code:"limit_tasks_observers_participants",bindElement:t}).show()}else{i.hidePopup();BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"postForm",subject:"auditor"}})}}))}},{key:"hidePopup",value:function e(){var t=n.PopupManager.getPopupById(this.getPopupId());if(t){t.close()}}}]);return e}();function X(e,t,i){A(e,t);H(i,"get");return F(e,i)}function H(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function A(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function F(e,t){if(t.get){return t.get.call(e)}return t.value}var D=function(){function e(i,n){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"jobs",new Map);babelHelpers.defineProperty(this,"editorParams",{height:100,ctrlEnterHandler:null,parsers:null,showPanelEditor:false,lazyLoad:true,urlPreviewId:null,tasksLimitExceeded:false});babelHelpers.defineProperty(this,"actionQueue",[]);this.id=i["id"];this.name=i["name"];this.formId=i["formId"];this.eventNode=i.eventNode||document.querySelector("#div"+(this.name||this.id));this.eventNode.dataset.bxHtmlEditable="Y";this.formEntityType=null;e.repo.set(this.getId(),this);if(!r.Type.isArray(n.parsers)&&r.Type.isPlainObject(n.parsers)){n.parsers=Object.values(n.parsers)}this.setEditorParams(n);this.bindEvents(window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(this.getId()):null);this.toolbar=new x(this.getEventObject(),this.getContainer());this.inited=true;if(this.name!==null){window[this.name]=this}BX.onCustomEvent(this,"onInitialized",[this,this.getFormId()]);t.EventEmitter.subscribe(this.getEventObject(),"OnFileUploadSuccess",(function(e){var t=e.compatData;BX.onCustomEvent(a.getEventObject(),"onFileIsAdded",t)}));t.EventEmitter.subscribe(this.getEventObject(),"onBusy",(function(e){var i=e.data;if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsBusy")}a.jobs.set(i,(a.jobs.get(i)||0)+1)}));t.EventEmitter.subscribe(this.getEventObject(),"onReady",(function(e){var i=e.data;if(a.jobs.size<=0||!a.jobs.has(i)){return}var n=a.jobs.get(i);if(n<=1){a.jobs["delete"](i);if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsReady")}}else{a.jobs.set(i,--n)}}))}babelHelpers.createClass(e,[{key:"setEditorParams",value:function e(t){this.editorParams=Object.assign(this.editorParams,t)}},{key:"bindEvents",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.events={};[["OnEditorInitedBefore",this.OnEditorInitedBefore.bind(this)],["OnCreateIframeAfter",this.OnCreateIframeAfter.bind(this)],["OnEditorInitedAfter",this.OnEditorInitedAfter.bind(this)]].forEach((function(e){var t=babelHelpers.slicedToArray(e,2),r=t[0],a=t[1];if(!n){i.events[r]=function(e){if(e.id===i.getId()){
//!it important to use deprecated eventEmitter
BX.removeCustomEvent(r,i.events[r]);delete i.events[r];a(e)}};
//!it important to use deprecated eventEmitter
BX.addCustomEvent(r,i.events[r])}else{a(n)}}));t.EventEmitter.subscribe(this.getEventObject(),"OnShowLHE",this.OnShowLHE.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnButtonClick",this.OnButtonClick.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnParserRegister",(function(e){var t=e.data;i.addParser(t)}));t.EventEmitter.subscribe(this.getEventObject(),"OnGetHTMLEditor",(function(e){var t=e.data;t.htmlEditor=i.getEditor()}));t.EventEmitter.subscribe(this.getEventObject(),"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.insertContent(n,r)}));t.EventEmitter.subscribe(this.getEventObject(),"OnAddButton",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.getToolbar().insertAfter(n,r)}));I(this)}},{key:"getId",value:function e(){return this.id}},{key:"setEditor",value:function i(n){var a=this;if(this.htmlEditor===n){return}this.htmlEditor=n;n.formID=this.getFormId();t.EventEmitter.subscribe(n,"OnCtrlEnter",(function(){n.SaveContent();if(r.Type.isFunction(a.editorParams.ctrlEnterHandler)){a.editorParams.ctrlEnterHandler()}else if(r.Type.isStringFilled(a.editorParams.ctrlEnterHandler)&&window[a.editorParams.ctrlEnterHandler]){window[a.editorParams.ctrlEnterHandler]()}else if(document.forms[a.getFormId()]){BX.submit(document.forms[a.getFormId()])}}));this.editorParams["height"]=n.config["height"];console.groupCollapsed("main.post.form: parsers: ",this.getId());this.editorParams.parsers.forEach((function(e){var t=g(e,a,n);if(t){console.groupCollapsed(e);console.log(t);if(t.hasButton()){n.AddButton(t.getButton())}n.AddParser(t.getParser());console.groupEnd(e)}}));console.groupEnd("main.post.form: parsers: ",this.getId());t.EventEmitter.subscribe(n,"OnImageDataUriHandle",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),r=i[0],o=i[1];var s=BX.UploaderUtils.dataURLToBlob(o.src);if(s&&s.size>0&&s.type.indexOf("image/")===0){t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");s.name=s.name||o.title||"image."+s.type.substr(6);s.referrerToEditor=o;t.EventEmitter.emit(a.getEventObject(),"OnImageHasCaught",new t.BaseEvent({data:s})).forEach((function(e){e.then((function(e){var i=e.image,r=e.html;t.EventEmitter.emit(n,"OnImageDataUriCaughtUploaded",new t.BaseEvent({compatData:[o,i,{replacement:r}]}))}))["catch"]((function(){t.EventEmitter.emit(n,"OnImageDataUriCaughtFailed",new t.BaseEvent({compatData:[o]}))}))}))}}));t.EventEmitter.subscribe(t.EventEmitter.GLOBAL_TARGET,"onAddVideoMessage",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),n=i[0],r=i[1];if(!r||a.getFormId()!==r){return}t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");t.EventEmitter.emit(a.getEventObject(),"OnVideoHasCaught",new t.BaseEvent({data:n}))}));if(this.editorParams.isDnDEnabled){(function(){var i=BX("micro"+(a.name||a.id));var n=false;var r=0;var o=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r);r=0}if(n===true){return}var o=t&&t["dataTransfer"]&&t["dataTransfer"]["types"]&&t["dataTransfer"]["types"].indexOf("Files")>=0;if(o){n=true;a.getContainer().classList.add("feed-add-post-dnd-over");if(i){i.classList.add("feed-add-post-micro-dnd-ready")}}return true};var s=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r)}r=setTimeout((function(){n=false;a.getContainer().classList.remove("feed-add-post-dnd-over");if(i){i.classList.remove("feed-add-post-micro-dnd-ready")}}),100);return false};var l=function e(i){s(i);if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(a.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}));t.EventEmitter.emit(a.getEventObject(),"onFilesHaveDropped",{event:i})}return false};a.getContainer().addEventListener("dragover",o);a.getContainer().addEventListener("dragenter",o);a.getContainer().addEventListener("dragleave",s);a.getContainer().addEventListener("dragexit",s);a.getContainer().addEventListener("drop",l);a.getContainer().setAttribute("dropzone","copy f:*/*");if(!document.body.hasAttribute("dropzone")){document.body.setAttribute("dropzone","copy f:*/*");document.body.addEventListener("dragover",(function(e){e.preventDefault();e.stopPropagation();return true}));document.body.addEventListener("drop",function(i){i.preventDefault();i.stopPropagation();if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){var n;var r;var a=X(this.constructor,e,N).keys();while((r=a.next())&&r.done!==true&&r.value){n=r.value}if(n){t.EventEmitter.emit(n.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(n.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}));t.EventEmitter.emit(n.getEventObject(),"onFilesHaveDropped",{event:i})}}return false}.bind(a))}if(i){i.addEventListener("dragenter",(function(e){o(e);t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}))}))}t.EventEmitter.subscribe(a.getEditor(),"OnIframeDrop",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return l(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragOver",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return o(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragLeave",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return s(i)}))})()}t.EventEmitter.subscribe(n,"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.insertContent(i,n)}));y(this,n,this.editorParams);w(n,this.editorParams);B(this,n);E(n,BX(this.getFormId()));S(this,n);t.EventEmitter.subscribe(this.getEventObject(),"OnAfterShowLHE",(function(){a.getEditor().AllowBeforeUnloadHandler()}));t.EventEmitter.subscribe(this.getEventObject(),"OnAfterHideLHE",(function(){k.hidePopup();a.getEditor().DenyBeforeUnloadHandler()}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){var e=new MouseEvent("click",{bubbles:true,cancelable:true,view:window});n.iframeView.container.dispatchEvent(e)}))}},{key:"getEditor",value:function e(){return this.htmlEditor}},{key:"getFormId",value:function e(){return this.formId}},{key:"getEventObject",value:function e(){return this.eventNode}},{key:"getContainer",value:function e(){return this.eventNode}},{key:"getToolbar",value:function e(){return this.toolbar}},{key:"OnEditorInitedBefore",value:function e(t){this.setEditor(t)}},{key:"OnCreateIframeAfter",value:function e(){if(this.editorIsLoaded!==true){this.editorIsLoaded=true;this.exec();t.EventEmitter.emit(this,"OnEditorIsLoaded",[])}}},{key:"OnEditorInitedAfter",value:function e(i){if(!this.editorParams.lazyLoad){t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",i,false]}))}if(i.sandbox&&i.sandbox.inited){this.OnCreateIframeAfter()}}},{key:"addParser",value:function e(t){var i=this;this.exec((function(){t.init(i.getEditor());i.getEditor().AddParser({name:t.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:t.unparse}});if(!i["addParserAfterDebounced"]){i.addParserAfterDebounced=r.Runtime.debounce((function(){var e=i.getEditor().GetContent();if(/&#9[13];/gi.test(e)){i.getEditor().SetContent(e.replace(/&#91;/gi,"[").replace(/&#93;/gi,"]"),true)}}),100)}i.addParserAfterDebounced()}))}},{key:"insertContent",value:function e(t){var i=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.exec((function(){var e=i.getEditor().GetViewMode();if(e==="wysiwyg"){var r=i.getEditor().selection.GetRange();i.getEditor().InsertHtml(n||t,r);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),500);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),1e3)}else{i.getEditor().textareaView.Focus();if(!i.getEditor().bbCode){var a=i.getEditor().GetIframeDoc();var o=a.createElement("DIV");o.style.display="none";o.innerHTML=t;a.body.appendChild(o);t=i.getEditor().Parse(t,true,false);o.parentNode.removeChild(o)}i.getEditor().textareaView.WrapWith("","",t)}}))}},{key:"reinit",value:function e(i,n){var a=this;var o="hide";if(r.Type.isPlainObject(n)&&Object.values(n).length){Object.values(n).forEach((function(e){if(e&&e["VALUE"]){o="show"}}))}t.EventEmitter.emitAsync(this.getEventObject(),"onReinitializeBeforeAsync",[i,n]).then((function(){t.EventEmitter.emit(a.getEventObject(),"onShowControllers",o);t.EventEmitter.emit(a.getEventObject(),"onReinitializeBefore",[i,n]);a.getEditor().CheckAndReInit(r.Type.isString(i)?i:"");BX.onCustomEvent(a.getEditor(),"onReinitialize",[a,i,n]);if(a.editorParams["height"]){a.oEditor.SetConfigHeight(a.editorParams["height"]);a.oEditor.ResizeSceleton()}}))}},{key:"OnShowLHE",value:function i(n){var a=this;var o=n.data,s=n.compatData;var l=o||s,d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];if(!this.getEditor()&&window["BXHtmlEditor"]){window["BXHtmlEditor"].Get(this.getId()).Init()}c=c===false||c==="hide"||c==="justShow"?c:true;var p=BX("micro"+(this.name||this.id));if(p){p.style.display=c===true||c==="justShow"?"none":"block"}if(c==="hide"){X(this.constructor,e,N)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");if(this.getContainer().style.display==="none"){t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide")}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.getContainer().scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){a.getContainer().style.cssText="";a.getContainer().style.display="none";t.EventEmitter.emit(a.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(a.getEventObject(),"onShowControllers","hide")}}).animate()}}else if(c){X(this.constructor,e,N).set(this);this.formEntityType=r.Type.isArray(f)&&r.Type.isStringFilled(f[0])&&f[0].match(/^TASK_(\d+)$/i)?"task":null;if(u&&r.Type.isPlainObject(u)){if(u["onShowControllers"]){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",u["onShowControllers"])}}t.EventEmitter.emit(this.getEventObject(),"OnBeforeShowLHE");if(c==="justShow"||this.getContainer().style.display==="block"){this.getContainer().style.display="block";t.EventEmitter.emit(this.getEventObject(),"OnAfterShowLHE");if(u!==false){this.getEditor().Focus()}}else{r.Dom.adjust(this.getContainer(),{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:this.getContainer().scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){t.EventEmitter.emit(a.getEventObject(),"OnAfterShowLHE");a.getEditor().Focus();a.getContainer().style.cssText=""}}).animate()}}else{X(this.constructor,e,N)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide");this.getContainer().style.display="none";t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE")}}},{key:"OnButtonClick",value:function e(i){var n=babelHelpers.slicedToArray(i.data,1),r=n[0];if(r!=="cancel"){var a={result:true};t.EventEmitter.emit(this.getEventObject(),"OnClickBeforeSubmit",new t.BaseEvent({compatData:[this,a]}));if(a["result"]!==false){t.EventEmitter.emit(this.getEventObject(),"OnClickSubmit",new t.BaseEvent({compatData:[this]}))}}else{t.EventEmitter.emit(this.getEventObject(),"OnClickCancel",new t.BaseEvent({compatData:[this]}));t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["hide"]}))}}},{key:"exec",value:function e(t,i){if(typeof t=="function"){this.actionQueue.push([t,i])}if(this.editorIsLoaded===true){var n;while((n=this.actionQueue.shift())&&n){n[0].apply(this,n[1])}}}},{key:"showPanelEditor",value:function e(){y(this,this.getEditor(),{})}},{key:"getContent",value:function e(){return this.oEditor?this.oEditor.GetContent():""}},{key:"setContent",value:function e(t){if(this.getEditor()){this.getEditor().SetContent(t)}}},{key:"controllerInit",value:function e(i){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",i==="hide"?"hide":"show")}},{key:"showCopilot",value:function e(){this.getEditor().SetView("wysiwyg");this.getEditor().ShowCopilotAtTheBottom()}},{key:"isTextCopilotEnabledBySettings",value:function e(){var t=this.getEditor().config.isCopilotTextEnabledBySettings;return r.Type.isNil(t)||t}},{key:"isImageCopilotEnabledBySettings",value:function e(){var t=this.getEditor().config.isCopilotImageEnabledBySettings;return r.Type.isNil(t)||t}},{key:"isReady",get:function e(){return this.editorIsLoaded}},{key:"oEditor",get:function e(){return this.getEditor()}},{key:"oEditorId",get:function e(){return this.getId()}},{key:"formID",get:function e(){return this.getFormId()}},{key:"params",get:function e(){return{formID:this.getFormId()}}},{key:"controllers",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var a={};Object.keys(n).forEach((function(e){a[e]=Object.assign({},n[e]);a[e]["values"]={};if(r.Type.isArray(n[e]["values"])){n[e]["values"].forEach((function(t){a[e]["values"][t]={id:t}}))}else if(r.Type.isPlainObject(n[e]["values"])){a[e]["values"]=Object.assign({},n[e]["values"])}}));return a}},{key:"arFiles",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var r={};Object.keys(n).forEach((function(e){if(n[e]["values"]){n[e]["values"].forEach((function(t){r[t]=[e]}))}}));return r}}]);return e}();babelHelpers.defineProperty(D,"repo",new Map);var N={writable:true,value:new Map};window["LHEPostForm"]={getEditor:function e(t){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(babelHelpers["typeof"](t)=="object"?t.id:t):null},getHandler:function e(t){var i=r.Type.isStringFilled(t)?t:t.id;return D.repo.get(i)},getHandlerByFormId:function e(t){var i=null;D.repo.forEach((function(e){if(e.getFormId()===t){i=e}}));return i},reinitData:function e(t,i,n){var a={};if(!r.Type.isPlainObject(n)){n={}}Object.entries(n).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];if(r.Type.isPlainObject(n)&&n["USER_TYPE_ID"]&&n["VALUE"]&&Object.values(n["VALUE"]).length>0){a[i]=n}}));var o=this.getHandler(t);if(o&&(o.isReady||r.Type.isStringFilled(i)||Object.values(a).length>0)){o.exec(o.reinit,[i,a])}return false},reinitDataBefore:function e(i){var n=D.repo.get(i);if(n&&n.getEventObject()){t.EventEmitter.emit(n.getEventObject(),"onReinitializeBefore",[n])}}};e.PostForm=D;e.PostFormTasksLimit=k})(this.BX.Main=this.BX.Main||{},BX.Event,BX,BX.Main,BX);(function(){if(window["BXPostFormTags"])return;var e={selector:{},mentionParams:{}};window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var r=BX.util.trim(t[n]);if(r.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(r,a)){var o;var s=BX.create("span",{children:[o=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});s.insertBefore(document.createTextNode(r),o);this.tagsContainer.insertBefore(s,this.addNewLink);BX.bind(o,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:s,tagValue:r}));this.hiddenField.value+=r+",";i.push(r)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy((function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)}),this));BX.bind(this.activeBlock,"click",BX.proxy((function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)}),this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var t=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e)){e=null}e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");t=e;BX.defer((function(){e.disabled=true}))()}};var i={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};BX.addCustomEvent(window,"onInitialized",(function(e){if(e&&e.eventNode){BX.onCustomEvent(e.eventNode,"OnClickCancel",(function(){i.node=null}))}}));BX.addCustomEvent(window,"BX.MPF.MentionSelector:open",(function(t){var i=BX.Type.isStringFilled(t.formId)?t.formId:"";if(!BX.Type.isStringFilled(i)||BX.Type.isUndefined(e.mentionParams[i])){return}var n=BX.Type.isDomNode(t.bindNode)?t.bindNode:null;var r=BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:null;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id")+(n?"-withsearch":"");var o=BX.UI.EntitySelector.Dialog.getById(a);if(!o){window.MPFcreateSelectorDialog({formId:i,selectorId:a,enableSearch:!!n,params:e.mentionParams[i]});o=BX.UI.EntitySelector.Dialog.getById(a)}if(!o){return}o.deselectAll();o.search("");o.show();var s={};if(BX.Type.isDomNode(n)){o.focusSearch();o.popup.setBindElement(n);s.position="top"}else if(BX.type.isNotEmptyObject(r)){r.top-=5;o.popup.setBindElement(r)}o.popup.adjustPosition(s)}));window.onKeyDownHandler=function(e,t,r){var a=e.keyCode;if(!window["BXfpdStopMent"+r]){return true}var o=window.MPFgetSelectorId("bx-mention-"+r+"-id");if(a===t.KEY_CODES["backspace"]&&i.node){var s=BX.util.trim(t.util.GetTextContent(i.node));if(s==="+"||s==="@"||i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}else if(i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}}if(BX.util.in_array(a,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(a,[50,43,61])||e.altKey&&BX.util.in_array(a,[76])||e.altKey&&e.ctrlKey&&BX.util.in_array(a,[81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[71,81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[50])&&e.key==="@"||BX.Type.isFunction(e.getModifierState)&&!!e.getModifierState("AltGraph")&&BX.util.in_array(a,[81,50,48])&&!BX.Type.isUndefined(e.key)&&e.key==="@"||BX.util.in_array(a,[192])&&e.key==="@"){setTimeout((function(){var e=t.selection.GetRange();var a=t.GetIframeDoc();var s=e?e.endContainer.textContent:"";var l=s?s.slice(e.endOffset-1,e.endOffset):"";var d=s?s.slice(e.endOffset-2,e.endOffset-1):"";if((l=="@"||l=="+")&&(!d||BX.util.in_array(d,["+","@",",","("])||d.length==1&&BX.util.trim(d)==="")){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=true;i.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);i.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},a);t.selection.Surround(i.node,e);e.setStart(i.node,1);e.setEnd(i.node,1);t.selection.SetSelection(e);if(BX.Type.isStringFilled(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:r,bindPosition:n(i.node,t)}])}}}),10)}if(i.listen){var l=null;var d=BX.Type.isStringFilled(o)?BX.UI.EntitySelector.Dialog.getById(o):null;if(d&&d.getActiveTab()){l=d.getActiveTab().getId()}var c=null;switch(a){case t.KEY_CODES.enter:c="Enter";break;case 9:c="Tab";break;case t.KEY_CODES.up:c="ArrowUp";break;case t.KEY_CODES.down:c="ArrowDown";break;case t.KEY_CODES.left:if(l==="departments"){c="ArrowLeft"}break;case t.KEY_CODES.right:if(l==="departments"){c="ArrowRight"}break}if(c){var u=new KeyboardEvent("keydown",{key:c,keyCode:a,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(u)){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}}if(!i.listen&&i.listenFlag&&a===t.KEY_CODES["enter"]){var f=t.selection.GetRange();if(f.collapsed){var p=f.endContainer;var h=t.GetIframeDoc();if(p){if(p.className!=="bxhtmled-metion"){p=BX.findParent(p,(function(e){return e.className=="bxhtmled-metion"}),h.body)}if(p&&p.className=="bxhtmled-metion"){t.selection.SetAfter(p)}}}}};window.onKeyUpHandler=function(e,t,n){var r=e.keyCode;var a;var o;if(!window["BXfpdStopMent"+n]){return true}if(i.listen===true){if(r==t.KEY_CODES.escape){var s=new KeyboardEvent("keyup",{key:"Escape",keyCode:r,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(s)){e.stopPropagation();e.preventDefault()}window["BXfpdStopMent"+n]()}else if(r!==t.KEY_CODES.enter&&r!==t.KEY_CODES.left&&r!==t.KEY_CODES.right&&r!==t.KEY_CODES.up&&r!==t.KEY_CODES.down){if(BX(i.node)){o=BX.util.trim(t.util.GetTextContent(i.node));var l=o;o=o.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(o);var d=window.MPFgetSelectorId("bx-mention-"+n+"-id");var c=BX.UI.EntitySelector.Dialog.getById(d);if(BX.Type.isStringFilled(o)&&c){c.search(o)}if(i.leaveContent&&i._lastText){if(l===""){window["BXfpdStopMent"+n]()}else if(l!==""&&o===""){i.bSearch=false;if(c){c.search("")}}}i.lastText=o;i._lastText=l}else{window["BXfpdStopMent"+n]()}}}else{if(!e.shiftKey&&(r===t.KEY_CODES["space"]||r===t.KEY_CODES["escape"]||r===188||r===190)){a=t.selection.GetRange();if(a.collapsed){var u=a.endContainer;var f=t.GetIframeDoc();if(u){if(u.className!=="bxhtmled-metion"){u=BX.findParent(u,(function(e){return e.className=="bxhtmled-metion"}),f.body)}if(u&&u.className=="bxhtmled-metion"){o=t.util.GetTextContent(u);var p=o.match(/[\s\.\,]$/);if(p||r===t.KEY_CODES["escape"]){u.innerHTML=o.replace(/[\s\.\,]$/,"");var h=BX.create("SPAN",{html:p||t.INVISIBLE_SPACE},f);t.util.InsertAfter(h,u);t.selection.SetAfter(h)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,n){var r=e.keyCode;if(i.listen&&r==t.KEY_CODES.enter){t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,n){var r=null;var a="";var o=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(i.listen===true){if(o==27){window["BXfpdStopMent"+n]()}else if(o!==13){a=t.textareaView.GetValue(false);r=t.textareaView.GetCursorPosition();var l="";var d="";if(a.indexOf("+")!==-1||a.indexOf("@")!==-1){var c=a.substr(0,r);var u=Math.max(c.lastIndexOf("+"),c.lastIndexOf("@"));if(u>=0){l=c.substr(u);d=l;l=l.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(l);var f=BX.UI.EntitySelector.Dialog.getById(s);if(BX.Type.isStringFilled(l)&&f){f.search(l)}}}if(i._lastText){if(d===""){window["BXfpdStopMent"+n]()}else if(d!==""&&l===""){i.bSearch=false;if(f){f.search("")}}}i.lastText=l;i._lastText=d}}else{if(o==16){var p=this;this.shiftPressed=true;if(this.shiftTimeout){this.shiftTimeout=clearTimeout(this.shiftTimeout)}this.shiftTimeout=setTimeout((function(){p.shiftPressed=false}),100)}if(o==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(o,[187,50,107,43,61])){r=t.textareaView.element.selectionStart;if(r>0){a=t.textareaView.element.value;var h=a.substr(r-1,1);if(h&&(h==="+"||h==="@")){i.listen=true;i.listenFlag=true;i.text="";i.textarea=true;i.bSearch=false;i.mode="plus";BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:n,bindPosition:BX.pos(document.getElementById("bx-b-mention-"+n))}])}}}}};var n=function(e,t){var i=BX.pos(e);var n=BX.pos(t.dom.areaCont);var r=BX.GetWindowScrollPos(t.GetIframeDoc());var a=n.top+i.bottom-r.scrollTop+2;var o=n.left+i.right-r.scrollLeft;return{top:a,left:o}};window.BxInsertMention=function(e){var t=e.item;var r=e.type;var a=e.formID;var o=e.editorId;var s=e.bNeedComa;var l=LHEPostForm.getEditor(o);var d;if((r==="user"||r==="project"||r==="department")&&t&&t.entityId>0&&l){if(l.GetViewMode()=="wysiwyg"){var c=l.GetIframeDoc();var u=l.selection.GetRange();var f=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},c);d=BX.create("SPAN",{html:s?",&nbsp;":"&nbsp;"},c);var p={tag:"postuser",params:{value:t.entityId}};switch(r){case"project":p.projectId=t.entityId;p.projectName=t.name;break;case"department":p.departmentId=t.entityId;p.departmentName=t.name;break;default:p.userId=t.entityId;p.userName=t.name}l.SetBxTag(f,p);if(BX(i.node)&&i.node.parentNode){l.util.ReplaceNode(i.node,f)}else{l.selection.InsertNode(f,u)}if(f&&f.parentNode){var h=BX.findParent(f,{className:"bxhtmled-metion"},c.body);if(h){l.util.InsertAfter(f,h)}}if(f&&f.parentNode){l.util.InsertAfter(d,f);l.selection.SetAfter(d)}}else if(l.GetViewMode()=="code"&&l.bbCode){l.textareaView.Focus();var b=l.textareaView.GetValue(false);var m=l.textareaView.GetCursorPosition();var v=b.substr(0,m);var g=Math.max(v.lastIndexOf("+"),v.lastIndexOf("@"));if(g>=0&&m>g){l.textareaView.SetValue(b.substr(0,g)+b.substr(m));l.textareaView.element.setSelectionRange(g,g)}var E="";switch(r){case"user":E="USER";break;case"project":E="PROJECT";break;case"department":E="DEPARTMENT";break;default:}l.textareaView.WrapWith(false,false,"["+E+"="+t.entityId+"]"+t.name+"[/"+E+"]"+(s?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t,r])}if(window["BXfpdStopMent"+a]){window["BXfpdStopMent"+a]()}i["text"]="";if(l.GetViewMode()=="wysiwyg"){l.Focus();l.selection.SetAfter(d)}var y=LHEPostForm.getHandler(o);if(y&&y.formEntityType==="task"&&y.editorParams.tasksLimitExceeded){BX.Main.PostFormTasksLimit.showPopup({bindPosition:n(i.node,l)})}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFcreateSelectorDialog=function(e){new BX.UI.EntitySelector.Dialog({targetNode:"mpf-mention-"+e.formId,id:e.selectorId,context:"MENTION",multiple:false,enableSearch:e.enableSearch,clearSearchOnSelect:true,hideOnSelect:true,hideByEsc:true,entities:e.params.entities,height:300,width:400,compactView:true,events:{onShow:function(){window.BXfpdOnDialogOpen()},onHide:function(){window.BXfpdOnDialogClose({editorId:e.params.editorId})},"Item:onSelect":function(t){var i=t.getData().item;if(i){window["BXfpdSelectCallbackMent"+e.formId]({item:{name:i.getTitle(),entityId:i.getId(),entityType:i.getEntityType()},entityType:i.getEntityId()})}}}})};window.MPFMentionInit=function(t,n){e.mentionParams[t]=n;if(n.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",(function(e){if(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.DEST_DATA)&&BX.type.isNotEmptyString(e.formId)&&e.formId==t&&BX.UI.EntitySelector){var i=JSON.parse(e.data.DEST_DATA);if(!Array.isArray(i)){return}var n=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(n)){return}n.preselectedItems=i;n.setPreselectedItems(i)}}));BX.addCustomEvent(window,"onMentionAdd",(function(e,t){var i=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(i)){return}var n="";if(t==="user"){if(e.isExtranet==="Y"){n="extranet"}else if(e.isEmail==="Y"){n="email"}else{n="employee"}}else if(t==="project"){if(e.isExtranet==="Y"){n="extranet"}}if(e.entityType!=="collaber"){i.addItem({avatar:e.avatar,customData:{email:BX.Type.isStringFilled(e.email)?e.email:""},entityId:t,entityType:n,id:e.entityId,title:e.name}).select()}}))}window["BXfpdSelectCallbackMent"+t]=function(e){window.BxInsertMention({item:e.item,type:e.entityType.toLowerCase(),formID:t,editorId:n.editorId,fireAddEvent:n.initDestination})};window["BXfpdStopMent"+t]=function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");var i=BX.UI.EntitySelector.Dialog.getById(e);if(i){i.hide()}};if(BX(t)){BX.addCustomEvent(BX(t),"OnUCFormAfterShow",(function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isArray(e.id)||!BX.Type.isStringFilled(e.id[0])){return}var t=new RegExp("EVENT_(\\d+)","i");if(!t.test(e.id[0])){return}}))}var r=LHEPostForm.getHandlerByFormId(t);if(r){r.exec()}BX.ready((function(){var e=BX("bx-b-mention-"+t);BX.bind(e,"click",(function(r){if(i.listen!==true){var a=LHEPostForm.getEditor(n.editorId);var o=a.GetIframeDoc();if(a.GetViewMode()=="wysiwyg"&&o){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";var s=a.selection.GetRange();if(BX(i.node)){BX.remove(BX(i.node))}a.InsertHtml('<span id="bx-mention-node">'+a.INVISIBLE_SPACE+"</span>",s);setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}]);i.node=o.getElementById("bx-mention-node");if(i.node){s.setStart(i.node,0);if(i.node.firstChild&&i.node.firstChild.nodeType==3&&i.node.firstChild.nodeValue.length>0){s.setEnd(i.node,1)}else{s.setEnd(i.node,0)}a.selection.SetSelection(s)}a.Focus()}),100)}else if(a.GetViewMode()=="code"){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}])}),100)}BX.onCustomEvent(e,"mentionClick")}}))}))};window.BXfpdOnDialogOpen=function(){i.listen=true;i.listenFlag=true};window.BXfpdOnDialogClose=function(e){i.listen=false;setTimeout((function(){i.listenFlag=false;if(!i.listen){var t=LHEPostForm.getEditor(e.editorId);if(t){t.Focus()}}}),100)};MPFEntitySelector=function(t){this.selector=null;this.inputNode=null;this.messages={};if(!BX.Type.isStringFilled(t.id)){return null}if(e.selector[t.id]){return e.selector[t.id]}e.selector[t.id]=this.init(t)};MPFEntitySelector.prototype.init=function(e){if(!BX.type.isPlainObject(e)){e={}}if(!BX.Type.isStringFilled(e.id)||!BX.Type.isStringFilled(e.tagNodeId)||!BX(e.tagNodeId)){return null}if(BX.Type.isStringFilled(e.inputNodeId)&&BX(e.inputNodeId)){this.inputNode=BX(e.inputNodeId)}if(BX.type.isNotEmptyObject(e.messages)){this.messages=e.messages}this.selector=new BX.UI.EntitySelector.TagSelector({id:e.id,dialogOptions:{id:e.id,context:BX.Type.isStringFilled(e.context)?e.context:null,preselectedItems:BX.type.isArray(e.preselectedItems)?e.preselectedItems:[],events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{title:this.messages.allUsersTitle,allowView:BX.type.isBoolean(e.allowToAll)&&e.allowToAll}}},{id:"user",options:{collabers:BX.type.isBoolean(e.collabers)?e.collabers:true,emailUsers:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,inviteGuestLink:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,myEmailUsers:true,footerInviteIntranetOnly:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]},"!type":["collab"]}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_LINK_2")});this.selector.renderTo(document.getElementById(e.tagNodeId));return this.selector};MPFEntitySelector.prototype.recalcValue=function(e){if(!BX.type.isArray(e)||!this.inputNode){return}var t=[];e.forEach((function(e){t.push([e.entityId,e.id])}));this.inputNode.value=JSON.stringify(t)};window.MPFEntitySelector=MPFEntitySelector})()})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1745563968814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?174556400713285";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,s){"use strict";const o=new Map;var a=babelHelpers.classPrivateFieldLooseKey("container");var n=babelHelpers.classPrivateFieldLooseKey("eventObject");var l=babelHelpers.classPrivateFieldLooseKey("uploader");var r=babelHelpers.classPrivateFieldLooseKey("id");var d=babelHelpers.classPrivateFieldLooseKey("onProgressHandler");var c=babelHelpers.classPrivateFieldLooseKey("handleFileComplete");var u=babelHelpers.classPrivateFieldLooseKey("handleFileAdd");var p=babelHelpers.classPrivateFieldLooseKey("handleFileProgress");var h=babelHelpers.classPrivateFieldLooseKey("handleFileError");var f=babelHelpers.classPrivateFieldLooseKey("handleMyDriveClick");var b=babelHelpers.classPrivateFieldLooseKey("handleCloudDriveClick");var v=babelHelpers.classPrivateFieldLooseKey("createFileInfo");var m=babelHelpers.classPrivateFieldLooseKey("createFileResult");class g{constructor(e){Object.defineProperty(this,m,{value:I});Object.defineProperty(this,v,{value:y});Object.defineProperty(this,b,{value:w});Object.defineProperty(this,f,{value:k});Object.defineProperty(this,h,{value:L});Object.defineProperty(this,p,{value:P});Object.defineProperty(this,u,{value:F});Object.defineProperty(this,c,{value:D});Object.defineProperty(this,a,{writable:true,value:null});Object.defineProperty(this,n,{writable:true,value:null});Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:`dialog-${t.Text.getRandom(5)}`});Object.defineProperty(this,d,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e.container;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.eventObject;let o=null;const g=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-fileUploader");if(g){if(g.tagName.toLowerCase()==="input"){o=g.parentNode;g.disabled=true}else{o=g}}const _=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-selector-link");if(_){t.Event.bind(_.parentNode,"click",babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this))}const S=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-selector-link-cloud");if(S){t.Event.bind(S.parentNode,"click",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}const U={_onUploadProgress:null};s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"DiskDLoadFormControllerInit",new s.BaseEvent({compatData:[U]}));if(t.Type.isFunction(U._onUploadProgress)){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=U._onUploadProgress}babelHelpers.classPrivateFieldLooseBase(this,l)[l]=new i.Uploader({id:e.id,controller:"disk.uf.integration.diskUploaderController",browseElement:o,multiple:true,maxFileSize:null,treatOversizeImageAsFile:true,ignoreUnknownImageTypes:true,hiddenFieldName:e.hiddenFieldName,hiddenFieldsContainer:babelHelpers.classPrivateFieldLooseBase(this,a)[a],events:{[i.UploaderEvent.FILE_ADD]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this),[i.UploaderEvent.FILE_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this),[i.UploaderEvent.FILE_ERROR]:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this),[i.UploaderEvent.FILE_UPLOAD_PROGRESS]:babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this)}})}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}}function D(e){const t=e.getData().file;s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"OnFileUploadSuccess",new s.BaseEvent({compatData:[babelHelpers.classPrivateFieldLooseBase(this,m)[m](t),this,t.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,v)[v](t)]}))}function F(e){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]!==null){const t=e.getData().file;babelHelpers.classPrivateFieldLooseBase(this,d)[d](babelHelpers.classPrivateFieldLooseBase(this,v)[v](t),5)}}function P(e){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]!==null){const t=e.getData().file;const i=e.getData().progress;babelHelpers.classPrivateFieldLooseBase(this,d)[d](babelHelpers.classPrivateFieldLooseBase(this,v)[v](t),i)}}function L(e){const t=e.getData().file;console.log("UploadMenu Error:",t.getError());s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"OnFileUploadFailed",new s.BaseEvent({compatData:[this,t.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,v)[v](t)]}))}function k(){t.Runtime.loadExtension("disk.uploader.user-field-widget").then((e=>{const{openDiskFileDialog:t}=e;t({dialogId:`file-${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}`,uploader:babelHelpers.classPrivateFieldLooseBase(this,l)[l]})}))}function w(){t.Runtime.loadExtension("disk.uploader.user-field-widget").then((e=>{const{openCloudFileDialog:t}=e;t({dialogId:`cloud-${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}`,uploader:babelHelpers.classPrivateFieldLooseBase(this,l)[l]})}))}function y(e){const t=e.getState();t.size=e.getSizeFormatted();t.sizeInt=e.getSize();t.ext=e.getExtension();t.nameWithoutExt=i.Helpers.getFilenameWithoutExtension(e.getName());return t}function I(e){return{element_id:e.getServerFileId(),element_name:e.getName(),element_url:e.getPreviewUrl(),storage:e.getCustomData("storage")||"disk"}}const _=e=>{const t=document.getElementById(`diskuf-selectdialog-${e["UID"]}`);if(!t){return null}if(o.has(e["UID"])){return o.get(e["UID"])}const i=new g({id:`disk-uf-file-${e["UID"]}`,container:t,eventObject:t.parentNode,hiddenFieldName:e.controlName});o.set(e["UID"],i);return i};e.add=_})(this.BX.Disk.UF=this.BX.Disk.UF||{},BX,BX.UI.Uploader,BX.Event);(function(e){if(e.BX.Disk&&e.BX.Disk.UFShowController)return;var t=e.BX;var i=0;var s={};var o=function(e){return t.Disk.ajaxPromise({url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var a=function(e){if(!t(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;t.unbindAll(e);t.unbindAll(this.node);t.show(this.node);t.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};a.prototype={turnOn:function(){this.timeout=setTimeout(t.delegate((function(){this.show()}),this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(t["UploaderUtils"]){var i=t.UploaderUtils.scaleImage(e,{width:parseInt(t.message("DISK_THUMB_WIDTH")),height:parseInt(t.message("DISK_THUMB_HEIGHT"))});e=i.destin}this.popup=new t.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:t.proxy((function(){this.popup=null}),this)},content:t.create("DIV",{props:e,children:[t.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};t.addCustomEvent("onDiskPreviewIsReady",(function(e){new a(e)}));t.Disk.UF.runImport=function(e){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});t.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:t.delegate((function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}}),this),onProgress:t.delegate((function(e){}),this)}).start()};t.Disk.UF.disableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.enableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};t.Disk.UFShowController=function(e){if(!t.type.isPlainObject(e)){e={}}this.entityType=t.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=t.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=t.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var i=this.container.querySelector(".disk-uf-file-switch-control");if(i){t.Event.bind(i,"click",t.Disk.UFShowController.onToggleView)}}if(t.type.isNotEmptyString(e.nodeId)){s[e.nodeId]=this}};t.Disk.UFShowController.getInstance=function(e){return t.type.isNotEmptyString(e)&&s[e]?s[e]:null};t.Disk.UFShowController.onToggleView=function(e){var i=e.currentTarget.closest(".diskuf-files-toggle-container"),s=e.currentTarget.getAttribute("data-bx-view-type");if(!t.type.isDomNode(i)||!t.type.isNotEmptyString(i.id)){return}var o=t.Disk.UFShowController.getInstance(i.id);if(o){o.toggleViewType({viewType:s})}e.preventDefault()};t.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();t.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();t.clean(this.container);t.html(this.container,e.data.html)}.bind(this),(function(e){this.hideToggleViewLoader()}))};t.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new t.Loader({target:this.container});this.loader.show()};t.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskOpenMenuCreateService=function(e){var i=[t.Disk.UF.getDocumentHandler("onlyoffice")?{text:t.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("onlyoffice");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,t.Disk.Document.Local.Instance.isEnabled()?{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("l");t.adjust(e,{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:t.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("gdrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("gdrive").name})}},{text:t.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("office365");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("office365").name})}},{text:t.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("onedrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onedrive").name})}}];t.PopupMenu.show("disk_open_menu_with_services",t(e),i,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,i){var s=[];for(var o in i){if(!i.hasOwnProperty(o))continue;s.push({text:i[o].name,code:i[o].id,href:"#",onclick:function(e,i){var s=i.layout.item;t.addClass(s,"diskuf-selector-link-cloud");s.setAttribute("data-bx-doc-handler",i.code);t.onCustomEvent("onManualChooseCloudImport",[{target:s}]);t.removeClass(s,"diskuf-selector-link-cloud");s.removeAttribute("data-bx-doc-handler");t.PopupMenu.destroy("disk_open_menu_with_import_services");return t.PreventDefault(e)}})}var a=new t.CViewer({});a.openMenu("disk_open_menu_with_import_services",t(e),s,{offsetTop:0,offsetLeft:25});return t.PreventDefault()};e.DiskActionFileMenu=function(e,s,o){i++;t.PopupMenu.show("bx-viewer-wd-popup"+i+"_"+e,t(s),o,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,i){var s=t(i);if(s){t.fireEvent(s,"click")}return false}})(window);
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?174556396763408*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1745563967575*/
; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?17455640712527*/
; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17455640895071*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/script.min.js?174556403021613*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/utils.min.js?1745564030734*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/stresslevel.min.js?17455640307949*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/grats.min.js?17455640307585*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/profilepost.min.js?17455640306180*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags.min.js?174556403014879*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/tags-users-popup.min.js?17455640305204*/
; /* /bitrix/components/bitrix/intranet.user.profile/templates/.default/js/form-entity.min.js?174556403017240*/
; /* /bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17455640301655*/
; /* /bitrix/components/bitrix/intranet.apps/templates/.default/script.min.js?17455640301894*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?174556396773565*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1745563968814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?174556400713285*/

//# sourceMappingURL=page_8391bf049f3b4b0de2d613ddee9304c9.map.js